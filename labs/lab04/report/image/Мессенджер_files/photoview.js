(()=>{"use strict";var __webpack_modules__={58819:(_,e,o)=>{o.d(e,{default:()=>t});const t=(0,o(63192).makeIcon)("Icon28ServicesOutline","services_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="services_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M9.116 15c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419H6.884c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26C3.108 22.739 3 22.18 3 21.116v-2.232c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26.582-.311 1.14-.419 2.205-.419h2.232Zm12 0c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419h-2.232c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26-.311-.582-.419-1.14-.419-2.205v-2.232c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26.582-.311 1.14-.419 2.205-.419h2.232Zm-12 2H6.884c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44c-.135.253-.183.499-.183 1.262v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262v-2.232c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44c-.253-.135-.499-.183-1.262-.183Zm12 0h-2.232c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44c-.135.253-.183.499-.183 1.262v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262v-2.232c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44c-.253-.135-.499-.183-1.262-.183ZM20.89 2.413c.631.19 1.102.51 1.856 1.263l1.577 1.577c.754.754 1.072 1.225 1.263 1.856a3.044 3.044 0 0 1 0 1.782c-.19.631-.51 1.102-1.263 1.856l-1.577 1.577c-.754.754-1.225 1.072-1.856 1.263a3.044 3.044 0 0 1-1.782 0c-.631-.19-1.102-.51-1.856-1.263l-1.577-1.577c-.754-.754-1.072-1.225-1.263-1.856a3.044 3.044 0 0 1 0-1.782c.19-.631.51-1.102 1.263-1.856l1.577-1.577c.754-.754 1.225-1.072 1.856-1.263a3.044 3.044 0 0 1 1.782 0ZM9.116 3c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419H6.884c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26C3.108 10.739 3 10.18 3 9.116V6.884c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26C5.261 3.108 5.82 3 6.884 3h2.232Zm10.573 1.327c-.274.082-.482.223-1.021.763L17.09 6.668c-.54.54-.68.747-.763 1.02a1.045 1.045 0 0 0 0 .623c.082.274.223.482.763 1.021l1.578 1.578c.54.54.747.68 1.02.763.21.064.415.064.623 0 .274-.082.482-.223 1.021-.763l1.578-1.578c.54-.54.68-.747.763-1.02a1.045 1.045 0 0 0 0-.623c-.082-.274-.223-.482-.763-1.021L21.332 5.09c-.54-.54-.747-.68-1.02-.763a1.045 1.045 0 0 0-.623 0ZM9.116 5H6.884c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44C5.047 5.876 5 6.122 5 6.885v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262V6.884c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44C10.124 5.047 9.878 5 9.115 5Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0)},95486:(_,e,o)=>{function t(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0a4 4 0 0 1 4 4h1.4c.55 0 .76.06.96.17.2.1.36.27.47.47.11.2.17.4.17.96v5.23c0 1.45-.15 1.98-.43 2.5-.29.54-.7.95-1.23 1.24-.53.28-1.06.43-2.5.43H5.16c-1.45 0-1.98-.15-2.5-.43-.54-.29-.95-.7-1.24-1.23-.28-.53-.43-1.06-.43-2.5V5.6c0-.55.06-.76.17-.96.1-.2.27-.36.47-.47.2-.11.4-.17.96-.17H4a4 4 0 0 1 4-4ZM4.77 5.5h-.04a.82.82 0 0 0-.4.09.6.6 0 0 0-.24.24.82.82 0 0 0-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 0 0 .24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 0 0-.09-.4.6.6 0 0 0-.24-.24.82.82 0 0 0-.4-.09Zm6.5 0h-.04a.82.82 0 0 0-.4.09.6.6 0 0 0-.24.24.82.82 0 0 0-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 0 0 .24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 0 0-.09-.4.6.6 0 0 0-.24-.24.82.82 0 0 0-.4-.09ZM8 1.5A2.5 2.5 0 0 0 5.5 4h5A2.5 2.5 0 0 0 8 1.5Z" fill="currentColor"/></svg>',name:"market_16"}}o.d(e,{getIcon16Market:()=>t})},29449:(_,e,o)=>{function t(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="user_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_outline_20__Icons-20/user_outline_20"><g id="user_outline_20__user_outline_20"><path opacity=".1" d="M0 0h20v20H0z"/><path d="M12.5 5a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0ZM14 5a4 4 0 1 1-8 0 4 4 0 0 1 8 0ZM4 15.5c0 .72.36 1 1 1h10c.64 0 1-.28 1-1 0-2.33-2.57-3.5-6-3.5s-6 1.17-6 3.5Zm-1.5 0c0-3.48 3.33-5 7.5-5s7.5 1.52 7.5 5c0 1.63-1.1 2.5-2.5 2.5H5c-1.4 0-2.5-.87-2.5-2.5Z" id="user_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"user_outline_20"}}o.d(e,{getIcon20UserOutline:()=>t})},80842:(_,e,o)=>{o.d(e,{GROUPS_ADMIN_LEVEL_USER:()=>t,GROUPS_ADMIN_LEVEL_ADMINISTRATOR:()=>i,USER_META_FIELD_IS_DONUT_PAID_MEMBER:()=>r,GROUPS_CLASS_EVENT:()=>a});var t=0,i=3,r="is_donut_paid_member",a=2},28208:(_,e,o)=>{o.d(e,{default:()=>n});var t=o(15544),i=o(86067),r=o(95724),a=o(49535),s=o(3834),l={init:function(_,e){cur.lSTL&&(0,t.re)(cur.lSTL);var o=(e=e||{}).parent=e.parent||boxLayerWrap;(0,r.extend)(cur,{lSTLWrap:o,lSTL:o.appendChild((0,t.ce)("div",{id:"layer_stl",innerHTML:`<div id="layer_stl_bg" class="fixed"></div><div id="layer_stl_cl"></div><nobr id="layer_stl_text" class="fixed">${(0,i.getLang)("global_to_top")}</nobr>`,el:_.bodyNode,onclick:a.cancelEvent,onmousedown:l.lSTLDown,sc:l.onScroll})),lSTLText:(0,t.ge)("layer_stl_text",o),lSTLShown:0,lSTLWas:0,lSTLWasSet:0,lSTLOpts:e}),_&&_.setOptions({onShow:l.show,onHide:l.hide}),_&&_.scrollInited||((0,a.addEvent)(o,"scroll",l.onScroll),_&&(_.scrollInited=!0)),onBodyResize(),l.onScroll()},hide:function(){var _=cur.lSTLOpts;_&&_.parent&&((0,a.removeEvent)(_.parent,"scroll",l.onScroll),(0,t.hide)(cur.lSTL),cur.lSTLShown=0,_.onHide&&_.onHide())},show:function(){var _=cur.lSTLOpts;_&&_.parent&&((0,a.addEvent)(_.parent,"scroll",l.onScroll),setTimeout(l.onScroll,0),_.onShow&&_.onShow())},lSTLDown:function(_){if(_=_||window.event,!(0,a.checkEvent)(_)){var e=cur.lSTLWrap;if(!__afterFocus){var o=0,t=e.scrollTop;cur.lSTLWasSet&&cur.lSTLWas?(o=cur.lSTLWas,cur.lSTLWas=0):cur.lSTLWas=t,e.scrollTop=o}return(0,a.cancelEvent)(_)}},onScroll:function(){if(cur.lSTL){var _=cur.lSTLWrap.scrollTop,e=200,o=cur.lSTLWas||_>e,r=0;if(cur.lSTL.style.marginTop=Math.min(_,boxLayer.scrollHeight-cur.lSTL.scrollHeight-1)+"px",vk.staticheader){var a=(0,t.getSize)("page_header_wrap")[1];cur.lSTLText.style.marginTop=Math.max(-Math.min((0,s.scrollGetY)(),bodyNode.clientHeight-(window.lastWindowHeight||0)),-a)+"px"}o?(1!==cur.lSTLShown&&((0,t.show)(cur.lSTL),cur.lSTLShown=1),cur.lSTLWas&&_>500&&(cur.lSTLWas=0),_>e?(r=(_-e)/e,cur.lSTLWasSet&&(cur.lSTLWasSet=0,(0,t.val)((0,t.domLC)(cur.lSTL),(0,i.getLang)("global_to_top")),(0,t.removeClass)((0,t.domLC)(cur.lSTL),"down"))):(r=(e-_)/e,cur.lSTLWas&&(cur.lSTLWasSet||(cur.lSTLWasSet=1,(0,t.val)((0,t.domLC)(cur.lSTL),""),(0,t.addClass)((0,t.domLC)(cur.lSTL),"down"))))):0!==cur.lSTLShown&&((0,t.hide)(cur.lSTL),cur.lSTLShown=0),(0,t.setStyle)(cur.lSTL,{opacity:Math.min(Math.max(r,0),1)})}}};const n=l},41086:(_,e,o)=>{o.d(e,{default:()=>u});o(59357),o(50110),o(98837),o(76142),o(66108),o(96253);var t=o(91789),i=o(26271),r=o(86067),a=o(40906),s=o(95724),l=o(49535),n=o(15544),d=o(18149),p="friends_dropdown__list_item",c="friends_dropdown__list_item system_message",v="add_term_tag";const u=class{constructor(_){void 0===_&&(_={}),this.options=(0,s.extend)({onUserSelected:()=>!1,onEscapePress:()=>!1,onKeyUp:()=>!1},_),cur.pvServerFriendsIndex&&cur.pvServerFriendsIds||(cur.pvServerFriendsIndex=new d.vkIndexer([],(_=>{_[0];return _[1]})),cur.pvServerFriendsIds=[]),this.topUsers=new d.vkIndexer([],(_=>{_[0];return _[1]})),this.isInited=!1,this.lastSeachTerm="",this.hoverItem=null,this.keyboardNavigation=!1,this.freeTerm=null,this._handleInputKeyEvent=this._handleInputKeyEvent.bind(this),this._handleMouseMoveOnce=this._handleMouseMoveOnce.bind(this)}init(){this.isInited&&this.friendsdListNode||((0,t.getIndexedFriends)()||this.fetchFriendsList(),this.isInited=!0,this._initElement(),this._initScroll());return this.friendsdListNode}update(_){void 0===_&&(_=[]),this._resetScroll(),this.setTopUsers(_),this._hideDropdown()}setTopUsers(_){this.topUsers.list.forEach((_=>{this.topUsers.remove(_)})),_.forEach((_=>{this.topUsers.add(_)})),this.topUsers.list=_}_hideDropdown(){(0,n.removeClass)(this.friendsdListNode,"show-dropdown")}_getItemHtml(_,e,o,t){return`<div class="${p}" data-id="${_}" data-name="${e}">\n      <img src="${t}" alt="${e}" class="friends_dropdown__list_image">\n      <div class="friends_dropdown__list_info">\n        <div class="friends_dropdown__list_name">${e} ${_===vk.id.toString()?`(${(0,r.getLang)("photos_tags_user_you")})`:""}</div>\n        <div class="friends_dropdown__list_label">${o}</div>\n      </div>\n    </div>`}_initElement(){this.friendsdListNode=(0,n.ce)("div",{className:"friends_dropdown__list"}),this.listInput=(0,n.ce)("input",{className:"friends_dropdown__list_input",placeholder:`${(0,a.replaceEntities)((0,r.getLang)("photos_tags_dropdown_placeholder"))}`}),this.listDropdown=(0,n.ce)("div",{className:"friends_dropdown__list_dropdown"}),this.listContent=(0,n.ce)("div",{className:"friends_dropdown__list_content"}),this.listDropdown.appendChild(this.listContent),this.friendsdListNode.appendChild(this.listInput),this.friendsdListNode.appendChild(this.listDropdown),this._setListHTML(`<div class="${c}">${(0,r.getLang)("box_loading")}</div>`),(0,l.addEvent)(this.friendsdListNode,"click",cancelEvent),(0,l.addEvent)(this.listDropdown,"click",(_=>{this._handleItemSelected(_.target)})),(0,l.addEvent)(this.listDropdown,"mouseover",(_=>{if(!this.keyboardNavigation){var e=(0,n.hasClass)(_.target,p)?_.target:(0,n.gpeByClass)(p,_.target);this._setHoverItem(e)}})),(0,l.addEvent)(this.listInput,"keyup keydown keypress",this._handleInputKeyEvent),(0,l.addEvent)(this.listInput,"click",(()=>{this.show()}))}_handleItemSelected(_){var e=(0,n.hasClass)(_,p)?_:(0,n.gpeByClass)(p,_),o=(0,n.domData)(e,"name"),t=(0,n.domData)(e,"id");t&&this.options.onUserSelected(t,o),(0,n.hasClass)(_,v)&&this.freeTerm&&this.options.onUserSelected(0,this.freeTerm)}_getItemEleById(_){return(0,n.domQuery1)(`[data-id="${_}"]`,this.listDropdown)}_setListHTML(_){(this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent).innerHTML=_}_setHoverItem(_,e){void 0===e&&(e=!1);var o=(0,n.domData)(_,"id");if(o&&o!==this.hoverItem){if(this.hoverItem){var t=this._getItemEleById(this.hoverItem);(0,n.removeClass)(t,"hover")}this.hoverItem=o,(0,n.addClass)(_,"hover"),e&&this.scroll&&this.scroll&&this.scroll.scrollIntoView(_)}}show(_){(0,n.hasClass)(this.friendsdListNode,"show-dropdown")||(this._renderFriendsList(this.lastSeachTerm,_),(0,n.addClass)(this.friendsdListNode,"show-dropdown"),this._resetScroll(),this.scroll&&this.scroll.update())}_renderFriendsList(_,e){if(void 0===e&&(e=!1),_=(0,s.trim)(_),(0,t.getIndexedFriends)()){var o=this._doSearch(_);this._renderFriendsDropdown(_,o,e)}else this._setListHTML(`<div class="${c}">${(0,r.getLang)("box_loading")}</div>`);clearTimeout(this.requestTimeout),_.length>0&&_!==this.lastSeachTerm&&(this.requestTimeout=setTimeout((()=>{this.fetchFriendsWithQuery(_)}),300))}_initScroll(){i.browser.safari||window.stManager.add(["ui_common.css","ui_common.js"],(()=>{this.scroll=new window.uiScroll(this.listContent,{global:!0})}))}_handleInputKeyEvent(_){if("keyup"===_.type){switch(_.keyCode){case l.KEY.ENTER:this._handleEnter();break;case l.KEY.ESC:return this.options.onEscapePress(),void this._hideDropdown();default:var e=_&&_.target.value;e!==this.lastSeachTerm&&(this._renderFriendsList(e),this.lastSeachTerm=e,this.hoverItem=null)}this.options.onKeyUp(),this.show()}else switch(_.keyCode){case l.KEY.UP:case l.KEY.DOWN:this._handleArrows(_.keyCode===l.KEY.DOWN)}}_handleArrows(_){var e,o;if(void 0===_&&(_=!0),this.keyboardNavigation||(this.keyboardNavigation=!0,(0,l.addEvent)(this.listDropdown,"mousemove",this._handleMouseMoveOnce)),this.hoverItem)e=this._getItemEleById(this.hoverItem),o=_?(0,n.domNS)(e):(0,n.domPS)(e);else{var t=this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent;o=(0,n.domFC)(t)}o&&this._setHoverItem(o,!0)}_handleMouseMoveOnce(){this.keyboardNavigation=!1,(0,l.removeEvent)(this.listDropdown,"mousemove",this._handleMouseMoveOnce)}_handleEnter(){if(this.hoverItem){var _=this._getItemEleById(this.hoverItem);this._handleItemSelected(_)}}_doSearch(_){var e;void 0===_&&(_="");var o,i,r,a=(0,t.getPhotoData)("tagged"),s=(0,t.getIndexedFriends)();_.length>0?(o=this.topUsers.search(_),i=s.search(_),r=cur.pvServerFriendsIndex.search(_)):(o=this.topUsers.list,i=s.list,r=cur.pvServerFriendsIndex.list),e=o.concat(i,r);var l=[];return(e=e.filter((_=>{var e=_[0],o=l.indexOf(e)<0&&(!a||!a[e]);return l.push(e),o}))).length>20&&(e=e.slice(0,20)),e}_renderFriendsDropdown(_,e,o){void 0===o&&(o=!1);var t="";if(e.forEach((_=>{var e=_[0],o=_[1],i=_[2],r=_[3],a=`id${e}`;t+=this._getItemHtml(e,o,i,r,a)})),!t&&o){this.freeTerm=_,_=(0,a.clean)(_);var i=(0,r.getLang)("photos_tags_not_found_tag_text").replace("{tagName}",`<span class="add_term_tag">${_}</span>`);t=`<div class="${c}">${i}</div>`,this._setListHTML(t)}else t&&(this._setListHTML(t),this.freeTerm=null,this._resetScroll());this.hoverItem=null}focus(){this.listInput.focus()}reset(){this.listInput.value="",this.lastSeachTerm="",this.hoverItem=null,this._resetScroll()}_resetScroll(){this.scroll?this.scroll.scrollTop():this.listContent.scrollTop=0}fetchFriendsList(){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags"},{onDone:_=>{(0,t.setIndexedFriends)(_,(()=>{this._renderFriendsList(this.lastSeachTerm)}))}})}fetchFriendsWithQuery(_){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags",str:_,photo:(0,t.getPhotoData)("id")},{onDone:e=>{this._handleFetchFriends(_,e)}})}_handleFetchFriends(_,e){if(void 0===e&&(e=[]),this.lastSeachTerm===_){var o,i=0,r=(0,t.getPhotoData)("tagged");(o=r?e.filter((_=>{var e=_[0];return!r[e]})):e).forEach((_=>{var e=_[0];cur.pvServerFriendsIds.indexOf(e)<0&&(cur.pvServerFriendsIds.push(e),cur.pvServerFriendsIndex.add(_),i++)})),(i>0||0===o.length)&&this._renderFriendsList(_,!0)}}}},23971:(_,e,o)=>{o.d(e,{FullscreenPV:()=>n});o(21466);var t=o(15544),i=o(86067),r=o(40906),a=o(49535),s=o(95724),l=o(76567),n={init(){if(cur.pvCanvas&&!cur.pvFSControls){var _=(0,r.positive)((0,l.getCookie)("remixfsss")),e=Math.min((0,r.positive)((0,l.getCookie)("remixfsdt"))||5,15);cur.pvFSControls=cur.pvCanvas.appendChild((0,t.ce)("div",{id:"pv_fs_controls",innerHTML:`\n<div id="pv_fs_topright" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_num"></div>\n      </td>\n      <td>\n        <div id="pv_fs_close" onclick="Photoview.fullscreenStop()">\n          <div id="pv_fs_close_btn"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_bottomleft" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_slide_check" onclick="FullscreenPV.startSlide()">\n          <div class="pv_fs_slide_check_icon"></div>${(0,i.getLang)("photos_slideshow")}\n        </div>\n      </td>\n      <td>\n        <div id="pv_fs_slide_speed_wrap">\n          <div id="pv_fs_slide_about"></div>\n          <div id="pv_fs_slide_speed" onmousedown="FullscreenPV.startSlideEdit(event)">\n            <div id="pv_fs_slide_speed_back"></div>\n            <div id="pv_fs_slide_speed_line">\n              <div id="pv_fs_slide_speed_ctrl"></div>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_left_wrap" class="pv_fs_controls">\n  <div id="pv_fs_left"></div>\n</div>\n\n<div id="pv_fs_right_wrap" class="pv_fs_controls">\n  <div id="pv_fs_right"></div>\n</div>\n`,onmouseover:n.over,onmouseout:n.out})),(0,s.extend)(cur,{pvFSInfo:(0,t.ge)("pv_fs_num"),pvFSSlideCheck:(0,t.ge)("pv_fs_slide_check"),pvFSSlideSpeedWrap:(0,t.ge)("pv_fs_slide_speed_wrap"),pvFSSlideLine:(0,t.ge)("pv_fs_slide_speed_line"),pvFSSlideAbout:(0,t.ge)("pv_fs_slide_about"),pvFSSlideCont:(0,t.ge)("pv_fs_bottomleft"),pvFSSlideDelta:e,pvFSLeft:(0,t.ge)("pv_fs_left"),pvFSRight:(0,t.ge)("pv_fs_right")}),cur.pvFSSlideLine.style.width=Math.floor(100*(e-1)/14)+"%",(0,t.val)(cur.pvFSSlideAbout,(0,i.getLang)("photos_seconds",e)),_&&(0,t.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),n.slide(),(0,a.addEvent)(cur.pvCanvas,"mousemove",n.showControls),(0,a.addEvent)(cur.pvCanvas,"mousedown",n.onClick),(0,a.addEvent)(cur.pvCanvas,"mouseup",n.endSlideEdit),n.showControls(!0),cur.pvPhoto.blur(),n.updateInfo()}},over(_){var e=_||window.event,o=e.target||e.srcElement||document;cur.pvFSOver=!o.id.match(/^pv_fs_(left|right)(_wrap)?$/)},out(){cur.pvFSOver=!1},onClick:_=>(__afterFocus||_&&(2==_.button||3==_.which)||(0,t.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSLeftShown?Photoview.show(cur.pvListId,cur.pvIndex-1):cur.pvFSRightShown&&Photoview.show(cur.pvListId,cur.pvIndex+1)),!!_&&(0,a.cancelEvent)(_)),showControls(_){var e,o,i=cur.pvFSrX=_.pageX,r=cur.pvFSrY=_.pageY;cur.pvFSSlideEdit&&n.updateSlide(),void 0!==cur.pvFSX&&void 0!==cur.pvFSY&&Math.abs(i-cur.pvFSX)+Math.abs(r-cur.pvFSY)<4||(cur.pvFSControlsTimer||((0,t.removeClass)(cur.pvCanvas,"pv_fs_nocursor"),clearTimeout(cur.pvFSHideControlsTimer),(0,t.show)(cur.pvFSControls),(0,t.addClass)(cur.pvFSControls,"pv_fs_shown")),clearTimeout(cur.pvFSControlsTimer),cur.pvFSOver||cur.pvFSSlideEdit||(cur.pvFSControlsTimer=setTimeout(n.hideControls,3e3)),(e=!cur.pvFSOver&&(i<100||cur.pvFSWidth&&i<(cur.pvScrWidth-cur.pvFSWidth)/2))&&!cur.pvFSLeftShown?(0,t.addClass)(cur.pvFSLeft,"pv_fs_over"):!e&&cur.pvFSLeftShown&&(0,t.removeClass)(cur.pvFSLeft,"pv_fs_over"),cur.pvFSLeftShown=e,(o=!cur.pvFSOver&&!e)&&!cur.pvFSRightShown?(0,t.addClass)(cur.pvFSRight,"pv_fs_over"):!o&&cur.pvFSRightShown&&(0,t.removeClass)(cur.pvFSRight,"pv_fs_over"),cur.pvFSRightShown=o,cur.pvFSX=i,cur.pvFSY=r)},hideControls(){(0,t.addClass)(cur.pvCanvas,"pv_fs_nocursor"),(0,t.removeClass)(cur.pvFSControls,"pv_fs_shown"),clearTimeout(cur.pvFSHideControlsTimer),cur.pvFSHideControlsTimer=setTimeout(t.hide.pbind(cur.pvFSControls),300),cur.pvFSControlsTimer=!1},startSlide(){(0,t.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")?(clearTimeout(cur.pvFSTimer),(0,t.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),(0,l.setCookie)("remixfsss",0)):((0,t.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),n.slide(),(0,l.setCookie)("remixfsss",1),clearTimeout(cur.hideAboutTO),cur.hideAboutTO=setTimeout((function(){(0,t.removeClass)(cur.pvFSSlideAbout,"highlighted")}),3e3),(0,t.addClass)(cur.pvFSSlideAbout,"highlighted"))},updateSlide(){var _=Math.floor(15*Math.max(Math.min((vk.rtl?cur.pvFSrLeft+cur.pvFSrWidth-cur.pvFSrX:cur.pvFSrX-cur.pvFSrLeft)/cur.pvFSrWidth,.99),0))+1;cur.pvFSSlideDelta!=_&&((0,l.setCookie)("remixfsdt",cur.pvFSSlideDelta=_),cur.pvFSSlideLine.style.width=Math.floor(100*(_-1)/14)+"%",(0,t.val)(cur.pvFSSlideAbout,(0,i.getLang)("photos_seconds",_)))},startSlideEdit(_){if(cur.pvFSrX&&cur.pvFSrY)return(0,s.extend)(cur,{pvFSSlideEdit:!0,pvFSrLeft:(0,t.getXY)((0,t.domPN)(cur.pvFSSlideLine))[0],pvFSrWidth:(0,t.getSize)((0,t.domPN)(cur.pvFSSlideLine))[0]}),(0,t.addClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),n.updateSlide(),clearTimeout(cur.pvFSTimer),(0,a.cancelEvent)(_||window.event)},endSlideEdit(){cur.pvFSSlideEdit&&(cur.pvFSSlideEdit=!1,(0,t.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),n.slide(),cur.pvFSOver||(clearTimeout(cur.pvFSControlsTimer),cur.pvFSControlsTimer=setTimeout(n.hideControls,3e3)))},slide(){clearTimeout(cur.pvFSTimer),!(0,t.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")||cur.pvFSSlideEdit||(0,t.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSTimer=setTimeout((function(){cur.pvSlideNeedAnimation=!0,Photoview.show(cur.pvListId,cur.pvIndex+1)}),1e3*cur.pvFSSlideDelta))},updateInfo(){var _=((cur.pvData||{})[cur.pvListId]||[]).length,e=cur.pvIndex+1;(0,t.val)(cur.pvFSInfo,e+" / "+_),(0,t.toggle)(cur.pvFSInfo,_>1),(_>1?t.removeClass:t.addClass)(cur.pvCanvas,"pv_fs_one")}};window.FullscreenPV=n},58369:(_,e,o)=>{o.d(e,{default:()=>h});o(51876),o(59357),o(91181),o(56997),o(96253),o(19371);var t=o(15544),i=o(95724),r=o(49535),a=o(54612),s=o(86067),l=o(13685),n=o(91789),d=o(23251),p=o(19331),c=o(65931),v="area_hover",u="visible_all";const h=class{constructor(_,e){this.imageNode=_,this.containerNode=e,this.activeAreaId=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this._handleImageMouseMove=this._handleImageMouseMove.bind(this),this._handleAreaClick=this._handleAreaClick.bind(this),this._removeActiveAreaAfterTimeout=this._removeActiveAreaAfterTimeout.bind(this),this._queueCheckUpdates=this._queueCheckUpdates.bind(this),this._queueReceiveUpdates=this._queueReceiveUpdates.bind(this),this._userSelectedCallback=this._userSelectedCallback.bind(this),this._handleSuggestionDeclined=this._handleSuggestionDeclined.bind(this),this.updatePhotoViewTags=this.updatePhotoViewTags.bind(this),this.deleteTag=this.deleteTag.bind(this),this._init(),this._queueCheckUpdates()}_init(){var _=(0,p.partConfigEnabled)("photo_recognition_web");this.photoTooltip=new l.default(window.layer,{onMouseLeave:this._removeActiveAreaAfterTimeout,onUserSelected:this._userSelectedCallback,onDeleteClicked:this.deleteTag,onEscapePressed:this._removeActiveAreaAfterTimeout,onSuggestionDeclined:this._handleSuggestionDeclined,hideAfterDecline:_}),this.photoView=window.Photoview,this.areasContainer=(0,t.ce)("div",{className:"photo_tags_suggested_areas_list"}),this.containerNode.innerHTML="",this.containerNode.appendChild(this.areasContainer),(0,r.addEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,r.addEvent)(this.imageNode,"mouseleave",this._removeActiveAreaAfterTimeout),(0,r.addEvent)(this.imageNode,"mouseenter",this.showAllSuggestedAreas.bind(this)),(0,r.addEvent)(this.areasContainer,"mouseleave",this._removeActiveAreaAfterTimeout),(0,r.addEvent)(this.areasContainer,"click",this._handleAreaClick),this.renderTagAreas()}_handleImageMouseMove(_){if(!this.areasHidden){var e=(0,t.getXY)(_.target),o=Math.round(100*(_.pageX-e[0])/_.target.offsetWidth),i=Math.round(100*(_.pageY-e[1])/_.target.offsetHeight);for(var r in clearTimeout(this.areasTimeOut),this.areasTimeOut=setTimeout((()=>{this.photoTooltip.isActive||this.activeAreaId||this.hideAllSuggestedAreas()}),700),this.showAllSuggestedAreas(),this.areas)if(this.areas.hasOwnProperty(r)){var a=this.areas[r],s=a.x,l=a.y,n=a.x2,d=a.y2;if(o>parseInt(s)&&o<parseInt(n)&&i>parseInt(l)&&i<parseInt(d)){if(r===this.activeAreaId)return void(this.tagAreaFound=!0);if(this.tagAreaFound=this.showTagArea(r),this.tagAreaFound)return}}this.tagAreaFound=!1,this._removeActiveAreaAfterTimeout()}}_handleAreaClick(_){(0,r.cancelEvent)(_),this.photoTooltip.showAndFocusFriendsList(_)}showTagArea(_){var e=this.areas[_];return!(!e||e.isDeleted)&&(null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,t.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=_,(0,t.addClass)(this.areas[_].ele,"active"),this.showTooltip(_),this.showAllSuggestedAreas(),!0)}hideTagArea(){clearTimeout(this.waitTimeout),null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,t.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=null,this.photoTooltip.hide(),this.hideAllSuggestedAreas()}_removeActiveAreaAfterTimeout(_){void 0===_&&(_=500),this.activeAreaId&&!this.waitToRemove&&(this.waitToRemove=!0,clearTimeout(this.waitTimeout),this.waitTimeout=setTimeout((()=>{!this.photoTooltip.isActive&&!this.tagAreaFound&&!this.photoTooltip.interaction&&this.hideTagArea(),this.waitToRemove=!1}),_))}showTooltip(_){if(!this.tooltipsPaused){var e=this.areas[_].ele,o=this._getTooltipOptions(_);if(e){var i=(0,t.getXYRect)(e,!0),r=i.top,a=i.right,s=i.bottom,l=i.left;this.photoTooltip.show({top:r,right:a,bottom:s,left:l},o)}}}showAllSuggestedAreas(){(0,t.addClass)(this.areasContainer,u),(0,t.removeClass)(this.areasContainer,v),this.activeAreaId&&(0,t.addClass)(this.areasContainer,v)}hideAllSuggestedAreas(){(0,t.removeClass)(this.areasContainer,u)}pauseTooltips(){this.hideTagArea(),this.tooltipsPaused=!0}resumeTooltips(){this.tooltipsPaused=!1}_createTagElement(_,e,o,i){var r=cur.pvPhWidth,a=cur.pvPhHeight/r,s=o-_,l=i-e,n=(0,t.ce)("div",{className:"photo_tags_suggested_area"},{left:`${_}%`,marginTop:a*e+"%",width:`${s}%`}),d=(0,t.ce)("div",{},{paddingBottom:100*a*(l/s)+"%"});return n.appendChild(d),n}renderTagAreas(){this.areas={},this.areasContainer.innerHTML="";var _=(0,n.getPhotoData)("tags"),e=(0,n.getPhotoData)("suggested_tags"),o=(0,p.partConfigEnabled)("photo_recognition_web");for(var t in!o&&cur.postTo&&cur.postTo<0&&(e=[]),_)if("0"!==t&&_.hasOwnProperty(t)){var i=_[t],r=i[0],a=i[1],s=i[2],l=i[3],d=i[4],c=i[5],v=i[6],u=this._createTagElement(r,a,s,l);this.areas[t]={ele:u,x:r,y:a,x2:s,y2:l,userName:d,userHref:c,canDeleteTag:Boolean(v),confirmedTag:!1},this.areasContainer.appendChild(u)}for(var h in e)if(h&&e.hasOwnProperty(h)){var E=e[h],P=E[0],g=E[1],m=E[2],b=E[3],w=E[4],D=E[5],M=E[6],O=this._createTagElement(P,g,m,b),T=void 0;w&&(T=`/id${w}`),this.areas[h]={ele:O,x:P,y:g,x2:m,y2:b,userHref:T,suggestedUserId:w,suggestedUserName:D,usersList:M,confirmedTag:!1},this.areasContainer.appendChild(O)}}_userSelectedCallback(_,e,o){void 0===o&&(o=!1);var t=(0,n.getPhotoData)("tags"),r=(0,n.getPhotoData)("suggested_tags"),a=(0,p.partConfigEnabled)("photo_recognition_web"),s=this.activeAreaId,l=this.areas[s],d=l.x,c=l.y,v=l.x2,u=l.y2,h=`/id${_}`,E=cur.pvAskForAutoTag&&o,P=(0,i.clean)(e),g={suggestedUserId:!1,suggestedUserName:!1,usersList:[],userId:_,userName:P,userHref:h,canDeleteTag:!0},m=this.activeAreaId;a?this.confirmSuggestedTags([s],(()=>{this.activeAreaId=m,this.photoTooltip.updateState(g),this.showTagArea(m),this._removeActiveAreaAfterTimeout(1e3)})):(t[s]=[d,c,v,u,P,h,!0],delete r[s],this._confirmSuggestedTag(s,_,e,a,(()=>{this.activeAreaId=m,this.areas[m]=(0,i.extend)(l,g),this.photoTooltip.updateState(g),this.showTagArea(m),this._removeActiveAreaAfterTimeout(1e3),E&&(cur.pvAskForAutoTag=!1,this.showSettingsBox())})))}showSettingsBox(){(0,a.showBox)("/al_photos.php",{act:"show_autotag_settings"},{params:{grey:!0,width:450,bodyStyle:{padding:0},hideButtons:!0,titleTransparent:!0},onDone:(_,e)=>{var o=_.bodyNode,t=o=>{_.hide(),window.ajax.post("/al_settings.php",{act:"a_change_autotag_friends",hash:e.hash,autotag_friends:o?1:0})};o.querySelector(".AutotagSettingsBox__yesButton").addEventListener("click",(()=>t(!0))),o.querySelector(".AutotagSettingsBox__noButton").addEventListener("click",(()=>t(!1)))}})}confirmAlert(_){void 0===_&&(_=!1);var e=cur.pvOneSuggestHintId,o=cur.pvOneSuggestHintHash;_?(e=cur.pvSomeSuggestsHintId,o=cur.pvSomeSuggestsHintHash,cur.pvNeedShowAlertForSomeSuggests=!1):cur.pvNeedShowAlertForOneSuggest=!1,window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:e,hash:o},{onDone:()=>{},onFail:()=>(console.error("something wrong with help hint"),!0)})}deleteTag(_){_||(_=this.activeAreaId,this.photoView.deleteTag(_)),this.hideTagArea();var e=this.areas[_];_&&e&&(e=(0,i.extend)(e,{isDeleted:!0}),(0,t.addClass)(e.ele,"deleted"))}_getTooltipOptions(_){var e=this.areas[_],o=e.suggestedUserId,t=e.suggestedUserName;return{suggestedUserId:o,userName:e.userName,userHref:e.userHref,suggestedUserName:t,usersList:e.usersList,canDeleteTag:e.canDeleteTag}}_handleSuggestionDeclined(){var _=this.activeAreaId,e=this.areas[_];if(e){var o=(0,n.getPhotoData)("suggested_tags"),t=(0,p.partConfigEnabled)("photo_recognition_web");this.areas[_]=(0,i.extend)(e,{suggestedUserId:!1,suggestedUserName:!1,userHref:null}),o&&o[_]&&(o[_][4]=0),t?this.declineSuggestedTags([_]):(this.showTagArea(_),this._declineSuggestedTag(_))}}declineSuggestedTags(_,e,o){var i=(0,n.getPhotoData)("id"),r=(0,n.getPhotoData)("hash"),a=cur.pvListId,l=cur.pvIndex,p=cur.pvData[a][l],c=(0,n.getPhotoData)("tags"),v=_.map((_=>`${i}_${_}`)).join(",");ajax.post("al_photos.php",{act:"decline_suggested_tags",tag_raw_ids:v,hash:r,extended:1},{onDone:(o,r,n)=>{this.decrementLeftMenuCounterIfNeeded(_),this.updatePhotoViewSuggestedTags(o,r,p),this.dispatchEvent(d.TagEventTypes.DECLINE_SUGGESTED_TAGS,{tagIds:_.map(Number),photoRawId:i}),a===cur.pvListId&&l===cur.pvIndex&&(!p.taginfo&&p.actions.tag&&c[0]<cur.pvMaxTags?(0,t.show)(cur.pvTagLink):(0,t.hide)(cur.pvTagLink),o||r||this.photoView.toggleTopInfoPanel((0,s.getLang)("photos_tag_deleted"),n)),e&&e()},onFail:_=>(_||(_=(0,s.getLang)("global_unknown_error")),o&&o(),this.handleTagRequestFail(_))})}confirmSuggestedTags(_,e,o){var i=cur.pvListId,r=cur.pvIndex,l=cur.pvData[i][r],p=(0,n.getPhotoData)("id"),c=(0,n.getPhotoData)("hash"),v=(0,n.getPhotoData)("suggested_tags"),u=_.length>1,h=_[0],E=v[h][4],P=()=>{var a=_.map((_=>`${p}_${_}`)).join(",");ajax.post("al_photos.php",{act:"confirm_suggested_tags",tag_raw_ids:a,hash:c,extended:1},{onDone:(o,a,s,n,c)=>{this.decrementLeftMenuCounterIfNeeded(_),this.updatePhotoViewTags(o,a,s,l),this.updatePhotoViewSuggestedTags(n,c,l),this.dispatchEvent(d.TagEventTypes.CONFIRM_SUGGESTED_TAGS,{tagIds:_.map(Number),photoRawId:p}),i===cur.pvListId&&r===cur.pvIndex&&(!l.taginfo&&l.actions.tag&&o[0]<cur.pvMaxTags?(0,t.show)(cur.pvTagLink):(0,t.hide)(cur.pvTagLink)),e&&e()},onFail:_=>(_||(_=(0,s.getLang)("global_unknown_error")),o&&o(),this.handleTagRequestFail(_))})};if(cur.pvNeedShowAlertForOneSuggest&&!u&&E!==window.vk.id||cur.pvNeedShowAlertForSomeSuggests&&u){var g="",m="",b="";if(u){var w=_.reduce(((_,e)=>{var o=v[e],t=o&&o[4];return t&&t!==window.vk.id&&(_[t]=!0),_}),{}),D=Object.keys(w).length;m=(0,s.getLang)("photo_recognition_some_tag_alert",D),g=(0,s.getLang)("photo_recognition_some_friends_alert_text",D),b=(0,s.getLang)("photo_recognition_some_friends_submit_btn")}else{var M=v[h][5],O=v[h][7];m=(0,s.getLang)("photo_recognition_one_tag_alert"),g=(0,s.langSex)(O,(0,s.getLang)("photo_recognition_one_tag_alert_text","raw")).replace("{name}",M),b=(0,s.getLang)("photo_recognition_one_friend_submit_btn")}var T=(0,a.showFastBox)(m,g,b,(()=>{T.hide(),P(),this.confirmAlert(u)}),(0,s.getLang)("global_cancel"),(()=>{T.hide(),o&&o()}))}else P()}decrementLeftMenuCounterIfNeeded(_){var e=(0,n.getPhotoData)("suggested_tags");_.forEach((_=>{var o=e[_],t=o&&o[4];t&&t===window.vk.id&&(0,c.decrementLeftMenuPhotoCounter)()}))}_confirmSuggestedTag(_,e,o,t,i){var r=(0,n.getPhotoData)("id"),a=(0,n.getPhotoData)("hash");ajax.post("al_photos.php",{act:"confirm_suggested_tag",tag:_,tagged_id:e,name:o,photo:r,hash:a},{onDone:(_,e,o)=>{this.updatePhotoViewTags(_,e,o),i()},onFail:this.handleTagRequestFail})}_declineSuggestedTag(_){var e=(0,n.getPhotoData)("id"),o=(0,n.getPhotoData)("hash");ajax.post("al_photos.php",{act:"decline_suggested_tag",tag:_,photo:e,hash:o},{onFail:this.handleTagRequestFail})}dispatchEvent(_,e){this.areasContainer.dispatchEvent(new CustomEvent(_,{detail:e,bubbles:!0}))}handleTagRequestFail(_){var e=(0,s.getLang)("global_error");return setTimeout((0,a.showFastBox)(e,_).hide,3e3),!0}unMount(){(0,r.removeEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,r.removeEvent)(this.areasContainer,"click",this._handleAreaClick),this.containerNode.innerHTML=""}hideAreas(){this.areasHidden=!0,(0,t.hide)(this.areasContainer),this.photoTooltip.hide()}showAreas(){this.areasHidden=!1,(0,t.show)(this.areasContainer),(0,r.removeEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,r.addEvent)(this.imageNode,"mousemove",this._handleImageMouseMove)}reload(_){void 0===_&&(_=null),this.hideTagArea(),this.resumeTooltips(),this.renderTagAreas(),_&&(this.imageNode=_),this.activeAreaId=null,this.waitToRemove=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this.showAreas()}_queueCheckUpdates(){cur.pvTagsQueueParams&&window.Notifier&&Notifier.addKey(cur.pvTagsQueueParams,this._queueReceiveUpdates)}updatePhotoViewTags(_,e,o,t){void 0===t&&(t=null),(t=t||(0,n.getCurrentPhoto)())&&(t.tags=_,t.tagged=e,t.tagshtml=o,this.photoView.setTags(o))}updatePhotoViewSuggestedTags(_,e,o){void 0===o&&(o=null),(o=o||(0,n.getCurrentPhoto)())&&(_&&Object.keys(_).length?o.suggested_tags=_:delete o.suggested_tags,e?(o.suggestedTagsInfo=e,this.photoView.showSuggestedInfoTopPanel(cur.pvCurPhoto)):(delete o.suggestedTagsInfo,this.photoView.toggleTopInfoPanel(!1)),this.reload())}_queueReceiveUpdates(_,e){e.events&&e.events.forEach((_=>{var e=_.split("<!>"),o=e[1],t=e[2],i=JSON.parse(t),r=JSON.parse(e[3]),a=JSON.parse(e[4]),s=e[5];if((0,n.getPhotoData)("id")===o)(0,n.setPhotoData)("suggested_tags",i),this.updatePhotoViewTags(r,a,s),this.renderTagAreas();else if(cur.pvData){var l=function(_){if(cur.pvData.hasOwnProperty(_)){var e=cur.pvData[_];e.length&&e.forEach(((e,t)=>{if(e.id&&e.id===o){var l=cur.pvData[_][t];l.suggested_tags=i,l.tags=r,l.tagged=a,l.tagshtml=s}}))}};for(var d in cur.pvData)l(d)}}))}}},13685:(_,e,o)=>{o.d(e,{default:()=>n});o(59357);var t=o(41086),i=o(49535),r=o(15544),a=o(95724),s=o(86067),l="right_top";const n=class{constructor(_,e){void 0===e&&(e={}),this.options=(0,a.extend)({closeOnClick:!0,resetDropdownOnShow:!0,onUserSelected:()=>!1,onMouseLeave:()=>!1,onEscapePressed:()=>!1,onDeleteClicked:()=>!1,onSuggestionDeclined:()=>!1},e),this.container=_,this.friendsDropdown=new t.default({onUserSelected:this._handleUserSelected.bind(this),onEscapePress:this._handleEscapePress.bind(this),onKeyUp:this._handleStartInteraction.bind(this)}),this.friendsDropdownNode=this.friendsDropdown.init(),this._handleConfirmedTooltipClick=this._handleConfirmedTooltipClick.bind(this),this._handleDocumentClick=this._handleDocumentClick.bind(this),this.renderTooltip()}renderTooltip(){this.tooltipNode=(0,r.ce)("div",{className:"photo_tooltip"},{display:"none"});var _=(0,r.ce)("div",{className:"photo_tooltip__content"});this.sugggestionNode=(0,r.ce)("div"),this.nameNode=(0,r.ce)("div",{className:"photo_tooltip__name"},{display:"none"}),this.listNode=(0,r.ce)("div",{className:"photo_tooltip__suggestion"}),this.listNode.appendChild(this.friendsDropdownNode),(0,i.addEvent)(this.nameNode,"click",this._handleConfirmedTooltipClick),_.appendChild(this.nameNode),_.appendChild(this.sugggestionNode),_.appendChild(this.listNode),this.tooltipNode.appendChild(_),this.container.appendChild(this.tooltipNode),(0,i.addEvent)(this.tooltipNode,"mouseenter",(()=>{this.isActive=!0})),(0,i.addEvent)(this.sugggestionNode,"click",(_=>{switch((0,i.cancelEvent)(_),(0,r.domData)(_.target,"button")){case"yes":this.options.onUserSelected(this.suggestedUserId,this.suggestedUserName,!0);break;case"no":this.options.onSuggestionDeclined(),(0,r.hide)(this.sugggestionNode),this.userHref=null,this.options.hideAfterDecline?this.hide():(this.showFriendsList(),this.showAndFocusFriendsList())}})),(0,i.addEvent)(this.tooltipNode,"mouseleave",(()=>{this.interaction||(this.isActive=!1,this.options.onMouseLeave())})),this.options.closeOnClick&&(0,i.addEvent)(document,"click",this._handleDocumentClick)}_handleDocumentClick(_){this.options.onMouseLeave(),this.interaction=!1,this.isActive=!1,this.hide()}_handleUserSelected(_,e){this.isActive=!1,this.options.onUserSelected(_,e)}_handleEscapePress(){this.isActive=!1,this.interaction=!1,this.friendsDropdown.reset(),this.options.onEscapePressed()}_handleStartInteraction(){this.interaction=!0}_handleConfirmedTooltipClick(_){(0,i.cancelEvent)(_),"button"===_.target.tagName.toLowerCase()?this.options.onDeleteClicked():this.userHref&&this._go(this.userHref,_)}updatePosition(_){var e=_.top,o=_.right,t=_.bottom,i=_.left,a=o-i,s=(0,r.getSize)(this.tooltipNode),n=s[0]?s[0]:280,d="bottom",p=i+Math.floor(a/2)-n/2,c=t;if((p<10||this.hasDropdown&&t>(0,r.clientHeight)()-300)&&(d=l),d===l){p=o,c=e;var v=(0,r.clientHeight)()-e;v<300&&(c=e-300+v)}(0,r.domData)(this.tooltipNode,"dir",d),(0,r.setStyle)(this.tooltipNode,{top:c,left:p})}updateSuggestionQuestion(_,e){this.sugggestionNode.innerHTML=this._getSuggestionHTML(_,e),this.suggestedUserName=e,this.suggestedUserId=_}_getSuggestionHTML(_,e){var o=_===vk.id?(0,s.getLang)("photos_tags_user_you"):e;return`<div class="suggested_tag_user">\n      ${(0,s.langTag)("<div>","</div>",(0,s.getLang)("photos_tags_suggestion_question"),"tag_span").replace("{userName}",`<div class="suggested_tag_user__name">&nbsp;${o}</div>`)}\n      <div class="suggested_tag_user__actions">\n        <button data-button="yes" class="yes">${(0,s.getLang)("box_yes")}</button>\n        <span>&middot;</span>\n        <button data-button="no">${(0,s.getLang)("box_no")}</button>\n      </div>\n    </div>`}updateState(_){var e=_.suggestedUserName,o=_.suggestedUserId,t=_.usersList,i=_.userName,a=_.userHref,s=_.canDeleteTag;this.suggestedUserName=!1,this.suggestedUserId=!1,this.userHref=a,this.hasDropdown=!1,(0,r.removeClass)(this.tooltipNode,"tagged"),i?(this.nameNode.innerHTML=`${i} ${s?"<button>Delete</button>":""}`,(0,r.toggleClass)(this.nameNode,"show_delete",s),(0,r.show)(this.nameNode),(0,r.hide)(this.listNode),(0,r.hide)(this.sugggestionNode),(0,r.addClass)(this.tooltipNode,"tagged")):o?(this.updateSuggestionQuestion(o,e),(0,r.hide)(this.nameNode),(0,r.hide)(this.listNode),(0,r.show)(this.sugggestionNode)):(this.friendsDropdown.update(t),(0,r.hide)(this.nameNode),(0,r.hide)(this.sugggestionNode),this.showFriendsList(),this.hasDropdown=!0)}showFriendsList(){(0,r.show)(this.listNode),this.options.resetDropdownOnShow&&this.resetFriendsDropdown()}resetFriendsDropdown(){this.friendsDropdown.reset()}show(_,e,o){void 0===e&&(e={}),void 0===o&&(o=!1),this.isActive=!1,this.interaction=!1,this.updateState(e),this.updatePosition(_),(0,r.show)(this.tooltipNode),o&&this.friendsDropdown.show(!0),this.friendsDropdown.focus()}hide(){(0,r.hide)(this.tooltipNode)}showAndFocusFriendsList(_){this.userHref?this._go(this.userHref,_):(this.friendsDropdown.focus(),this.friendsDropdown.show())}unMount(){(0,i.removeEvent)(document,"click",this._handleDocumentClick),(0,r.re)(this.tooltipNode)}_go(_,e){e&&e.ctrlKey?window.open(_):nav.go(_,e)}}},16171:(_,e,o)=>{o.d(e,{Phototag:()=>d});o(19371),o(98837),o(91181),o(56997),o(96253);var t=o(13685),i=o(86067),r=o(95724),a=o(23251),s=o(91789),l=o(6593),n=o(15544),d={startTag(){if(!cur.pvTagger&&cur.pvPhoto.firstChild){!cur.pvTaggerTooltip&&window.layer?cur.pvTaggerTooltip=new t.default(layer,{closeOnClick:!1,resetDropdownOnShow:!1,onUserSelected:d.addTag,onEscapePressed:d.stopTag}):cur.pvTaggerTooltip.resetFriendsDropdown(),(0,n.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");var _=l.FlatButton.render({children:(0,i.getLang)("global_done"),appearance:l.FlatButtonAppearance.PRIMARY,size:l.FlatButtonSize.M,restAttrs:{onclick:"Phototag.stopTag()"}});if(Photoview.toggleTopInfoPanel((0,i.getLang)("photos_select_tag_area"),[_]),Photoview.toggleNavControls(""),Photoview.toggleOnPhotoControls(!1),layerWrap.scrollTop=0,cur.pvTagger="loading",cur.pvTagger){var e={minw:30,minh:30,onStart(){cur.pvPhotoTags&&cur.pvPhotoTags.pauseTooltips(),cur.pvTaggerTooltip.hide()},onFinish:d.showFriends};Photoview.updatePhotoDimensions(),cur.pvTagger=window.photoTagger(cur.pvPhoto.firstChild,(0,r.extend)(e,{zstart:50})),cur.pvPhotoTags&&cur.pvPhotoTags.hideAllSuggestedAreas()}}},stopTag(){cur.pvTagger&&"loading"!=cur.pvTagger?((0,s.getPhotoData)("suggestedTagsInfo")?Photoview.showSuggestedInfoTopPanel(cur.pvCurPhoto):Photoview.toggleTopInfoPanel(!1),(0,n.hide)(cur.pvFriends),cur.pvTaggerTooltip&&cur.pvTaggerTooltip.hide(),cur.pvListId&&cur.pvData[cur.pvListId].length>1&&Photoview.toggleNavControls("left close right"),Photoview.toggleOnPhotoControls(!0),cur.pvTagger.destroy(),cur.pvTagger=!1,Photoview.updatePhotoDimensions(),cur.pvPhotoTags&&cur.pvPhotoTags.reload()):cur.pvTagger=!1},addTag(_,e){if(!cur.pvTagger||"loading"==cur.pvTagger)return!1;var o=cur.pvTagger.result();if(!_&&!e||!o[2])return!1;var t=(0,s.getPhotoData)("id"),i=(0,s.getPhotoData)("suggested_tags"),r=cur.pvListId,l=cur.pvIndex,p=cur.pvData[r][l],c=(0,n.getSize)(cur.pvPhoto.firstChild),v=o[0]/c[0]*100,u=o[1]/c[1]*100,h=(o[0]+o[2])/c[0]*100,E=(o[1]+o[3])/c[1]*100;return ajax.post("al_photos.php",{act:"add_tag",mid:_,photo:p.id,name:e,hash:p.hash,x:v,y:u,x2:h,y2:E},{onDone(_,e,o,s,c){if(cur.pvPhotoTags.updatePhotoViewTags(_,e,o,p),s&&c&&cur.pvPhotoTags.updatePhotoViewSuggestedTags(s,c,p),i){var v=Object.keys(i),u=s?v.filter((_=>!s[_])):v;cur.pvPhotoTags.dispatchEvent(a.TagEventTypes.DELETE_TAG,{tagIds:u.map(Number),photoRawId:t})}cur.pvListId==r&&cur.pvIndex==l&&((0,n.re)(Photoview.actionInfo()),(!p.taginfo&&p.actions.tag&&_[0]<cur.pvMaxTags?n.show:n.hide)(cur.pvTagLink),cur.pvTaggerTooltip.hide(),cur.pvTagger.reset(),cur.pvPhotoTags.renderTagAreas(),cur.pvTaggerTooltip.resetFriendsDropdown(),i&&c&&d.stopTag())},onFail:cur.pvPhotoTags.handleTagRequestFail}),!1},showFriends(){if(cur.pvTagger&&"loading"!=cur.pvTagger){var _=cur.pvTagger.result(),e=_[0],o=_[1],t=_[2],i=_[3],r=(0,n.getXYRect)(cur.pvPhoto.firstChild,!0),a=r.left+e,s=r.top+o,l=r.left+e+t,d=r.top+o+i;cur.pvTaggerTooltip.hide(),cur.pvPhotoTags&&cur.pvPhotoTags.resumeTooltips(),cur.pvTaggerTooltip.show({left:a,top:s,right:l,bottom:d},{},!0)}}}},45896:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Photoview:()=>Photoview});var core_js_modules_es6_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(98837),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(75115),core_js_modules_es7_object_entries__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83276),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(91181),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(56997),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(96253),core_js_modules_es6_array_slice__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(50110),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21466),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(51876),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(59357),_icons_desktop_getIcon16Chevron__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(69828),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(26271),_web_lib_market__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(87910),_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(86067),_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(40906),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(416),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(35429),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(86125),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(3834),_web_lib_legacy__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(27909),_shared_lib_parse__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(20820),_icons_desktop_getIcon16Market__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(95486),_icons_desktop_getIcon24Cancel__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(20130),_web_photos_photos__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(60741),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(23971),_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(16171),_photo_tags__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(58369),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(87481),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(50167),_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(15544),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(49535),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(95724),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(28208),_web_page_wall__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(75617),_internal_nospam_common__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(52416),_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(86409),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(54612),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(76852),_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(35676),_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(82452),_photoview_utils__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(91789),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(19331),_web_photos_types__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(23251),_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(65931),_web_reports_reports__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(33127),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(6593),_shared_market_analytics_utils__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(92930),_shared_ecomm_market_stats_types__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(54932),_web_ecomm_market_shared_utils_logViewMarketItemOnPhoto__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(91802),Photoview={MIN_WIDTH:600,MIN_HEIGHT:450,PE_MIN_WIDTH:750,PE_MIN_HEIGHT:500,SIDE_COLUMN_WIDTH:310,SIDE_MIN_GAP:40,VERTICAL_MIN_GAP:15,BOTTOM_BAR_HEIGHT:52,SIDE_NAV_PANELS_MAX_WIDTH:120,SIDE_NAV_PANELS_MIN_WIDTH:25,LEFT_RIGHT_NAV_RATIO:.25,blank:"/images/blank.gif",blankf:()=>{},cacheSize:3,allSizes:["x","y","z","w"],PE_V1:1,PE_V2:2,PE_V3:4,_getViewedPhotoFullId(){var _=cur.pvListId,e=cur.pvIndex;return cur.pvData[_][e].id},changeThumbs(_,e,o){if(_){var t=[(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("photo_row"+cur.filterPhoto),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("photos_add_thumb"+cur.filterPhoto)],i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("page_post_thumb_wrap");for(var r in i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("page_preview_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("im_preview_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("page_square_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("photos_row")),i)if(i.hasOwnProperty(r)){var a=i[r].getAttribute("onclick");if(!a){var s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(i[r]);a=!!s&&s.getAttribute("onclick")}a&&-1!=a.indexOf(`'${cur.filterPhoto}'`)&&t.push(i[r])}for(var l in t)if(t[l]){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(t[l],"page_square_photo")||t[l].style.backgroundImage){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(t[l],{backgroundImage:`url('${_}')`});continue}var n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByTag1)("img",t[l]);n&&(n.src=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(n,{height:"auto"}))}if(cur.pvNoTemp||(cur.pvNoTemp={}),cur.pvNoTemp[cur.filterPhoto]=!0,window.ThumbsEdit&&e){var d=ThumbsEdit.cache();for(var p in d)if(d.hasOwnProperty(p)){var c=d[p].previews||[],v=!1;for(var u in c)c.hasOwnProperty(u)&&"photo"==c[u].type&&c[u].photo.id=="photo"+o&&(c[u].photo.sizes=e,delete c[u].photo.restrictionBlur,v=!0);v&&ThumbsEdit.refresh(p)}}}},openStickersEditor(_){cur.pvEditorMode||(_||(_=cur.pvCurPhoto),Photoview.stopTagger(),cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas(),Photoview.toggleNavControls(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvLikeFSWrap),Photoview.hideTag(!0),cur.pvEditorMode=!0,cur.pvEditorSaved=!1,Photoview.updatePhotoDimensions(),window.stManager.add([window.jsc("web/spe.js"),"photo_editor.css"],(()=>{SPE.init(_,((e,o,t,i)=>{var r=document.querySelector(`.photos_photo_edit_row[data-id="${e.id}"] .photos_photo_edit_row_thumb`);r&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(r,"background-image",`url(${o})`);var a=e.id!=_.id;if(cur.pvEditorSaved=!0,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),_.closeOnPEEdit){if(e&&o&&window.ThumbsEdit&&t){var s=ThumbsEdit.cache();for(var l in s)if(s.hasOwnProperty(l)){var n=l.replace("thumbs_edit",""),d=cur.addMedia[n],p=s[l].previews||[],c=!1;for(var v in p)if(p.hasOwnProperty(v)&&"photo"==p[v].type&&p[v].photo.id=="photo"+_.id){var u=p[v].photo;if(a){u.id="photo"+e.id,u.pid=e.id.split("_")[1];var h=d.getMedias();(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)(h,(function(){if("photo"==this[0]&&this[1]==_.id)return this[1]=e.id,!1}))}p[v].click=d.showPhoto.pbind(e.id,e.list,(0,_shared_lib_parse__WEBPACK_IMPORTED_MODULE_19__.parseJSON)(i)),p[v].itemId=u.pid,u.sizes=t,c=!0}c&&(ThumbsEdit.refresh(l),d.onChange&&d.onChange())}}return Photoview.changeThumbs(o,t,e.id),Photoview.hide(0)}if(cur.pvListId){var E=cur.pvListId,P=cur.pvData[E],g=cur.pvIndex;if(!P)return nav.reload();var m=P[g];if(a){var b=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({},e);g=++cur.pvIndex,P.splice(g,0,b),m=b,cur.pvCommsLikes[m.id]=[m.comments,0,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)(),!1],delete m.comments,delete m.likes}var w=cur.pvShown&&E==cur.pvListId&&g==cur.pvIndex;e&&o&&!a&&(Photoview.changeThumbs(o,t,_.id),delete m.x_,delete m.x_src,delete m.y_,delete m.y_src,delete m.z_,delete m.z_src,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(m,e)),m.peType=Photoview.PE_V3,w&&(cur.pvCurData=Photoview.genData(m,Photoview.getPhotoSize()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto).src=Photoview.blank,setTimeout(Photoview.show.pbind(cur.pvListId,cur.pvIndex),0))}}),(()=>{if(delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),_.closeOnPEEdit)return Photoview.hide(0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvLikeFSWrap),Photoview.toggleNavControls(["left","right","close"]),setTimeout(Photoview.updatePhotoDimensions,1)}))})))},genUrl:(_,e)=>e?(e.match(/\.[a-z]{3}(?:\?|$)/i)||(e+=".jpg"),e.match(/https?:\/\//i)?e:(_||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+e):"",genData(_,e){for(var o,t,i="x"==e?3:"y"==e?2:"z"==e?1:0,r=["w","z","y","x"].slice(i),a=0;a<4-i;++a){var s=r[a];if(o=_[s+"_"])break;if(t=_[s+"_src"])break}return o||(o=[t]),{src:Photoview.genUrl(_.base,o[0]),width:o[2]&&o[1],height:o[1]&&o[2],restrictionBlur:_.restrictionBlur,restrictionGeo:_.restrictionGeo,restrictionTitle:_.restrictionTitle,restrictionText:_.restrictionText,restrictionButton:_.restrictionButton,photoRaw:_.photoRaw,unblurHash:_.unblurHash}},actionInfo:()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_action_info")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)(cur.pvTags).insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{id:"pv_action_info",className:"pv_right_block"}),cur.pvTags),locNav(_,e,o,t){if(cur.pvListId=="newtag"+vk.id+(o.rev?"/rev":"")&&o[0]=="albums"+vk.id&&"added"==o.act)return Photoview.hide(t.hist),!1;if((o=nav.toStr(o)).replace("?rev=1","/rev")==cur.pvListId&&cur.pvShown)return Photoview.hide(t.hist),!1;var i=o.match(/^photo(-?\d+_\d+)\??((all=1|newtag=\d+)(&rev=1)?|(rev=1&)?tag=\d+|rev=1)?$/);if(i){var r=cur.pvListId;r&&cur.pvShown||(r="added"==nav.objLoc.act?"newtag"+vk.id+(nav.objLoc.rev?"/rev":""):nav.strLoc.replace("?rev=1","/rev"));var a=cur.pvData[r];if(a)for(var s=0,l=a.length;s<l;++s)if(a[s]&&a[s].id==i[1])return Photoview.show(r,s,!1,cur.pvRoot),!1}},updateLocNav(){if(cur.pvRoot){for(var _=0,e=cur.nav.length;_<e;++_)if(cur.nav[_]==Photoview.locNav)return;cur.nav.push(Photoview.locNav)}else for(var o=0,t=cur.nav.length;o<t;++o)cur.nav[o]==Photoview.locNav&&(cur.nav.splice(o,1),--o,--t)},toggleOnPhotoControls(_){_=!!_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggle)(cur.pvFSWrap,_)},checkLayerVisibility(){if(cur.pvShown)return!0;(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("layerqueue.hide from photoview"),layerQueue.hide(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(window,"resize",Photoview.onResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(document,"keydown",Photoview.onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(layerWrap,"click",Photoview.onLayerClick),boxQueue.hideAll(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(layerBG,{opacity:""}),layers.show(),layers.fullhide=Photoview.hide},emojiShowTT:(_,e)=>void 0!==cur.pvEmoji&&Emoji.ttShow(cur.pvEmoji,_,e),emojiHideTT:(_,e)=>void 0!==cur.pvEmoji&&Emoji.ttHide(cur.pvEmoji,_,e),onImageWrapMouseDown(_){if(2!=_.button&&!cur.pvEditorMode){if(_.target.closest(".pv_attach_product_badge"))return!1;if(cur.pvAttachedProducts.isProcess)return Photoview.attachProductPoint(_),!1;if(!cur.pvTagger&&!1===(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.checkEvent)(_)){var e=cur.pvIndex;return Photoview.updateNavBtnsLeftThreshold(),_.pageX<cur.pvLeftBtnAmount?e-=1:e+=1,cur.pvPointerPosition=[_.pageX,_.pageY],Photoview.show(!1,e,_)}}},onImageWrapMouseLeave(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvNavBtnLeft,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvNavBtnRight,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvImageAreaWrap,"pv_init_hover"),Photoview.updateNavBtnsLeftThreshold(!0)},onImageWrapMouseMove(_){Photoview.updateNavBtnsLeftThreshold(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",_.pageX<cur.pvLeftBtnAmount),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvNavBtnRight,"pv_nav_btn_show",_.pageX>cur.pvLeftBtnAmount)},toggleLightModeClass(_){_=!!_&&cur.pvIsLightMode,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvBox,"pv_light_mode",!!_),_=!!_&&cur.pvShowBottomActions,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvBox,"pv_show_bottom_actions",!!_)},isPhotosList:()=>!!(cur.pvVideoTagsShown||cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown),createLayer(){var _,e,o;cur.pvLayerCreated=!0,delete cur.pvLeftBtnAmount,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(layerBG,"pv_layer");var t=Photoview.isPhotosList(),i=nav.objLoc[0].match(/^faq(\d)+$/),r=nav.objLoc[0].match(/^bug(\d)+$/),a=cur.translationBoxOpened;cur.pvIsLightMode=r||0==nav.objLoc[0].indexOf("blog/")||i||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.inArray)(nav.objLoc[0],["blog","about","support","helpdesk","tutorial","market","bugs","translation","restore2"])||a||cur.pvOptions&&cur.pvOptions.isLightMode,cur.pvShowBottomActions=!cur.pvIsLightMode||i||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.inArray)(nav.objLoc[0],["helpdesk","support"]);var s="display: none",l=cur.pvAlbumsShown?cur.pvAlbumsData[cur.pvAlbumsShown].html:"",n=cur.pvVideoTagsShown?cur.pvVideoTagsData.html:"",d=t?s:"",p=t?"":s,c=cur.pvAlbumsShown?"":s,v=cur.pvVideoTagsShown?"":s,u=cur.pvAlbumShown?cur.pvAlbumData[cur.pvAlbumShown].html:"",h=cur.pvAlbumShown?"":s;cur.pvPhotoTagShown&&(u=cur.pvPhotoTagData[cur.pvPhotoTagShown].html,h=""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments")&&(cur.pvBackupComments=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments")).removeChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments")));var E=(null==(_=cur.pvAlbumsData)||null==(e=_[cur.oid])||null==(o=e.opts)?void 0:o.photos_map_tags_markup)||"",P=`\n    <div style="${p}" class="box_title_wrap box_grey">\n      <div class="box_x_button" onclick="Photoview.hide(0)">${(0,_icons_desktop_getIcon24Cancel__WEBPACK_IMPORTED_MODULE_46__.getIcon24Cancel)().icon}</div>\n      ${E}\n      <div class="box_title_controls"></div>\n      <div class="box_title"></div>\n    </div>\n    `,g=cur.pvIsLightMode?"":'\n      <div class="pv_fs_wrap">\n        <div class="pv_fs_btn" onmousedown="return Photoview.fullscreen(event);"><div></div></div>\n      </div>\n    ',m=`\n      <div class="pv_bottom_info clear_fix">\n        <div>\n          <div class="pv_bottom_info_left">\n            <div class="pv_album_name" onmouseover="setTitle(this)"></div>\n            <span class="pv_counter"></span></div>\n            ${cur.pvShowBottomActions?'<div class="pv_bottom_actions"></div>':""}\n        </div>\n      </div>`,b=cur.pvIsLightMode?"":'\n      <div class="pv_narrow_column_wrap">\n        <div class="pv_narrow_column_cont wall_module">\n          <div class="narrow_column" id="pv_narrow"></div>\n        </div>\n      </div>',w=(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_15__.getProgressHtml)("pv_image_progress");layer.innerHTML=`\n    <div class="pv_cont">\n      <div id="pv_box" class="_scroll_node pv_box" tabindex="0" onclick="cur.pvClicked = true;" onmouseenter="removeClass(layerWrap, 'pv_mouse_out_layer')" onmouseleave="addClass(layerWrap, 'pv_mouse_out_layer')">\n        ${P}\n        <div class="clear_fix pv_photo_wrap" style="${d}">\n          <div class="pv_close_btn" onclick="Photoview.hide(0)"></div>\n          <div class="no_select pv_left_wrap">\n            <div class="no_select pv_image_wrap">\n              <div id="pv_tag_info" class="PhotoViewTopPanel">\n                <div class="pv_tag_info_text"></div>\n                <div class="pv_tag_info_buttons_wrap"></div>\n              </div>\n              <div id="pv_tag_frame"></div>\n              <div id="pv_tag_faded"></div>\n              <div id="pv_tag_person" onmouseout="Photoview.hideTag()"></div>\n              <div class="pv_photo_tags" id="pv_photo_tags"></div>\n              <div class="pv_img_area_wrap pv_init_hover" onmouseleave="return Photoview.onImageWrapMouseLeave(event)" onmousedown="return Photoview.onImageWrapMouseDown(event)" onmousemove="Photoview.onImageWrapMouseMove(event)">\n                <div class="pv_img_progress_wrap">${w}</div>\n                <div id="pv_photo"></div>\n                \n      <div class="pv_nav_btn" id="pv_nav_btn_left" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex - 1, event);">\n        <div class="pv_nav_btn_icon"></div>\n      </div>\n      <div class="pv_nav_btn" id="pv_nav_btn_right" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex + 1, event);"><div class="pv_nav_btn_icon"></div></div>\n    \n                <div class="pv_like_fs_wrap">\n                ${g}\n                </div>\n              </div>\n            </div>\n            ${m}\n          </div>\n          ${b}\n        </div>\n        <div id="pv_albums_wrap" class="pv_white_bg photos_container_albums" style="${c}">${l}</div>\n        <div id="pv_album_wrap" class="pv_white_bg" style="${h}">${u}</div>\n        <div id="pv_vtagged_wrap" class="pv_white_bg" style="${v}">${n}</div>\n      </div>\n    </div>`,cur.pvYourComment&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_your_comment")).replaceChild(cur.pvYourComment,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_your_comment")),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvCont:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(layer),pvBox:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_box"),pvImageAreaWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_img_area_wrap"),pvLeftWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_left_wrap"),pvTitle:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("box_title_wrap"),pvTitleText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("box_title"),pvImageWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_image_wrap"),pvNavBtnLeft:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_nav_btn_left"),pvNavBtnRight:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_nav_btn_right"),pvNavBtnClose:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_close_btn"),pvNarrowColumnWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_narrow_column_wrap"),pvNarrowColumn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_narrow_column_cont"),pvPhotoWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_photo_wrap"),pvAlbumWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_album_wrap"),pvAlbumsWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_albums_wrap"),pvVTagsWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_vtagged_wrap"),pvPhotoTagsContainer:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_photo_tags"),pvTagInfo:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag_info"),pvTagFrame:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag_frame"),pvTagFaded:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag_faded"),pvTagPerson:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag_person"),pvPhoto:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_photo"),pvTagInfoText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_tag_info_text"),pvTagInfoButtons:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_tag_info_buttons_wrap"),pvBottomInfo:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_bottom_info"),pvAlbumName:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_album_name"),pvCounter:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_counter"),pvBottomActions:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_bottom_actions"),pvBottomLeft:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_bottom_info_left"),pvNarrow:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_narrow"),pvWide:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_wide"),pvImgProgress:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_image_progress"),pvLikeFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_like_fs_wrap"),pvFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_fs_wrap"),pvFS:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs"),pvFSFg:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_fg"),pvActions:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pvs_actions"),pvYourComment:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_your_comment"),pvAddMedia:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_add_media")),pvMediaPreview:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_media_preview"),pvCommentSend:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comment_send"),pvComment:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comment")}),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(layerWrap,"scroll",Photoview.scrollResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(layerWrap,"mousemove",Photoview.onLayerMouseMove),Photoview.updateSize(),t&&_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__.default.init(!1,{parent:layerWrap});var D=layerWrap.scrollTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.elfocus)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("_scroll_node",cur.pvCont)),layerWrap.scrollTop=D},doShowAlbums(_,e){if(_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_),!e||2!=e.button&&3!=e.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);var o=(cur.pvAlbumsData||{})[_];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()}),cur.pvShown=!0,cur.pvAlbumsShown=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_owner")!=_&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvaOffset:o.opts.offset,pvaCount:o.opts.count,pvaPhotosOffset:o.opts.photos_offset,pvaPhotosCount:o.opts.photos_count,pvShowAllAlbums:!1}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_owner")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)(cur.pvAlbumsWrap,o.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvAlbumsWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvPhotoWrap,cur.pvAlbumWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumsWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_scroll"))):Photoview.createLayer(!0),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__.default.show(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumsWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex}):(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.version>8)&&(cur.pvClicked=!1),Photoview.toggleNavControls(),cur.pvListId=!1;var t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(nav.objLoc,{z:"albums"+cur.pvAlbumsShown});return nav.strLoc!=nav.toStr(t)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(t)),Photoview.updatePeriods(),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e)}}},jumpToAlbums(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="albums"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_owner")||cur.pvJumpTo.z!=nav.objLoc.z)?(_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.showAlbums)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_owner"),{noHistory:!0})},jumpToAlbum(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="album"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_album")||cur.pvJumpTo.z!=nav.objLoc.z)?(_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.showAlbum)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_album"),{noHistory:!0})},jumpToTagged(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag")||cur.pvJumpTo.z!=nav.objLoc.z)?(cur.pvJumpTo.z=="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag")&&(cur.pvJumpTo.z="photo_"+cur.pvJumpTo.z),_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Photoview.showTagged((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag"),{noHistory:!0})},doShowAlbum(_,e){if(!e||2!=e.button&&3!=e.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);var o=(cur.pvAlbumData||{})[_];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()}),cur.pvShown||cur.pvAlbumShown||cur.pvAlbumsShown||layerQueue.push(),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__.default.show(),cur.pvShown=!0,cur.pvAlbumShown=_,cur.pvLayerCreated&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_album")==_||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_album")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)(cur.pvAlbumWrap,o.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_scroll"))):Photoview.createLayer(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumWrap);var t=o.opts.author||"";if(cur.pvTitleText.innerHTML=(t?t+'<span class="divider"></span> ':"")+o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var i=(cur.pvListId||"").split("/");i[0]&&Photoview.showRepeat((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)(i[0]))}else(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(nav.objLoc,{z:"album"+cur.pvAlbumShown});return nav.strLoc!=nav.toStr(r)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(r)),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e)}}},doShowTagged(_,e){if(_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_),!e||2!=e.button&&3!=e.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e);var o=(cur.pvPhotoTagData||{})[_];if(o){if(Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()}),cur.pvShown=!0,cur.pvPhotoTagShown=_,cur.pvLayerCreated&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag")==_||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)(cur.pvAlbumWrap,o.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_scroll"))):Photoview.createLayer(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvAlbumWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var t=(cur.pvListId||"").split("/");t[0]&&Photoview.showRepeat((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)(t[0]))}else(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(nav.objLoc,{z:"photo_tag"+cur.pvPhotoTagShown});return nav.strLoc!=nav.toStr(i)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(i)),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e)}}},toggleNavControls(_){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)([cur.pvNavBtnRight,cur.pvNavBtnLeft,cur.pvNavBtnClose],(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(this)})),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isString)(_)&&(_=_.split(" ")),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)(_||[],(function(_,e){switch(e){case"close":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvNavBtnClose);break;case"left":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvNavBtnLeft);break;case"right":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvNavBtnRight)}}))},getPhotoSize(){var _;switch(cur.pvVeryBig){case 3:_="w";break;case 2:case 1:_="z";break;default:_="y"}return _},show(_,e,o,t){if(!cur.pvEditorMode&&(cur.pvAttachedProducts=cur.pvAttachedProducts||{},cur.pvAttachedProducts.badges&&cur.pvAttachedProducts.badges.forEach((_=>_.remove())),!o||2!=o.button&&3!=o.which))if(cur.cancelClick)delete cur.cancelClick;else{if(Photoview.destroyPeriod(),clearTimeout(window.__pvhideTimer),"temp"==_&&cur.pvShown){if(cur.pvListId&&"temp"!=cur.pvListId)return;cur.pvWasShown=!0}else cur.pvWasShown=!1;if(__afterFocus)return!!o&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(o);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),!1!==o))return!!o&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(o);if(!1===_){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown){if(cur.pvOldListId)return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvJumpTo:cur.pvOldJumpTo,pvJumpFrom:cur.pvOldJumpFrom,pvJumpSteps:cur.pvOldJumpSteps}),e==cur.pvOldIndex+1&&++cur.pvOldIndex,Photoview.show(cur.pvOldListId,cur.pvOldIndex,o,t);Photoview.toggleNavControls()}_=cur.pvListId}var i=((cur.pvData||{})[_]||{}).length,r=_!=cur.pvListId;if(i){o&&o.pageX&&o.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldX:o.pageX,pvOldY:o.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()}),(cur.pvOptions||{}).queue&&(layerQueue.push(),cur.pvOptions.queue=!1,cur.pvHistoryLength=0),Photoview.checkLayerVisibility()||(r=!0);var a=e+(e<0?i:e>=i?-i:0),s=r?1:cur.pvIndex>e?-1:1;if(!r&&!cur.pvCanvas){if(cur.pvJumpTo){if(cur.pvJumpSteps+=e-cur.pvIndex,a===cur.pvJumpFrom&&cur.pvJumpSteps>=i)return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvOldJumpFrom:cur.pvJumpFrom,pvOldJumpSteps:cur.pvJumpSteps-(e-cur.pvIndex),pvOldJumpTo:cur.pvJumpTo}),Photoview.jumpToAlbums(cur.pvJumpSteps<0);if(s>0&&(a<cur.pvJumpFrom&&a+4>cur.pvJumpFrom||a<cur.pvJumpFrom+i&&a+4>cur.pvJumpFrom+i)){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)().src=window.stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":"")+".png?3";var l=cur.pvJumpTo.z.match(/^albums(-?\d+)$/);l&&(cur.pvAlbumsData||(cur.pvAlbumsData={}),cur.pvAlbumsData[l[1]]||(cur.pvAlbumsData[l[1]]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:l[1],other:1},{onDone:Photoview.loadedAlbums})))}cur.pvJumpSteps<=-i&&(cur.pvJumpSteps+=i)}if(1==i&&e!=cur.pvIndex&&("temp"!=_||cur.pvOptions.temp_final))return Photoview.hide(),!!o&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(o)}r&&"temp"!=_&&(!1===cur.pvJumpFrom&&(cur.pvJumpFrom=a),cur.pvRoot=t,Photoview.updateLocNav()),e=a;var n=cur.pvData[_][e];if(n&&(n.x_||n.x_src)){cur.pvIndex=e,cur.pvShown=!0,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvListId=_,Photoview.calculateVeryBig();var d=Photoview.getPhotoSize();return cur.pvCurData=Photoview.genData(n,d),cur.pvLayerCreated||Photoview.createLayer(),cur.pvCurrent&&(cur.pvCurrent.onload=Photoview.blankf,cur.pvCurrent.src=Photoview.blank),delete cur.pvCurrent,cur.pvCurrent=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),cur.pvCurrent.onload=Photoview.preload.pbind(e,s),cur.pvCurrent.src=cur.pvCurData.src,r&&Photoview.toggleNavControls(i>1?"left right close":"close"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.hideProgress)(cur.pvCounter),"temp"!=_||cur.pvOptions.temp_final?"temp"==_&&cur.pvOptions.temp_final&&cur.pvOptions.temp_summary||(cur.pvCounter.innerHTML=i>1?(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_photo_counter_num_of_N").replace("%s",cur.pvIndex+1).replace(/%s|{count}/,i):""):(((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(cur.pvCurData)||cur.pvCurData.restrictionGeo)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvImgProgress),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.showProgress)(cur.pvCounter,"","pr_baw")),cur.pvCurPhoto=n,cur.pvCurData.width&&cur.pvCurData.height?Photoview.doShow():(cur.pvCurData=cur.pvCurrent,cur.pvTimerPassed=0,clearTimeout(cur.pvTimer),cur.pvTimer=setTimeout(Photoview.doShow,0)),cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown),!!o&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(o)}}}},_checkWebGL:()=>navigator.userAgent.indexOf("Windows NT 5.1")>=0?-1:function(){try{var _=document.createElement("canvas");_.width=_.height=100;var e={preserveDrawingBuffer:!0,premultipliedAlpha:!1};return!!window.WebGLRenderingContext&&(_.getContext("webgl",e)||_.getContext("experimental-webgl",e))}catch(_){return!1}}()?1:_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.safari?((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("photo editor: webgl enable needed"),-2):((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("photo editor: webgl not suported"),-1),openEditor(_,e){function o(o){return o||(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("photo editor: CORS not available ("+e+")"),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("al_photos.php",{act:"edit_photo",photo:_||cur.pvData[cur.pvListId][cur.pvIndex].id,webgl:Photoview._checkWebGL(),cors:o},{dark:1,stat:["ui_controls.css","ui_controls.js"]})}e=e||cur.pvCurData.src;var t=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)();t.onerror=()=>o(0),t.onload=()=>o(1),t.crossOrigin="",t.src=e},showReportPhotoForm(){if(!cur.pvCurPhoto.reported){var _=Photoview._getViewedPhotoFullId().split("_"),e=_[0],o=_[1];(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_41__.showReportForm)("photo",e,o,(()=>{cur.pvCurPhoto.reported=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_more_act_spam"),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_report_sent"))}))}},showReportPhotoCommentForm(_,e){(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_41__.showReportForm)("photo_comment",_,e,(()=>(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_41__.afterCommentReportSubmit)("photo",_,e)))},hideLoadProgress(_){if(_){var e=_.currentSrc;if(e&&(_.naturalHeight<=50||_.naturalWidth<=50)){var o=new Image;o.onload=function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvImgProgress)},o.src=e}}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvImgProgress)},doShow(){var _=cur.pvCurData;if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvImgProgress),(!_.width||!_.height)&&cur.pvTimerPassed<5e3)return clearTimeout(cur.pvTimer),cur.pvTimerPassed+=100,void(cur.pvTimer=setTimeout(Photoview.doShow,100));if(cur.pvShown)if(cur.pvCanvas)Photoview.pvCanvasSet();else{Photoview.toggleLightModeClass(!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvAlbumsWrap)&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvAlbumsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvPhotoWrap),Photoview.updateSize()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvAlbumWrap)&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvAlbumWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvPhotoWrap),Photoview.updateSize()),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__.default.hide(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--geo",!!_.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(_));var e=cur.pvPhoto&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto);if(e&&e.src){var o=/https?:\/\/[a-z0-9\.\-]+/;(e.src.replace(o,"")!=_.src.replace(o,"")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(e,"ZPhotosRestriction")||_.restrictionGeo||_.restrictionBlur)&&V(_)}else V(_);if(Photoview.hideLoadProgress(e),Photoview.updatePhotoDimensions(),window.tooltips&&tooltips.destroyAll(cur.pvBox),"temp"==cur.pvListId)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvCommentsData),Photoview.toggleOnPhotoControls(!1),void Photoview.updateVerticalPosition();Photoview.toggleOnPhotoControls(!0);var t=cur.pvCurPhoto;if(t.peData)return t.closeOnPEEdit=!0,void Photoview.openStickersEditor(t);var i=!(t.commshown>=0)&&-t.commshown;cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),Photoview.hideTag(!0),(_.width<200||_.height<200)&&(t.actions.prof=!1,t.actions.dialog=!1);var r="";("NA"!=t.album&&2!=i||t.graffiti)&&(r=t.album);var a=!t.album||!t.author;if(!cur.pvIsLightMode&&!a){var s="";s+='<div class="pv_author_block clear_fix">';var l="";"NA"!=t.author&&(l=t.author),l&&(t.author_href&&(s+=`<a class="pv_author_img fl_l" href="${t.author_href}">`),s+=`<div class="ow_ava ow_ava_comm" style="background-image: url('${t.author_photo}');"></div>`,t.author_href&&(s+="</a>")),s+=`\n        <div class="pv_author_info">\n          <div id="pv_author_name">${l}</div>\n          <div class="pv_date_info_wrap">\n            <span id="pv_date_info">${t.date}</span>\n          </div>\n        </div>\n      </div>`,s+=(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_15__.getProgressHtml)("pv_progress");var n=cur.pvCommsLikes[t.id],d=n[0],p=n[1];s+=Likes.makeTemplate(t.likes_tpl,{object_raw:t.id,likes_count:p||"",liked:t.liked,share_count:t.shares||"",share_opts:{list:cur.pvListId,to:"mail"}});var c=1&t.actions.edit||t.desc,v="";if(c){var u=t.desc||`<span class="pv_desc_edit">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_desc")}</span>`,h="";1&t.actions.edit?(h+='class="pv_can_edit pv_desc_cont"',h+='onclick="Photoview.editInline(event)"'):h+='class="pv_desc_cont"',v=`<div ${h}>${u}</div>`}1==t.was_edited?s+=`<div id="pv_edit_info" class="pv_right_block">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_was_edited")}</div>`:t.was_edited&&(s+=`\n          <div id="pv_edit_info" class="pv_right_block" onmouseover="showTooltip(this, {\n            text: '${t.was_edited}',\n            black: 1\n          });">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_was_edited")}</div>`),s+='<div id="pv_desc" class="pv_right_block" style="'+(c?"":"display: none")+'">'+v+"</div>",s+='<div id="pv_attached_products_list"></div>',s+='<div id="pv_microdata">'+(t.microdata_html?t.microdata_html:"")+(t.microdata_preview_button?t.microdata_preview_button:"")+"</div>",t.microdata_html&&(0,_web_lib_market__WEBPACK_IMPORTED_MODULE_11__.shortCurrency)(),s+='<div id="pv_tags"'+(t.tagshtml?"":' style="display: none"')+' class="pv_right_block">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_onthisphoto")+": "+t.tagshtml+"</div>",s+='<div id="pv_place" class="pv_right_block">'+(t.place?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+t.place+"</a>":"")+"</div>",s+=d.tagName?'<div id="pv_comments_place"></div>':(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.trim)(d),cur.pvReplyForm&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(cur.pvReplyForm),cur.pvReplyForm=null,s+='<div id="pv_rotate"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>',cur.pvNarrow.innerHTML="",Photoview.updateRightBlock(),cur.pvNarrow.innerHTML=s;var E=Photoview.generateMarketList(t.attached_tags.tags),P=E[0],g=E[1];t.attached_tags.tags&&t.attached_tags.tags.length&&document.getElementById("pv_attached_products_list").appendChild(P),cur.pvImageAreaWrap.appendChild(g);var m=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_closed_commments_placeholder"),b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_no_commments_placeholder");if(i||!t.actions.comm?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(m,"unshown"),i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(b,"unshown")):t.reply_form&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(m,"unshown"),t.replyFormEl=cur.pvReplyForm=t.replyFormEl||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.se)(t.reply_form),cur.pvNarrowColumn.appendChild(cur.pvReplyForm),cur.onReplyFormSizeUpdate=cur.onMediaChanged=_=>{cur.pvShown&&Photoview.updateRightBlock()},cur.onReplyFormFocus=()=>{Photoview.updateRightBlock(!0),cur.pvNarrowScrollbar.scrollBottom(0,!0)}),d.tagName){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("page_gif_loading",d),(()=>{Page.hideGif(this,!1)}));var w=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments_place");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)(w).replaceChild(d,w)}if(cur.pvNarrowScrollbar=new uiScroll(cur.pvNarrow,{global:!0}),t.reply_form){var D=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("reply_field",cur.pvNarrowColumn);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.data)(D,"send",Photoview.sendComment),(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_14__.placeholderInit)(D,{editable:1}),cur.pvOptions.commentFocusInit){delete cur.pvOptions.commentFocusInit;var M=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("submit_post_field",cur.pvReplyForm);M&&M.focus()}}cur.editing=!1,Photoview.updateRightBlock()}var O=[];if(r=r||"",cur.pvAlbumName.innerHTML=r,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggle)(cur.pvBottomInfo,!cur.pvIsLightMode||cur.pvShowBottomActions||r),vk.id&&t.actions.share&&O.push(`<a id="pv_share" onclick="Photoview.sendPhoto()">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_share_from_view")}</a>`),!t.taginfo&&t.actions.tag&&t.tags[0]<cur.pvMaxTags&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(t)&&O.push(`\n          <a id="pv_tag_link" onclick="stManager.add([jsc('web/photo_tagger_mode.js'), 'tagger.css', jsc('web/tagger.js')], () => {\n            Phototag.startTag();\n          })">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_tagperson")}</a>`),t.actions.del&&O.push(`<a id="pv_delete" onclick="Photoview.deletePhoto()">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_delete")}</a>`),t.actions.save&&O.push(`<a id="pv_save_to_me" onclick="Photoview.savePhoto()">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_save")}</a>`),cur.pvShowBottomActions&&!a){var T=[];if(t.actions.spam){var L=cur.pvCurPhoto.reported?(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_report_sent"):(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_report");T.push(["spam",L,"Photoview.showReportPhotoForm()"]),T.push("sep")}if(t.actions.forbid){var C=Photoview._getViewedPhotoFullId().split("_"),I=C[0],A=C[1];T.push(["atfr",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("reports_atfr"),"sfof("+I+", "+A+", 1)"])}if(t.actions.blur){var B=Photoview._getViewedPhotoFullId().split("_"),f=B[0],R=B[1];T.push(["b",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("reports_b"),"scblf('photo', "+f+", "+R+")"])}if(t.actions.geoBlock){var W=Photoview._getViewedPhotoFullId().split("_"),U=W[0],K=W[1];T.push(["gb",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("reports_gb"),"scgbf('photo', "+U+", "+K+")"])}if(t.actions.edit&&(t.peType&Photoview.PE_V1||t.peType&Photoview.PE_V2)&&T.push(["pe",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_photoeditor"),"Photoview.openEditor()"]),vk.id&&t.actions.pe&&t.peType&Photoview.PE_V3&&(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.isPhotoeditor3Available)()&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.inArray)(nav.objLoc[0],["support","helpdesk"])&&!t.restrictionGeo&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(t)){var S=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_38__.partConfigEnabled)("web_photo_editor_hide_entrypoint")?(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_photoeditor"):(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_pe_edit");T.push(["spe",S,"Photoview.openStickersEditor()"])}if(t.actions.rotate?(T.push(["rotate_ccw",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_rotate_ccw"),"Photoview.rotatePhoto(-1)"]),T.push(["rotate_cw",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_rotate_cw"),"Photoview.rotatePhoto(1)"]),T.push("sep")):t.actions.rot&&(T.push(["rotate_ccw",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_rotate_ccw"),"Photoview.rotatePhotoOld(-1)"]),T.push(["rotate_cw",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_rotate_cw"),"Photoview.rotatePhotoOld(1)"]),T.push("sep")),t.actions.place&&T.push(["place",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_add_place"),"Photoview.editPlace()"]),t.attached_tags&&t.attached_tags.hash){var y=`<div class="pv_more_act_item_icon">${(0,_icons_desktop_getIcon16Market__WEBPACK_IMPORTED_MODULE_47__.getIcon16Market)().icon}</div>`;T.push(["market",`${y} ${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_add_market")}`,"Photoview.selectProductInBox()"])}if(t.actions.prof&&t.profile_data){var x=JSON.stringify(t.profile_data);T.push(["to_profile",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_to_avatar"),"","",`data-task-click='Page/owner_set_exist_photo' data-options='${x}'`])}if(t.actions.dialog&&T.push(["to_dialog",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_load_to_dialog"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${t.id}', oid: ${t.actions.dialog}, list: '${cur.pvListId}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]});`]),t.actions.move){var k=t.id.split("_")[0];T.push(["move_to",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_move_to_album"),`\n            showBox('al_photos.php', {act: 'a_move_to_album_box', photo_id: '${t.id}', owner_id: ${k}}, {stat: ['page.js', 'page.css', 'wide_dd.js', 'wide_dd.css']})\n          `]),t.actions.cover&&T.push(["as_title",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_album_to_cover"),`\n              ajax.post('al_photos.php', {act: 'a_set_as_album_title', photo: '${t.id}', hash: '${t.hash}'}, {onDone: showDoneBox})\n            `])}var F="";(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)(T,((_,e)=>{"sep"===e?0!==_&&_!==T.length-1&&(F+='<div class="pv_more_act_item_sep"></div>'):F+=`\n              <div class="pv_more_act_item" onmouseover="${e[3]||""}" onclick="${e[2]||""}" id="pv_more_act_${e[0]}" ${e[4]||""}>\n                ${e[1]}\n              </div>\n            `})),t.restrictionGeo||(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(t)||(F+=`<a\n          class="pv_more_act_item"\n          id="pv_more_act_download"\n          target="_blank"\n          rel="noopener"\n          href="${Photoview.genData(t,"w").src}\n        ">\n            ${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_open_original")}\n        </a>`),F=`<div class="pv_more_acts">${F}</div>`,T.length?(T=(T=JSON.stringify(T)).replace(/\"/g,"&quot;"),O.push(`<a class="pv_actions_more" data-items="${T}">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_actions_more")}</a>`)):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.inArray)(nav.objLoc[0],["support","helpdesk"])&&O.push(`\n            <a id="pv_more_act_download" target="_blank" rel="noopener" href="${Photoview.genData(t,"w").src}">\n              ${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_open_original")}\n            </a>\n          `),O=O.join('<span class="divider"></span>'),cur.pvIsLightMode&&(O+='<div id="pv_rotate" style="display:none;"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'),cur.pvBottomActions.innerHTML=O;var N=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_actions_more");N&&(cur.pvMoreActionsTooltip=new ElementTooltip(N,{id:"pv_more_acts_tt",forceSide:"top",elClassWhenShown:"pv_more_shown",content:F,offset:[0,-5],autoShow:!0,noHideOnClick:!0}))}if(Photoview.updatePhotoDimensions(),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvTagLink:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag_link"),pvLikeIcon:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_like_icon"),pvLikeLink:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_like_link"),pvDesc:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_desc"),pvTags:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tags"),pvEditing:!1,pvProgress:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_progress")}),t.deleted||!t.author)(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isArray)(t.deleted)&&Photoview.toggleTopInfoPanel(t.deleted[0],t.deleted[1]),a||Photoview.toggleDeletedState(!0);else if(t.taginfo){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");var H=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_confirm_tag"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,restAttrs:{id:"pv_confirm_tag",onclick:`Photoview.confirmTag(${t.tagid}, this)`}}),j=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_delete_tag"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"pv_delete_tag",onclick:`Photoview.deleteTag(${t.tagid}, this)`}});Photoview.toggleTopInfoPanel(t.taginfo,[H,j]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvCommentsData)}else t.suggestedTagsInfo?Photoview.showSuggestedInfoTopPanel(t):(Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1));(cur.pvOptions||{}).scroll&&cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollTop(cur.pvOptions.scroll),cur.pvBodyScrollTop=bodyNode.scrollTop,setTimeout((function(){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop)}),0),Photoview.updateVerticalPosition();var z=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto);cur.pvPhotoTags?cur.pvPhotoTags.reload(z):vk.id&&(cur.pvPhotoTags=new _photo_tags__WEBPACK_IMPORTED_MODULE_23__.default(z,cur.pvPhotoTagsContainer)),setTimeout(Photoview.afterShow,2)}function V(_){var e="";if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(_)){var o="";if(_.restrictionButton)o=`<button class="ZPhotosRestriction__button" onMouseDown="${`event.stopPropagation(); Page.unblurPhoto('${_.photoRaw}', '${_.unblurHash}', this);`}">${_.restrictionButton}</button>`;e=`<div class="ZPhotosRestriction__title">${_.restrictionTitle||" "}</div><div class="ZPhotosRestriction__text">${_.restrictionText}</div>${o}`}_.restrictionGeo&&(e=`<div class="ZPhotosRestriction__title">${_.restrictionText||" "}</div>`),cur.pvPhoto.innerHTML='<img src="'+(_.src||"/images/blank.gif")+'" />'+e,Photoview.hideLoadProgress(cur.pvPhoto&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto))}},toggleTopInfoPanel(_,e){var o=!!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isString)(_)||!!_;void 0!==_&&(cur.pvTagInfoText.innerHTML=_),void 0!==e&&(Array.isArray(e)||(e=[e]),cur.pvTagInfoButtons.innerHTML="",e.forEach((_=>{_ instanceof HTMLButtonElement?cur.pvTagInfoButtons.append(_):cur.pvTagInfoButtons.innerHTML+=_}))),cur.pvTagInfo.classList.toggle("PhotoViewTopPanel--show",o),Photoview.updatePhotoTagsContainerDimensions(),Photoview.updatePhotoDimensions()},toggleDeletedState(_){_=!!_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvCont,"pv_deleted_state",_),Photoview.updateRightBlock()},showSuggestedInfoTopPanel(_){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_38__.partConfigEnabled)("photo_recognition_web")&&_.suggestedTagsInfo){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");var e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.getPhotoData)("suggested_tags");if(e){var o=Object.keys(e);if(o.length){var t="",i="";if(o.length>1)t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_tag_confirm_all"),i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_recognition_decline_all");else e[o[0]][4]===vk.id?(t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_recognition_item_confirm_me"),i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_recognition_item_decline_me")):(t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_confirm_tag"),i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_delete_tag"));var r=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:t,appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,restAttrs:{id:"pv_confirm_suggested_tags",onclick:"Photoview.confirmAllSuggestedTags(this)"}}),a=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:i,appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"pv_decline_suggested_tags",onclick:"Photoview.declineAllSuggestedTags(this)"}});Photoview.toggleTopInfoPanel(_.suggestedTagsInfo,[r,a])}}}},updatePhotoTagsContainerDimensions(_){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto);if(e){_||(_=e.offsetWidth);var o=e.offsetLeft,t=e.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvPhotoTagsContainer,{top:t+"px",left:o+"px",width:_+"px"})}},updateTagFrameDimensions(_,e,o){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto);if(t){var i=t.offsetLeft,r=t.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagFaded,{width:cur.pvPhWidth+"px",height:cur.pvPhHeight+"px",left:i+"px",top:r+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagFrame,{left:i+"px",top:r+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagPerson,{left:i+"px",top:r+"px"}),_&&e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvTagFrame),{width:_,height:e,marginTop:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(o)})}},afterShow(){cur.pvPhoto.href="/photo"+cur.pvCurPhoto.id,cur.pvPhoto.focus(),4&cur.pvCurPhoto.actions.edit&&1&cur.pvCurPhoto.actions.edit&&!cur.pvCurPhoto.desc&&Photoview.editInline(),cur.pvTagFrame.innerHTML='<img src="'+(cur.pvCurData.src||"/images/blank.gif")+'" />',Photoview.updateTagFrameDimensions(),(cur.pvOptions||{}).scroll&&(layerWrap.scrollTop=cur.pvOptions.scroll,cur.pvOptions.scroll=0),Photoview.updateLoc(),Photoview.updatePhotoDimensions()},pvCanvasUpdate(_){var e=cur.pvCurData;if(cur.pvCanvas&&e&&e.width&&e.height){cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight;var o,t=e.width||604,i=e.height||453,r=cur.pvScrWidth/t,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_fade")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_wrap"),s=a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(a);i*r>cur.pvScrHeight&&(r=cur.pvScrHeight/i),r>1.25&&(r=1.25),t=Math.floor(t*r),i=Math.floor(i*r),o=Math.floor((cur.pvScrHeight-i)/2),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(s,"ZPhotosRestriction--geo",!!e.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(s,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(e));var l="";l=e.restrictionGeo?`<div class="ZPhotosRestriction__title">${e.restrictionText||" "}</div>`:(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.isImgBlurred)(e)?`<div class="ZPhotosRestriction__title">${e.restrictionTitle||" "}</div>`:"",s.innerHTML!==l&&(s.innerHTML=l),(cur.pvFSWidth!=t||cur.pvFSHeight!=i||cur.pvFSTop!=o||_)&&(cur.pvFSWidth=t,cur.pvFSHeight=i,cur.pvFSTop=o,s&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(s,{marginTop:o,width:t,height:i}),s.style.backgroundImage=`url('${e.src}')`))}},pvCanvasSet(){var _=cur.pvCurData;if(cur.pvCanvas&&_){var e,o=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),t=()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_fade")&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)("pv_fs_img_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_fade").id="pv_fs_img_wrap")};t(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_wrap"))&&cur.pvSlideNeedAnimation?(cur.pvSlideNeedAnimation=!1,cur.pvCanvas.insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.se)(`<div id="pv_fs_img_fade"><div style="background-image: url('${_.src}')" /></div>`),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_wrap")),e=()=>{(0,_web_lib_legacy__WEBPACK_IMPORTED_MODULE_18__.cssAnim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_wrap"),{opacity:0},{duration:1e3},(()=>{t(),Photoview.fullscreenOnLoad()})),(0,_web_lib_legacy__WEBPACK_IMPORTED_MODULE_18__.cssAnim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_fade"),{opacity:1},{duration:1e3})}):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_fs_img_wrap"),`<div style="background-image: url('${_.src}')" /></div>`),e=Photoview.fullscreenOnLoad),Photoview.pvCanvasUpdate(!0),o.onload=e,o.src=_.src,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__.FullscreenPV.updateInfo()}},updateLoc(){var _,e=cur.pvListId;cur.pvRoot?(_={0:"photo"+cur.pvCurPhoto.id},"photos"==e.substr(0,6)?_.all=1:"tag"==e.substr(0,3)?_.tag=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(e.substr(3)):"newtag"==e.substr(0,6)&&(_.newtag=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(e.substr(6))),-1!=e.indexOf("/rev")&&(_.rev=1),(0,_internal_nospam_common__WEBPACK_IMPORTED_MODULE_31__.isClaimContent)()&&(_.claim=window.nav.objLoc.claim,_.dmcah=window.nav.objLoc.dmcah)):_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(nav.objLoc,{z:"photo"+cur.pvCurPhoto.id+"/"+(cur.pvCurPhoto.list_override||e)}),nav.strLoc!=nav.toStr(_)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(_),(cur.pvOptions||{}).fromQueue&&(cur.pvNoHistory=!0,cur.pvHistoryLength=0)),cur.pvOptions&&(cur.pvOptions.fromQueue=!1)},canFullscreen(){var _=_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser,e=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.floatval)(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.version);return!_.mobile&&(document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||_.safari&&e>5)},fullscreenOnLoad(){_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__.FullscreenPV.slide()},fullscreenEnd(_){var e=cur.pvCanvas;e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(e),clearTimeout(cur.pvFSTimer),clearTimeout(cur.pvFSControlsTimer),cur.pvCanvas=cur.pvFSControls=cur.pvFSTimer=cur.pvFSControlsTimer=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(document,"webkitfullscreenchange mozfullscreenchange fullscreenchange webkitfullscreenerror mozfullscreenerror fullscreenerror"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(pageNode),cur.pvCanvasUpdateTO&&clearInterval(cur.pvCanvasUpdateTO),void 0!==cur.pvScrWasY&&((0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__.scrollToY)(cur.pvScrWasY,0),delete cur.pvScrWasY),!0!==_&&(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex)))},fullscreen(_){if(!cur.pvCanvas&&!cur.pe){var e=cur.pvCanvas=bodyNode.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{className:"fixed",id:"pv_fullscreen",innerHTML:'<div id="pv_fs_img_wrap"></div>'})),o=e.requestFullscreen||e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;cur.pvFinishing=!1,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__.FullscreenPV.init(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(document,"webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",Photoview.onFullscreen),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(document,"webkitfullscreenerror mozfullscreenerror MSFullscreenError fullscreenerror",Photoview.fullscreenEnd.pbind(!0));try{o.call(e)}catch(_){cur.pvPartScreen=!0,Photoview.onFullscreen()}return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(_)}},fullscreenStop(_){cur.pvFinishing=!0===_,cur.pvPartScreen=!1;var e=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;try{e.call(document)}catch(_){Photoview.onFullscreen()}setTimeout(Photoview.fullscreenEnd,30)},onFullscreen(){(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__.isFullScreen)()?(cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight,cur.pvScrWasY=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__.scrollGetY)(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(pageNode),cur.pvCanvasUpdateTO=setInterval(Photoview.pvCanvasUpdate.pbind(!1),100),cur.pvFinishing||(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex))):Photoview.fullscreenEnd(cur.pvFinishing)},showDD(_,e){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(_,"pv_report_blocked")&&e&&(clearTimeout(cur.hideShareTimer),_.blur(),!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(e,"pv_dd_hiding"))){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e))return(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeIn)(e,0);cur.ddShown&&Photoview.hideDD(0),cur.ddShown=e,setTimeout(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent.pbind(document,"click",Photoview.hideDD),1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(e)}},hideDD(_){if(_>0)cur.hideShareTimer=setTimeout(Photoview.hideDD.pbind(0),_);else{var e=cur.ddShown;e&&(-1==_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(e):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(e,"pv_dd_hiding"),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeOut)(e,200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(e,"pv_dd_hiding")}))),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(document,"click",Photoview.hideDD),cur.ddShown=!1)}},createDD:(_,e)=>`\n      <div onmouseover="Photoview.showDD(this.previousSibling, this);" onmouseout="Photoview.hideDD(500)" onclick="Photoview.hideDD(-1)" class="pvs_dd fixed">\n        <table cellspacing="0" cellpadding="0">\n          <tr>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n            <td>\n              <div class="pvs_header_wrap">\n                <div class="pvs_header">\n                  <span class="pvs_header_text">${e}</span>\n                </div>\n              </div>\n              <div class="pvs_acts">${_}</div>\n              <div class="pvs_sh1"></div>\n              <div class="pvs_sh2"></div>\n            </td>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n          </tr>\n        </table>\n       </div>\n    `,showShare(){clearTimeout(cur.hideShareTimer);var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pvs_dd");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_share").blur(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_))return(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeIn)(_,0);setTimeout(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent.pbind(document,"click",Photoview.hideShare),1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(_)},hideShare(_){if(_>0)cur.hideShareTimer=setTimeout(Photoview.hideShare.pbind(0),_);else{var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pvs_dd");e&&(-1==_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(e):(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeOut)(e,200),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(document,"click",Photoview.hideShare))}},savePhoto(){var _=cur.pvListId,e=cur.pvData[_][cur.pvIndex];ajax.post("al_photos.php",{act:"save_me",photo:e.id,list:_,hash:e.hash},{onDone:()=>{var _=document.getElementById("pv_save_to_me");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)(_).replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{className:"pv_save_to_me_saved",innerHTML:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_save_saved")}),_),e.actions.save=0},onFail:_=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_error"),_),!0)})},sendPhoto(){var _=cur.pvListId,e=cur.pvIndex,o=cur.pvData[_][e];(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("like.php",{act:"publish_box",object:"photo"+o.id,list:_,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")]})},moveToAlbumBox:(_,e,o)=>!(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("al_photos.php",{act:"a_move_to_album_box",photo_id:_+"_"+e,owner_id:_,from:o},{stat:["page.js","page.css","wide_dd.js","wide_dd.css"]}),moveToAlbum(_,e,o){ajax.post("al_photos.php",{act:"a_move_photo",photo:_,album_id:e,hash:o},{onDone:_=>{(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)().hide();var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_album_name");e&&(e.innerHTML=_),cur.pvCurPhoto.album=_,(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.showDoneBox)('<div class="pv_done_box">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_move_to_album_success").replace("{album}",_)+"</div>")}})},setTags(_){Photoview.hideTag(),_?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvTags),window.tooltips&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("delete",cur.pvTags),(()=>{tooltips.destroy(this)})),cur.pvTags.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_onthisphoto")+": "+_):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvTags)},preload(_,e){window.updateWndVScroll&&updateWndVScroll();var o=cur.pvListId,t=((cur.pvData||{})[o]||{}).length;if(t){var i=cur.pvVeryBig>2?"w":cur.pvVeryBig?"z":"y",r=cur.pvVeryBig>1||cur.pvVeryBig?"z":"y",a=cur.pvVeryBig>1?"z":cur.pvVeryBig?"y":"x",s=cur.pvVeryBig>1?"y":cur.pvVeryBig?"x":0;cur.pvLastFrom=_,cur.pvLastDirection=e;for(var l=Photoview.allSizes,n=0;n<Math.min(Photoview.cacheSize,t-Photoview.cacheSize);++n){for(var d=_+(n+1)*-e;d>=t;)d-=t;for(;d<0;)d+=t;var p=cur.pvData[o][d];if(p)for(var c=0,v=l.length;c<v;++c){var u=l[c];p[u]&&p[u].src&&(p[u].src=Photoview.blank,delete p[u])}}var h=function(l){for(var n=_+(l+1)*e;n>=t;)n-=t;for(;n<0;)n+=t;var d=cur.pvData[o][n];return d&&d.id?d[i]?"continue":d[i+"_src"]?(d[i]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),d[i].src=d[i+"_src"],"continue"):(d[i]=1,d[r]?"continue":d[r+"_src"]?(d[r]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),d[r].src=d[r+"_src"],"continue"):(d[r]=1,d[a]?"continue":d[a+"_src"]?(d[a]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),d[a].src=d[a+"_src"],"continue"):(d[a]=1,d[s]?"continue":d[s+"_src"]?(d[s]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),d[s].src=d[s+"_src"],"continue"):(d[s]=1,d.x?"continue":(d.x=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkImage)(),void(d.x.src=d.x_src)))))):((!d||(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()-d>3e3)&&(cur.pvData[o][n]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)(),setTimeout((()=>{ajax.post("al_photos.php",{act:"show",gid:cur.gid,list:o,offset:Photoview.realOffset(o,n,-1),direction:e},{onDone:Photoview.loaded})}),10)),"break")};_:for(var E=0;E<Photoview.cacheSize;++E){switch(h(E)){case"break":break _;case"continue":continue}}}},hide(_,e){if(Photoview.hideTag(!0),cur.pvShown&&(!__afterFocus||!0===e)){if(cur.pvCanvas&&Photoview.fullscreenStop(!0),cur.prevPhotoWidth=cur.prevPhotoHeight=0,(cur.pvJumpTo||{}).z=="albums"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pva_owner")&&!cur.pvAlbumsShown&&0===_)return Photoview.jumpToAlbums(!0);if((cur.pvJumpTo||{}).z=="album"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_album")&&!cur.pvAlbumShown&&0===_)return Photoview.jumpToAlbum(!0);if((cur.pvJumpTo||{}).z=="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pvsa_tag")&&!cur.pvPhotoTagShown&&0===_)return Photoview.jumpToTagged(!0);if("temp"==cur.pvListId)cur.pvCancelLoad();else if(!cur.pvNoHistory&&!_&&cur.pvHistoryLength>0&&cur.pvHistoryLength<10)return cur.pvNoHistory=!0,__adsUpdate("very_lazy"),cur.pvBodyScrollTop=bodyNode.scrollTop,history.go(-cur.pvHistoryLength);var o;if(!0!==_&&!layerQueue.count())cur.pvRoot?("newtag"==cur.pvListId.substr(0,6)?(o="albums"+vk.id+"?act=added",-1!=cur.pvListId.indexOf("/rev")&&(o+="&rev=1")):o=cur.pvListId.replace(/^photos/,"albums").replace("/rev","?rev=1"),nav.setLoc(o)):delete(o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(nav.objLoc)).z,nav.strLoc!=nav.toStr(o)&&nav.setLoc(o),__adsUpdate("very_lazy");window.__pvhideTimer=setTimeout(Photoview.doHide.pbind(cur),0),__adsUpdate(),cur.pvaOffset=cur.pvaInitOffset,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1}},doHide(_){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop),cur.pvTaggerTooltip&&(cur.pvTaggerTooltip.unMount(),delete cur.pvTaggerTooltip),_.pvHistoryLength=0,cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),_.pvFriends&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_add_tag","pv_cancel_tag",_.pvFriends.firstChild.firstChild,_.pvFriends),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(_.pvFriends),_.pvFriends=_.pvFriendName=!1),_web_page_wall__WEBPACK_IMPORTED_MODULE_30__.default.cancelEdit(!0);var e=Photoview.allSizes,o=_.pvListId,t=((_.pvData||{})[o]||{}).length;if(_.pvLastDirection&&t){for(var i=0;i<Photoview.cacheSize;++i){for(var r=_.pvLastFrom+(i+1)*_.pvLastDirection;r>=t;)r-=t;for(;r<0;)r+=t;var a=_.pvData[o][r];if(a)for(var s=0,l=e.length;s<l;++s){var n=e[s];a[n]&&a[n].src&&(a[n].src=Photoview.blank,delete a[n])}}_.pvLastDirection=_.pvLastFrom=!1}if(cur.pvYourComment=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(cur.pvYourComment),layers.hide(),layers.fullhide=!1,delete cur.pvLayerCreated,window.tooltips&&tooltips.destroyAll(cur.pvBox),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(layerBG,"pv_layer"),layerBG.style.opacity="",_.pvShown=_.pvListId=_.pvClicked=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(window,"resize",Photoview.onResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(document,"keydown",Photoview.onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(layerWrap,"click",Photoview.onLayerClick),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(layerWrap,"scroll",Photoview.scrollResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)(layerWrap,"mousemove",Photoview.onLayerMouseMove),cur.pvOptions){var d=cur.pvOptions.onHide;cur.pvOptions.onHide=!1,d&&(window.wkcur&&"likes"===window.wkcur.type&&window.wkcur.shown?window.wkcur.photoViewverHideCB=d:d())}if(layerQueue.pop(),Photoview.destroyPeriod(),_.pvPreloaded&&_===cur){for(var p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("photos_container"),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:_.pvPreloaded});c.firstChild;)p.appendChild(c.firstChild);p.qsorter&&setTimeout(qsorter.added.pbind(p),0),_.pvPreloaded=!1}_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_29__.default.hide(),Photoview.toggleFastChats(!0),delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&(cur.pvPhotoTags.unMount(),delete cur.pvPhotoTags)},editPhoto(){},descTT:_=>(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_34__.showTooltip)(_,{text:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_desc"),black:1,shift:[-160,13,0],showdt:0,appendParentCls:"narrow_column"}),editInline(_){if("A"!=((_||window.event||{}).target||{}).tagName&&!cur.pvEditing){window.tooltips&&window.tooltips.hideAll();var e=cur.pvListId,o=cur.pvIndex,t=cur.pvData[e][o],i=_=>{if(cur.pvShown&&cur.pvListId==e&&cur.pvIndex==o&&!cur.pvEditing){cur.pvEditing=[e,o];var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_caption_warn"),i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_desc_intro"),r=cur.pvDesc.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:`\n          <textarea\n            class="dark"\n            id="pv_edit_text"\n            onkeydown="onCtrlEnter(event, Photoview.saveInline)"\n            onkeyup="checkTextLength(cur.pvCaptionLimit, this, ${t});"\n            placeholder="${i}"\n          >${_}</textarea>\n          <div id="pv_caption_warn"><div>`},{display:"none"})),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_edit_text");(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_15__.autosizeSetup)(a,{minHeight:21,maxHeight:350}),setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(r),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.elfocus)(a),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.addEvent)(a,"blur",Photoview.saveInline),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvDesc.firstChild),cur.pvNarrowScrollbar.scrollTop(0)}),1)}};!t.desc?i(""):ajax.post("al_photos.php",{act:"edit_desc",photo:t.id},{onDone:i,progress:cur.pvProgress})}},cancelInline(){cur.pvEditing=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_edit_text"),"blur"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvDesc.firstChild),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(cur.pvDesc.firstChild.nextSibling)},saveInline(){if(cur.pvEditing){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.removeEvent)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_edit_text"),"blur");var _=cur.pvEditing[0],e=cur.pvEditing[1],o=cur.pvData[_][e],t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)("pv_edit_text"));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_desc_edit",cur.pvDesc)&&!t)return Photoview.cancelInline();ajax.post("al_photos.php",{act:"save_desc",photo:o.id,hash:o.hash,text:t},{onDone:t=>{if(o.desc=t,cur.pvShown&&_==cur.pvListId&&e==cur.pvIndex){cur.pvEditing=!1;var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvDesc);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)(i,t||'<span class="pv_desc_edit">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_edit_desc")+"</span>"),i.onmouseover=t?Photoview.descTT.pbind(i):()=>{},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domNS)(i))}},progress:cur.pvProgress})}},cmp(_,e){var o=_.length,t=e.length;return o<t?-1:o>t?1:_<e?-1:_>e?1:0},receiveComms(_,e,o,t,i,r){if(_==cur.pvListId&&e==cur.pvIndex){for(var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:o}),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments_list"),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domLC)(s),n=l,d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(n,!0)[1],p=cur.pvData[_][e],c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domLC)(a);c;c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domLC)(a)){for(p.actions.comm&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(c,"reply_replieable");n&&Photoview.cmp(n.id,c.id)>0;)n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPS)(n);n&&!Photoview.cmp(n.id,c.id)?(s.replaceChild(c,n),n=c):(n&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domNS)(n)?s.insertBefore(c,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domNS)(n)):!n&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(s)?!0===i?(--p.commshown,a.removeChild(c)):s.insertBefore(c,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(s)):s.appendChild(c),++p.commshown)}r&&l&&(layerWrap.scrollTop+=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(l,!0)[1]-d),cur.pvCommsLikes[p.id][0]=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments"),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur.pvReplyNames,t),Photoview.updateComms()}},commSaved(_){if(cur.pvShown){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments"),o=!!e&&cur.pvData[cur.pvListId][cur.pvIndex],t=_.match(/^(-?\d+)photo(_\d+)/);o&&t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comment"+t[1]+t[2])&&(cur.pvCommsLikes[o.id][0]=e)}},comments(_){if(_){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments")).id||"";if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)("pv_comments_header")||Photoview.cmp(e,"pv_comment"+_)<0)return}var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t],r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments_header");ajax.post("al_photos.php",{act:"photo_comments",offset:i.commshown,photo:i.id,list_id:cur.pvListId},{onDone:(e,i)=>{Photoview.receiveComms(o,t,e,i,!1,_),_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comment"+_)&&Photoview.showComment(_)},showProgress:()=>{r.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.showProgress)(r)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.hideProgress)(r)}})},updateComms(_){var e=cur.pvData[cur.pvListId][cur.pvIndex],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments_header"),t="";e.commcount>e.commshown&&(t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_show_prev_comments",e.commcount-e.commshown)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments_list"),"unshown",!_&&0==e.commcount),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggle)(o,t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_no_commments_placeholder"),0==e.commcount&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("_post_content",cur.pvBox)),o.innerHTML=t},commentChanged(){(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_36__.checkTextLength)(cur.pvCommLimit,cur.pvComment),cur.pvCommenting=cur.pvData[cur.pvListId][cur.pvIndex].id},updateRightBlock(_){function e(){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvLeftWrap)[1]-(cur.pvReplyForm?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvReplyForm)[1]:0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvNarrow,"height",_);var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pv_no_commments_placeholder_wrap");if(e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e.children[0])||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e.children[1]))){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(e)[1],t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)("pv_comments_list")[1],i=_-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments").offsetTop-t;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(e,"margin-top",Math.max(0,i/2-o/2))}}e(),clearTimeout(cur.pvRightBlockUpdateTO),cur.pvRightBlockUpdateTO=setTimeout(e)},getReplyAsGroupEl:()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_reply_as_group"),sendComment(_,e,o){void 0===o&&(o={});var t=cur.pvListId,i=cur.pvIndex,r=cur.pvData[t][i],a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("reply_field"+_),s=a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.data)(a,"composer"),l=(cur.pvReplyNames[(cur.reply_to||{})[0]]||[])[1],n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("addpost_button",cur.pvReplyForm),d={},p=o.stickerId;if(p)d={message:"",attach1_type:"sticker",attach1:p,sticker_referrer:o.sticker_referrer};else{if((d=s?Composer.getSendParams(s,Photoview.sendComment.pbind(_)):{message:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.trim)(Emoji.editableVal(a))}).delayed)return;if(!d.attach1_type&&(!d.message||l&&!l.indexOf(d.message)))return void Emoji.editableFocus(a,!1,!0)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)("reply_warn"+_);var c=Photoview.getReplyAsGroupEl();ajax.post("al_photos.php",_web_page_wall__WEBPACK_IMPORTED_MODULE_30__.default.fixPostParams((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(d,{act:"post_comment",photo:r.id,hash:r.hash,from_group:c&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domData)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domClosest)("_submit_post_box",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)(c)),"from-oid")<0?1:"",reply_to:(cur.reply_to||{})[1]})),{onDone:(o,l)=>{++r.commcount,Photoview.receiveComms(t,i,o,l,!0),p||(s?Composer.reset(s):Emoji.val(a,"")),a.autosize&&a.autosize.update(),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.mobile?_web_page_wall__WEBPACK_IMPORTED_MODULE_30__.default.hideEditReply(_):(Emoji.editableFocus(a,!1,!0),_web_page_wall__WEBPACK_IMPORTED_MODULE_30__.default.cancelReplyTo(_,e)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)("reply_link"+_),_web_page_wall__WEBPACK_IMPORTED_MODULE_30__.default.hideEditPostReply(null,!0),cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollBottom(),Photoview.updateRightBlock()},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(n)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(n)}})},highlightComment(_){if(_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)(_)){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(_,!0)[1],o=_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate.pbind(_,{backgroundColor:"#ECEFF3"},200,(()=>{setTimeout((()=>{(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(_,{backgroundColor:"#FFF"},200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(_,{backgroundColor:""})}))}),1e3)}));e<0||e>lastWindowHeight-200?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(layerWrap,{scrollTop:layerWrap.scrollTop+e-50},300,o):o()}},showComment(_){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comment"+_);return e?Photoview.highlightComment(e):Photoview.comments(_),!1},commDone(node,text,del,script){if(node){var fc=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(node),msg=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domNS)(fc),ph=null!=cur.pvListId&&null!=cur.pvIndex&&cur.pvData[cur.pvListId][cur.pvIndex];if(!text)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(fc),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(msg),void(ph?(++ph.commcount,++ph.commshown,Photoview.updateComms()):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_20__.photos.recache(cur.offset,1));if(msg?(msg.innerHTML=text,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(msg)):node.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:text})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(fc),del&&(ph?(--ph.commshown,--ph.commcount,Photoview.updateComms(del)):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_20__.photos.recache(cur.offset,-1)),ph&&(cur.pvCommsLikes[ph.id][0]=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_comments")),script)try{eval(script)}catch(_){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.logEvalError)(_,script)}}},commProgress(_,e){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_actions"+_);if(o){var t=o.firstChild.nextSibling;if(!0!==e)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(t),void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(o.firstChild);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(o.firstChild),t||(t=o.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{className:"progress"}))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(t)}},commParams:(_,e)=>({onDone:Photoview.commDone.pbind(_,e),progress:"pv_progress"+_+e,stat:[window.jsc("web/privacy.js"),"privacy.css"]}),commAction(_,e,o,t){if("spam"!==_){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.gpeByClass)("reply",e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.gpeByClass)("post_actions",e),a="post_actions_progress";(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(i,a)||ajax.post("al_photos.php",{act:_+"_comment",comment:o,hash:t},{onDone:Photoview.commDone.pbind(i),showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass.pbind(r,a),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass.pbind(r,a)})}else{var s=o.split("_"),l=s[0],n=s[1];this.showReportPhotoCommentForm(l,n)}},_isOverLayer:_=>_.target==layer||_.target==cur.pvCont,_isOverLayerLeft(_){if(Photoview._isOverLayer(_)){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvBox),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvBox);return _.pageX<e[0]&&_.pageY>e[1]&&_.pageY<e[1]+o[1]}},onLayerMouseMove(_){if(Photoview._isOverLayer(_)){var e=Photoview._isOverLayerLeft(_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(layerWrap,"pv_left_panel_over",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",e)}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(layerWrap,"pv_left_panel_over")},onLayerClick(_,e){if(Photoview._isOverLayer(_)&&Photoview._isOverLayerLeft(_))return Photoview.show(!1,cur.pvIndex-1,_);Photoview._doLayerClick(_,e)},_doLayerClick(_,e){if(cur.pvClicked&&!e||__afterFocus||_&&cur.__mdEvent&&_.target!=cur.__mdEvent.target)cur.pvClicked=!1;else if(!_||2!=_.button&&3!=_.which&&!_.pvHandle){_&&(_.pvHandle=!0);var o=_.pageX,t=_.pageY;if(null==o&&null!=_.clientX){var i=document.documentElement,r=bodyNode;o=_.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i.clientLeft||0),t=_.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i.clientTop||0)}var a=Math.abs(o-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(cur.pvOldX)),s=Math.abs(t-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(cur.pvOldY));(a>3||s>3)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)()-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(cur.pvOldT)>300&&(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag():cur.pvEditorMode?_.target!=layerWrap&&_.target!=layer||SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0))}},onKeyDown(_){if(!1===_.returnValue)return!1;if((!window.SPE||!window.SPE.editor)&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.inArray)(_.keyCode,[_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.DOWN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.UP])&&cur.pvNarrowScrollbar&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(_.target,"reply_field")&&_.target&&"pv_edit_text"!==_.target.id)return cur.pvNarrowScrollbar.scrollBy(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.DOWN?70:-70),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(_);if(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.ESC&&cur.pvEditing)return Photoview.cancelInline(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(_);_.altKey&&_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.RETURN&&Photoview.canFullscreen()&&(cur.pvCanvas?Photoview.fullscreenStop():Photoview.fullscreen()),_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.SPACE&&cur.pvCanvas&&(_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__.FullscreenPV.startSlide(),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_21__.FullscreenPV.showControls(!0));var e=_.target.contentEditable;return!!(window.Emoji&&Emoji.shown||_.target&&("INPUT"==_.target.tagName||"TEXTAREA"==_.target.tagName||"DIV"==_.target.tagName&&e&&"inherit"!=e))||(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.ESC?(cur.pvCanvas?Photoview.fullscreenStop():cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag():_.vkCanceled||(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)()||(cur.pvEditorMode?SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0)),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(_)):(cur.pvTagger||boxQueue.count()||cur.pvComment&&cur.pvComment.focused||_.ctrlKey||(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.RIGHT?Photoview.show(cur.pvListId,cur.pvIndex+1):_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.KEY.LEFT&&Photoview.show(cur.pvListId,cur.pvIndex-1)),!cur.pvCanvas&&void 0))},updateVerticalPosition(_){if(cur.pvCont){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvCont),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.clientHeight)()/2-e[1]/2-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(layer,"margin-top",Math.round(o))}},calculateVeryBig(){var _=Math.max(document.documentElement.clientWidth,window.innerWidth||0);cur.pvVeryBig=_>1800?3:_>1200?2:_>800&&1,window.devicePixelRatio>1&&(cur.pvVeryBig+=1,cur.pvVeryBig=Math.min(3,cur.pvVeryBig))},updateNavBtnsLeftThreshold(_){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvImageWrap)[0],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvImageWrap)[0];cur.pvLeftBtnAmount&&!_||(cur.pvLeftBtnAmount=o+Photoview.LEFT_RIGHT_NAV_RATIO*e)},updatePhotoDimensions(_){if(!Photoview.isPhotosList()&&!cur.pvEditorModeDimensionsUpdated){var e=Photoview.MIN_WIDTH,o=Photoview.MIN_HEIGHT;cur.pvEditorMode&&(e=Photoview.PE_MIN_WIDTH,o=Photoview.PE_MIN_HEIGHT,cur.pvEditorModeDimensionsUpdated=!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvBottomInfo,"pv_with_line_break");var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvTagInfo),i=t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvTagInfo)[1]:0,r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),a=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvBottomInfo)[1],l=Math.max(e,r-Photoview.SIDE_COLUMN_WIDTH-2*Photoview.SIDE_MIN_GAP),n=Math.max(o,a-s-2*Photoview.VERTICAL_MIN_GAP-i);Photoview.calculateVeryBig();var d=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(cur.pvCurData||{width:e,height:o});d.width=d.width||e,d.height=d.height||o;var p=d.width/d.height,c=Math.min(l,d.width),v=c/p;v=Math.min(n,v),c=Math.ceil(v*p);var u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvBottomLeft)[0]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvBottomLeft)[0]>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvBottomActions)[0]-20;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvBottomInfo,"pv_with_line_break",u),_&&(cur.prevPhotoWidth=cur.prevPhotoHeight=0);var h=cur.prevPhotoWidth=Math.max(c,e,cur.prevPhotoWidth||0),E=cur.prevPhotoHeight=Math.max(v,o,(cur.prevPhotoHeight||0)-i),P=Math.max(0,E/2-v/2);if(P>0&&!t){var g=((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvPhoto)[1]+s)/2-v/2;g>s&&(P=g)}cur.pvAttachedProducts.photoSize={width:c,height:v,top:P},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvPhoto,{width:h,height:E});(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvBottomInfo,{width:h-46}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)(cur.pvPhoto),{width:c,height:v,marginTop:P}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagInfo,{width:h}),cur.pvTagFrame&&Photoview.updateTagFrameDimensions(c,v,P),cur.pvPhotoTagsContainer&&Photoview.updatePhotoTagsContainerDimensions(c),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvImgProgress,"marginTop",P+v/2);var m=(cur.pvIsLightMode?0:Photoview.SIDE_COLUMN_WIDTH)+h;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvCont,{width:m,paddingLeft:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.sbWidth)()}),Photoview.updateRightBlock(),Photoview.updateVerticalPosition(),cur.pvPhWidth=c,cur.pvPhHeight=v,Photoview.updateNavBtnsLeftThreshold();var b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvCont),w=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvCont),D=b[1]+w[1],M=r-(b[0]+w[0])<85||a-D<60;Photoview.toggleFastChats(!M)}},toggleFastChats(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)("chat_onl_wrap","hidden",!_),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("rb_box_wrap"),(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(this,"hidden",!_)}))},onResize(){if(cur.pvCanvas){var _=cur.pvVeryBig,e=cur.pvCanvas.offsetWidth,o=cur.pvCanvas.offsetHeight;return cur.pvVeryBig=e>1280||o>1280?2:(e>807||o>807)&&1,void(_!=cur.pvVeryBig&&setTimeout(Photoview.preload.pbind(cur.pvIndex,cur.pvLastDirection||1),10))}if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvCont,"width",800):Photoview.updatePhotoDimensions(!0),cur.pvPhoto){if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.mozilla&&cur.pvPhoto.firstChild){var t=cur.pvPhoto.firstChild.offsetLeft,i=(lastWindowWidth-cur.pvActualWidth)%2&&(cur.pvActualWidth-cur.pvPhWidth)%2?4:3;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagFrame,{left:t-i+"px"})}Photoview.scrollResize(),Photoview.stopTagger()}},stopTagger(){cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag()},updateSize(){cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown||!!cur.pvAlbumShown),onBodyResize(),Photoview.onResize()},activate(_){_&&_.timeout?(clearTimeout(_.timeout),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeAttr)(_,"timeout")):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_)&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeTo)(_,200,vk.pvdark?1:.7)},deactivate(_){_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_)&&!_.timeout&&(_.timeout=setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeAttr)(_,"timeout"),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeTo)(_,200,.4)}),1))},deletePhoto(_){var e=cur.pvListId,o=cur.pvIndex,t=cur.pvData[e][o],i=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)();if(cur.deletionProgress=cur.deletionProgress||{},!cur.deletionProgress[t.id])if(cur.deletionProgress[t.id]=!0,cur.pvTagger)Photoview.stopTagger();else{cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas();var r={act:"delete_photo",photo:t.id,hash:t.hash,set_prev:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isChecked)("pvb_prev_check"),sure:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_)};(0,_internal_nospam_common__WEBPACK_IMPORTED_MODULE_31__.isClaimContent)()&&(r._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_photos.php",r,{onDone:(_,r)=>{if(cur.deletionProgress[t.id]=!1,i)return i.hide(),nav.go("/id0",!1,{nocur:!0});e==cur.pvListId&&o==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(r||(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_deleted"),_),t.deleted=[cur.pvTagInfoText.innerHTML,cur.pvTagInfoButtons.innerHTML],Photoview.toggleDeletedState(!0),Photoview.updatePhotoDimensions())}})}},restorePhoto(_){var e=cur.pvListId,o=cur.pvIndex,t=cur.pvData[e][o];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isButtonLocked)(_)||ajax.post("al_photos.php",{act:"restore_photo",photo:t.id,hash:t.hash},{onDone:_=>{t.deleted=!1,e==cur.pvListId&&o==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1),Photoview.updatePhotoDimensions()),cur.pvPhotoTags&&cur.pvPhotoTags.showAreas()},onFail:_=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_error"),_),!0),showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(_),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)})},spamPhoto(_,e){var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isButtonLocked)(e)||(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_22__.Phototag.stopTag():ajax.post("al_photos.php",{act:"spam_photo",photo:i.id,hash:i.hash,spam_hash:_,pv:1},{onDone:(_,e)=>{e&&(i.deleted=_),o==cur.pvListId&&t==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photo_marked_as_spam_restore"),""),e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvCommentsData))},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(e),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(e)}))},rotatePhoto(_){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_rotate_progress");if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e)){_%=4,Photoview.stopTagger(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(e);var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t],r=i.id,a=i.rotate_hash;window.ajax.post("/al_photos.php?act=make_rotate",{type:"view",list_id:o,hash:a,photo:r,index:t,to:_},{onDone:Photoview.rotatePhotoDone,onFail:Photoview.rotatePhotoDone})}},rotatePhotoOld(_){var e=document.querySelector("#pv_rotate_progress");if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e)){Photoview.stopTagger(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_rotate").appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{id:"pv_rotate_frame",className:"upload_frame",innerHTML:'<iframe name="pv_rotate_frame"></iframe>'}));var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t],r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_rotate_form");r.innerHTML="",r.action=i.rotate[0];var a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({act:"do_rotate",to:_,list_id:o,index:t,fid:i.id},i.rotate);if(_=(_+4)%4,"rotate_photo"==a.act&&(a.angle=(a.angle+_)%4),a["rot"+_])return a.act="done_rotate",a.complete=1,void window.ajax.post("/al_photos.php",a,{onDone:Photoview.rotateDone,onFail:()=>{Photoview.rotateDone()}});for(var s in a)0!=s&&r.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("input",{type:"hidden",name:s,value:a[s]}));r.submit()}},rotatePhotoDone(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)("pv_rotate_progress"),_){var e=_.list_id;if(e){var o=_.index,t=cur.pvData[e][o];t&&(Object.entries(_.photos).forEach((function(_){var e=_[0],o=_[1];t[`${e}_`]=o,t[`${e}_src`]=o[0]})),e===cur.pvListId&&o===cur.pvIndex&&Photoview.show(e,o),cur.pvPhotoTags&&cur.pvPhotoTags.reload())}}},rotateDone(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)("pv_rotate_progress");var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_rotate_frame");if(e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(e),_)){var o=_.list_id,t=_.index,i=cur.pvData[o][t];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(i,{x_src:_.x_src,y_src:_.y_src,z_src:_.z_src,w_src:_.w_src,base:_.base,x_:_.x_,y_:_.y_,z_:_.z_,w_:_.w_,x:0,y:0,z:0,w:0,tags:_.tags,tagged:_.tagged,suggested_tags:_.suggested_tags,tagshtml:_.html}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(i.rotate,{photo:_.photo,hash:_.hash,rhash:_.rhash,angle:_.angle,rot1:_.rot1,rot3:_.rot3}),o==cur.pvListId&&t==cur.pvIndex&&Photoview.show(o,t),cur.pvPhotoTags&&cur.pvPhotoTags.reload()}},likeUpdate(_,e,o){e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_like"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domByClass)(t,"_count");if(i){var r=t.tt||{},a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(r.opts||{}),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domByClass)(r.container,"_value"),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domByClass)(r.container,"_content"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domByClass)(r.container,"_title");o&&n&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)(n,o),r&&(r.likeInvalidated=!0),s&&(s.value=e),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animateCount)(i,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(t,"pv_liked",_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(t,"no_likes",!e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.toggleClass)(l,"me_hidden",!_),e?!r.el||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(r.container)||o||tooltips.show(r.el,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(a,{showdt:0})):r.el&&r.hide()}},tagOver(_){(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(_,{backgroundColor:"#6B8DB1"},200),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_34__.showTooltip)(_,{text:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_delete_tag"),shift:[0,-2,0]})},tagOut(_){_.parentNode&&_.parentNode.parentNode&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(_,{backgroundColor:"#C4D2E1"},200)},deleteTag(_,e){var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t];if(i.tagid){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)("pv_tag_handling"))return}else if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_action_progress"))return;var r=e?1:0;ajax.post("al_photos.php",{act:"delete_tag",photo:i.id,tag:_,hash:i.hash,top_panel:r,extended:1},{onDone:(e,r,a,s)=>{i.tagid?((0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_40__.decrementLeftMenuPhotoCounter)(),cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_39__.TagEventTypes.DECLINE_USER_TAG,{tagId:_,photoRawId:i.id}),i.taginfo=i.tagid=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_tag_deleted"),e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(cur.pvTagInfoButtons,"no_events"),setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvTagInfoButtons,"no_events")}),1e3)):Photoview.actionInfo().innerHTML=e,void 0!==r&&(i.tags=r,i.tagged=a,i.tagshtml=s,cur.pvListId==o&&cur.pvIndex==t&&(Photoview.setTags(s),(!i.taginfo&&i.actions.tag&&r[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvTagLink))),cur.pvPhotoTags&&cur.pvPhotoTags.deleteTag(_)},onFail:_=>{if(_)return Photoview.actionInfo().innerHTML=_,!0},showProgress:()=>{if((0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(e),i.tagid);else{var _=Photoview.actionInfo();_.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.showProgress)(_)}},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(e),i.tagid||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(Photoview.actionInfo())}})},restoreTag(_){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_action_progress")){var e=cur.pvListId,o=cur.pvIndex,t=cur.pvData[e][o];ajax.post("al_photos.php",{act:"restore_tag",photo:t.id,tag:_,hash:t.hash},{onDone:(_,i,r,a)=>{void 0!==i&&(t.tags=i,t.tagged=r,t.tagshtml=a,cur.pvListId==e&&cur.pvIndex==o&&(Photoview.setTags(a),(!t.taginfo&&t.actions.tag&&i[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvTagLink)),cur.pvPhotoTags&&cur.pvPhotoTags.renderTagAreas()),Photoview.actionInfo().innerHTML=_},onFail:_=>{if(_)return Photoview.actionInfo().innerHTML=_,!0},showProgress:()=>{var _=Photoview.actionInfo();_.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.showProgress)(_)},hideProgress:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(Photoview.actionInfo())}})}},confirmTag(_,e){var o=cur.pvListId,t=cur.pvIndex,i=cur.pvData[o][t];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)("pv_tag_handling")||ajax.post("al_photos.php",{act:"confirm_tag",tag:_,photo:i.id,hash:i.hash,extended:1},{onDone:(e,r,a)=>{i.tags=e,i.tagged=r,i.tagshtml=a,i.taginfo=i.tagid=!1,cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_39__.TagEventTypes.CONFIRM_USER_TAG,{tagId:_,photoRawId:i.id}),(0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_40__.decrementLeftMenuPhotoCounter)(),o==cur.pvListId&&t==cur.pvIndex&&(Photoview.setTags(a),(!i.taginfo&&i.actions.tag&&e[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(cur.pvTagLink),i.suggestedTagsInfo&&!i.taginfo&&e[0]<cur.pvMaxTags?Photoview.showSuggestedInfoTopPanel(i):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1)))},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(e)}})},confirmAllSuggestedTags(_){if(cur.pvPhotoTags){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(_);var e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.getPhotoData)("suggested_tags"),o=Object.keys(e);cur.pvPhotoTags.confirmSuggestedTags(o,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)}))}},declineAllSuggestedTags(_){if(cur.pvPhotoTags){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(_);var e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_37__.getPhotoData)("suggested_tags"),o=Object.keys(e);cur.pvPhotoTags.declineSuggestedTags(o,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)}))}},toProfileTag(){var _=cur.pvData[cur.pvListId][cur.pvIndex].tagged[vk.id];_&&!cur.pvTagger&&Photoview.showTag(_)},showTag(_){cur.pvPhotoTags&&cur.pvPhotoTags.showTagArea(_)},showDynTag(_){if(clearTimeout(cur.pvHidingTag),cur.pvShowingTag!=_){var e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(cur.pvData[cur.pvListId][cur.pvIndex].tags[_]),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_tag"+_);if(o){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.each)(e,((_,o)=>{e[_]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.positive)(o*cur[_%2?"pvPhHeight":"pvPhWidth"]/100)}));var t=0;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(cur.pvTagInfo)&&(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvTagInfo)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagPerson,{marginLeft:e[0]+"px",marginTop:t+e[3]+"px",minWidth:e[2]-e[0]+"px"}),cur.pvTagPerson.innerHTML=o.firstChild.innerHTML;var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvTagPerson);e[3]+i[1]>cur.pvPhHeight&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(cur.pvTagPerson,{marginTop:cur.pvPhHeight-i[1]+"px"}),cur.pvTagPerson.onmouseover=Photoview.showDynTag.pbind(_),cur.pvShowingTag=_,_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.show)(cur.pvTagPerson):(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.fadeIn)(cur.pvTagPerson,200)}}},hideTag(){cur.pvPhotoTags&&cur.pvPhotoTags.hideTagArea()},realOffset(_,e,o){var t=e;if(!cur.pvData||!cur.pvData[_])return t;for(var i=0;i<e;i++)cur.pvData[_][i]&&(cur.pvData[_][i].deleted||cur.pvData[_][i].moved)&&(t+=o);return t},realCount(_,e){var o=e;if(!cur.pvData||!cur.pvData[_])return o;for(var t=0;t<cur.pvData[_].length;t++)cur.pvData[_][t]&&(cur.pvData[_][t].deleted||cur.pvData[_][t].moved)&&o++;return o},list(_,e,o){"deleted"!=o&&(cur.pvList||(cur.pvList={}),cur.pvList[_+"_"+e]=o)},loaded(_,e,o,t,i){if("deleted"!=_){if(i&&((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{lang:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur.lang||{},i.lang),pvHash:i.hash,pvCommLimit:i.commlimit,pvCaptionLimit:i.captionlimit,pvMaxTags:i.maxtags,pvReasons:i.reasons,pvReplyNames:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur.pvReplyNames||{},i.names||{}),pvAskForAutoTag:i.ask_for_autotag,pvNeedShowAlertForOneSuggest:i.need_show_alert_for_one_suggest,pvNeedShowAlertForSomeSuggests:i.need_show_alert_for_some_suggests,pvOneSuggestHintId:i.one_suggest_hint_id,pvOneSuggestHintHash:i.one_suggest_hint_hash,pvSomeSuggestsHintId:i.some_suggests_hint_id,pvSomeSuggestsHintHash:i.some_suggests_hint_hash,pvTagsQueueParams:i.qparams}),window.pvcur=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(window.pvcur||{},{wallTpl:i.wallTpl,rmedia_types:i.rmedia_types}),cur.wallTpl=cur.wallTpl||i.wallTpl,cur.options||(cur.options={}),cur.options.share||(cur.options.share=i.share),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_add_media")),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_add_media"))),e=Photoview.realCount(_,e),o=Photoview.realOffset(_,o,1),cur.pvData||(cur.pvData={}),cur.pvCommsLikes||(cur.pvCommsLikes={}),cur.pvData[_])if(cur.pvData[_].length<e)for(var r=cur.pvData[_].length;r<e;++r)cur.pvData[_].push(void 0);else cur.pvData[_].length>e&&(cur.pvData[_]=cur.pvData[_].slice(0,e));else cur.pvData[_]=new Array(e);for(var a=0,s=t.length;a<s;++a){for(var l=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(t[a]),n=o+a;n>=e;)n-=e;cur.pvCommsLikes[l.id]=[l.comments,l.likes,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.vkNow)(),!1],delete l.comments,delete l.likes,cur.pvData[_][n]=l}}},showDeleted(_,e,o){cur.pvShown&&"temp"==cur.pvListId&&(e+="<br><br>"+o),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showFastBox)({title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_error"),onHide:()=>{cur.pvShown&&"temp"==cur.pvListId&&Photoview.hide(!0)}},e)},spamDeleted(_,e,o){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)().progress)||ajax.post("al_photos.php",{act:"spam_photo",photo:e,hash:o,from:"deleted"},{onDone:e=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domPN)(_).replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("span",{innerHTML:e}),_)},showProgress:(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)().showProgress,hideProgress:(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)().hideProgress})},showPhoto(_,e,o,t){if(cur.pvShown&&("temp"!=cur.pvListId||cur.pvWasShown)&&void 0===o.noHistory||((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("in showPhoto noHistory: "+o.noHistory),cur.pvNoHistory=o.noHistory,cur.pvHistoryLength=o.noHistory?0:o.histLen||0),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(cur,{pvJumpTo:o.jumpTo||!1,pvJumpFrom:!1,pvJumpSteps:0}),e=cur.pvList&&cur.pvList[_+"_"+e]||e,cur.pvData&&cur.pvData[e]){var i=cur.pvData[e],r=cur.pvOptions&&cur.pvOptions.onHide,a=!0;cur.pvOptions=o,cur.pvOptions.onHide||(cur.pvOptions.onHide=r);for(var s=0,l=i.length;s<l;++s)if(i[s]){if(i[s].id===_)return Photoview.show(e,s,!1,o.root),o.onShow&&o.onShow(),!1}else a=!1;return a&&t?(o.onEmpty&&o.onEmpty(),!1):void 0}},loadedAlbums(_,e,o,t){cur.pvAlbumsData&&(ajax.preload("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({offset:t.offset,part:1,owner:_},{act:"show_albums"}),o),cur.curYear=t.cur_year,cur.pvAlbumsData[_]={html:e,opts:t},cur.pvaInitOffset=t.offset,cur.pvAlbumsShowing==_&&(Photoview.doShowAlbums(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)))},showAlbums(_,e){_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_),cur.pvAlbumsData||(cur.pvAlbumsData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvAlbumsShowing=_;var o=e.onFail;cur.pvAlbumsData[_]?"loading"!=cur.pvAlbumsData[_]&&(Photoview.doShowAlbums(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)):(cur.pvAlbumsData[_]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(e,{onDone:Photoview.loadedAlbums,onFail:e=>(o&&o(e),delete cur.pvAlbumsData[_],cur.pvAlbumsData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedAlbum(_,e,o,t){cur.pvAlbumData&&(o&&ajax.preload("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({offset:t.offset,part:1,album:_},{act:"show_album"}),o),cur.pvAlbumData[_]={html:e,opts:t},cur.pvAlbumShowing==_&&(Photoview.doShowAlbum(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)))},showAlbum(_,e){cur.pvAlbumData||(cur.pvAlbumData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvAlbumShowing=_;var o=e.onFail;cur.pvAlbumData[_]?"loading"!=cur.pvAlbumData[_]&&(Photoview.doShowAlbum(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)):(cur.pvAlbumData[_]="loading",ajax.post("al_photos.php",{act:"show_album",album:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(e,{onDone:Photoview.loadedAlbum,onFail:e=>(o&&o(e),delete cur.pvAlbumData[_],cur.pvAlbumData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedTagged(_,e,o){cur.pvPhotoTagData&&(cur.pvPhotoTagData[_]={html:e,opts:o},cur.pvPhotoTagShowing==_&&(Photoview.doShowTagged(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)))},showTagged(_,e){_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(_),cur.pvPhotoTagData||(cur.pvPhotoTagData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvPhotoTagShowing=_;var o=e.onFail;cur.pvPhotoTagData[_]?"loading"!=cur.pvPhotoTagData[_]&&(Photoview.doShowTagged(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.boxRefreshCoords)(layer)):(cur.pvPhotoTagData[_]="loading",ajax.post("al_photos.php",{act:"show_tag",mid:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)(e,{onDone:Photoview.loadedTagged,onFail:e=>(o&&o(e),delete cur.pvPhotoTagData[_],cur.pvPhotoTagData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},updatePeriods(){Photoview.periods=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass)("photos_period_delimiter")},destroyPeriod(){Photoview.fixedPeriod&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)},fixPeriod(){if(Photoview.periods&&Photoview.periods.length){var _=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__.scrollGetY)(),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(Photoview.periods[0])[1],o=!1,t=!1;for(var i in Photoview.periods)if(Photoview.periods.hasOwnProperty(i)){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(Photoview.periods[i])[1]>=_)break;o=Photoview.periods[i];var r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.intval)(i)+1;t=!!Photoview.periods[r]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(Photoview.periods[r])[1]-_}if(o){o==Photoview.fixedPeriodEl||(Photoview.fixedPeriod?Photoview.fixedPeriod.innerHTML=o.innerHTML:(Photoview.fixedPeriod=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:o.innerHTML,className:"pva_period_fixed"},{left:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(o)[0]+"px"}),utils.appendChild(Photoview.fixedPeriod)),Photoview.fixedPeriodEl=o);var a=!1!==t?t-e:0;a>=0&&(a=0),Photoview.fixedPeriodTop!==a&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.setStyle)(Photoview.fixedPeriod,{top:a+"px"}),Photoview.fixedPeriodTop=a)}else!o&&Photoview.fixedPeriod&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)}},scrollResize(){if(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.mobile&&cur.pvShown&&(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown||cur.pvVideoTagsShown)){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more"),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pva_more_load_more"),o=3*lastWindowHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_)&&o>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(_)[1]-(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie6?0:(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__.scrollGetY)())&&(cur.pvVideoTagsShown?Photoview.loadVideoTags():cur.pvPhotoTagShown?Photoview.loadTaggedPhotos():cur.pvAlbumsShown?Photoview.loadAlbumsPhotos():Photoview.loadAlbumPhotos()),cur.pvAlbumsShowing&&Photoview.fixPeriod(),cur.pvAlbumsShown&&cur.pvShowAllAlbums&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e)&&o>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(e)[1]-(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_10__.browser.msie6?0:(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_17__.scrollGetY)())&&Photoview.loadAlbums()}},loadAlbums(){cur.pvShowAllAlbums=!0,Photoview.loadAlbumsPhotos(!0)},loadedAlbumsPhotos(_,e,o,t){if(cur.pvaLoading=0,cur.pvAlbumsShown){o?cur.pvaOffset=_:cur.pvaPhotosOffset=_,t&&(cur.curYear=t);var i=o?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pva_content"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pva_content_photos"),r=o?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pva_more_load_more"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more"),a=o?{act:"show_albums"}:{act:"show_albums",only_photos:1,cur_year:cur.curYear},s=o?cur.pvaOffset:cur.pvaPhotosOffset,l=o?cur.pvaCount:cur.pvaPhotosCount;if(i){for(var n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{innerHTML:e});n.firstChild;){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hasClass)(n.firstChild,"photos_period_delimiter")){var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.domData)(n.firstChild,"year");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("photos_period_delimiter_"+d)){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.re)(n.firstChild);continue}}i.appendChild(n.firstChild)}Photoview.onResize(),Photoview.updatePeriods(),_>=l||!e?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(r):o&&(cur.pvaLoading=1,ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({offset:s,part:1,owner:cur.pvAlbumsShown},a||{}),{onDone(){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("preload done: "+cur.pvaLoading),2==cur.pvaLoading?Photoview.loadedAlbumsPhotos.apply(window,arguments):cur.pvaLoading=!1},onFail:()=>(cur.pvaLoading=0,!0)}))}}},loadAlbumsPhotos(_){var e=_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pva_more_load_more"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more"),o=_?{act:"show_albums"}:{act:"show_albums",only_photos:1},t=_?cur.pvaOffset:cur.pvaPhotosOffset;cur.pvAlbumsShown&&e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(e)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isButtonLocked)(e)&&(cur.pvaLoading?cur.pvaLoading=2:ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({offset:t,part:1,owner:cur.pvAlbumsShown},o||{}),{cache:o.only_photos?0:1,onDone:Photoview.loadedAlbumsPhotos,onFail:()=>(cur.pvaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(e)}}))},loadedAlbumPhotos(_,e){if(cur.pvaLoading=0,cur.pvAlbumShown){cur.pvsaOffset=_;var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pvsa_content_photos"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more");if(o){if(o.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cf)(e)),!cur.pvAlbumData[cur.pvAlbumShown].opts.no_known_count&&_>=cur.pvsaCount||!e)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(t),void Photoview.onResize();setTimeout((()=>{Photoview.onResize()}),10),cur.pvsaLoading=1,ajax.post("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},{onDone(){2==cur.pvsaLoading?Photoview.loadedAlbumPhotos.apply(window,arguments):(cur.pvsaLoading=!1,ajax.preload("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},arguments))},onFail:()=>(cur.pvsaLoading=0,!0)})}}},loadAlbumPhotos(){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more"),e=cur.pvsaOffset;cur.pvAlbumShown&&_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isButtonLocked)(_)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_album",album:cur.pvAlbumShown,offset:e,part:1},{onDone:Photoview.loadedAlbumPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(_)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)},cache:!0}))},loadedTaggedPhotos(_,e){if(cur.pvaLoading=0,cur.pvPhotoTagShown){cur.pvsaOffset=_;var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pvsa_content_photos"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more");o&&(o.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.cf)(e)),Photoview.onResize(),_>=cur.pvsaCount||!e?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)(t):(cur.pvsaLoading=1,ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.extend)({offset:cur.pvsaOffset,part:1,mid:cur.pvPhotoTagShown},{act:"show_tag"}),{onDone(){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_24__.debugLog)("preload done: ",cur.pvsaLoading),2==cur.pvsaLoading?Photoview.loadedTaggedPhotos.apply(window,arguments):cur.pvsaLoading=!1},onFail:()=>(cur.pvsaLoading=0,!0)})))}},loadTaggedPhotos(){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("ui_pv_photos_load_more"),e=cur.pvsaOffset;cur.pvPhotoTagShown&&_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.isVisible)(_)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.isButtonLocked)(_)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_tag",mid:cur.pvPhotoTagShown,offset:e,part:1},{onDone:Photoview.loadedTaggedPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.lockButton)(_)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_32__.unlockButton)(_)},cache:1}))},thumbOver(_,e){clearTimeout((cur.pvHideTO||{})[e]);var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_title",_),t=o.previousSibling,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_desc",_))[1];i<5||((0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(o,{marginTop:146-(i+7)},{duration:200,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.Fx.Transitions.easeOutCirc}),"pva_repeat"==t.className&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(t,{marginTop:43-Math.floor((i+7)/2)},{duration:200,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.Fx.Transitions.easeOutCirc}))},thumbOut(_,e){cur.pvHideTO||(cur.pvHideTO={}),cur.pvHideTO[e]=setTimeout((()=>{var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_title",_),o=e.previousSibling;(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(e,{marginTop:146},200),"pva_repeat"==o.className&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_35__.animate)(o,{marginTop:43},200)}),150)},fsMove(_){if(!(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown)&&cur.pvCurPhoto.author){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getXY)(cur.pvActions),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.getSize)(cur.pvActions),t=Math.max(100,.2*cur.pvPhWidth);_.pageX>e[0]-t&&_.pageX<e[0]+o[0]+t&&_.pageY>e[1]-t&&_.pageY<e[1]+o[1]+t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.addClass)(cur.pvActions,"visible"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.removeClass)(cur.pvActions,"visible")}},showRepeat(_){if(_&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_repeat",_)){var e=window.stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":""),o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_repeat_album");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_link",_).insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ce)("div",{className:"pva_repeat",innerHTML:`\n        <div class="pva_repeat_blob">\n         <div class="pva_repeat_cont">\n         <img class="pva_repeat_img png" src="${e}.png?3" />\n         <span class="pva_repeat_text">${o}</span></div>\n        </div>`}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.geByClass1)("pva_title",_))}},showPlace(){var _=cur.pvCurPhoto.geohash;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("al_places.php",{act:"show_photo_place",geohash:_,photo:cur.pvCurPhoto.id},{cache:1})},editPlace(){var _=cur.pvCurPhoto.geohash;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("al_places.php",{act:"show_photo_place",edit:1,geohash:_||"",photo:cur.pvCurPhoto.id})},updatePlace(_,e){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_edit_place");e?(o&&(o.innerHTML=e?e+".":""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.ge)("pv_place").innerHTML=e?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+e+"</a>":"",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_26__.hide)("pv_add_place")):setTimeout((()=>{ajax.post("al_photos.php",{act:"get_photo_place",photo:_},{onDone:e=>{Photoview.updatePlace(_,e)}})}),1e3)},reportComment(_,e,o){var t=o.split("_"),i=t[0],r=t[1];this.showReportPhotoCommentForm(i,r)},selectProductInBox:function(){var _=cur.pvData[cur.pvListId][cur.pvIndex].attached_tags,e=(_.tags?_.tags.length:0)>=_.max_tags_per_object;if(_.tags&&e)return(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_error"),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("market_attach_products_overflow",_.max_tags_per_object)),!1;(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.showAttachProductBox)(window.event,Photoview.attachProduct)},attachProduct:function(_){(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_16__.curBox)().hide();var e=`<span class="attach_market_title">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("market_product_attach_photo")} "${_.title}</span>`,o=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("groups_cancel2"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"attach_market_cancel"}}),t=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.render({children:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("Save"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButtonSize.M,disabled:!0,restAttrs:{id:"attach_market_save"}});Photoview.toggleTopInfoPanel(e,[o,t]);var i=()=>{Photoview.toggleTopInfoPanel();var _=cur.pvAttachedProducts;_.point&&_.point.remove(),cur.pvAttachedProducts.isProcess=!1};cur.pvAttachedProducts.isProcess=!0,document.getElementById("attach_market_cancel").addEventListener("click",i),document.getElementById("attach_market_save").addEventListener("click",(function(){i();var e,o=cur.pvAttachedProducts;if(Object.assign(_,o.tempTag),!o.tempTag)return!1;if(document.getElementById("MarketList")){var t=Photoview.generateMarketListItem(_),r=t[0],a=t[1];e=r,document.getElementById("MarketList").appendChild(r),cur.pvImageAreaWrap.appendChild(a)}else{var s=Photoview.generateMarketList([_],!0),l=s[0],n=s[1],d=s[2];e=d,cur.pvImageAreaWrap.appendChild(n),document.getElementById("pv_attached_products_list").appendChild(l)}var p=cur.pvData[cur.pvListId][cur.pvIndex],c="link"===_.type?_.url:_.url.match(/product-?\d+_\d+/)[0],v=p.id.split("_"),u=v[0],h=v[1];_.x=o.tempTag.x,_.y=o.tempTag.y,ajax.post("al_market.php",{act:"add_tag_content_product",owner_id:u,item_id:h,type:"photo",hash:p.attached_tags.hash,tag_object:c,x:o.tempTag.x,y:o.tempTag.y},{onDone:o=>{e.id=o,p.attached_tags.tags=p.attached_tags.tags||[],_.tag_id=o,p.attached_tags.tags.push(_)}})}))},attachProductPoint:function(_){var e=document.getElementById("pv_product_point");e||((e=document.createElement("div")).classList.add("attach_market_point"),e.id="pv_product_point");var o=cur.pvImageAreaWrap,t=cur.pvAttachedProducts;t.tempTag=t.tempTag||{},_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_42__.FlatButton.setDisabled(document.getElementById("attach_market_save"),!1);var i=_.currentTarget.getBoundingClientRect(),r=cur.pvAttachedProducts.photoSize,a=_.clientX-i.left-(i.width-r.width)/2,s=_.clientY-i.top-(i.height-r.height)/2;a>0&&s>0&&a<r.width&&s<r.height&&(document.getElementById("pv_product_point")||o.appendChild(e),t.tempTag.y=(_.clientY-i.top-r.top)/r.height,t.tempTag.x=(_.clientX-i.left-(i.width-r.width)/2)/r.width,e.style.top=_.clientY-i.top+"px",e.style.left=_.clientX-i.left+"px"),t.point=e},generateMarketList:function(_){var e=document.createElement("span");e.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_attached_goods"),e.classList.add("pv_photo_product_attach_label");var o,t=document.createElement("ul");t.id="MarketList",t.classList.add("AttachedProductsList");var i=document.createDocumentFragment(),r=document.createDocumentFragment();_&&_.forEach((function(e){var t=Photoview.generateMarketListItem(e);1===_.length&&(o=t[0]),i.appendChild(t[0]),r.appendChild(t[1])})),t.appendChild(i);var a=document.createElement("div");return a.appendChild(e),a.appendChild(t),[a,r,o]},generateMarketListItem:function(_){var e=document.createElement("li");e.id=_.tag_id,e.classList.add("AttachedProductsList__item");var o=document.createElement("a");o.href=_.url,o.setAttribute("target","_blank");var t=e=>{(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.checkEvent)(e)||(layerQueue.push(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e),(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.showWiki)({w:_.url.match(/product-?\d+_\d+/)[0]},!1,e,{onLoaded:()=>(0,_shared_market_analytics_utils__WEBPACK_IMPORTED_MODULE_43__.onMarketItemCardOpen)(_shared_ecomm_market_stats_types__WEBPACK_IMPORTED_MODULE_44__.RefSource.PHOTO)}))};"link"!==_.type&&o.addEventListener("click",t),o.classList.add("AttachedProductsList__content");var i=document.createElement("div");i.classList.add("AttachedProductsList__img"),i.style.backgroundImage="url("+(_.thumb||"/images/market/attach_product_list_placeholder.png")+")",o.appendChild(i);var r=document.createElement("span");r.classList.add("AttachedProductsList__title"),r.innerHTML=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.unclean)(_.title)),o.appendChild(r);var a=document.createElement("span");a.classList.add("AttachedProductsList__price"),a.innerHTML=_.price,o.appendChild(a),e.appendChild(o);var s=cur.pvData[cur.pvListId][cur.pvIndex],l=document.createElement("button");s.attached_tags&&s.attached_tags.hash&&(l.classList.add("AttachedProductsList__cross"),e.appendChild(l));var n=document.createElement("a");n.href=_.url,n.setAttribute("target","_blank"),"link"!==_.type&&n.addEventListener("click",t),n.classList.add("pv_attach_product_badge"),n.innerHTML=`\n      <div class="pv_attach_product_badge_text">\n        <div class="pv_attach_product_badge_title">${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.unclean)(_.title))}</div>\n        <div class="pv_attach_product_badge_price">${_.price}</div>\n      </div>\n      <div class="pv_attach_product_badge_icon">\n        ${(0,_icons_desktop_getIcon16Chevron__WEBPACK_IMPORTED_MODULE_48__.getIcon16Chevron)().icon}\n      </div>\n    `;var d=cur.pvImageAreaWrap.getBoundingClientRect(),p=cur.pvAttachedProducts.photoSize,c=176,v=54,u=14,h={top:Math.floor(_.y*p.height)+(d.height-p.height)/2,left:Math.floor(_.x*p.width)+(d.width-p.width)/2,height:v+u,width:c};n.style.top=`${h.top}px`,n.style.left=`${h.left}px`,n.style.opacity="1";var E=Photoview.getBadgePositioningClass({photoSize:p,badgeRect:h});n.classList.add(E);var P=s.id.split("_"),g=P[0],m=P[1];return s.attached_tags&&s.attached_tags.hash&&l.addEventListener("click",(_=>{ajax.post("al_market.php",{act:"delete_tag_content_product",owner_id:g,item_id:m,type:"photo",access_key:cur.pvCurPhoto.hash,hash:s.attached_tags.hash,tag_id:_.target.parentElement.id});var e=cur.pvData[cur.pvListId][cur.pvIndex];return e.attached_tags.tags=e.attached_tags.tags.filter((e=>e.tag_id!=_.target.parentElement.id)),n.remove(),document.getElementById("MarketList").childElementCount>1?_.target.parentElement.outerHTML="":document.getElementById("pv_attached_products_list").innerHTML="",(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(_)})),l.addEventListener("mouseover",(_=>{(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_34__.showTooltip)(_.target,{text:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("photos_pv_act_delete"),black:1,center:!0,shift:[0,3]})})),e.addEventListener("mouseover",(function(){n.style.opacity="1"})),e.addEventListener("mouseout",(function(_){if(e.contains(_.relatedTarget))return!1;n.style.opacity="0"})),cur.pvImageAreaWrap.addEventListener("mouseover",(function(){cur.pvEditorMode||(n.style.opacity="1")})),cur.pvImageAreaWrap.addEventListener("mouseout",(function(_){if(cur.pvImageAreaWrap&&cur.pvImageAreaWrap.contains(_.relatedTarget))return!1;n.style.opacity="0"})),cur.pvAttachedProducts.badges=cur.pvAttachedProducts.badges||[],cur.pvAttachedProducts.badges.push(n),(0,_web_ecomm_market_shared_utils_logViewMarketItemOnPhoto__WEBPACK_IMPORTED_MODULE_45__.logViewMarketItemOnPhoto)(_),[e,n]},isBadgeWiderThanPhoto:_=>{var e=_.photoWidth;return _.badgeWidth>e},getRequiredBadgeSideSize:_=>_/2,isBadgeCroppedFromLeft:_=>{var e=_.photoSize,o=_.badgeRect;if(Photoview.isBadgeWiderThanPhoto({photoWidth:e.width,badgeWidth:o.width}))return!1;var t=Photoview.getRequiredBadgeSideSize(o.width);return o.left<t},isBadgeCroppedFromRight:_=>{var e=_.photoSize,o=_.badgeRect;if(Photoview.isBadgeWiderThanPhoto({photoWidth:e.width,badgeWidth:o.width}))return!1;var t=Photoview.getRequiredBadgeSideSize(o.width);return o.left+o.width>e.width-t},isBadgeCroppedFromBottom:_=>{var e=_.photoSize,o=_.badgeRect;return!(o.height>e.height)&&o.top>e.height-o.height},getBadgePositioningClass:_=>{var e={photoSize:_.photoSize,badgeRect:_.badgeRect},o=Photoview.isBadgeCroppedFromLeft(e),t=Photoview.isBadgeCroppedFromRight(e),i=Photoview.isBadgeCroppedFromBottom(e),r="pv_attach_product_badge",a=`${r}--down-middle`;return o||t||i?o&&t&&!i?a:o?i?`${r}--up-right`:`${r}--down-right`:t?i?`${r}--up-left`:`${r}--down-left`:i?`${r}--up-middle`:a:a},showProfileBox:(_,e)=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_33__.showBox)("al_places.php",{act:"photos_box",uid:_},{stat:["maps.js",window.jsc("web/places.js"),"places.css","ui_controls.js","ui_controls.css"]}),Photoview.hide(0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_27__.cancelEvent)(e),!1)}},87503:(_,e,o)=>{o.d(e,{GroupAdminLevel:()=>t});var t={USER:0,MODERATOR:1,EDITOR:2,ADMINISTRATOR:3,HOST:4,EVENT_CREATOR:5,CREATOR:6,PSEUDO_LEVEL_ADVERTISER:100}},91802:(_,e,o)=>{o.d(e,{logViewMarketItemOnPhoto:()=>a});var t=o(92458),i=o(73762),r=o(54932);function a(_){t.viewAnalytics.logMarketItemView({view:{start_view:"0",end_view:"0"},screen:(0,i.getStatScreen)(),ref_source:r.RefSource.PHOTO,params:{item_id:_.item_id,owner_id:_.owner_id,search_query_id:0,item_idx:0}})}},83183:(_,e,o)=>{var t=o(45896);window.Photoview=t.Photoview;try{window.stManager.done(window.jsc("web/photoview.js"))}catch(_){}},75382:(_,e,o)=>{o.d(e,{floatingButtonCollapseAllRepliesHide:()=>r,floatingButtonCollapseAllRepliesShow:()=>a,loadRepliesLinkShow:()=>s,loadRepliesLinkIsVisible:()=>l,highlightUpdatedReply:()=>n,highlightUpdatedReplyContent:()=>d});var t=o(30104),i=o(15544),r=function(_){_ instanceof HTMLElement&&_.classList.contains("replies_side")&&_.classList.add("replies_side_hidden")},a=function(_){_ instanceof HTMLElement&&_.classList.contains("replies_side")&&_.classList.remove("replies_side_hidden")},s=function(_){_ instanceof HTMLElement&&_.classList.contains("replies_next")&&_.classList.add("replies_next_shown")},l=function(_){return!!(_ instanceof HTMLElement&&_.classList.contains("replies_next"))&&(_.classList.contains("replies_next_shown")||(0,i.isVisible)(_))},n=function(_){(0,t.triggerAnimationClass)(_,"reply_highlight_updated",3e3)},d=function(_){(0,t.triggerAnimationClass)(_,"reply_highlight_updated_content",3e3)}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(_){var e=__webpack_module_cache__[_];if(void 0!==e)return e.exports;var o=__webpack_module_cache__[_]={id:_,loaded:!1,exports:{}};return __webpack_modules__[_].call(o.exports,o,o.exports,__webpack_require__),o.loaded=!0,o.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(_,e,o,t)=>{if(!e){var i=1/0;for(l=0;l<deferred.length;l++){for(var[e,o,t]=deferred[l],r=!0,a=0;a<e.length;a++)(!1&t||i>=t)&&Object.keys(__webpack_require__.O).every((_=>__webpack_require__.O[_](e[a])))?e.splice(a--,1):(r=!1,t<i&&(i=t));if(r){deferred.splice(l--,1);var s=o();void 0!==s&&(_=s)}}return _}t=t||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>t;l--)deferred[l]=deferred[l-1];deferred[l]=[e,o,t]},__webpack_require__.n=_=>{var e=_&&_.__esModule?()=>_.default:()=>_;return __webpack_require__.d(e,{a:e}),e},getProto=Object.getPrototypeOf?_=>Object.getPrototypeOf(_):_=>_.__proto__,__webpack_require__.t=function(_,e){if(1&e&&(_=this(_)),8&e)return _;if("object"==typeof _&&_){if(4&e&&_.__esModule)return _;if(16&e&&"function"==typeof _.then)return _}var o=Object.create(null);__webpack_require__.r(o);var t={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&e&&_;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((e=>t[e]=()=>_[e]));return t.default=()=>_,__webpack_require__.d(o,t),o},__webpack_require__.d=(_,e)=>{for(var o in e)__webpack_require__.o(e,o)&&!__webpack_require__.o(_,o)&&Object.defineProperty(_,o,{enumerable:!0,get:e[o]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(_){if("object"==typeof window)return window}}(),__webpack_require__.hmd=_=>((_=Object.create(_)).children||(_.children=[]),Object.defineProperty(_,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+_.id)}}),_),__webpack_require__.o=(_,e)=>Object.prototype.hasOwnProperty.call(_,e),__webpack_require__.r=_=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},(()=>{var _={31036:0};__webpack_require__.O.j=e=>0===_[e];var e=(e,o)=>{var t,i,[r,a,s]=o,l=0;for(t in a)__webpack_require__.o(a,t)&&(__webpack_require__.m[t]=a[t]);if(s)var n=s(__webpack_require__);for(e&&e(o);l<r.length;l++)i=r[l],__webpack_require__.o(_,i)&&_[i]&&_[i][0](),_[r[l]]=0;return __webpack_require__.O(n)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var __webpack_exports__=__webpack_require__.O(void 0,[76429,22897,75514,24509,40885,56990,38288,68592,91454,41081,48195,22129,46643,59302,85820,83063,87586],(()=>__webpack_require__(83183)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();