(self.webpackChunkvk=self.webpackChunkvk||[]).push([[46643],{15653:(e,t,o)=>{"use strict";o.d(t,{default:()=>i});const i=(0,o(63192).makeIcon)("Icon24MenuOutline","menu_outline_24","0 0 24 24",'<symbol fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="menu_outline_24"><path d="M21 11H3a1 1 0 1 0 0 2h18a1 1 0 1 0 0-2zm0-7H3a1 1 0 0 0 0 2h18a1 1 0 1 0 0-2zM3 20h18a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2z" fill="currentColor" /></symbol>',24,24,!1,void 0)},81536:(e,t,o)=>{"use strict";o.d(t,{default:()=>i});const i=(0,o(63192).makeIcon)("Icon24MoreHorizontal","more_horizontal_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="more_horizontal_24"><g fill="none" fill-rule="evenodd"><path d="M24 0H0v24h24z" /><path d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Zm-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Zm-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0)},21114:(e,t,o)=>{"use strict";o.d(t,{default:()=>i});const i=(0,o(63192).makeIcon)("Icon24NarrativeActiveOutline","narrative_active_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="narrative_active_outline_24"><path d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.726 1.726 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119c-.26.243-.43.539-.512.886-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302.244.26.54.43.887.512.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.726 3.726 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.722 3.722 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22zM18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.174 4.174 0 0 1 2.036-.653z" fill="currentColor" /></symbol>',24,24,!1,void 0)},87142:(e,t,o)=>{"use strict";o.d(t,{default:()=>d});var i=o(3834),r=o(82452),n=o(15544),a=o(95724),s=o(49535);function l(e,t,o){if((0,a.isObject)(t)?o=t:this._dragElClass=t,this.options=(0,a.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},o),this._contEl=(0,n.ge)(e),this._contEl){this._excludedCount=0;for(var i=0;i<this._contEl.children.length;i++)this._contEl.children[i].getAttribute("nodrag")&&this._excludedCount++;(0,s.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,n.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(e){for(var t,o=e;o&&(t=(0,n.domPN)(o))!==this._contEl;)o=t;return o===this._curPlaceholderEl&&(o=null),o},l.prototype._onKey=function(e){e.keyCode===s.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype._onMouseDown=function(e){if(!(this._disabled||0!=e.button||this._curDragEl||(0,n.attr)(e.target,"nodrag")||this._dragElClass&&!(0,n.domClosest)(this._dragElClass,e.target))){for(var t=e.target;t&&t!==window.document;){if((0,a.intval)((0,n.domData)(t,"nodrag")))return;t=(0,n.domPN)(t)}var o=this._getParentDragItemEl(e.target);if(o&&!(0,n.attr)(o,"nodrag")&&((0,n.re)((0,n.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,n.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var i=window.getComputedStyle(o),r=(0,n.getXY)(o);this._initial={candidateEl:o,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(i.marginLeft),y:parseInt(i.marginTop)},shift:{x:e.pageX-r[0],y:e.pageY-r[1]}},(0,s.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,s.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,s.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,s.cancelEvent)(e)}}},l.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},l.prototype._onMouseUp=function(e){var t=this._curDragEl,o=!e;if(this._curDragEl){this._curDragEl=null,(0,n.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,n.getXY)(this._curPlaceholderEl),size:(0,n.getSize)(this._curPlaceholderEl)});var i=this._curOverCell.pos,r=this._curOverCell.el,a=this._grid[this._curDragCellIndex],l=a&&a.size;(0,n.gpeByClass)("_ape_item_list",t)&&(i[0]+=20,i[1]+=20),l&&this._isShiftToLeft&&(i[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(o){for(var e=0,r=this._grid.length;e<r;e++){var n=this._grid[e];n.dirty&&this._setPos(n.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:i[0],top:i[1]})})),setTimeout((()=>{if((0,n.re)(this._curPlaceholderEl),(0,n.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,n.removeClass)(t,this.options.dragCls),this._inited){var e;if(o){for(var i=this._grid.length,a=0;a<i;a++){var s=this._grid[a];s.dirty&&this._setPos(s.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{var l;e=this._isShiftToLeft?(0,n.domNS)(r):r,this._contEl.insertBefore(t,e);var d=-1,c=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),c||(0,n.setStyle)(t,{width:null,height:null});for(var u=this._grid.length,v=0;v<u;v++){var h=this._grid[v];(h.dirty||h.el===t)&&(this._setPos(h.el,{left:null,top:null}),c||(0,n.setStyle)(h.el,{width:null,height:null}),h.pos=this._calcElementPos(h.el),h.dirty=!1),h.el===t?l=v:h.el===r&&(d=v)}if(d>=0){var _=this._grid.splice(l,1);this._grid.splice(d,0,_[0])}}(0,n.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,o&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(t),r!==t&&!o&&this.options.onReorder&&this.options.onReorder(t,e,(0,n.domPS)(t))}}),210),e&&this._dist(e)>5&&((0,s.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),o||t&&this._overEl&&this.options.onDragDrop&&(o=this.options.onDragDrop(this._overEl,t)),this._overEl=null},l.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),(0,s.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,s.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,s.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,s.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?(0,n.setStyle)(e,(0,a.extend)({transform:null},t)):null===t.left||null===t.top?(0,n.setStyle)(e,{transform:null,top:null,left:null}):(0,n.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){var e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t!==e){for(var o=0,i=!1,r=!1,n=this._grid.length,a=0;a<n;a++){var s=this._grid[a];if(s.el===e){i=!0;break}if(s.el===t){i=!1;break}}this._isShiftToLeft=i;for(var l=i?0:this._grid.length-1,d=i?this._grid.length:-1,c=i?1:-1,u=[0,0];l!==d;l+=c){var v=this._grid[l];if(2!==o)if(v.el!==e){if(v.el===t&&o++,1===o||2===o){var h=0,_=0;i?(h=r.pos[0]+u[0],_=r.pos[1]+u[1],u[0]+=v.size[0]-r.size[0],u[1]+=v.size[1]-r.size[1]):(u[0]+=r.size[0]-v.size[0],u[1]+=r.size[1]-v.size[1],h=r.pos[0]+u[0],_=r.pos[1]+u[1]),this._setPos(v.el,{left:h-v.pos[0],top:_-v.pos[1]}),v.dirty=!0}else v.dirty&&(this._setPos(v.el,{left:null,top:null}),v.dirty=!1);r=v}else o++,r=v;else v.dirty&&(this._setPos(v.el,{left:null,top:null}),v.dirty=!1),r=v}}else for(var p=this._grid.length,g=0;g<p;g++){var f=this._grid[g];f.el!==e&&f.dirty&&(f.dirty=!1,this._setPos(f.el,{left:null,top:null}))}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,n.getSize)(this._contEl);var e=0,t=this._contEl.children.length-this._excludedCount-(0,a.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=(0,n.getSize)(this._contEl);else{var o=(0,n.getSize)(this._contEl),i=this._contInfo.prevSize;(Math.abs(i[0]-o[0])>5||Math.abs(i[1]-o[1])>5)&&(e=1),this._contInfo.prevSize=o}return e},l.prototype._initGrid=function(e){var t=e?1:this._needGridUpdate();if(t){1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var o=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var i,r=!!o,a=this._contEl.children;if(a.length)for(var s=this._getItemMargins(),l=this._curDragEl?this._grid.length:0,d=a.length;l<d;l++){var c=a[l];o&&c===o.el?r=!1:r||c===this._curPlaceholderEl||c.getAttribute("nodrag")||((i=(0,n.getSize)(c))[0]+=s[0],i[1]+=s[1],this._grid.push({el:c,size:i,pos:this._calcElementPos(c)}))}}},l.prototype._getRelativeMousePos=function(e){var t=this._getContPos(),o=this._getContShift();return{left:e.clientX-t[0]-o[0],top:e.clientY-t[1]-o[1]}},l.prototype._updateDraggablePosition=function(e){if(this._curDragEl){var t=this._getRelativeMousePos(e),o=this._getItemShift(),i=this._getContShift(),r=this._getContSize(),a=t.top-this._initial.shift.y-o[1]+i[1];this.options.limitBottomMove&&(a=Math.min(a,r[1]+30)),(0,n.hasClass)(this._contEl,"_ape_item_list")&&(a+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-o[0]+i[0],top:a}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,n.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,n.getXY)(this._contEl),this._contInfo.pos[1]-=(0,i.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(e){var t=this._getContShift(),o=this._getItemShift();return[e.offsetLeft-t[0]-o[0],e.offsetTop-t[1]-o[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,r.throttle)((e=>{var t=this.options.wrapNode||e,o=(0,n.data)(t,"sb");o&&o.update(!1,!0)}),500)},l.prototype._onMouseMove=function(e){var t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,i.scrollGetY)(),o=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:(0,i.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);var r=this._getContSize(),a=this._getRelativeMousePos(e),l=!1;if((0,n.hasClass)(this._contEl,"_ape_item_list")&&(a.top+=this._contEl.scrollTop),a.left>0&&a.left<r[0]&&a.top>0&&a.top<r[1])for(var d=0,c=this._grid.length-1,u=50;u;){var v=d+Math.floor((c-d)/2),h=this._grid[v];if(a.left>h.pos[0]&&a.top>h.pos[1]&&a.left<h.pos[0]+h.size[0]&&a.top<h.pos[1]+h.size[1]){l=h;break}if(d===c)break;a.top<h.pos[1]||a.left<h.pos[0]&&a.top<h.pos[1]+h.size[1]?c=c===v?c-1:v:d=d===v?d+1:v,u--}else{for(var _,p,g,f=this._grid.length,m=999999,w=0;w<f;w++){var y=this._grid[w],S=(p=a.left-(y.pos[0]+y.size[0]/2))*p+(g=a.top-(y.pos[1]+y.size[1]/2))*g;m>S&&(m=S,_=y)}l=_}!l||this._curOverCell&&this._curOverCell.el===l.el||(this._curOverCell=l,this._recalc());var C,N,x,b,E=0;if(this.options.wrapNode)C=b=this.options.wrapNode,N=(0,n.getSize)(C),(x=(0,n.getXY)(C))[1]-=(0,i.scrollGetY)(),E=e.clientY;else{var k=window,L=document.documentElement,T=document.getElementsByTagName("body")[0],I=k.innerWidth||L.clientWidth||T.clientWidth,B=k.innerHeight||L.clientHeight||T.clientHeight;b=k.bodyNode,N=[I,B],x=[0,0],E=e.clientY}var D=Math.max(20,N[1]/10),P=x[1]+D-E,A=D-(x[1]+N[1]-E);if(A>0||P>0){var R=Math.min(1,P/D),j=Math.min(1,A/D);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;var e=t();o(e+16*(R>0?-R:j)),e!==b.scrollTop&&(this._updateScrollbar(b),this._onMouseMove())}),20))}if(this.options.onDragOverElClass){var O=e.target;(0,n.hasClass)(O,this.options.onDragOverElClass)||(O=(0,n.gpeByClass)(this.options.onDragOverElClass,O))?this._overEl!==O&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(O,this._curDragEl),this._overEl=O):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var M=this._grid.length,U=0;U<M;U++)if(this._grid[U].el===this._curDragEl){this._curDragCellIndex=U;break}this.options.dragCls&&(0,n.addClass)(this._curDragEl,this.options.dragCls);var H=(0,n.getSize)(this._curDragEl),F=(0,n.getXY)(this._curDragEl),G=window.getComputedStyle(this._curDragEl),V=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,n.setStyle)(this._curDragEl,{width:H[0],height:H[1]}),this._initialCurDragPos={left:F[0]-V[0],top:F[1]-V[1]-bodyNode.scrollTop},this._curPlaceholderEl=(0,n.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,n.setStyle)(this._curPlaceholderEl,{width:H[0]+parseFloat(G.marginLeft)+parseFloat(G.marginRight),height:H[1]+parseFloat(G.marginTop)+parseFloat(G.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,n.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,s.cancelEvent)(e)};const d=l},80309:(e,t,o)=>{"use strict";o.d(t,{getNativeOption:()=>n,createScroll:()=>d});var i=o(10124),r=o(3834);function n(e,t){return bodyNode[e]||document.documentElement[e]}class a{constructor(e,t){this.el=e,this.opts=t,this.module=(0,i.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return n("scrollTop",this.el);!function(e,t,o){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return n("scrollHeight")}smoothScroll(e){(0,r.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=Date.now(),o=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",o)};window.addEventListener("scroll",o),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),o=t-this.prevScroll,i=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-o,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&i-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,i.destroyModule)(this.module)}}class s{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var o=this.scrollTop(),i=this.prevTop-o;this.prevTop=o,t.scrollChange&&t.scrollChange(o),t.onScroll&&t.onScroll(i,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function d(e,t){return t.noScroll?new l(e):t.nativeScroll?new a(e,t):new s(e,t)}},18793:(e,t,o)=>{"use strict";o.d(t,{Scroll:()=>s});o(75115),o(91181),o(56997),o(96253);var i=o(85893),r=(o(67294),o(32821)),n=o(80309);o(45697);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},a.apply(this,arguments)}var s=e=>{var t=e.children,o=function(e,t){if(null==e)return{};var o,i,r={},n=Object.keys(e);for(i=0;i<n.length;i++)o=n[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,["children"]);return(0,i.jsx)(r.ScrollContext.Provider,{value:{createScroll:n.createScroll},children:(0,i.jsx)(r.Scroll,a({},o,{children:t}))})};s.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},42041:(e,t,o)=>{"use strict";o.d(t,{Likes:()=>y});o(91181),o(56997),o(96253),o(96409),o(59357),o(75115),o(21466);var i=o(15544),r=o(49535),n=o(76852),a=o(95724),s=o(35676),l=o(50167),d=o(40906),c=o(54612),u=o(86067),v=o(65864),h=o(25698),_=o(95146),p=o(8706),g=o(7337),f=o(76772),m=o(10277);function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},w.apply(this,arguments)}var y={toggle(e,t,o,n){if((0,r.cancelEvent)(t),(0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();var a=(0,i.hasClass)(e,"active");(0,i.addClass)(e,"animate"),this.clientUpdate(o,h.LikeButtonTypes.like,a?-1:1,!a);var s=()=>{(0,i.toggleClass)(e,"active",a),this.clientUpdate(o,h.LikeButtonTypes.like,a?1:-1,a)};window.ajax.post("like.php",{act:a?"a_do_unlike":"a_do_like",object:o,hash:n,list:cur.pvListId,wall:2,from:this._getReference(o),from_widget:vk.widget?1:0},{onDone:t=>{if(t.unauth_action_box)return s(),void f.UnauthActionBox.show(t.unauth_action_box);this.update(o,t);var i=o.match(/^(wall|market)(.*)/);i&&cur.onLike&&cur.onLike(e,i[1],i[2],a)},onFail:()=>(s(),!1)}),(0,d.intval)((0,i.domData)(e,"count"))>0?y.showLikes(e,o,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?`feed_${cur.subsection?cur.subsection:cur.section}`:"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):(0,a.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):`feed_${cur.section}`:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e,t){if(void 0===t&&(t={}),vk.widget&&!vk.id)return window.Widgets.oauth();if((0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();var o=(0,v.parseLikeObjectId)(e),i=o.objectType,r=o.objectId;(vk.widget?window.showBox:c.showBox)("like.php",w({act:"publish_box",object:e,from_widget:vk.widget?1:0},t),{onDone:(e,t)=>{t.unauth_action_box&&(e.hide(),f.UnauthActionBox.show(t.unauth_action_box))},stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===i&&window.Wall&&window.Wall.triggerAdPostStat(r,"share_post"),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>y.update(e,window.cleanObj(t)))},clientUpdate(e,t,o,r){var n=this._getButtonsByType(e,t);if(n.length){var a=(0,d.intval)((0,i.domData)(n[0],"count"))+o;this._updateDom(e,t,a,r),this.updateExternalIndex(e,{type:t,count:a,isActive:r})}},update(e,t){if(!isNaN(parseInt(t.like_num))){var o=(0,d.isUndefined)(t.like_my)?void 0:!!(0,d.intval)(t.like_my);this._updateDom(e,h.LikeButtonTypes.like,t.like_num,o,t.like_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.like,count:t.like_num,isActive:o})}if(!isNaN(parseInt(t.share_num))){var i=(0,d.isUndefined)(t.share_my)?void 0:!!(0,d.intval)(t.share_my);this._updateDom(e,h.LikeButtonTypes.share,t.share_num,i,t.share_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.share,count:t.share_num})}if((0,a.isNumeric)(t.views_num)&&this._updateDom(e,h.LikeButtonTypes.views,t.views_num,void 0,t.views_title),(0,a.isNumeric)(t.comment_num)&&this._updateDom(e,h.LikeButtonTypes.comment,t.comment_num),t[_.REACTIONS_COUNTS_RESPONSE_FIELD]){var r=!!t.isQueueUpdate;(0,g.triggerReactionsUpdate)(e,t[_.REACTIONS_COUNTS_RESPONSE_FIELD],void 0,{isQueueUpdate:r,isUserAction:!1,previewVisibility:p.previewVisibilityUseCurrent})}},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,o,r,n){var l=this._getButtonsByType(e,t),c=t===h.LikeButtonTypes.views;if(null==l?void 0:l.length){var _="";c?_=o:o>0&&(_=vk.widget?(0,a.formatCount)(o):(0,u.langNumeric)(o,"%s",!0)),c||(o=(0,d.intval)(o));for(var p=0;p<l.length;p++){var g=l[p];if(!(0,i.hasClass)(g,"no_counter")){var f,w=c?l[p]:(0,v.getElementLikeButtonCount)(l[p]);if((0,s.animateCount)(w,_,{str:"auto",noWrapWidth:!c,noSpaceIfEmpty:!0}),(0,i.toggleClass)(g,"empty",o<=0),"boolean"==typeof r&&(0,i.toggleClass)(g,"active",r),(0,i.attr)(l[p],"data-count",o),(0,m.updateAriaLabelCounter)(g,o,t),c)null==g||null==g.closest||null==(f=g.closest(".like_views"))||f.setAttribute("title",n||"");var y=l[p].tt;if(y){var S=(0,i.domByClass)(y.container,"_content"),C=(0,i.domByClass)(y.container,"_value"),N=(0,i.domByClass)(y.container,"_title"),x=(0,d.intval)((0,i.val)(C));(0,i.val)(C,o),n&&(0,i.val)(N,n),(0,d.isObject)(y)&&(y.likeInvalidated=!0),(x!==o&&x<7||!1===n)&&(t===h.LikeButtonTypes.like?g.needReinitLikesTT=!0:t===h.LikeButtonTypes.share&&(g.needReinitShareTT=!0)),t===h.LikeButtonTypes.like&&(0,i.toggleClass)(S,"me_hidden",!r),!1===n&&y.destroy&&y.destroy()}}}}},_getButtonsByType:(e,t)=>(0,i.domQuery)(`._like_${e} ._${t}, ._like_${e} [data-like-button-type="${t}"]`),showLikes(e,t,o){var r;if(void 0===o&&(o={}),e&&e instanceof HTMLElement&&!e.postDontShowLikes&&(!vk.widget||!vk.show_external_auth_box)){var s=o.views?{views:1}:o.share?{published:1}:{};o.listId&&(s.list=o.listId),o.like_hash&&(s.like_hash=o.like_hash),o.like_stats_params&&Object.assign(s,o.like_stats_params);var l=!!(0,i.geByClass1)("share",(0,i.gpeByClass)("like_wrap",e)),c=document.body,u=!1,h=getComputedStyle(e),_=(0,d.intval)(h.getPropertyValue("padding-left").replace("px","")),p=(0,d.intval)(h.getPropertyValue("padding-top").replace("px","")),g=(0,v.getElementLikeButtonIcon)(e),f=40;"wpost"===o.from&&(f=24);var m,w,S=[f-(0,i.getSize)(g)[0]/2-_,10-p],C=o.cl||"";if(o.share)C+="likes_tt_share";else if(C+="likes_tt_like","widget_community"===o.from)S[0]=6;else if("wcomments"===o.from||"widget_comments"===cur.wallType){S[0]=(0,i.getSize)(e)[0]+16-(0,i.getSize)(g)[0]/2-10}else"photo_carousel"===o.from&&(S[1]=10);if(!!(null==(r=o)?void 0:r.isFromReactionsPreview)){var N=e.querySelector("._ReactionsPreview__itemsContainer");if(N){var x=N.querySelector(".ReactionsPreviewItem"),b=(0,i.getXYRect)(x,!1),E=(b.width||0)/2,k=E;c=N,b.left+b.width/2>window.innerWidth/2&&(u=!0,k=N.offsetWidth-E),S[0]=-k+f}}o.share?(m="needReinitLikesTT",w="resetLikesTTTimer"):(m="needReinitShareTT",w="resetShareTTTimer"),clearTimeout(e[w]),(0,n.showTooltip)(e,{url:"/like.php",params:(0,a.extend)({act:"a_get_stats",object:t,has_share:l?1:""},s),appendEl:c,slide:15,shift:S,ajaxdt:o.fast?0:100,showdt:o.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,needLeft:u,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{y.showLikes(e,t,o)}},typeClass:"like_tt",className:C,onHide:()=>{clearTimeout(e[w]),e[m]&&(e[w]=setTimeout((()=>{delete e[m],e.tt&&e.tt.destroy&&e.tt.destroy()}),200))}})}},showShare:function(e,t,o){y.showLikes(e,t,(0,a.extend)(o,{share:1}))},updateViews:(e,t)=>{vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,o){var r=(0,i.ce)("div",{innerHTML:o});y._updateDom(e,h.LikeButtonTypes.views,t,void 0,r.innerText||r.textContent)}})},makeTemplate(e,t){if(!e)return"";(t=(0,a.extend)({buttons_prepend:"",object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:"",like_class_name:"",[_.REACTIONS_COUNTS_RESPONSE_FIELD]:"",reactions_class_name:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?(0,u.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?(0,u.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name+=t.likes_count>0?"":" empty",t.share_class_name=t.share_count>0?"":"empty";var o=t[_.REACTIONS_COUNTS_RESPONSE_FIELD],r=!!o&&Object.values(o).some((e=>!!e));return t.reactions_class_name+=r?"":" PostBottomAction--empty",(0,i.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e,t){void 0===t&&(t={});var o=(0,v.parseLikeObjectId)(e),i=o.objectType,r=o.objectId;switch(i){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==r)return;var n=cur.pvListId,a=cur.pvIndex,s=cur.pvData[n][a];t.type===h.LikeButtonTypes.like?(s.likes=t.count,s.liked=t.isActive,cur.pvCommsLikes[s.id][1]=t.count):t.type===h.LikeButtonTypes.share&&(s.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===r&&t.type===h.LikeButtonTypes.like){var l=window.Videoview.getMvData();l.likes=t.count,void 0!==t.isActive&&(l.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}break;case"clip":t.type===h.LikeButtonTypes.like&&window.Videoview.playerOnLiked(t.isActive)}},showLikesList(e,t){cur.viewAsBox||(0,i.hasClass)((0,i.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"likes/"+(0,a.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||(0,i.hasClass)((0,i.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"shares/"+(0,a.clean)(t)},!1,!1,{queue:1})}}},41319:(e,t,o)=>{"use strict";var i,r,n,a,s;o.d(t,{StoryType:()=>i,StoryEntryPoint:()=>r,StorySource:()=>n,StoryBlockType:()=>a,StoryListName:()=>s}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LIVE="live"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(r||(r={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar",e.MY_QUESTIONS="questions"}(n||(n={})),function(e){e.stories="stories",e.communityGroupedStories="community_grouped_stories",e.appGroupedStories="app_grouped_stories",e.discover="discover"}(a||(a={})),function(e){e.feed="feed",e.groups="groups",e.apps="apps",e.discover="discover"}(s||(s={}))},73023:(e,t,o)=>{"use strict";o.d(t,{UploadPhoto:()=>i.UploadPhoto});var i=o(47409)},69351:(e,t,o)=>{"use strict";var i,r,n;o.d(t,{UploadPhotoErrorCodes:()=>i,OwnerAvatarEditorPhotoTypes:()=>r,OwnerAvatarEditorMods:()=>n}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UPLOAD=1]="UPLOAD",e[e.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",e[e.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",e[e.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",e[e.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO"}(i||(i={})),function(e){e.UPLOADED="uploaded",e.EXISTED="existed"}(r||(r={})),function(e){e[e.UPLOAD=1]="UPLOAD",e[e.SELECT=2]="SELECT",e[e.EDIT=3]="EDIT"}(n||(n={}))},47409:(e,t,o)=>{"use strict";o.d(t,{UploadPhoto:()=>a});var i=o(70655),r=o(69351),n=o(46512),a=function(){function e(e,t){this.config=(0,i.__assign)({allowedTypes:["*"]},e),this.progressCallback=t}return e.prototype.validate=function(e){var t=this.config,o=t.constraints,a=t.allowedTypes,s=t.lang,l=!1;return a&&(l=a.some((function(t){return"*"===t||t===e.type}))),l?o?(0,n.getImageSizeByBlob)(e).then((function(e){var t=o.maxWidth,n=o.minWidth,a=o.maxHeight,l=o.minHeight,d=o.maxAspectRatio,c=o.minAspectRatio,u=(0,i.__read)(e,2),v=u[0],h=u[1],_=v/h;if(v>t||h>a){var p=(s["error_"+r.UploadPhotoErrorCodes.IMAGE_TOO_BIG]||"").replace("{width}",String(t)).replace("{height}",String(a));return Promise.reject({code:r.UploadPhotoErrorCodes.IMAGE_TOO_BIG,text:p})}if(v<n||h<l){p=(s["error_"+r.UploadPhotoErrorCodes.IMAGE_TOO_SMALL]||"").replace("{width}",String(n)).replace("{height}",String(l));return Promise.reject({code:r.UploadPhotoErrorCodes.IMAGE_TOO_SMALL,text:p})}return c&&c>_||d&&_>d?Promise.reject({code:r.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:s["error_"+r.UploadPhotoErrorCodes.BAD_ASPECT_RATIO]}):Promise.resolve(null)})).catch((function(e){return e&&e.text&&e.code?Promise.reject(e):Promise.reject({code:r.UploadPhotoErrorCodes.UNKNOWN,text:s["error_"+r.UploadPhotoErrorCodes.UNKNOWN]})})):Promise.resolve(null):Promise.reject({code:r.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION,text:s["error_"+r.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION]})},e.prototype.upload=function(e,t,o){var i=this;return void 0===o&&(o="file1"),this.validate(e).then((function(){return new Promise((function(n,a){var s=new XMLHttpRequest,l=new FormData;l.append(o,e),s.open("POST",t||i.config.url,!0),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE&&200===s.status){var e=void 0;try{s.responseText&&(e=JSON.parse(s.responseText))}catch(e){a({code:r.UploadPhotoErrorCodes.UNKNOWN,text:i.config.lang["error_"+r.UploadPhotoErrorCodes.UNKNOWN]})}n(e)}},s.onerror=function(){a({code:r.UploadPhotoErrorCodes.UPLOAD,text:i.config.lang["error_"+r.UploadPhotoErrorCodes.UPLOAD]})},s.upload.onprogress=function(e){i.progressCallback&&i.progressCallback(e.loaded,e.total)},s.send(l)}))}))},e}()},46512:(e,t,o)=>{"use strict";function i(e){return t=URL.createObjectURL(e),new Promise((function(e,o){var i=new Image;i.onload=function(){var t=Number(i.height),o=Number(i.width);e([o,t])},i.onerror=function(){o()},i.onabort=function(){o()},i.src=t}));var t}o.d(t,{getImageSizeByBlob:()=>i})},41929:(e,t,o)=>{"use strict";o.d(t,{BoxModal:()=>l});var i=o(70655),r=o(85893),n=o(67294),a=o(83295),s=o(61650),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,n=e.title,l=e.actionButtons,d=e.onClose,c=e.children,u=e.hint,v=e.hasScroll;return(0,r.jsx)("div",(0,i.__assign)({className:"BoxModal"},{children:(0,r.jsxs)("div",(0,i.__assign)({className:(0,a.classNames)("Modal","Modal--"+o,t)},{children:[(0,r.jsx)(s.default.Header,{title:n,onClose:d},void 0),Boolean(c)&&(0,r.jsx)(s.default.Body,(0,i.__assign)({hasScroll:v},{children:c}),void 0),Boolean(l)&&(0,r.jsx)(s.default.Footer,{actionButtons:l,hint:u},void 0)]}),void 0)}),void 0)},t.defaultProps={appearance:"white",hasScroll:!0},t}(n.Component)},65864:(e,t,o)=>{"use strict";o.d(t,{parseLikeObjectId:()=>r,likePostObjectId:()=>n,likeReplyObjectId:()=>a,getElementLikeButtonCount:()=>s,getElementLikeButtonIcon:()=>l,getElementLikeButtonLabel:()=>d});var i=o(70655);function r(e){var t=e.match(/^([a-z_]+)([0-9\-_]+)$/);if(!t)return null;var o=(0,i.__read)(t,3);return{objectType:o[1],objectId:o[2]}}var n=function(e){return"wall"+e},a=function(e){return"wall_reply"+e},s=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_count, ._like_button_count"))&&void 0!==t?t:void 0},l=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_icon, ._like_button_icon"))&&void 0!==t?t:void 0},d=function(e){var t;return null!==(t=e.querySelector(".like_button_label, ._like_button_label"))&&void 0!==t?t:void 0}},25698:(e,t,o)=>{"use strict";o.d(t,{LikeButtonTypes:()=>i});var i={like:"like",share:"share",views:"views",comment:"comment"}},8706:(e,t,o)=>{"use strict";o.d(t,{isVariantInActionStatusBar:()=>r,isVariantHidden:()=>n,previewVisibilityUseCurrent:()=>a,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewHidden:()=>l,isIntentPreviewUseCurrent:()=>d,previewVisibilityIntentForVariant:()=>c,parsePreviewVariant:()=>u});var i=o(4608),r=function(e){return e===i.PreviewVariantActionStatusBar},n=function(e){return e===i.PreviewVariantHidden},a={kind:"useCurrent"},s=function(e){return e.kind===i.PreviewVariantActionStatusBar},l=function(e){return e.kind===i.PreviewVariantHidden},d=function(e){return"useCurrent"===e.kind},c=function(e){return e?{kind:e}:a},u=function(e){return i.PreviewVariants.includes(e)?e:void 0}},4608:(e,t,o)=>{"use strict";o.d(t,{PreviewVariantActionStatusBar:()=>i,PreviewVariantHidden:()=>r,PreviewVariants:()=>n});var i="action_status_bar",r="hidden",n=[i,r]},95146:(e,t,o)=>{"use strict";o.d(t,{SUPPORTED_OBJECT_TYPES:()=>i,SIZE_32:()=>r,SIZE_40:()=>n,SIZE_96:()=>a,SIZE_128:()=>s,REACTIONS_COUNTS_RESPONSE_FIELD:()=>l,WK_SECTION_PREFIX_REACTIONS:()=>d});var i={wall:"wall",wall_reply:"wall_reply"},r={width:32,height:32},n={width:40,height:40},a={width:96,height:96},s={width:128,height:128},l="reactions_counts",d="reactions"},65872:(e,t,o)=>{"use strict";o.d(t,{reactionsCountsUpdatePayload:()=>n,isReactionsFullUpdatePayload:()=>a,reactionsCountsOnlyUpdatePayload:()=>s});var i=o(70655),r=o(71904),n=function(e,t){return(0,i.__assign)((0,i.__assign)({kind:r.PayloadKindFull},e),{reactionIdState:{reactionId:t.id}})},a=function(e){return e.kind===r.PayloadKindFull},s=function(e){return(0,i.__assign)({kind:r.PayloadKindCountsOnly},e)}},71904:(e,t,o)=>{"use strict";o.d(t,{PayloadKindCountsOnly:()=>i,PayloadKindFull:()=>r});var i="counts_only",r="counts_with_current_reaction"},7337:(e,t,o)=>{"use strict";o.d(t,{triggerReactionsUpdate:()=>s});var i=o(65864),r=o(95146),n=o(53580),a=o(65872),s=function(e,t,o,s){var l=(0,i.parseLikeObjectId)(e);l&&l.objectType===r.SUPPORTED_OBJECT_TYPES.wall&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.post_reactions_counts_update,function(e,t,o,i){var r={counts:e,isFromWkLayer:null==t?void 0:t.isFromWkLayer,isPrimaryLikeButtonClick:null==t?void 0:t.isPrimaryLikeButtonClick,isQueueUpdate:null==t?void 0:t.isQueueUpdate,isUserAction:t.isUserAction,postFullId:o.objectId,previewVisibility:t.previewVisibility,reactionIdState:i?{reactionId:i.id}:void 0};return i?(0,a.reactionsCountsUpdatePayload)(r,i):(0,a.reactionsCountsOnlyUpdatePayload)(r)}(t,s,l,o)):l&&l.objectType===r.SUPPORTED_OBJECT_TYPES.wall_reply&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.reply_reactions_counts_update,{counts:t,replyFullId:l.objectId,reactionIdState:o?{reactionId:o.id}:void 0}):console.warn("Unsupported reactions object update",e)}},14200:(e,t,o)=>{"use strict";o.d(t,{default:()=>d});var i=o(40906),r=o(285),n=o(26489),a=o(49464),s=o(47612),l=o(25696);const d=function(){function e(){var e=this;this.destroy=function(){e.gallery&&e.gallery.destroy()},this.moduleEl=document.querySelector(".narratives_module"),this.isWide=this.moduleIsWide(this.moduleEl),this.initGallery(),this.needOnBoard()&&this.showOnboardTooltipIfNeeded(),window.cur.destroy&&window.cur.destroy.push((function(){e.destroy()}))}return e.prototype.initGallery=function(){if(this.isWide&&(this.galleryEl=document.querySelector(".NarrativeBlock"),this.galleryEl)){var e=this.galleryEl.querySelectorAll(".ui_gallery_item"),t={scrollY:!1};(!e||e.length<7)&&(t.scrollX=!1),this.gallery=new s.UIGallery(this.galleryEl,t)}},e.prototype.moduleIsWide=function(e){if(e){var t=e.getAttribute("data-is-wide");return!!(0,i.intval)(t)}return!1},e.prototype.getOnboardHash=function(){var e;return null===(e=this.moduleEl)||void 0===e?void 0:e.dataset.onboardHash},e.prototype.openNarrativeBox=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;this.showBox(),(0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.openNarrativeList,{ownerId:e},t)},e.prototype.seeMore=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;this.showBox(),(0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.seeMore,{ownerId:e},t)},e.prototype.showBox=function(){var e=this.getOwnerId(),t={ownerId:e,onSave:function(){return(0,n.updateNarrativeBlock)()},onRemove:function(){return(0,n.updateNarrativeBlock)()},onReorder:function(){return(0,n.updateNarrativeBlock)()},navScreen:e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club};(0,r.showNarrativeBox)(t)},e.prototype.showNarrativeEditorBox=function(){var e=this.getOwnerId(),t=e>0?a.NarrativeAnalyticNavScreen.profile:a.NarrativeAnalyticNavScreen.club;if((0,a.sendNarrativeAnalytic)(a.NarrativeAnalyticEventType.createNarrative,{ownerId:e},t),e<0)window.nav.go(location.pathname+"?act=narrative_create");else{var o={onSave:function(){return(0,n.updateNarrativeBlock)()},navScreen:t};(0,r.showNarrativeEditorBox)(e,o)}},e.prototype.getOwnerId=function(){return(0,i.intval)(window.cur.oid)},e.prototype.showOnboardTooltipIfNeeded=function(){var e=this.getOnboardHash();e&&(window.cur.storyLayer&&l.hideAllLayers(!0),window.boxQueue.hideAll(),(0,n.highlightNarrativeBlock)(e))},e.prototype.needOnBoard=function(){return Boolean(window.cur.needNarrativeOnboard)},e}()},3425:(e,t,o)=>{"use strict";o.d(t,{MAX_THUMB_HEIGHT:()=>p,MAX_THUMB_WIDTH:()=>g,NarrativeCoverCropper:()=>f});var i=o(70655),r=o(85893),n=o(67294),a=o(41929),s=o(88420),l=o(41650),d=o(3669),c=o(54612),u=o(91525),v=o(18690),h=o(61540);function _(e,t,o,i,r,n){return void 0===n&&(n=0),new Promise((function(a,s){("string"==typeof e?(0,h.loadImage)(e):Promise.resolve(e)).then((function(e){var l=document.createElement("canvas");l.width=90===n||270===n?e.naturalHeight:e.naturalWidth,l.height=90===n||270===n?e.naturalWidth:e.naturalHeight;var d=l.getContext("2d");if(d){d.fillStyle="#fff",d.fillRect(0,0,d.canvas.width,d.canvas.height),n?(d.translate(l.width/2,l.height/2),d.rotate(n*Math.PI/180),d.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2)):d.drawImage(e,0,0);var c=d.getImageData(t,o,i,r),u=document.createElement("canvas");u.width=i,u.height=r;var v=u.getContext("2d");if(v)return v.putImageData(c,0,0),(0,h.loadImage)(u.toDataURL("image/jpeg",1)).then(a).catch(s);a(e)}else a(e)})).catch(s)}))}var p=604,g=468,f=function(e){function t(t){var o=e.call(this,t)||this;return o.onSaveCrop=function(){var e=o.props,t=e.onSave,i=e.onClose,r=e.coverUrl,n=o.crop;n&&(o.setState({isLoading:!0}),_(r,n.left,n.top,n.width,n.height).then((function(e){return t(o.getCropForSaving(n),e.src)})).then(i).catch((function(e){o.setState({isLoading:!1}),(0,c.showFastBox)((0,l.getLang)("global_error"),e||(0,l.getLang)("global_unknown_error")),console.error(e),(0,u.logError)(new Error("error with onSaveCrop"+(e?": "+e:"")))})))},o.onCropUpdate=function(e){o.crop=e},o.state={isLoading:!1},o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.coverUrl,n=e.coverHeight,c=e.coverWidth,u=e.thumbHeight,h=e.thumbWidth,_=e.crop,p=this.state.isLoading;return(0,r.jsx)(a.BoxModal,(0,i.__assign)({className:"NarrativeCoverCropper",appearance:"white",title:(0,l.getLang)("stories_cover_cropper_title"),onClose:t,hasScroll:!1},{children:(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeCoverCropper__inner"},{children:[(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeCoverCropper__info"},{children:[(0,r.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_1")},void 0),(0,r.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_2")},void 0)]}),void 0),(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeCoverCropper__frame"},{children:(0,r.jsx)(d.PhotoAreaSelector,{className:"NarrativeCoverCropper__tagger",imgSrc:o,imgHeight:n,imgWidth:c,previewHeight:u,previewWidth:h,minHeight:75,minWidth:75,isSquare:!0,preview100:!0,cropRect:this.getCropForTagger(_),onCropUpdated:this.onCropUpdate},void 0)}),void 0),(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeCoverCropper__footer"},{children:[(0,r.jsx)(v.default,(0,i.__assign)({loading:p,onClick:this.onSaveCrop},{children:(0,l.getLang)("stories_cover_next")}),void 0),(0,r.jsx)(s.default,(0,i.__assign)({disabled:p,appearance:"secondary",onClick:t},{children:(0,l.getLang)("stories_cover_back")}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.getCropForTagger=function(e){var t,o=this.props,i=o.coverWidth,r=o.coverHeight;if(e){var n=Math.round(e.width*i),a=Math.round(e.height*r);if(Math.abs(a-n)>1)return t;a=n,t={top:Math.round(e.y*r),left:Math.round(e.x*i),width:n,height:a}}return t},t.prototype.getCropForSaving=function(e){var t=this.props,o=t.coverWidth,i=t.coverHeight;return{y:e.top/i,x:e.left/o,width:e.width/o,height:e.height/i}},t}(n.Component)},57405:(e,t,o)=>{"use strict";o.d(t,{NarrativeEditor:()=>re});var i=o(70655),r=o(85893),n=o(67294),a=o(41650),s=o(87157),l=o(88420),d=o(86409),c=o(86125),u=o(18690),v=o(41388),h=o(83295),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridContainerRef=(0,n.createRef)(),t}return(0,i.__extends)(t,e),t.prototype.getGridContainer=function(){return this.gridContainerRef.current},t.prototype.render=function(){var e=this.props,t=e.className,o=e.children,n=e.isScrolling;return(0,r.jsx)("div",(0,i.__assign)({className:(0,h.classNames)("StoryArchivePreviewGrid",t,{"StoryArchivePreviewGrid--scrolling":n})},{children:(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreviewGrid__inner",ref:this.gridContainerRef},{children:o}),void 0)}),void 0)},t.defaultProps={className:""},t}(n.Component),p=o(285),g=o(91525),f=o(89988),m=o(13984),w=o(63192);const y=(0,w.makeIcon)("Icon16Videocam","videocam_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="videocam_16"><path fill-rule="evenodd" d="M1.772 4.865C1.5 5.4 1.5 6.1 1.5 7.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092C3.4 12.5 4.1 12.5 5.5 12.5h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092C11.5 10.6 11.5 9.9 11.5 8.5v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C9.6 3.5 8.9 3.5 7.5 3.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417V6.768a.5.5 0 0 1 .223-.416Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var S=o(39664),C=function(e){function t(t){var o=e.call(this,t)||this;return o.videoRef=(0,n.createRef)(),o.needPauseAfterLoading=!1,o.onLinkButtonClick=function(e){var t=o.props,i=t.story,r=t.onStoryLinkUpdate,n=t.linkData;t.isDragged||((0,p.showStoryLinkEditorBox)({story:i,onStoryLinkUpdate:r,linkData:n}),e.stopPropagation())},o.onMouseEnter=function(){o.setState({isHovered:!0})},o.onMouseLeave=function(){o.setState({isHovered:!1})},o.onToggleCheck=function(){var e=o.props,t=e.onToggleCheck,i=e.story;!e.isDragged&&t&&t(i)},o.state={isHovered:!1,preloadVideo:!1,canPlayVideo:!1,isLoading:!1},o}return(0,i.__extends)(t,e),t.prototype.componentDidUpdate=function(e,t){var o=this.props,i=o.story,r=o.isDragged,n=this.state.isHovered;i.videoUrl&&(r||(!t.isHovered&&n?this.playVideo():t.isHovered&&!n&&this.pauseVideo()),!e.isDragged&&r&&this.pauseVideo(),e.isDragged&&!r&&n&&this.playVideo())},t.prototype.componentWillUnmount=function(){this.cleanVideoPlayTimeout(),this.cleanVideoPauseTimeout(),this.cleanVideoLoaderTimeout()},t.prototype.playVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPauseDelayTimeout&&this.cleanVideoPauseTimeout();var o=function(){delete t.videoPlayDelayTimeout,t.videoRef.current&&(t.videoRef.current.muted=!0,t.videoRef.current.play().then((function(){var e;if(t.hideLoader(),t.setState({canPlayVideo:!0}),t.needPauseAfterLoading)return null===(e=t.videoRef.current)||void 0===e||e.pause(),void(t.needPauseAfterLoading=!1)})).catch((function(e){t.hideLoader(),console.error(e),(0,g.logError)(e)})))};e?o():null==this.videoPlayDelayTimeout&&(this.videoLoaderTimeout=setTimeout((function(){t.setState({isLoading:!0})}),800),this.setState({preloadVideo:!0}),this.videoPlayDelayTimeout=setTimeout((function(){o()}),200))},t.prototype.pauseVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPlayDelayTimeout&&this.cleanVideoPlayTimeout();var o=function(){var e;if(delete t.videoPauseDelayTimeout,t.hideLoader(),t.state.canPlayVideo){var o=null===(e=t.videoRef)||void 0===e?void 0:e.current;null==o||o.pause()}else t.needPauseAfterLoading=!0};e?o():null==this.videoPauseDelayTimeout&&(this.videoPauseDelayTimeout=setTimeout((function(){o()}),200))},t.prototype.cleanVideoPlayTimeout=function(){this.videoPlayDelayTimeout&&(clearTimeout(this.videoPlayDelayTimeout),delete this.videoPlayDelayTimeout)},t.prototype.cleanVideoPauseTimeout=function(){this.videoPauseDelayTimeout&&(clearTimeout(this.videoPauseDelayTimeout),delete this.videoPauseDelayTimeout)},t.prototype.cleanVideoLoaderTimeout=function(){this.videoLoaderTimeout&&(clearTimeout(this.videoLoaderTimeout),delete this.videoLoaderTimeout)},t.prototype.hideLoader=function(){this.state.isLoading&&this.setState({isLoading:!1}),this.cleanVideoLoaderTimeout()},t.prototype.render=function(){var e=this,t=this.props,o=t.story,n=t.checked,s=t.selectable,l=t.draggable,d=t.className,c=t.isEditingLinksAvailable,u=t.needShowDate,v=this.state,_=v.preloadVideo,p=v.canPlayVideo,g=v.isLoading,w=Boolean(o.videoUrl),C=new Date(1e3*o.time);return(0,r.jsx)("div",(0,i.__assign)({className:(0,h.classNames)("StoryArchivePreview","StoryPreviewContainer",d,{"StoryArchivePreview--video":w,"StoryArchivePreview--checked":n}),onClick:this.onToggleCheck,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-id":o.rawId},{children:(0,r.jsxs)("div",(0,i.__assign)({className:"StoryArchivePreview__wrapper"},{children:[w&&(0,r.jsxs)(r.Fragment,{children:[_&&(0,r.jsx)("video",{className:(0,h.classNames)("StoryArchivePreview__media",{"StoryArchivePreview__media--hidden":!p}),src:o.videoUrl,ref:this.videoRef,controls:!1,preload:"metadata",loop:!0,playsInline:!0},void 0),!p&&(0,r.jsx)("img",{className:"StoryArchivePreview__media",src:o.preview,alt:""},void 0)]},void 0),!w&&(0,r.jsx)("img",{className:"StoryArchivePreview__media",src:o.preview,alt:""},void 0),u&&(0,r.jsxs)("div",(0,i.__assign)({className:"StoryArchivePreview__date"},{children:[(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreview__day"},{children:C.getDate()}),void 0),(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreview__month"},{children:(0,r.jsx)(m.default,{children:(0,a.getLang)("months_sm_of")[C.getMonth()+1]},void 0)}),void 0)]}),void 0),l&&!u&&(0,r.jsx)("div",{className:"StoryArchivePreview__draggableIcon"},void 0),s&&(0,r.jsx)("div",{className:(0,h.classNames)("StoryArchivePreview__select",{"StoryArchivePreview__select--on":n})},void 0),(c||o.videoUrl)&&(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreview__footer"},{children:(0,r.jsxs)("div",(0,i.__assign)({className:"StoryArchivePreview__footerInner"},{children:[o.videoUrl&&(0,r.jsxs)("div",(0,i.__assign)({className:"StoryArchivePreview__play"},{children:[(0,r.jsx)(y,{},void 0),(0,r.jsx)("span",(0,i.__assign)({className:"StoryArchivePreview__playTime"},{children:(0,f.formatTime)(o.duration||0)}),void 0)]}),void 0),c&&(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreview__linkBtn",onClick:function(t){return e.onLinkButtonClick(t)}},{children:o.linkUrl?(0,a.getLang)("stories_edit_link"):(0,a.getLang)("stories_add_link")}),void 0)]}),void 0)}),void 0),g&&(0,r.jsx)("div",(0,i.__assign)({className:"StoryArchivePreview__loader"},{children:(0,r.jsx)(S.default,{size:24,strokeWidth:3,color:"#fff"},void 0)}),void 0)]}),void 0)}),void 0)},t.defaultProps={checked:!1,selectable:!1,draggable:!1,isDragged:!1,className:"",isEditingLinksAvailable:!1,onToggleCheck:function(){},onStoryLinkUpdate:function(){},linkData:[]},t}(n.PureComponent),N=o(17173),x=o(87142),b="NarrativeEditorSelectedTab__storyPreview",E=function(e){function t(t){var o=e.call(this,t)||this;return o.gridContainerRef=(0,n.createRef)(),o.tabRef=(0,n.createRef)(),o.state={draggingStoryRawId:""},o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.stories,n=t.selectedStoriesMap,a=t.className,s=t.isEditingLinksAvailable,l=t.onStoryLinkUpdate,d=t.linkData,c=t.onToggleCheck,u=this.state.draggingStoryRawId;return(0,r.jsx)("div",(0,i.__assign)({className:(0,h.classNames)("NarrativeEditorSelectedTab ScrollContainer",a),ref:this.tabRef},{children:(0,r.jsx)(_,(0,i.__assign)({ref:this.gridContainerRef},{children:o.map((function(t){return(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorSelectedTab__story"},{children:(0,r.jsx)(C,{className:b,story:t,draggable:!0,isDragged:t.rawId===u,checked:!!n[t.id],selectable:e.isSelectable(t),onToggleCheck:c,onStoryLinkUpdate:l,isEditingLinksAvailable:s,linkData:d},void 0)}),t.rawId)}))}),void 0)}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,o=Object.keys(t).length;return!e.isUnavailable&&!!(o<N.MAX_NARRATIVE_STORIES||t[e.rawId])},t.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.onReorder,i=t.appearance,r=this.getGridContainer(),n={dragThreshold:0,onDragFinish:function(){e.setState({draggingStoryRawId:""})},onDragStart:function(t){var o=t.querySelector("."+b);if(o){var i=o.dataset.id;e.setState({draggingStoryRawId:i})}},onReorder:function(){var t=e.props.stories,i=document.querySelectorAll("."+b),r=[];i.forEach((function(e){var o=e.getAttribute("data-id"),i=t.find((function(e){return e.rawId===o}));i&&r.push(i.id)})),o(r)}};r&&(i===s.EditorViewType.box&&(n.wrapNode=this.getTabEl()),this.sorter=new x.default(r,"",n))},t.prototype.componentWillUnmount=function(){this.sorter&&this.sorter.destroy()},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.prototype.getGridContainer=function(){var e,t;return null===(t=null===(e=this.gridContainerRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.getGridContainer()},t}(n.Component),k=o(59397),L=function(e){function t(t){var o=e.call(this,t)||this;return o.tabRef=(0,n.createRef)(),o.onScroll=function(){o.props.hasMore&&o.checkLoading()},o.checkLoading=(0,k.throttle)((function(){var e=o.props,t=e.loadMore,i=e.hasMore,r=o.state.isLoading,n=o.getScrollContainer(),a=o.getTabEl();i&&a&&(!r&&o.isMount&&(n instanceof HTMLElement?a.scrollTop+a.clientHeight>=a.scrollHeight-N.SCROLL_LOADING_MORE_GAP:window.innerHeight+N.SCROLL_LOADING_MORE_GAP>=a.getBoundingClientRect().bottom)&&(o.setState({isLoading:!0}),t().catch((function(e){console.error(e),(0,g.logError)(e)})).finally((function(){o.setState({isLoading:!1})}))))}),N.SCROLL_THROTTLE_DELAY),o.state={isLoading:!1},o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e,t=this,o=this.props,n=o.stories,a=o.selectedStoriesMap,s=o.className,l=o.onToggleCheck,d=o.isEditingLinksAvailable,c=o.onStoryLinkUpdate,u=o.linkData,v=this.state.isLoading;return(0,r.jsxs)("div",(0,i.__assign)({className:(0,k.classNames)("NarrativeEditorAllTab ScrollContainer",s),ref:this.tabRef},{children:[(0,r.jsx)(_,(0,i.__assign)({className:"NarrativeEditorAllTab__grid"},{children:n.map((function(o){var n=!1,s=new Date(1e3*o.time).toDateString();return e&&s===e||(e=s,n=!0),(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorAllTab__story"},{children:(0,r.jsx)(C,{story:o,checked:!!a[o.id],selectable:t.isSelectable(o),onToggleCheck:l,onStoryLinkUpdate:c,isEditingLinksAvailable:d,linkData:u,needShowDate:n},void 0)}),o.rawId)}))}),void 0),v&&(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorAllTab__loader"},{children:(0,r.jsx)(S.default,{},void 0)}),void 0)]}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,o=Object.keys(t).length;return!e.isUnavailable&&!!(o<N.MAX_NARRATIVE_STORIES||t[e.id])},t.prototype.componentDidMount=function(){this.isMount=!0,this.initScrollListener()},t.prototype.componentWillUnmount=function(){this.isMount=!1,this.deInitScrollContainer()},t.prototype.initScrollListener=function(){var e=this.getScrollContainer(),t=this.getTabEl();e&&t&&e.addEventListener("scroll",this.onScroll,!0)},t.prototype.deInitScrollContainer=function(){var e;null===(e=this.getScrollContainer())||void 0===e||e.removeEventListener("scroll",this.onScroll)},t.prototype.getScrollContainer=function(){return this.props.appearance===s.EditorViewType.box?this.getTabEl():window},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.defaultProps={isEditingLinksAvailable:!1,hasMore:!1},t}(n.Component),T=function(e){function t(t){var o=e.call(this,t)||this;return o.onTabClick=function(e,t){o.setState({tabKey:t,selectedTabStoryIds:(0,i.__spreadArray)([],(0,i.__read)(o.props.selectedStoryIds),!1)})},o.onReorder=function(e){var t=o.props.onSelectedStoriesUpdate,i=o.getSelectedStoriesMap(),r=e.filter((function(e){return i[e]}));o.setState({selectedTabStoryIds:e}),t(r)},o.onStorySelectToggle=function(e){var t,r=o.props,n=r.selectedStoryIds,a=r.onSelectedStoriesUpdate,l=o.state,d=l.tabKey,c=l.selectedTabStoryIds,u=o.getSelectedStoriesMap();if(!(Object.keys(u).length>=N.MAX_NARRATIVE_STORIES)||u[e.id]){if(!c.length)return o.setState({selectedTabStoryIds:[e.id]}),void a([e.id]);if(u[e.id]){a(n.filter((function(t){return t!==e.id})))}else{var v=[],h=(0,i.__assign)((0,i.__assign)({},u),((t={})[e.id]=e,t));if(d===s.EditorTabKey.selected)v=c.filter((function(e){return h[e]}));else if(d===s.EditorTabKey.all){if(c.includes(e.id))v=c.filter((function(e){return h[e]}));else v=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),[e.id],!1).filter((function(e){return h[e]})),o.setState({selectedTabStoryIds:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),[e.id],!1)})}a(v)}}},o.state={tabKey:t.selectedStoryIds.length?s.EditorTabKey.selected:s.EditorTabKey.all,selectedTabStoryIds:(0,i.__spreadArray)([],(0,i.__read)(t.selectedStoryIds),!1)},o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e,t=this.props,o=t.selectedStoryIds,n=t.appearance,l=t.isEditingLinksAvailable,d=t.linkData,c=t.onStoryLinkUpdate,u=t.loadMore,_=t.hasMore,p=this.state.tabKey,g=this.getSelectedStoriesMap(),f=this.getAllStories();return(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeEditorStoriesTabPanel"},{children:[(0,r.jsxs)(v.default,(0,i.__assign)({className:"NarrativeEditorStoriesTabPanel__tabs",onTabClick:this.onTabClick,active:p,disabledTabMap:(e={},e[s.EditorTabKey.selected]=!o.length,e)},{children:[(0,r.jsxs)("span",{children:[(0,a.getLang)("stories_narrative_editor_selected_tab"),o.length>0&&(0,r.jsx)("span",(0,i.__assign)({className:"Tabs__desc"},{children:o.length}),void 0)]},s.EditorTabKey.selected),(0,r.jsx)("span",{children:(0,a.getLang)("stories_narrative_editor_all_tab")},s.EditorTabKey.all)]}),void 0),p===s.EditorTabKey.selected&&(0,r.jsx)(E,{className:(0,h.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:this.getSelectedTabStories(),onReorder:this.onReorder,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:g,onStoryLinkUpdate:c,isEditingLinksAvailable:l,linkData:d},void 0),p===s.EditorTabKey.all&&(0,r.jsx)(L,{className:(0,h.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:f,loadMore:u,hasMore:_,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:g,onStoryLinkUpdate:c,isEditingLinksAvailable:l,linkData:d},void 0)]}),void 0)},t.prototype.getSelectedTabStories=function(){var e=this;return this.state.selectedTabStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getAllStories=function(){var e=this;return this.props.storyIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getSelectedStoriesMap=function(){var e=this;return this.props.selectedStoryIds.reduce((function(t,o){return t[o]=e.props.storyMap[o],t}),{})},t.defaultProps={isEditingLinksAvailable:!1},t}(n.Component),I=o(49062),B=o(49535),D=o(26271);const P=(0,w.makeIcon)("Icon24Write","write_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="write_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="m14.188 6.273 3.54 3.54-8.624 8.622a6.674 6.674 0 0 1-2.77 1.664l-2.903.886a.334.334 0 0 1-.416-.416l.886-2.902a6.674 6.674 0 0 1 1.664-2.771l8.623-8.623Zm1.061-1.06 1.769-1.77a1.5 1.5 0 0 1 2.121 0l1.418 1.419a1.5 1.5 0 0 1 0 2.121L18.79 8.752l-3.54-3.54Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var A=function(e){function t(t){var o=e.call(this,t)||this;return o.getInputEl=function(){return o.nameInputRef&&o.nameInputRef.current},o.onKeyDown=function(e){e.keyCode===B.KEY.ENTER&&(e.ctrlKey||e.metaKey&&D.browser.mac)&&o.props.onSubmit()},o.nameInputRef=(0,n.createRef)(),o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.name,o=e.onNameChange,n=e.selectedStoriesCount,s=e.coverUrl,l=e.onCoverClick,d=e.className,c=0===n,u="";return c||(u=(0,a.getLang)("stories_choose_cover")),(0,r.jsxs)("div",(0,i.__assign)({className:(0,k.classNames)("NarrativeEditorDataPanel",d)},{children:[(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeEditorDataPanel__preview"},{children:[(0,r.jsx)(I.NarrativeItemPreviewCover,{className:(0,k.classNames)("NarrativeEditorDataPanel__cover",{"NarrativeEditorDataPanel__cover--active":!c}),onClick:l,cover:s,title:u,extra:!c&&(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorDataPanel__pencil"},{children:(0,r.jsx)(P,{},void 0)}),void 0)},void 0),(0,r.jsx)("span",(0,i.__assign)({className:(0,k.classNames)("NarrativeEditorDataPanel__name",{"NarrativeEditorDataPanel__name--empty":!t})},{children:t||(0,a.getLang)("stories_narrative_name_full")}),void 0)]}),void 0),(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeEditorDataPanel__form"},{children:[(0,r.jsx)("span",(0,i.__assign)({className:"NarrativeEditorDataPanel__nameLabel"},{children:(0,a.getLang)("stories_narrative_name")}),void 0),(0,r.jsx)("input",{className:"NarrativeEditorDataPanel__nameInput",value:t,onChange:o,onKeyDown:this.onKeyDown,type:"text",placeholder:(0,a.getLang)("stories_enter_name"),maxLength:N.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),n>0&&(0,r.jsx)("span",(0,i.__assign)({className:"NarrativeEditorDataPanel__selectedStoryCount"},{children:(0,a.getLang)("stories_selected_count",n)}),void 0)]}),void 0)]}),void 0)},t}(n.Component),R=o(95724),j=o(41929),O=o(26489),M=o(50382),U=function(e){var t=e.appearance,o=e.actionButtons;return(0,r.jsx)("div",(0,i.__assign)({className:(0,h.classNames)("NarrativeEditorFooter","NarrativeEditorFooter--"+t)},{children:(0,r.jsx)(M.ModalFooter,{actionButtons:o},void 0)}),void 0)},H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollContainerRef=(0,n.createRef)(),t}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.children,n=e.appearance,a=e.actionFooterButtons;return(0,r.jsxs)("div",(0,i.__assign)({className:(0,h.classNames)("NarrativeEditorSection",t),ref:this.scrollContainerRef},{children:[(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorSection__body"},{children:o}),void 0),Boolean(a)&&(0,r.jsx)(U,{appearance:n,actionButtons:a},void 0)]}),void 0)},t.prototype.getSectionEl=function(){var e;return null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current},t}(n.Component);const F=(0,w.makeIcon)("Icon36Add","add_36","0 0 36 36",'<symbol viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" id="add_36"><g fill="none" fill-rule="evenodd"><path d="M0 0h36v36H0z" /><path d="M19.5 19.5v9a1.5 1.5 0 0 1-3 0v-9h-9a1.5 1.5 0 0 1 0-3h9v-9a1.5 1.5 0 0 1 3 0v9h9a1.5 1.5 0 0 1 0 3h-9Z" fill="currentColor" /></g></symbol>',36,36,!1,void 0);var G=function(e){var t=e.text,o=e.multiple,n=void 0!==o&&o,a=e.onFilesLoad;return(0,r.jsxs)("div",(0,i.__assign)({className:"StoryLoadFile StoryPreviewContainer"},{children:[(0,r.jsx)(F,{},void 0),(0,r.jsx)("span",(0,i.__assign)({className:"StoryLoadFile__text"},{children:t}),void 0),(0,r.jsx)("input",{type:"file",className:"StoryLoadFile__input",multiple:n,onChange:function(e){var t=e.currentTarget.files;t&&a(Array.from(t))}},void 0)]}),void 0)},V=function(){return(0,r.jsx)("div",(0,i.__assign)({className:"UploadDropBoxArea"},{children:(0,r.jsx)("div",(0,i.__assign)({className:"UploadDropBoxArea__inner"},{children:(0,r.jsx)("div",(0,i.__assign)({className:"UploadDropBoxArea__text"},{children:(0,a.getLang)("stories_narrative_cover_drop_hint")}),void 0)}),void 0)}),void 0)},W=o(94021),z=function(){return(0,r.jsx)(W.WithPortal,{children:(0,r.jsx)("div",(0,i.__assign)({className:"UploadDropPageArea"},{children:(0,r.jsxs)("div",(0,i.__assign)({className:"UploadDropPageArea__inner"},{children:[(0,r.jsx)("div",{className:"UploadDropPageArea__image"},void 0),(0,r.jsx)("div",(0,i.__assign)({className:"UploadDropPageArea__text"},{children:(0,a.getLang)("stories_drop_page_area_label")}),void 0)]}),void 0)}),void 0)},void 0)},K=3,Y=2*Math.PI*22,X=(0,n.memo)((function(e){var t=e.percent,o=void 0===t?60:t,n=e.width,a=void 0===n?24:n,s=e.height,l=void 0===s?24:s,d=(Y-K)*o/100+K;return(0,r.jsx)("svg",(0,i.__assign)({className:"StoryProgressSpinner",width:a,height:l,viewBox:"0 0 50 50"},{children:(0,r.jsx)("circle",{cx:"25",cy:"25",r:22,stroke:"#fff",fill:"none",strokeWidth:"6",strokeMiterlimit:"10",strokeDashoffset:"0",strokeDasharray:d+","+Y,strokeLinecap:"round"},void 0)}),void 0)}));const q=(0,w.makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Q=o(3562),Z=function(e){function t(t){return e.call(this,t)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.checked,o=e.coverUrl,n=e.onToggleCheck,s=e.uploadingStatus,l=e.uploadingPercent,d=e.retryUpload,c=s===Q.CoverUploadStatus.uploaded,u=s===Q.CoverUploadStatus.uploading,v=s===Q.CoverUploadStatus.failed,h=c;return(0,r.jsxs)("div",(0,i.__assign)({className:(0,k.classNames)("StoryCustomCoverPreview StoryPreviewContainer",{"StoryCustomCoverPreview--empty":u||v}),onClick:function(){h&&n()}},{children:[c&&(0,r.jsx)("div",(0,i.__assign)({className:"StoryCustomCoverPreview__coverFrame"},{children:(0,r.jsx)("div",(0,i.__assign)({className:"StoryCustomCoverPreview__coverWrap"},{children:(0,r.jsx)("img",{src:o,className:"StoryCustomCoverPreview__cover",alt:""},void 0)}),void 0)}),void 0),u&&(0,r.jsx)(X,{percent:l},void 0),v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q,{},void 0),(0,r.jsx)("span",(0,i.__assign)({className:"StoryCustomCoverPreview__errorText"},{children:(0,a.getLang)("stories_upload_error_text")}),void 0),(0,r.jsx)("div",(0,i.__assign)({className:"StoryCustomCoverPreview__repeat",onClick:d},{children:(0,a.getLang)("stories_upload_repeat")}),void 0)]},void 0),h&&(0,r.jsx)("div",{className:(0,k.classNames)("StoryCustomCoverPreview__select",{"StoryCustomCoverPreview__select--on":t})},void 0)]}),void 0)},t.defaultProps={uploadingStatus:Q.CoverUploadStatus.uploaded},t}(n.PureComponent),$=o(73023),J=o(54612),ee=o(61540),te=o(3425),oe=function(e){function t(t){var o,s=e.call(this,t)||this;s.scrollContainerRef=(0,n.createRef)(),s.isMount=!1,s.isCropSubmitted=!1,s.onFilesLoad=function(e){s.file=e[0],s.file&&s.uploadCover()},s.uploadCover=function(){if(s.file){var e=s.file,t=s.props.coverUploadConfig,o=new $.UploadPhoto(t,s.onUploadCoverProgress);o.validate(e).then((function(){if(s.isMount){var t=URL.createObjectURL(e),r={id:Q.CustomCoverId,url:t,customPhotoOriginalUrl:t,percent:0,status:Q.CoverUploadStatus.uploading};return s.setState({customCover:r}),o.upload(e).then((function(e){if(s.isMount){var t=JSON.stringify(e);s.setState({customCover:(0,i.__assign)((0,i.__assign)({},r),{percent:100,status:Q.CoverUploadStatus.uploaded,uploadResponse:t}),checkedCoverId:Q.CustomCoverId})}}))}})).catch((function(e){if(s.isMount){var t=s.state.customCover;t&&(t=(0,i.__assign)((0,i.__assign)({},t),{percent:0,status:Q.CoverUploadStatus.failed})),console.error(e),e=(0,k.isObject)(e)?e.text:String(e),(0,J.showFastBox)((0,a.getLang)("global_error"),e||(0,a.getLang)("global_unknown_error")),(0,g.logError)(new Error("error with uploadCover"+(e?": "+e:""))),s.setState({customCover:t})}}))}},s.onUploadCoverProgress=function(e,t){var o=Math.min(e/t*100,90);s.setState((function(e){var t=e.customCover;return t?{customCover:(0,i.__assign)((0,i.__assign)({},t),{percent:o})}:null}))},s.selectCustomCover=function(){s.setState({checkedCoverId:Q.CustomCoverId})},s.toggleCheck=function(e){s.setState({checkedCoverId:e.rawId})},s.openCropper=function(){var e=s.state.checkedCoverId,t=s.getCoverById(e);if(t){var o=s.getCoverOriginalUrl(t);o&&(0,ee.loadImage)(o).then((function(e){if(s.isMount){var r=e.width,n=e.height,a=(0,i.__read)(s.getThumbSizes(r,n),2),l=a[0],d=a[1];s.setState({isModalOpen:!0}),(0,p.showNarrativeCropCoverBox)({coverUrl:o,coverHeight:n,coverWidth:r,thumbHeight:d,thumbWidth:l,crop:t.crop,onSave:s.onCropSave,onClose:s.onCropClose})}})).catch((function(e){console.error(e),e=String(e),(0,J.showFastBox)((0,a.getLang)("global_error"),e||(0,a.getLang)("global_unknown_error")),(0,g.logError)(new Error("error with cover openCropper"+(e?": "+e:"")))}))}},s.onCropSave=function(e,t){return s.saveCustomPhotoIfNeeded().then((function(o){s.isCropSubmitted=!0;var r=s.state.covers;(0,Q.isSelectableCustomCover)(o)?s.setState({customCover:(0,i.__assign)((0,i.__assign)({},o),{url:t,crop:e})}):s.setState({covers:r.map((function(r){return r.id===o.id?(0,i.__assign)((0,i.__assign)({},o),{url:t,crop:e}):r}))})}))},s.onCropClose=function(){var e=s.props.onSave,t=s.state.checkedCoverId;s.setState({isModalOpen:!1});var o=s.getCoverById(t);o&&s.isCropSubmitted&&e({url:o.url,coverStoryId:o.coverStoryId,customPhotoOriginalUrl:o.customPhotoOriginalUrl,customPhotoId:o.customPhotoId,crop:o.crop})},s.getFooterButtons=function(){var e=s.props.onSave,t=s.state.customCover;return[(0,r.jsx)(l.default,(0,i.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,a.getLang)("global_cancel")}),"close"),(0,r.jsx)(u.default,(0,i.__assign)({onClick:s.openCropper,disabled:(null==t?void 0:t.status)===Q.CoverUploadStatus.uploading},{children:(0,a.getLang)("stories_narrative_cover_next_step")}),"save")]},s.onDragEnter=function(e){var t,o,i,r;("file"===(null===(o=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.items[0])||void 0===o?void 0:o.kind)||(null===(r=null===(i=null==e?void 0:e.dataTransfer)||void 0===i?void 0:i.types)||void 0===r?void 0:r.includes("Files")))&&(clearTimeout(s.dragLeaveTimeout),delete s.dragLeaveTimeout,s.setState({showDropArea:!0})),(0,B.cancelEvent)(e)},s.onDragLeave=function(e){clearTimeout(s.dragLeaveTimeout),s.dragLeaveTimeout=setTimeout((function(){delete s.dragLeaveTimeout,s.setState({showDropArea:!1})}),100),(0,B.cancelEvent)(e)},s.onDragDrop=function(e){var t,o;s.onDragLeave(e),(null===(o=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.files)||void 0===o?void 0:o.length)&&s.onFilesLoad(Array.from(e.dataTransfer.files));var i=s.getScrollContainer();i&&i.scrollTo({top:0,behavior:"smooth"}),(0,B.cancelEvent)(e)};var d=(0,i.__read)(s.buildCovers(t),2),c=d[0],v=d[1],h=null===(o=c[0])||void 0===o?void 0:o.id;if(t.cover){var _=t.cover.customPhotoId,f=t.cover.coverStoryId;h=_?Q.CustomCoverId:f?t.storyMap[f].rawId:t.stories[0].rawId}return s.state={showDropArea:!1,covers:c,customCover:v,checkedCoverId:h,isModalOpen:!1},s}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.className,n=t.appearance,l=t.stories,d=this.state,c=d.customCover,u=d.checkedCoverId,v=d.showDropArea,h=d.isModalOpen;return(0,r.jsxs)(H,(0,i.__assign)({className:(0,k.classNames)("NarrativeEditorCoverSection",o),appearance:n,actionFooterButtons:this.getFooterButtons()},{children:[(0,r.jsxs)("div",(0,i.__assign)({className:"ScrollContainer",ref:this.scrollContainerRef},{children:[(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorCoverSection__hint StoryGridHint"},{children:(0,a.getLang)("stories_choose_cover_hint")}),void 0),(0,r.jsxs)(_,(0,i.__assign)({className:"NarrativeEditorCoverSection__grid"},{children:[(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorCoverSection__create"},{children:(0,r.jsx)(G,{text:(0,a.getLang)("stories_upload_narrative_cover"),onFilesLoad:this.onFilesLoad},void 0)}),void 0),c&&(0,r.jsx)(Z,{uploadingStatus:c.status,coverUrl:c.customPhotoOriginalUrl,checked:c.id===u,uploadingPercent:c.percent,onToggleCheck:this.selectCustomCover,retryUpload:this.uploadCover},void 0),l.map((function(t){return(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditorCoverSection__story"},{children:(0,r.jsx)(C,{story:t,checked:u===t.rawId,selectable:!0,onToggleCheck:e.toggleCheck},void 0)}),t.rawId)}))]}),void 0)]}),void 0),v&&!h&&n===s.EditorViewType.box&&(0,r.jsx)(V,{},void 0),v&&!h&&n===s.EditorViewType.page&&(0,r.jsx)(z,{},void 0)]}),void 0)},t.prototype.getThumbSizes=function(e,t){var o,i,r=e/t;return e>=t?(o=Math.min(e,te.MAX_THUMB_WIDTH),(i=Math.floor(o/r))>te.MAX_THUMB_HEIGHT&&(i=te.MAX_THUMB_HEIGHT,o=Math.floor(i*r))):(i=Math.min(t,te.MAX_THUMB_HEIGHT),(o=Math.floor(i*r))>te.MAX_THUMB_WIDTH&&(o=te.MAX_THUMB_WIDTH,i=Math.floor(o/r))),[o,i]},t.prototype.saveCustomPhotoIfNeeded=function(){var e=this,t=this.props,o=t.ownerId,r=t.coverUploadConfig,n=this.state.checkedCoverId,a=this.getCoverById(n);return a?(0,Q.needSavePhoto)(a)?new Promise((function(t,n){window.ajax.post("al_stories.php",{act:"save_narrative_cover",owner_id:o,upload_response:a.uploadResponse,hash:r.hash},{onDone:function(o){var r=e.state.customCover;if(e.isMount&&r){var a=(0,i.__assign)((0,i.__assign)({},r),{customPhotoId:o});t(a)}else n()},onFail:function(e){return console.error(e),n(e),!0}})})):Promise.resolve(a):Promise.reject()},t.prototype.componentDidMount=function(){this.isMount=!0;var e=this.getDragAndDropContainer();e&&(e.addEventListener("drop",this.onDragDrop),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragover",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))},t.prototype.componentWillUnmount=function(){this.isMount=!1,null!=this.dragLeaveTimeout&&clearTimeout(this.dragLeaveTimeout);var e=this.getDragAndDropContainer();e&&(e.removeEventListener("drop",this.onDragDrop),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragover",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave))},t.prototype.getDragAndDropContainer=function(){return this.props.appearance===s.EditorViewType.box?window.boxLayerWrap:document.body},t.prototype.getScrollContainer=function(){return this.props.appearance===s.EditorViewType.box?this.scrollContainerRef.current:document.documentElement},t.prototype.buildCovers=function(e){var t,o=e.cover,r=e.stories;return o&&(0,Q.isCustomCover)(o)&&(t=(0,i.__assign)({id:Q.CustomCoverId},o)),[r.map((function(e){return(null==o?void 0:o.coverStoryId)===e.id?(0,i.__assign)({id:e.rawId},o):{id:e.rawId,url:e.preview,coverStoryId:e.id}})),t]},t.prototype.getCoverById=function(e){return e===Q.CustomCoverId?this.state.customCover:this.state.covers.find((function(t){return t.id===e}))},t.prototype.getCoverOriginalUrl=function(e){var t,o=this.props.storyMap,i="";return(0,Q.isSelectableCustomCover)(e)?i=e.customPhotoOriginalUrl:e.coverStoryId&&(i=null===(t=o[e.coverStoryId])||void 0===t?void 0:t.originalPreviewUrl),i},t}(n.Component),ie=o(49464),re=function(e){function t(t){var o=e.call(this,t)||this;o.onSelectedStoriesUpdate=function(e){void 0===e&&(e=[]);var t=o.props.storyMap,i=o.state.cover,r=null==i?void 0:i.coverStoryId,n={selectedStoryIds:e};if((null==i?void 0:i.customPhotoId)||r&&e.includes(r))e.length||(n.cover=null);else{var a=e[0];e[0]?n.cover={url:t[a].preview,coverStoryId:a}:n.cover=null}o.setState(n)},o.openCoverSelection=function(){var e=o.state.cover;((null==e?void 0:e.coverStoryId)||(null==e?void 0:e.customPhotoId))&&o.setState({section:s.EditorSectionType.cover})},o.confirmCover=function(e){var t=o.state.cover;o.setState({cover:e||t,section:s.EditorSectionType.main})},o.onNameChange=function(e){var t=e.target.value,i=(0,R.trim)(t)?t:"";o.setState({name:i})},o.close=function(e,t){var r=o.props,n=r.ownerId,a=r.narrativeRawId,s=r.navScreen;if(!e){var l="";a&&(l=(0,i.__read)(a.split("_"),2)[1]),(0,ie.sendNarrativeAnalytic)(ie.NarrativeAnalyticEventType.close,{ownerId:n,id:Number(l)},s)}o.props.close(t)},o.onSave=function(e){o.props.onSave(e)},o.getFooterButtons=function(){var e=o.props.type,t=o.state,n=t.selectedStoryIds,d=t.loading;return[(0,r.jsx)(l.default,(0,i.__assign)({appearance:"tertiary",onClick:function(){return o.close(!1)},disabled:d},{children:(0,a.getLang)("global_cancel")}),"close"),(0,r.jsx)(u.default,(0,i.__assign)({loading:d,onClick:o.save,disabled:0===n.length},{children:e===s.EditorModeType.edit?(0,a.getLang)("global_save"):(0,a.getLang)("stories_create_narrative")}),"save")]},o.save=function(){var e=o.props,t=e.publishHash,r=e.editHash,n=e.type,l=e.navScreen,u=e.ownerId,v=o.state,h=v.cover,_=v.loading,p=o.getSelectedStories(),g=o.state.name,f=void 0===g?"":g,m=o.props.narrativeRawId;if(!_)if(f=(0,R.trim)(f)){if((null==h?void 0:h.coverStoryId)||(null==h?void 0:h.customPhotoId)){var w="publish_narrative",y=t;n===s.EditorModeType.edit&&(w="edit_narrative",y=r);var S={act:w,owner_id:u,title:f,hash:y,story_ids:(0,O.prepareStoriesForPublishing)(p)};if(m){var C=(0,i.__read)(m.split("_"),2)[1];S.narrative_id=C}h.customPhotoId&&(S.custom_cover_photo_id=h.customPhotoId),h.coverStoryId&&(S.cover_story_id=h.coverStoryId),h.crop&&(S.crop_y=h.crop.y,S.crop_x=h.crop.x,S.crop_height=h.crop.height,S.crop_width=h.crop.width),window.ajax.post("al_stories.php",S,{onDone:function(e){m||(m=u+"_"+e);var t=o.getPublishDoneHtml(m,f,n);o.onSave(m),o.close(!0,(function(){return(0,c.showDoneBox)(t)})),(0,ie.sendNarrativeAnalytic)(n===s.EditorModeType.edit?ie.NarrativeAnalyticEventType.editNarrative:ie.NarrativeAnalyticEventType.publishNarrative,{ownerId:Number(u),id:Number(e)},l)},onFail:function(e){return(0,c.showDoneBox)(e||(0,a.getLang)("global_error")),!0},hideProgress:function(){o.setState({loading:!1})}}),o.setState({loading:!0})}}else o.dataPanelRef.current&&(0,d.notaBene)(o.dataPanelRef.current.getInputEl())};var v=t.cover,h=t.selectedStoryIds[0];return!v&&h&&(v={url:t.storyMap[h].preview,coverStoryId:h}),o.state={tabKey:t.activeTabKey,name:t.name,selectedStoryIds:t.selectedStoryIds,cover:v,loading:!1,section:s.EditorSectionType.main},o.dataPanelRef=(0,n.createRef)(),o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;return this.props.appearance===s.EditorViewType.box?(0,r.jsx)(j.BoxModal,(0,i.__assign)({className:"NarrativeEditor NarrativeEditor--box",appearance:"blue",title:this.getBoxTitle(),onClose:function(){return e.close()},hasScroll:!1},{children:this.renderInner()}),void 0):(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeEditor NarrativeEditor--page"},{children:this.renderInner()}),void 0)},t.prototype.renderInner=function(){var e=this.props,t=e.storyIds,o=e.storyMap,n=e.onStoryLinkUpdate,a=e.isEditingLinksAvailable,l=e.linkData,d=e.appearance,c=e.loadMore,u=e.hasMore,v=e.coverUploadConfig,h=e.ownerId,_=this.state,p=_.name,g=_.selectedStoryIds,f=_.cover,m=_.section,w=this.getSelectedStories(),y=(null==f?void 0:f.url)||"";return(0,r.jsxs)("div",(0,i.__assign)({className:"NarrativeEditor__inner"},{children:[m===s.EditorSectionType.main&&(0,r.jsxs)(H,(0,i.__assign)({appearance:d,actionFooterButtons:this.getFooterButtons()},{children:[(0,r.jsx)(A,{className:"NarrativeEditor__dataPanel",coverUrl:y,name:p,selectedStoriesCount:g.length,onNameChange:this.onNameChange,onSubmit:this.save,onCoverClick:this.openCoverSelection,ref:this.dataPanelRef},void 0),(0,r.jsx)(T,{appearance:d,onSelectedStoriesUpdate:this.onSelectedStoriesUpdate,storyIds:t,loadMore:c,hasMore:u,selectedStoryIds:g,storyMap:o,linkData:l,isEditingLinksAvailable:a,onStoryLinkUpdate:n},void 0)]}),void 0),m===s.EditorSectionType.cover&&(0,r.jsx)(oe,{ownerId:h,appearance:d,cover:f,stories:w,onSave:this.confirmCover,coverUploadConfig:v,storyMap:o},void 0)]}),void 0)},t.prototype.getBoxTitle=function(){var e=this.props.type;return this.state.section===s.EditorSectionType.cover?(0,a.getLang)("stories_choose_cover_title"):e===s.EditorModeType.create?(0,a.getLang)("stories_creating_narrative"):(0,a.getLang)("stories_editing_narrative")},t.prototype.getPublishDoneHtml=function(e,t,o){var r=this.props.getPublishDoneHTML;if(r)return r(e,t,o);var n=(0,i.__read)(e.split("_"),2),l=n[0],d=n[1],c="if (!event.metaKey && !event.ctrlKey) { showNarrative("+Number(l)+", "+Number(d)+", 0, 'narrative"+e+"'); return false; }";return'\n      <div class="top_result_header">\n        '+(o===s.EditorModeType.create?(0,a.getLang)("stories_narrative_created"):(0,a.getLang)("stories_narrative_edited")).replace("{name}",'<a href="/narrative'+e+'" onclick="'+c+'">'+(0,R.clean)(t)+"</a>")+'\n      </div>\n      <a href="#" class="link" onclick="window.Likes.share(\'narrative'+e+"'); return false;\">"+(0,a.getLang)("stories_manage_share_narrative")+"</a>\n    "},t.prototype.getSelectedStories=function(){var e=this;return this.state.selectedStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.componentWillUnmount=function(){this.revokeCustomUrls()},t.prototype.revokeCustomUrls=function(){var e=this.state.cover;e&&(0,Q.isCustomCover)(e)&&[e.url,e.customPhotoOriginalUrl].forEach((function(e){(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))},t.defaultProps={name:"",type:s.EditorModeType.create,activeTabKey:s.EditorTabKey.selected,isEditingLinksAvailable:!1,appearance:s.EditorViewType.page},t}(n.Component)},87157:(e,t,o)=>{"use strict";var i,r,n,a;o.d(t,{EditorModeType:()=>i,EditorTabKey:()=>r,EditorViewType:()=>n,EditorSectionType:()=>a}),function(e){e[e.create=0]="create",e[e.edit=1]="edit"}(i||(i={})),function(e){e.all="all",e.selected="selected"}(r||(r={})),function(e){e.box="box",e.page="page"}(n||(n={})),function(e){e.main="main",e.cover="cover"}(a||(a={}))},3562:(e,t,o)=>{"use strict";var i;function r(e){return Boolean(e.customPhotoId||e.uploadResponse)}function n(e){return Boolean(e.customPhotoId)}function a(e){return e.uploadResponse&&!e.customPhotoId}function s(e){var t={url:e.coverUrl,crop:e.coverCrop};return e.customCover?(t.customPhotoId=e.customCover.photoId,t.customPhotoOriginalUrl=e.customCover.originalPhotoUrl):t.coverStoryId=e.coverStoryId,t}o.d(t,{CoverUploadStatus:()=>i,isSelectableCustomCover:()=>r,isCustomCover:()=>n,needSavePhoto:()=>a,getPreparedCover:()=>s,CustomCoverId:()=>l}),function(e){e[e.uploaded=0]="uploaded",e[e.uploading=1]="uploading",e[e.failed=2]="failed"}(i||(i={}));var l="custom"},49062:(e,t,o)=>{"use strict";o.d(t,{NarrativeItemPreviewCover:()=>s});var i=o(70655),r=o(85893),n=o(67294),a=o(83295),s=(0,n.memo)((function(e){var t=e.title,o=e.onClick,s=e.cover,l=e.href,d=e.className,c=void 0===d?"":d,u=e.extra,v=e.noBorder,h=void 0!==v&&v,_=e.isDraft,p=void 0!==_&&_,g=e.size,f=void 0===g?58:g,m=s?{backgroundImage:"url("+s+")"}:{},w=(0,a.classNames)("NarrativeItemPreviewCover","NarrativeItemPreviewCover--size"+f,c,{"NarrativeItemPreviewCover--noBorder":h,"NarrativeItemPreviewCover--isDraft":p}),y=(0,r.jsx)("div",(0,i.__assign)({className:"NarrativeItemPreviewCover__image",style:m,title:t||void 0},{children:u}),void 0);return(0,r.jsxs)(n.Fragment,{children:[l&&(0,r.jsx)("a",(0,i.__assign)({href:l,className:w,onClick:o},{children:y}),void 0),!l&&(0,r.jsx)("div",(0,i.__assign)({className:w,onClick:o},{children:y}),void 0)]},void 0)}))},17173:(e,t,o)=>{"use strict";o.d(t,{STORIES_MANAGE_MODULE:()=>i,LONG_PRESS_DELAY_MS:()=>r,ADMIN_STORY_VIEW_MODULE:()=>n,StickerTypes:()=>a,EMOJI_REACTIONS_ARR:()=>s,QUESTION_SELECT_MODE:()=>l,MAX_FEEDBACK_STORIES_SLICE_COUNT:()=>d,INIT_MAX_FEEDBACK_STORIES_COUNT:()=>c,MAX_NARRATIVE_STORIES:()=>u,NARRATIVE_MAX_TITLE_LENGTH:()=>v,BOX_ITEM_DRAGGABLE_CLASS:()=>h,SCROLL_THROTTLE_DELAY:()=>_,SCROLL_LOADING_MORE_GAP:()=>p});var i="stories_manage",r=200,n="admin_story_view",a={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14},s=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],l={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},d=50,c=10,u=100,v=23,h="NarrativeBox__draggable",_=34,p=400},26489:(e,t,o)=>{"use strict";o.d(t,{highlightNarrativeBlock:()=>N,prepareStoriesForPublishing:()=>S,updateNarrativeBlock:()=>C,updateNarrativeSnippetsFromQueueByPost:()=>x});var i=o(15544),r=o(86125),n=o(49535),a=o(3834);function s(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var l=o(99392),d="page_header_cont",c="onboarding";class u{constructor(e,t,o){var i;void 0===o&&(o={}),this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;var r,n,a={autoShow:!1,noAutoHideOnWindowClick:null==(i=o.noAutoHideOnWindowClick)||i,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${n=null!=(r=o.class)?r:"",o.tooltipWhite?n:n+" feature_intro_blue_tt"}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:o.scrollOffset||0,align:o.align||l.ElementTooltip.ALIGN_CENTER};o.side&&(a.forceSide=o.side),o.offset&&(a.offset=o.offset),o.width&&(a.width=o.width),o.shift&&(a.centerShift=o.shift),o.border?this.border=o.border:this.border=[10,10,10,10],o.ttOnHide&&(a.onHide=o.ttOnHide),o.withCloseButton&&(a.withCloseButton=o.withCloseButton,a.onCloseButtonClick=o.onCloseButtonClick),o.align&&(a.align=o.align),this.ttParams=a,this.opts=o,this.initOnboardingBG()}initOnboardingBG(){if(!window.onboardingBG){var e=(0,i.se)('\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ');(0,i.domInsertBefore)(e,window.layerBG),window.onboardingBGHeader=(0,i.ge)("onboarding_bg_header"),window.onboardingBG=(0,i.ge)("onboarding_bg"),window.onboardingBGRect=(0,i.ge)("onboarding_bg_rect"),window.onboardingBGClip=(0,i.ge)("onboarding_bg_clip"),window.cur.destroy.push((()=>{(0,i.hide)(window.onboardingBG),(0,i.hide)(window.onboardingBGHeader),(0,i.removeClass)((0,i.ge)(d),c),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,n.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,n.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){var e=(0,i.getXY)(this.el)[1];this.tt=new l.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();var t=this.tt.getContent();s(this.el)&&s(t)||(0,a.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,n.removeEvent)(window,"scroll"),(0,n.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,n.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,n.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,n.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){var e=this.el.offsetWidth,t=this.el.offsetHeight,o=(0,i.getXY)(this.el);(0,i.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,i.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,i.attr)(window.onboardingBGClip,"x",o[0]-this.border[1]),(0,i.attr)(window.onboardingBGClip,"y",o[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){var e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,i.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,i.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,i.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,i.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,i.show)(window.onboardingBG),(0,i.isVisible)(window.onboardingBGHeader)||((0,i.show)(window.onboardingBGHeader),(0,i.addClass)((0,i.ge)(d),c)))}removeDarkens(){this.hideDarkness&&((0,i.hide)(window.onboardingBG),(0,i.hide)(window.onboardingBGHeader),(0,i.removeClass)((0,i.ge)(d),c))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){var e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){var e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}}var v,h,_=o(35429);var p=o(86067),g=o(40906),f=o(14200),m=o(33228),w=o(91525),y=o(19331);function S(e){return e.map((function(e){return e.id})).join(",")}function C(e){void 0===e&&(e=!1);var t=(0,g.intval)(window.cur.oid);if(window.cur.narrativeBlock)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:function(e){var t=(0,g.intval)(window.cur.oid),o=document.getElementById("narratives_module"+t+"_wrapper");if(o)if(e)(0,i.domReplaceEl)(o,e),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new f.default);else{var r=o.parentElement;(null==r?void 0:r.children.length)&&(null==r?void 0:r.children.length)>1?o.remove():null==r||r.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,m.removeStoryList)("narratives"+t)}});else if(t>0&&"profile"===window.cur.module){var o=document.getElementById("profile_media_narrow_block"),n=!o;window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t,need_wrap_block:(0,g.intval)(n)},{onDone:function(e){if(o)o.insertAdjacentHTML("afterbegin",e);else{var i=document.getElementById("narrow_column");if(!i)return;i.insertAdjacentHTML("beforeend",e)}window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new f.default,window.cur.narrativeBlock.showOnboardTooltipIfNeeded()),(0,m.removeStoryList)("narratives"+t)}})}else e&&function(e){window.boxQueue.hideAll();var t=document.querySelector("#box_layer_wrap"),o=document.querySelector("#box_loader");window.nav.reload({onDone:function(){e&&e()},showProgress:function(){(0,i.show)(t),(0,i.show)(o),(0,r.boxRefreshCoords)(o)},hideProgress:function(){(0,i.hide)(t),(0,i.hide)(o)}})}((function(){window.cur.needNarrativeOnboard=!0}))}function N(e){e&&function(e){var t,o=document.getElementById(e.module);if(o&&o.classList.contains("module")){window.cur.__narrowBarForceNotFixed=!0;var r=e.speed?e.speed:300;(0,a.scrollToY)((0,i.getXY)(o)[1]-100,r);var n=function(){v&&(v.hideTT(),(0,a.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,_.updateNarrow)(),e.onClose&&e.onClose())};(v=new u(o,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:n,onCloseButtonClick:n})).show(),(0,a.disableBodyScroll)(),e.autoCancelDelay&&(h=setTimeout((function(){n(),h=null}),e.autoCancelDelay),null===(t=window.cur.destroy)||void 0===t||t.push((function(){h&&clearTimeout(h)})))}}({module:"narratives_module"+window.vk.id,text:(0,p.getLang)("stories_narrative_block_onboarding_text"),onClose:function(){delete window.cur.needNarrativeOnboard,window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"profile_narrative"})},autoCancelDelay:1e4,speed:600})}function x(e){if(window.vk.id&&(0,y.partConfigEnabled)("update_private_snippets_by_queue")){var t=Array.from(e.querySelectorAll(".NarrativeSnippet"));if(t.length){var o=[];t.forEach((function(e){if(window.vk.id&&e.dataset.needUpdate){var t=e.dataset.narrativeRawId;t&&o.push({narrative_raw_id:t,snippet_type:e.dataset.snippetType,from:e.dataset.from})}})),o.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(o)},{onDone:function(e){t.forEach((function(t){t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:function(){return(0,w.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0}})}}}},285:(e,t,o)=>{"use strict";o.d(t,{loadRecommendedNarrativesBoxData:()=>ie,showNarrativeBox:()=>te,showNarrativeChooseBox:()=>ne,showNarrativeCreateLiteBox:()=>ae,showNarrativeCropCoverBox:()=>le,showNarrativeEditorBox:()=>ee,showRecommendedNarrativesBox:()=>oe,showStoryLinkEditorBox:()=>se});var i,r=o(70655),n=o(85893),a=o(87157),s=o(59397),l=o(81117),d=o(67294),c=o(41929),u=o(88420),v=o(41650),h=function(e){var t=e.title,o=e.count,i=void 0===o?0:o,a=e.showNarrativeNumber,s=void 0===a||a;return(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeBoxTitle"},{children:[t,s&&i>0&&(0,n.jsx)("span",(0,r.__assign)({className:"NarrativeBoxTitle__count"},{children:i}),void 0)]}),void 0)};!function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(i||(i={}));var _=o(13165),p=(0,d.memo)((function(e){e.id;var t,o=e.title,i=e.subtitle,a=e.preview,l=e.aside,d=e.href,c=e.onClick,u=e.className,v=void 0===u?"":u,h=e.size,_=void 0===h?58:h,p=(0,r.__rest)(e,["id","title","subtitle","preview","aside","href","onClick","className","size"]),g=Boolean(c||d);return o=(0,s.decodeHTMLEntities)(o),t=d?(0,n.jsx)("a",(0,r.__assign)({href:d,className:"NarrativeRowBase__title",onClick:c},{children:o}),void 0):(0,n.jsx)("span",(0,r.__assign)({className:"NarrativeRowBase__title",onClick:c},{children:o}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeRowBase","NarrativeRowBase--previewSize"+_,v,{"NarrativeRowBase--clickable":g})},p,{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__preview"},{children:a}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeRowBase__inner"},{children:[(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeRowBase__main"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__title"},{children:t}),void 0),i&&(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__subtitle"},{children:i}),void 0)]}),void 0),l&&(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeRowBase__aside"},{children:l}),void 0)]}),void 0)]}),void 0)}));const g=(0,o(63192).makeIcon)("Icon28AddOutline","add_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="add_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M14 4a1 1 0 0 1 1 1v8h8a1 1 0 0 1 0 2h-8v8a1 1 0 0 1-2 0v-8H5a1 1 0 0 1 0-2h8V5a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var f,m=(0,d.memo)((function(e){var t=e.onClick,o=e.clickable,i=void 0!==o&&o,a=e.size,l=void 0===a?58:a,d=(0,v.getLang)("stories_create_new_narrative"),c=(0,n.jsx)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeRowCreation__preview","NarrativeRowCreation__preview--size"+l)},{children:(0,n.jsx)(g,{},void 0)}),void 0);return(0,n.jsx)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeRowCreation NarrativeListItem",{"NarrativeRowCreation--clickable":i})},{nodrag:"true"},{children:(0,n.jsx)(p,{className:"NarrativeRowCreation__inner",title:d,onClick:t,preview:c,size:l},void 0)}),void 0)})),w=o(87142),y=o(39664),S=o(86125),C=o(40906),N=o(64891),x=o(53449),b=o(50167),E=o(42041),k=o(49062),L=o(21114),T=(0,d.memo)((function(e){var t,o,i,a,l=e.narrative,c=e.aside,u=e.onClick,h=e.className,_=e.clickable,g=e.size,f=e.noBorder,m=!l.storiesCount,w=m?"":"/narrative"+l.ownerId+"_"+l.id;return m?(t=(0,n.jsx)(k.NarrativeItemPreviewCover,{isDraft:!0,extra:(0,n.jsx)(L.default,{},void 0),size:g},void 0),o=(0,n.jsxs)(d.Fragment,{children:[(0,v.getLang)("groups_narrative_box_stories_count",l.storiesCount),(0,n.jsx)("span",{className:"dvd"},void 0),(0,n.jsx)("span",{children:(0,v.getLang)("stories_narratives_draft")},void 0)]},void 0)):(t=(0,n.jsx)(k.NarrativeItemPreviewCover,{onClick:u,size:g,cover:l.coverUrl,href:w,noBorder:f},void 0),o=(0,n.jsx)("span",{children:(0,v.getLang)("groups_narrative_box_stories_count",l.storiesCount)},void 0)),_?i=u:m||(a=u),(0,n.jsx)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeRow NarrativeListItem",h,{"NarrativeRow--clickable":_}),"data-id":l.id,onClick:i},{children:(0,n.jsx)(p,{className:"NarrativeRow__inner",href:w,onClick:a,preview:t,id:l.id,title:l.title,subtitle:o,size:g,aside:c},void 0)}),void 0)})),I=o(17173),B=o(81536),D=o(15653),P=o(49464),A=function(e){function t(t){var o=e.call(this,t)||this;return o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,a=e.boxData,s=e.type,l=[(0,n.jsx)(u.default,(0,r.__assign)({appearance:"primary",onClick:function(){return t()}},{children:(0,v.getLang)("global_close")}),"close")];if(s===i.edit&&a.userId===a.ownerId){var d=a.ownerDomain||"id"+a.userId;l.unshift((0,n.jsx)(N.default,(0,r.__assign)({href:d+"?w=stories",onClick:function(){t(),(0,b.showWiki)({w:"stories"})},className:"NarrativeBox__additionalFooterButton"},{children:(0,v.getLang)("stories_archive")}),"archive"))}return l},o.onNarrativeClick=function(e,t){if(!e.ctrlKey&&!e.metaKey){e.preventDefault(),e.stopPropagation();var i=o.props.list?o.props.list:"narrative"+t.ownerId+"_"+t.id;(0,_.showNarrative)(t.ownerId,t.id,0,i,{trackCode:o.props.trackCode,source:o.props.source})}},o.onCreateNarrativeClick=function(){var e=o.props,t=e.boxData,i=e.navScreen,r=t.ownerId;if((0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.createNarrative,{ownerId:r},i),r>0)o.openNarrativeEditorBox();else{var n=t.ownerDomain?t.ownerDomain:"club"+-r;window.open("https://"+location.hostname+"/"+n+"?act=narrative_create")}},o.openNarrativeEditorBox=function(e){var t=o.props,i=t.onSave,n=t.boxData,a=t.onClose,s=t.navScreen;if(i){var l=[];(null==e?void 0:e.stories.length)&&(l=(0,r.__spreadArray)([],(0,r.__read)(e.stories),!1));var d={narrative:e,selectedStories:l,publishHash:n.publishHash,onSave:function(e){i(e),a()},navScreen:s};ee(n.ownerId,d)}},o.getNarrativeItemActions=function(e){var t=[];if(o.canEdit())t.push({text:(0,v.getLang)("global_edit"),onClick:function(){return o.editNarrative(e)}}),t.push({text:(0,v.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}}),t.push({separator:!0}),t.push({text:(0,v.getLang)("global_delete"),onClick:function(){return o.removeNarrative(e)}});else{var i=e.isBookmarked?(0,v.getLang)("global_remove_from_bookmarks"):(0,v.getLang)("global_add_to_bookmarks");t.push({text:i,onClick:function(){return o.bookmarkNarrative(e)}}),t.push({text:(0,v.getLang)("stories_share"),onClick:function(){return o.shareNarrative(e)}})}return t},o.state={isLoad:!1,draggingNarrativeRawId:""},o.scrollContainerRef=(0,d.createRef)(),o.gridRef=(0,d.createRef)(),o.sentinelRef=(0,d.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.narratives,i=t.onClose,a=t.boxData,s=this.state,l=s.isLoad,u=s.draggingNarrativeRawId,v=o.length<a.count,h=this.canEdit();return(0,n.jsx)(c.BoxModal,(0,r.__assign)({className:"NarrativeBox",title:this.getTitle(),actionButtons:this.getBoxActionButtons(),onClose:i,hasScroll:!1},{children:(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__scrollContainer",ref:this.scrollContainerRef},{children:(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__scrollInner"},{children:[(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__list",ref:this.gridRef},{children:[h&&(0,n.jsxs)(d.Fragment,{children:[(0,n.jsx)(m,{onClick:this.onCreateNarrativeClick},"create"),o.map((function(t){return(0,n.jsx)(T,{className:I.BOX_ITEM_DRAGGABLE_CLASS,narrative:t,onClick:function(o){return e.onNarrativeClick(o,t)},aside:(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeBox__aside"},{children:[t.rawId===u&&(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,n.jsx)(B.default,{},void 0)}),void 0),t.rawId!==u&&(0,n.jsx)(x.default,(0,r.__assign)({position:"b",align:"center",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,n.jsx)(B.default,{},void 0)}),void 0)}),void 0),(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--burger"},{children:(0,n.jsx)(D.default,{},void 0)}),void 0)]}),void 0)},t.rawId)}))]},void 0),!h&&(0,n.jsx)(d.Fragment,{children:o.map((function(t){return(0,n.jsx)(T,{narrative:t,onClick:function(o){return e.onNarrativeClick(o,t)},aside:(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__aside"},{children:(0,n.jsx)(x.default,(0,r.__assign)({position:"b",align:"right",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,n.jsx)(B.default,{},void 0)}),void 0)}),void 0)}),void 0)},t.rawId)}))},void 0)]}),void 0),l&&(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeBox__loader"},{children:(0,n.jsx)(y.default,{},void 0)}),"loader"),v&&(0,n.jsx)("div",{className:"NarrativeBox__sentinel",ref:this.sentinelRef},void 0)]}),void 0)}),void 0)}),void 0)},t.prototype.canEdit=function(){var e=this.props,t=e.type,o=e.onSave,r=e.onReorder,n=e.onRemove;return t===i.edit&&Boolean(o)&&Boolean(r)&&Boolean(n)},t.prototype.componentDidMount=function(){this.initSorter(),this.observeNarrativeScrollIfNeeded()},t.prototype.componentWillUnmount=function(){this.deInitSorter(),this.unObserveNarrativeScrollIfNeeded()},t.prototype.editNarrative=function(e){var t=this.props.boxData;(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.clickToEditNarrative,e,this.props.navScreen),t.ownerId>0?this.openNarrativeEditorBox(e):window.open("https://"+location.hostname+location.pathname+"?act=narrative_edit&nid="+e.id)},t.prototype.shareNarrative=function(e){E.Likes.share("narrative"+e.rawId),(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.shareNarrative,e,this.props.navScreen)},t.prototype.bookmarkNarrative=function(e){var t=this.props.onBookmark;(0,b.bookmark)(e.ownerId,e.id,"narrative",e.bookmarkHash,e.isBookmarked),(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.addToBookmarks,e,this.props.navScreen),t(e)},t.prototype.removeNarrative=function(e){var t,o;null===(o=(t=this.props).onRemove)||void 0===o||o.call(t,e)},t.prototype.observeNarrativeScrollIfNeeded=function(){var e=this,t=this.props,o=t.narratives,i=t.boxData;if(o.length<i.count){var r=this.scrollContainerRef.current,n=this.sentinelRef.current;if(!n)return;this.observer=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&e.loadViewers()}))}),{threshold:[0],root:r,rootMargin:"0px 0px 480px 0px"}),this.observer.observe(n)}},t.prototype.unObserveNarrativeScrollIfNeeded=function(){this.observer&&this.observer.disconnect()},t.prototype.loadViewers=function(){var e=this,t=this.props.loadMore;this.state.isLoad||(this.setState({isLoad:!0}),t().finally((function(){e.setState({isLoad:!1})})))},t.prototype.initSorter=function(){var e,t,o=this,i=this.props.boxData;if(this.canEdit()){var r=null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current,n=null===(t=this.gridRef)||void 0===t?void 0:t.current;if(n&&r){var a={dragThreshold:0,wrapNode:r,onDragFinish:function(){o.setState({draggingNarrativeRawId:""})},onDragStart:function(e){var t=o.getNarrativeIdByEl(e);o.setState({draggingNarrativeRawId:i.ownerId+"_"+t})},onReorder:function(e){var t=o.getNarrativeIdByEl(e),i=Array.from(n.querySelectorAll("."+I.BOX_ITEM_DRAGGABLE_CLASS));if(1!==i.length){var r=0,a=0,s=i.findIndex((function(e){return o.getNarrativeIdByEl(e)===t}));i[s-1]&&(r=o.getNarrativeIdByEl(i[s-1])),i[s+1]&&(a=o.getNarrativeIdByEl(i[s+1])),o.saveReorder(t,a,r)}}};this.sorter=new w.default(n,"",a)}}},t.prototype.saveReorder=function(e,t,o){var i=this,r=this.props,n=r.boxData,a=r.onReorder;if(a){var s=n.ownerId;window.ajax.post("al_stories.php",{act:"narratives_reorder",narrative_id:e,before_narrative_id:t,after_narrative_id:o,hash:n.reorderHash,owner_id:s},{onDone:function(){var t,o=i.props.narratives,r=null===(t=i.gridRef)||void 0===t?void 0:t.current;if(r){var n=Array.from(r.querySelectorAll("."+I.BOX_ITEM_DRAGGABLE_CLASS)),l=[];n.forEach((function(e){var t=i.getNarrativeIdByEl(e),r=o.find((function(e){return e.id===t}));r&&l.push(r)})),(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.changeSort,{ownerId:s,id:e},i.props.navScreen),a(l)}},onFail:function(e){return(0,S.showDoneBox)(e||(0,v.getLang)("global_error")),!0}})}},t.prototype.getNarrativeIdByEl=function(e){return(0,C.intval)(e.getAttribute("data-id"))},t.prototype.getTitle=function(){var e=this.props,t=e.title,o=e.boxData,i=e.showNarrativeNumber;return(0,n.jsx)(h,{title:t||(0,v.getLang)("stories_narratives_title"),count:o.count,showNarrativeNumber:i},void 0)},t.prototype.deInitSorter=function(){this.sorter&&this.sorter.destroy()},t.defaultProps={type:i.view,showNarrativeNumber:!0},t}(d.Component),R=o(86067),j=o(86409),O=o(54612),M=o(18690),U=o(83295),H=o(23985);!function(e){e.Add="add",e.Delete="delete"}(f||(f={}));var F=function(e){function t(t){var o=e.call(this,t)||this;return o.loadMore=function(){var e=o.props,t=e.loadMore,i=e.story,n=o.state.selectedNarrativeIds;return t().then((function(e){void 0===e&&(e=[]),o.setState({selectedNarrativeIds:(0,r.__assign)((0,r.__assign)({},n),o.getSelectedNarrativeIdsMap(i.id,e))})}))},o.onCheckboxClick=function(e){var t=o.state.selectedNarrativeIds,i=(0,r.__assign)({},t);i[e.id]?delete i[e.id]:i[e.id]=!0,o.setState({selectedNarrativeIds:i})},o.getBoxActionButtons=function(){var e=o.props,t=e.onClose,i=e.story,a=e.narratives,s=o.state,l=s.isLoad,d=s.selectedNarrativeIds,c=o.getSelectedNarrativeIdsMap(i.id,a),h=o.getDiffOperations(i.id,d,c);return[(0,n.jsx)(u.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return t()}},{children:(0,v.getLang)("global_close")}),"close"),(0,n.jsx)(M.default,(0,r.__assign)({appearance:"primary",disabled:!h.length,onClick:o.save,loading:l},{children:(0,v.getLang)("global_save")}),"save")]},o.save=function(){var e=o.props,t=e.story,i=e.narratives,r=e.boxData,n=e.onClose,a=e.onSave,s=e.navScreen,l=o.state.selectedNarrativeIds,d=o.getSelectedNarrativeIdsMap(t.id,i),c=o.getDiffOperations(t.id,l,d),u=Boolean(Object.keys(l).length),h=r.ownerId;o.setState({isLoad:!0}),window.ajax.post("al_stories.php",{act:"batch_edit",owner_id:h,operations:JSON.stringify(c),hash:r.editHash},{onDone:function(){a(u),n(),(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.addStoryToNarrative,{ownerId:h},s),(0,S.showDoneBox)(o.getDoneText(c))},onFail:function(e){return(0,S.showDoneBox)(e||(0,v.getLang)("global_error")),!0},hideProgress:function(){o.setState({isLoad:!1})}})},o.onCreateNarrativeClick=function(){var e=o.props,t=e.story,i=e.narratives,r=e.onSave,n=e.onClose,a=e.boxData,s=e.navScreen,l=a.ownerId;if(l>0){var d=o.getSelectedNarrativeIdsMap(t.id,i),c=Boolean(Object.keys(d).length);return ee(l,{selectedStories:[t],onSave:function(){c=!0},onClose:function(){r(c),n()},navScreen:s}),void(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.createNarrative,{ownerId:l},s)}var u=a.ownerDomain?a.ownerDomain:"club"+-a.ownerId;window.nav.go(u+"?act=narrative_create&story_id="+t.id)},o.onNarrativeClick=function(e,t){e.ctrlKey||e.metaKey||((0,_.showNarrative)(t.ownerId,t.id,0,"narrative"+t.ownerId+"_"+t.id),e.preventDefault(),e.stopPropagation())},o.state={isLoad:!1,selectedNarrativeIds:o.getSelectedNarrativeIdsMap(t.story.id,t.narratives)},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,o=t.onClose,i=t.narratives,a=t.boxData,s=this.state.selectedNarrativeIds,l=i.length<a.count;return(0,n.jsx)(c.BoxModal,(0,r.__assign)({className:"NarrativeChooseBox",title:(0,v.getLang)("stories_narrative_choosing"),actionButtons:this.getBoxActionButtons(),onClose:o,hasScroll:!1,appearance:"blue"},{children:(0,n.jsxs)(H.default,(0,r.__assign)({className:"NarrativeChooseBox__list",itemHeight:80,loadMore:this.loadMore,hasMore:l},{children:[(0,n.jsx)(m,{onClick:this.onCreateNarrativeClick,clickable:!0,size:50},"create"),i.map((function(t){return(0,n.jsx)(T,{narrative:t,onClick:function(){return e.onCheckboxClick(t)},size:50,noBorder:!0,clickable:!0,aside:(0,n.jsx)("div",{className:(0,U.classNames)("NarrativeChooseBox__checkbox",{"NarrativeChooseBox__checkbox--checked":s[t.id]})},void 0)},t.rawId)}))]}),void 0)}),void 0)},t.prototype.getDoneText=function(e){var t=e.filter((function(e){return e.op===f.Add})).length;if(t>1)return(0,v.getLang)("stories_saved_in_narratives_text");if(1===t)return(0,v.getLang)("stories_saved_in_narrative_text");var o=e.filter((function(e){return e.op===f.Delete})).length;return o>1?(0,v.getLang)("stories_deleted_in_narratives_text"):1===o?(0,v.getLang)("stories_deleted_in_narrative_text"):(0,v.getLang)("stories_settings_saved")},t.prototype.getDiffOperations=function(e,t,o){var i=[];return Object.keys(t).forEach((function(t){o[t]||i.push({op:f.Add,story_id:e,narrative_id:Number(t)})})),Object.keys(o).forEach((function(o){t[o]||i.push({op:f.Delete,story_id:e,narrative_id:Number(o)})})),i},t.prototype.getSelectedNarrativeIdsMap=function(e,t){return t.reduce((function(t,o){return o.stories.find((function(t){return t.id===e}))&&(t[o.id]=!0),t}),{})},t}(d.Component),G=o(95724),V=function(e){var t=e.className,o=e.coverUrl,i=e.title,a=e.ownerName,l=e.storyCount;return(0,n.jsx)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeSnippet",t)},{children:(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeSnippet__inner"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeSnippet__cover"},{children:(0,n.jsx)("div",{className:"NarrativeSnippet__image",style:{backgroundImage:"url("+o+")"}},void 0)}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeSnippet__info"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:(0,s.classNames)("NarrativeSnippet__title",{"NarrativeSnippet__title--empty":!i})},{children:i||(0,v.getLang)("stories_narrative_name_full")}),void 0),(0,n.jsx)("span",(0,r.__assign)({className:"NarrativeSnippet__author"},{children:a}),void 0),(0,n.jsxs)("span",(0,r.__assign)({className:"NarrativeSnippet__description"},{children:[(0,n.jsx)("span",{children:(0,v.getLang)("global_type_narrative")},void 0),(0,n.jsx)("span",{className:"dvd"},void 0),(0,n.jsx)("span",{children:(0,v.getLang)("global_narrative_stories_count",l)},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)},W=function(e){function t(t){var o=e.call(this,t)||this;return o.onNameChange=function(e){var t=e.target.value,i=(0,G.trim)(t)?t:"";o.setState({name:i})},o.getBoxActionButtons=function(){var e=o.state.isLoad;return[(0,n.jsx)(M.default,(0,r.__assign)({appearance:"primary",onClick:o.save,loading:e},{children:(0,v.getLang)("groups_edit_narrative_publish")}),"publish")]},o.save=function(){var e=o.state.isLoad,t=o.state.name,i=void 0===t?"":t;e||((i=(0,G.trim)(i))?(o.setState({isLoad:!0}),o.props.onSave(i).catch((function(){o.setState({isLoad:!1})}))):(0,j.notaBene)(o.nameInputRef.current))},o.state={isLoad:!1,name:"",coverStory:t.stories[0]},o.nameInputRef=(0,d.createRef)(),o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.ownerName,i=e.stories,a=this.state,s=a.name,l=a.coverStory,d=null==l?void 0:l.preview;return(0,n.jsx)(c.BoxModal,(0,r.__assign)({className:"NarrativeCreateLiteBox",title:(0,v.getLang)("stories_creating_narrative"),actionButtons:this.getBoxActionButtons(),onClose:t,hasScroll:!1,appearance:"blue"},{children:(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__inner"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,v.getLang)("groups_edit_narrative_title")}),void 0),(0,n.jsx)("input",{type:"text",className:"NarrativeCreateLiteBox__nameInput",value:s,onChange:this.onNameChange,placeholder:(0,v.getLang)("stories_enter_name"),maxLength:I.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,v.getLang)("groups_edit_narrative_preview")}),void 0),(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__text"},{children:(0,v.getLang)("groups_edit_narrative_pin_text")}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previews"},{children:[(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewWrapper"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,v.getLang)("stories_narrative_preview_block_title")}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__smallPreview"},{children:[(0,n.jsx)(k.NarrativeItemPreviewCover,{cover:d},void 0),(0,n.jsx)("span",(0,r.__assign)({className:"NarrativeCreateLiteBox__smallPreviewName"},{children:s||(0,v.getLang)("stories_narrative_name_full")}),void 0)]}),void 0)]}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewWrapper NarrativeCreateLiteBox__previewWrapper--snippet"},{children:[(0,n.jsx)("div",(0,r.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,v.getLang)("stories_narrative_preview_feed_title")}),void 0),(0,n.jsx)(V,{className:"NarrativeCreateLiteBox__snippet",ownerName:o,coverUrl:d,title:s,storyCount:i.length},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)},t}(d.Component),z=o(56589),K=o(14217),Y=function(e){var t=e.text,o=e.children,i=e.open,a=void 0!==i&&i,s=(0,n.jsx)("div",(0,r.__assign)({className:"StoryLinkHint"},{children:(0,n.jsx)("div",(0,r.__assign)({className:"StoryLinkHint__inner"},{children:t}),void 0)}),void 0);return(0,n.jsx)(K.Popper,(0,r.__assign)({open:a,position:"t",align:"left",content:s},{children:o}),void 0)},X=o(91525),q=function(e){function t(t){var o=e.call(this,t)||this;return o.inputRef=(0,d.createRef)(),o.onChangeLink=function(e){var t=(0,G.trim)(e.target.value);o.setState({link:t,needShowHint:!o.isLinkValid(t)})},o.onKeyUpLink=function(){var e=o.state.link;o.setState({needShowHint:!o.isLinkValid(e)})},o.onChangeLinkType=function(e){o.setState({linkType:String(e.selected.value)})},o.onSave=function(){var e,t,i,r=o.props.linkData,n=o.state.linkType,a=o.state.link;if(a=(0,G.trim)(a),!o.isLinkValid(a))return null===(t=null===(e=o.inputRef)||void 0===e?void 0:e.current)||void 0===t||t.focus(),(0,j.notaBene)(null===(i=o.inputRef)||void 0===i?void 0:i.current),void o.setState({needShowHint:!0});r.needShowHint?(0,O.showFastBox)((0,v.getLang)("stories_saving_link"),(0,v.getLang)("stories_link_editing_warning"),(0,v.getLang)("global_save"),(function(e){o.edit(a,n,!0,e)}),(0,v.getLang)("global_cancel")):o.edit(a,n)},o.onDelete=function(){o.props.linkData.needShowHint?(0,O.showFastBox)((0,v.getLang)("stories_deleting_link"),(0,v.getLang)("stories_link_deleting_warning"),(0,v.getLang)("global_delete"),(function(e){o.delete(e)}),(0,v.getLang)("global_cancel")):o.delete()},o.state={link:t.story.linkUrl||"",linkType:t.story.linkType||t.linkData.items[0].value,needShowHint:!1,isSaving:!1,isDeleting:!1},o}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.linkData,i=this.state,a=i.linkType,s=i.link,l=i.needShowHint,d=this.isEditMode()?(0,v.getLang)("stories_edit_link_title"):(0,v.getLang)("stories_add_link_title");return(0,n.jsx)(c.BoxModal,(0,r.__assign)({className:"StoryLinkEditorBox",appearance:"blue",onClose:t,title:d,actionButtons:this.getActionButtons(),hasScroll:!1},{children:(0,n.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__inner"},{children:[(0,n.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,n.jsx)("span",(0,r.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,v.getLang)("stories_link_label_url")}),void 0),(0,n.jsx)("div",(0,r.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,n.jsx)(Y,(0,r.__assign)({open:l,text:(0,v.getLang)("stories_upload_link_format")},{children:(0,n.jsx)("div",(0,r.__assign)({className:"StoryLinkHint__input"},{children:(0,n.jsx)("input",{className:"StoryLinkEditorBox__link",value:s,onChange:this.onChangeLink,onKeyUp:this.onKeyUpLink,autoFocus:!0,ref:this.inputRef},void 0)}),void 0)}),void 0)}),void 0)]}),void 0),(0,n.jsxs)("div",(0,r.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,n.jsx)("span",(0,r.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,v.getLang)("stories_link_label_text")}),void 0),(0,n.jsx)("div",(0,r.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,n.jsx)(z.default,{className:"StoryLinkEditorBox__select",appearance:"secondary",options:o.items,value:a,onChange:this.onChangeLinkType},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.isEditMode=function(){return Boolean(this.props.story.linkUrl)},t.prototype.isLinkValid=function(e){if(e.length<2)return!1;if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;if(!e.match(/^[a-z0-9\/\-._:%=?&@#]+$/i))return!1;try{new URL(e)}catch(e){return!1}return!0},t.prototype.edit=function(e,t,o,i){var r=this;void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=!0);var n=this.props,a=n.onStoryLinkUpdate,s=n.onClose,l=n.story,d=n.linkData;window.ajax.post("al_stories.php",{act:"edit_link",story_raw_id:l.rawId,link_url:e,link_text:t,hash:d.editHash},{onDone:function(){s(),a(l.rawId,e,t)},onFail:function(e){(0,S.showDoneBox)(e||(0,v.getLang)("global_unknown_error"));var t="Link saving error in StoryLinkEditor"+(e?": "+e:"");return(0,X.logError)(new Error(t)),!0},showProgress:function(){o?r.setState({isSaving:!0}):r.setState({isDeleting:!0}),(0,j.lockButton)(i)},hideProgress:function(){var e;i&&(null===(e=(0,S.curBox)())||void 0===e||e.hide(),(0,j.unlockButton)(i)),o?r.setState({isSaving:!1}):r.setState({isDeleting:!1})}})},t.prototype.delete=function(e){this.edit("","",!1,e)},t.prototype.getActionButtons=function(){var e=this.props.onClose,t=this.state,o=t.isSaving,i=t.isDeleting,a=[(0,n.jsx)(u.default,(0,r.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,v.getLang)("global_cancel")}),"close"),(0,n.jsx)(M.default,(0,r.__assign)({loading:o,appearance:"primary",onClick:this.onSave},{children:this.isEditMode()?(0,v.getLang)("global_save"):(0,v.getLang)("stories_add_link")}),"save")];return this.isEditMode()&&a.unshift((0,n.jsx)(M.default,(0,r.__assign)({loading:i,appearance:"link",className:"StoryLinkEditorBox__extraFooterBtn",onClick:this.onDelete},{children:(0,v.getLang)("stories_delete_link")}),"delete")),a},t}(d.Component),Q=o(57405),Z=o(3425),$=o(3562),J=560;function ee(e,t){void 0===t&&(t={});var o={},i=t.narrative,d=t.onClose,c=t.onSave,u=t.navScreen,v=t.stories,h=t.selectedStories,_=void 0===h?[]:h,p=t.publishHash,g=t.editHash,f=t.linkData,m=t.isEditingLinksAvailable,w=t.storiesCount,y=t.coverUploadConfig,C=t.getPublishDoneHTML,N=!1;function x(){window.stManager.add(["NarrativeEditor.css"]).then((function(){o.box=(0,l.showComponentInBox)(I(),{width:638,onDestroy:function(e){(0,l.destroyComponentInBox)(e),d&&d(N)}})})).catch((function(e){console.error(e),(0,X.logError)(e)}))}function b(){return(null==v?void 0:v.length)?new Promise((function(t,o){if(!(null==v?void 0:v.length))return o("empty stories");window.ajax.post("al_stories.php",{act:"get_archive_stories",owner_id:e,offset:v.length},{onDone:function(e,i){if(v){v=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(v),!1),(0,r.__read)(e),!1);var n=(w=i)>v.length;t(n),L()}else o("empty stories after loading")},onFail:function(e){return o(e),!0}})})):Promise.reject("empty stories")}function E(e){N=!0,c&&c(e)}function k(e){o.box&&o.box.hide(),e&&e()}function L(){(null==v?void 0:v.length)&&p&&g&&(0,l.updateCurrentComponentInBox)(I())}function T(e,t,o){if(null==v?void 0:v.length){var i=function(i){return null==i?void 0:i.map((function(i){return i.rawId===e?(0,r.__assign)((0,r.__assign)({},i),{linkUrl:t,linkType:o}):i}))};v=i(v),_=i(_)||[],L()}}function I(){if((null==v?void 0:v.length)&&p&&g&&w&&y){var t=v.reduce((function(e,t){return e[t.id]=t,e}),{});t=_.reduce((function(e,t){return e[t.id]=t,e}),t);var o=v.map((function(e){return e.id})),r=_.map((function(e){return e.id})),l=i?a.EditorModeType.edit:a.EditorModeType.create,d=(null==i?void 0:i.title)?(0,s.decodeHTMLEntities)(i.title):"",c=w>v.length,h=i?(0,$.getPreparedCover)(i):void 0;return(0,n.jsx)(Q.NarrativeEditor,{ownerId:e,type:l,name:d,narrativeRawId:null==i?void 0:i.rawId,cover:h,selectedStoryIds:r,storyIds:o,hasMore:c,storyMap:t,close:k,loadMore:b,onSave:E,publishHash:p,editHash:g,linkData:f,isEditingLinksAvailable:m,onStoryLinkUpdate:T,appearance:a.EditorViewType.box,navScreen:u,coverUploadConfig:y,getPublishDoneHTML:C},void 0)}}v&&p&&g&&w&&y?x():new Promise((function(t,o){window.ajax.post("al_stories.php",{act:"get_narrative_editor_data",owner_id:e},{loader:!0,onDone:function(e){v=e.stories,w=e.storiesCount,p=e.publishHash,g=e.editHash,f=e.linkData,m=e.isEditingLinksAvailable,y=e.coverUploadConfig,t([v,w,p,g,f,m,y])},onFail:function(e){return o(e),!0}})})).then((function(){x()})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error")),(0,X.logError)(e)}))}function te(e){var t=e.ownerId,o=e.onClose,a=e.onSave,s=e.onRemove,d=e.onReorder,c=e.navScreen,u={narratives:[],ownerId:t,boxAct:"get_narrative_box_data"},v=!1;function h(){return ce(u).then((function(){_()})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error"))}))}function _(){if(u.boxData){var e=u.boxData.canEdit?i.edit:i.view;(0,l.updateCurrentComponentInBox)((0,n.jsx)(A,{type:e,boxData:u.boxData,narratives:u.narratives,onClose:m,onSave:p,onRemove:g,onBookmark:y,onReorder:w,loadMore:h,navScreen:c},void 0))}}function p(e){a&&a(e),v=!0}function g(e){var t,o,i;t=e,o={title:(0,R.getLang)("global_warning")},i=function(e){var o=u.boxData;o&&window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:t.rawId,hash:o.removeHash},{onDone:function(){o.count-=1,(0,P.sendNarrativeAnalytic)(P.NarrativeAnalyticEventType.deleteNarrative,t,c),u.narratives=u.narratives.filter((function(e){return e.rawId!==t.rawId})),_(),(0,S.showDoneBox)((0,R.getLang)("stories_deleted_narrative")),s&&s()},onFail:function(e){return(0,S.showDoneBox)(e||(0,R.getLang)("global_error")),!0},showProgress:function(){return(0,j.lockButton)(e)},hideProgress:function(){(0,S.curBox)().hide(),(0,j.unlockButton)(e)}})},(0,O.showFastBox)(o,(0,R.getLang)("stories_narrative_remove_warning"),(0,R.getLang)("stories_remove_confirm"),i,(0,R.getLang)("global_cancel"))}function f(){v&&m()}function m(){u.box&&u.box.hide()}function w(e){u.narratives=e,_(),d&&d()}function y(e){e.isBookmarked=!e.isBookmarked,_()}de(u).then((function(e){var t=(0,r.__read)(e,3),a=t[0],s=t[1],d=t[2];u.narratives=a,u.boxData=s,u.startFrom=d,u.box=function(e,t){var r=t.canEdit?i.edit:i.view;return(0,l.showComponentInBox)((0,n.jsx)(A,{type:r,boxData:t,narratives:e,loadMore:h,onClose:m,onSave:p,onReorder:w,onBookmark:y,onRemove:g,navScreen:c},void 0),{width:J,onShow:f,onDestroy:function(e){(0,l.destroyComponentInBox)(e),o&&o()}})}(a,s)})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error")),o&&o()}))}function oe(e){var t;void 0===e&&(e={});var o=re(e);function i(){return ce(o).then((function(){s()})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error"))}))}function a(){return(0,l.showComponentInBox)(d(),{width:J,onDestroy:function(e){(0,l.destroyComponentInBox)(e)}})}function s(){o.boxData&&(0,l.updateCurrentComponentInBox)(d())}function d(){if(o.boxData)return(0,n.jsx)(A,{title:(0,R.getLang)("news_fb_block_recommend_narratives"),showNarrativeNumber:!1,boxData:o.boxData,narratives:o.narratives,loadMore:i,onClose:c,onBookmark:u,trackCode:o.trackCode,list:o.list,source:o.source},void 0)}function c(){o.box&&o.box.hide()}function u(e){e.isBookmarked=!e.isBookmarked,s()}(null===(t=o.narratives)||void 0===t?void 0:t.length)&&o.boxData?o.box=a():de(o).then((function(e){var t=(0,r.__read)(e,2),i=t[0],n=t[1];o.narratives=i,o.boxData=n,o.box=a()})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error"))}))}function ie(e){return void 0===e&&(e={}),de(re(e),!0)}function re(e){return void 0===e&&(e={}),{narratives:e.narratives?e.narratives:[],boxData:e.boxData,boxAct:"get_recommended_narratives",trackCode:e.trackCode,list:e.list,source:e.source}}function ne(e){var t=e.ownerId,o=e.story,i=e.onClose,a=e.onSave,s=e.navScreen,d={narratives:[],ownerId:t,boxAct:"get_narrative_choose_box_data"},c=!1;function u(){return ce(d).then((function(e){return function(){if(!d.boxData)return;(0,l.updateCurrentComponentInBox)((0,n.jsx)(F,{story:o,narratives:d.narratives,onClose:_,onSave:v,boxData:d.boxData,loadMore:u,navScreen:s},void 0))}(),e})).catch((function(e){return(0,S.showDoneBox)(e||(0,R.getLang)("global_error")),[]}))}function v(e){c=!0,a&&a(e)}function h(){c&&_()}function _(){d.box&&d.box.hide()}de(d).then((function(e){var t=(0,r.__read)(e,3),a=t[0],p=t[1],g=t[2];d.narratives=a,d.boxData=p,d.startFrom=g,d.box=function(e,t){return(0,l.showComponentInBox)((0,n.jsx)(F,{story:o,narratives:e,boxData:t,loadMore:u,onClose:_,onSave:v,navScreen:s},void 0),{width:J,onShow:h,onDestroy:function(e){(0,l.destroyComponentInBox)(e),i&&i(c)}})}(a,p)})).catch((function(e){(0,S.showDoneBox)(e||(0,R.getLang)("global_error")),i&&i()}))}function ae(e){var t=e.onSave,o=e.onClose,i=e.ownerId,r=e.ownerName,a=e.stories,s=e.publishNarrativeHash,d=(0,l.showComponentInBox)((0,n.jsx)(W,{stories:a,ownerId:i,ownerName:r,publishNarrativeHash:s,onSave:t,onClose:function(){d&&d.hide()}},void 0),{width:J,onDestroy:function(e){(0,l.destroyComponentInBox)(e),o&&o()}})}function se(e){var t=e.story,o=e.onClose,i=e.onStoryLinkUpdate,a=e.linkData;t.linkType&&t.linkText&&(a.items.find((function(e){return e.value===t.linkType}))||(a=(0,r.__assign)((0,r.__assign)({},a),{items:(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(a.items),!1),[{value:t.linkType,label:t.linkText}],!1)})));var s=(0,l.showComponentInBox)((0,n.jsx)(q,{story:t,onClose:function(){s&&s.hide()},onStoryLinkUpdate:i,linkData:a},void 0),{width:450,onDestroy:function(e){(0,l.destroyComponentInBox)(e),o&&o()}})}function le(e){var t=e.coverUrl,o=e.coverHeight,i=e.coverWidth,r=e.thumbHeight,a=e.thumbWidth,s=e.onClose,d=e.onSave,c=e.crop,u=(0,l.showComponentInBox)((0,n.jsx)(Z.NarrativeCoverCropper,{coverUrl:t,coverHeight:o,coverWidth:i,thumbHeight:r,thumbWidth:a,onClose:function(){u&&u.hide()},onSave:d,crop:c},void 0),{width:638,onDestroy:function(e){(0,l.destroyComponentInBox)(e),s&&s()}})}function de(e,t){return void 0===t&&(t=!1),new Promise((function(o,i){window.ajax.post("al_stories.php",{act:e.boxAct,owner_id:e.ownerId,start_from:e.startFrom,track_code:e.trackCode},{loader:!e.narratives.length&&!t,onDone:function(e,t,i){o([e,t,i])},onFail:function(e){return i(e),!0}})}))}function ce(e){return de(e).then((function(t){var o,i=(0,r.__read)(t,3),n=i[0],a=i[2];return e.narratives=(null===(o=e.narratives)||void 0===o?void 0:o.concat(n))||n,e.startFrom=a,n}))}},25696:(e,t,o)=>{"use strict";o.d(t,{addLayer:()=>h,removeLayer:()=>_,layerShown:()=>p,layerHide:()=>g,hideAllLayers:()=>f,getFirstLayer:()=>m,getPrevLayer:()=>w,slicePrevLayers:()=>y,onReplyDeleted:()=>S,checkAndPrepareBoxQueue:()=>N,isOpeningLocked:()=>x});var i=o(75632),r=o(49535),n=o(15544),a=o(86125),s=[],l=!1,d=function(){window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},c=function(){window.cur.storyLayer&&window.cur.storyLayer.onResize()},u=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},v=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)};function h(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),(0,n.ge)("stories_layers_background")||(document.body.appendChild((0,n.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=f,(0,r.addEvent)(window,"visibilitychange",d,void 0,void 0,!0),(0,r.addEvent)(window,"resize",c),(0,r.addEvent)(document,"keydown",u),(0,r.addEvent)(document,"keyup",v)),window.cur.storyLayer=e,l=!0,e.animateStory("expand",t.fromEl).catch((function(){})).finally((function(){l=!1})),s.push(e),(0,n.addClass)(document.body,"stories_layer_shown"),(0,i.cancelStackPush)("stories_layer_close"+s.length,(function(t){void 0===t&&(t={}),t.byTimer?e.sendNavigationStatEvents("close_auto_by_time"):e.sendNavigationStatEvents("close_tap"),s.length>1&&!t.isCloseBtnClick?e.back():(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1))}))}function _(){var e;s.pop(),window.cur.storyLayer=s[s.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(f(!0),window.layerQueue.pop(),window.cur.storiesCashedBoxQueueData&&((0,a.restoreBoxQueue)(window.cur.storiesCashedBoxQueueData),(e=C())&&(e.forceHide=!1,e._show(!0,!1,!0)),delete window.cur.storiesCashedBoxQueueData))}function p(){s.length>1&&(s[s.length-2].setLayerVisibility(!1),s[s.length-1].showBackButton())}function g(){s.length>1?s[s.length-2].setLayerVisibility(!0):(0,n.setStyle)("stories_layers_background","opacity",0)}function f(e){void 0===e&&(e=!1);for(var t=0;t<s.length;t++)s[t].hide(!0);if(window.layers.fullhide=!1,(0,n.removeClass)(document.body,"stories_layer_shown"),(0,n.re)("stories_layers_background"),(0,r.removeEvent)(window,"visibilitychange",d),(0,r.removeEvent)(window,"resize",c),(0,r.removeEvent)(document,"keydown",u),(0,r.removeEvent)(document,"keyup",v),e){var o=window.nav.objLoc;delete o.w,window.nav.setLoc(o)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),s=[]}function m(){return s[0]}function w(){return s[s.length-2]}function y(){for(var e=s.length-2;e>=0;e--)s[e].doHide(!0);s.splice(0,s.length-1)}function S(e){for(var t=0;t<s.length;t++)s[t].onReplyDeleted(e)}function C(){var e;if(!(null===(e=window._message_boxes)||void 0===e?void 0:e.length))return null;var t=window._message_boxes.filter(Boolean);return t.length?t[t.length-1]:null}function N(e){(0,a.curBox)()&&(e.fromEl=null,function(){var e=C();e&&(e._hide(!1,!0,!0),e.forceHide=!0)}(),window.cur.storiesCashedBoxQueueData=(0,a.getAndCleanBoxQueueData)())}function x(){return l}window.LayersX=s},33228:(e,t,o)=>{"use strict";o.d(t,{getVolume:()=>s,setVolume:()=>l,getStoryList:()=>d,removeStoryList:()=>c,preloadDiscoverList:()=>u,fetchDiscover:()=>v,isDiscoverLoading:()=>h,getStoryBlockKey:()=>_,createUserStackMaskIfNeeded:()=>p,isNewDesignEnabled:()=>g});var i=o(70655),r=o(41319),n=o(15544),a=o(19331);function s(){var e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function l(e){window.ls.set("video_volume",e)}function d(e){return window.cur["stories_list_"+e]}function c(e){delete window.cur["stories_list_"+e]}function u(e){if(void 0===e&&(e=!1),window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;var t,o,n=d(r.StoryListName.feed);return n&&(o=n.find((function(e){return e.type===r.StoryBlockType.discover})))&&(t=o.track_code),window.cur.storiesDiscoverFetchingPromise=v("",t,e).then((function(e){var t=(0,i.__read)(e,2),r=t[0],n=t[1];return o&&(o.grouped=r,o.next_from=n),r})).finally((function(){delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise}function v(e,t,o,i){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=!1),void 0===i&&(i=15),new Promise((function(r,n){window.ajax.post("al_stories.php",{act:"get_discover",start_from:e,count:i,track_code:t},{loader:o,onDone:function(e,t){r([e,t])},onFail:function(e){return n(e),!0}})}))}function h(){return Boolean(window.cur.storiesDiscoverFetchingPromise)}function _(e){var t,o,i;return(null===(t=null==e?void 0:e.author)||void 0===t?void 0:t.id)&&(null===(o=null==e?void 0:e.narrative)||void 0===o?void 0:o.id)?e.author.id+"narrative"+(null===(i=e.narrative)||void 0===i?void 0:i.id):""+e.id}function p(){var e,t="users_stack_stories_mask",o=document.getElementById(t);o||(o=(0,n.se)('\n        <svg width="0" height="0">\n          <defs>\n            <clipPath id="'+t+'">\n              <path transform="translate(1.5 0)" d="M1.20772 8C1.20772 6.32671 0.768742 4.75626 0 3.39821C1.44342 1.34278 3.8277 0 6.52463 0C10.9293 0 14.5 3.58172 14.5 8C14.5 12.4183 10.9293 16 6.52463 16C3.8277 16 1.44342 14.6572 0 12.6018C0.768742 11.2437 1.20772 9.6733 1.20772 8Z"></path>\n            </clipPath>\n          </defs>  \n        </svg>  \n      '))&&(document.body.appendChild(o),null===(e=window.cur.destroy)||void 0===e||e.push((function(){null==o||o.remove()})))}function g(){return(0,a.partConfigEnabled)("story_reactions_sending_feature_web")}},53580:(e,t,o)=>{"use strict";o.d(t,{WallDataEvents:()=>a,registerUniqueListener:()=>d,registerNonGlobalNonUniqueListener:()=>c,emitEvent:()=>u});var i=o(70655),r=o(61508),n=o(69687),a={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update"},s=(0,n.makeSharedState)("wall-data",(function(){return{emitter:new r.default,keyedListeners:Object.create(null)}})),l=function(e,t,o){var r,n,a=s(),l=null===(n=null===(r=a.keyedListeners)||void 0===r?void 0:r[e])||void 0===n?void 0:n[t];return l&&a.emitter.removeListener(e,l),function(e,t,o){var r,n=s();return n.emitter.addListener(e,o),n.keyedListeners[e]=(0,i.__assign)((0,i.__assign)({},n.keyedListeners[e]),((r={})[t]=o,r)),function(){var i,r;n.emitter.removeListener(e,o),(null===(i=n.keyedListeners[e])||void 0===i?void 0:i[t])===o&&(null===(r=n.keyedListeners[e])||void 0===r||delete r[t])}}(e,t,o)},d=function(e,t,o){return l(t,e,o)},c=function(e,t){return function(e,t){var o=s();return o.emitter.addListener(e,t),function(){o.emitter.removeListener(e,t)}}(e,t)},u=function(e,t){s().emitter.emit(e,t)}},10277:(e,t,o)=>{"use strict";o.d(t,{updateAriaLabelCounter:()=>n});var i=o(86067),r=o(25698),n=function(e,t,o){if("number"==typeof t&&e instanceof HTMLElement&&e.classList.contains("PostBottomAction")){var n=function(e){var t=void 0;switch(e){case r.LikeButtonTypes.comment:t=(0,i.getLang)("likes_comments_N_aria_short","raw");break;case r.LikeButtonTypes.like:t=(0,i.getLang)("likes_likes_N_aria_short","raw");break;case r.LikeButtonTypes.share:t=(0,i.getLang)("likes_shares_N_aria_short","raw")}return t}(o);if(n){var a=(0,i.langNumeric)(t,n,!1);e.setAttribute("aria-label",a)}}}}}]);try{stManager.done("dist/6e0870dc3f1703f4fe933bffd7fbbaf8.d0374ddbbd59dc65c043.js")}catch(e){}