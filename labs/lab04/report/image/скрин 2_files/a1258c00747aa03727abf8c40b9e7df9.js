(self.webpackChunkvk=self.webpackChunkvk||[]).push([[43639],{2215:(e,t,i)=>{"use strict";i.d(t,{StickersAnimation:()=>n});i(40851),i(66108),i(96253);var r=i(61540),o=(0,i(19331).partConfigEnabled)("rlottie")&&!(0,r.isMvk)(),n=function(){var e,t,i,r,s=!1,a=!1,c={},l={},_={},d={},u={};function m(e,t){var i=o&&!t,r=v(e),n=1;if(r){hide(geByClass1("sticker_img",e)),addClass(e,"animation_play"),r.play();var s=attr(e,"data-loop-count");if(s=parseInt(s),isNaN(s)&&(s=3),-1!==s){var a,c,l=i?null==r||null==(a=r.listeners)?void 0:a.loopComplete:null==r||null==(c=r._cbs)?void 0:c.loopComplete;(!l||0===(null==l?void 0:l.length))&&r.addEventListener("loopComplete",(function t(){n++;var o=!0;s>=n&&(o=!1),o&&(h(e,!1),r.removeEventListener("loopComplete",t),r[i?"pause":"stop"]())}))}}}function f(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function h(e,t){u[f(e)]=t}function v(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var i=_[t];return i||!1}function p(e,t,n){var s=o&&!t,a=v(e);if(a)"function"==typeof n&&n(a);else{var d=attr(e,"data-uniq-id"),m=attr(e,"data-uid");if(!u[f(e)])if(!s||!hasClass(e,"animation_play")){h(e,!0);var p=attr(e,"data-animation-path"),g=attr(e,"data-sticker-id"),w=!1,S=s?l[g]:c[g];if(g&&(w=(S||p)&&k(e)),w){var E=attr(e,"data-animation-class")||"",b=s?{container:e,loop:!0,autoplay:!0,name:m,group:"sticker",className:`svg_sticker_animation ${E}`}:{container:e,renderer:"svg",loop:!0,autoplay:!1,name:d,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:`svg_sticker_animation ${E}`}};S?b.animationData=S:b[s?"animationUrl":"path"]=p;var y=geByClass1("svg_sticker_animation",e);if(y&&re(y),a=(s?r:i).loadAnimation(b),!c[g]||s)return a instanceof Promise||(a=Promise.resolve(a)),void a.then((e=>{var t=s?"firstFrame":"data_ready";e.addEventListener(t,(()=>{var t=e.animationData;s?l[g]=t:c[g]=t,_[d]=e,"function"==typeof n&&n(e)}))}))}"function"==typeof n&&(_[d]=a,n(a))}}}function g(e){return t(o&&!e).then((e=>{if(Array.isArray(e)){var t=e[0],o=e[1];r=t,i=o}else i=e;return i}))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),i=geByClass1("sticker_animation",t);n.loadAndPlaySticker(i)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);n.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var i="_msg"+e;t&&(i="msg_id_"+e);var r=geByClass1("sticker_animation",geByClass1(i));n.loadAndPlayStickerWithTimer(r,500)},loadAutoplayAnimationStickers:function(e){if(i){if(e){if(a)return;a=!0}if(!s){s=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){p(t,!1,(function(){m(t,!1)}))})),s=!1}}else g().then((()=>{n.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e,t){e&&(i?requestAnimationFrame((()=>{p(e,t,(function(){m(e,t)}))})):g(t).then((()=>{n.loadAndPlaySticker(e,t)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!d[e]){t||(t=1e3);var i=ge(e);hasClass(i,"sticker_animation_disabled_timer")||(d[e]=setTimeout((function(){!i&&(i=ge(e),hasClass(i,"sticker_animation_disabled_timer"))||(n.loadAndPlaySticker(i),clearTimeout(d[e]),d[e]=!1)}),t))}},reloadStickers:function(){_={}},touchStartSticker:function(t){t.addEventListener("contextmenu",n.preventContextMenu,!1),e=setTimeout((function(){n.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()},stopAnimation(e,t){var i=o&&!t,r=v(e);if(r&&r[i?"pause":"stop"](),i){var n=attr(e,"data-uniq-id");removeClass(e,"animation_play"),show(geByClass1("sticker_img",e)),delete _[n]}}};function k(e){var t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t<window.innerHeight&&i>=0&&isVisible(e)}}()},80183:(e,t,i)=>{"use strict";i.d(t,{Emoji:()=>Si});i(79665),i(95767),i(66108),i(51876),i(83276),i(20075),i(9865),i(96409),i(75115),i(40851),i(19371),i(30522),i(98837),i(83946),i(21466),i(59357),i(50110),i(98184),i(91181),i(56997),i(96253),i(88416);var r=i(24816),o=i(26271),n=i(87481),s=i(79957),a=i(416),c=i(86125),l=i(35676),_=i(3834),d=i(49535),u=i(25488),m=i(98884),f={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},h=Object.keys(f).reduce(((e,t)=>(e[t]=f[t].map((e=>(0,u.emojiSymbolToByteHex)(e))),e)),{});function v(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}var p=i(19331),g=i(95724),k=i(15544),w=i(62857),S=i(50167);function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},E.apply(this,arguments)}var b=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],y=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],T=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],j=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],C=new RegExp(`(${j.join(")|(")})`);function P(e,t){return"amount"===e?function(e){var t=e.match(C);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var I=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...b,...y,...T,...j].join("|")}))+)\\s*$`),x=new RegExp(`(${b.join("|")})|(${y.join("|")})|(${T.join("|")})|(${j.join("|")})`,"gi"),O={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e,t){void 0===t&&(t=0);var i=e.toLowerCase().replace(/ё/g,"е").match(I);if(i){for(var r={input:e,request:i[1],send:i[2],context:i[3]};i=x.exec(r.context),i;)for(var o={receiver:i[1],subject:i[2],method:i[3],amount:i[4]},n=0,s=Object.entries(o);n<s.length;n++){var a=s[n],c=a[0],l=a[1];l&&(r[c]=P(c,l))}if(r.subject||r.method||r.amount)return r}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i,r,o){if(void 0===r&&(r=0),void 0===o&&(o={}),this.introViewed){var n=[e,t,i,r].join("_");w.MoneyTransfer.showMoneyTransferBox({tab:i,amount:r,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===n},void 0,(()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=o.onSendStart)})),this.lastBoxId=n}else(0,S.showWiki)(E({w:"moneysend_promo",fromId:e,toId:t,action:i},r?{amount:r}:{})),this.introViewed=!0}};const R=O;var M=i(40906),A=Object.entries(r.EMOJI_HINTS).map((e=>{var t=e[0],i=e[1],r=(i[0],i[1]);return[new RegExp(`(\\s|^)(${(0,M.escapeRE)(r)}${r.endsWith(")")||r.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),t]})),B={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};o.browser.mac?B["\\"]="ё":B["`"]="ё";var L=new RegExp(`[${(0,M.escapeRE)(Object.keys(B).join(""))}]`,"gi"),D=e=>e.replace(L,(e=>B[e])),N=Object.entries(B).reduce(((e,t)=>{var i=t[0];return e[t[1]]=i,e})),H=new RegExp(`[${(0,M.escapeRE)(Object.keys(N).join(""))}]`,"gi"),K=e=>e.replace(H,(e=>N[e])),W=-184940019;const V=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=A.reduce(((e,t)=>{var i=t[0],r=t[1];return e.replace(i,((e,t,i,o)=>(t||"")+(0,u.emojiByteHexToSymbol)(r)+(o||"")))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var r=[e=(0,u.emojiRemoveSkinToneModifiers)(e)],o=0,n=[...r];o<n.length;o++){var s=n[o];r.push(D(s)),r.push(K(s))}for(var a=0,c=[...r];a<c.length;a++){var l=c[a];r.push(l.replace(/ё/g,"е")),r.push(l.replace(/е/g,"ё"))}for(var _=0,d=[...r];_<d.length;_++){var m=d[_];r.push(m.replace(/[.!?]+$/,""))}return Object.keys(r.reduce(((e,t)=>(e[t]=1,e)),{}))}isBotLinkEnabled(){return(0,p.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==W}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${W}`:`/im?sel=${W}`}getBotLinkImageUrl(e,t){return void 0===t&&(t="light"),`/images/stickers_suggestions_bot_${t}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return(0,p.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}};var F,U=i(76270),$=i(86409),z=i(54612),G=i(76852),q=i(86067),Y=i(83295),X=i(26338),J=i(6593);!function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(F||(F={}));var Z,Q=Symbol(),ee=Symbol();!function(e){e.IsNew="is_new"}(Z||(Z={}));var te,ie=function(e){return void 0!==e.sticker_ids},re=function(e){return void 0!==e.base_id},oe=function(e){return ie(e)&&!re(e)};!function(e){e.Pack="pack",e.Style="style"}(te||(te={}));var ne,se,ae,ce,le=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(oe(e)?this.pack.add(e):re(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}(),_e=(function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(oe(t)?this.pack.push(e):re(t)&&this.style.push(e))}}(),i(70655)),de={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},ue=(F.LIGHT,F.LIGHT,F.LIGHT,F.LIGHT,F.LIGHT,F.LIGHT,F.DARK,F.DARK,F.DARK,F.DARK,F.DARK,F.DARK,{"64_png":{id:"64.png",width:64,height:64,theme:F.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:F.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:F.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:F.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:F.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:F.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:F.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:F.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:F.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:F.DARK}}),me=((ne={})[F.LIGHT]="animation.json",ne[F.DARK]="animation.b.json",ne),fe={products:(se=[],new Map(se)),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map};!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(ae||(ae={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(ce||(ce={}));var he=function(e,t,i,r){void 0===r&&(r=F.DEFAULT);var o=window.devicePixelRatio,n=[t*=o,i*=o,r].toString(),s=e[ee];if(s&&s.has(n)){var a=s.get(n);if(a)return a}s||(s=new Map,e[ee]=s);var c=function(e){var t=e[Q];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[Q]=t),t}(e).filter((function(e){return!e.theme||e.theme===r})),l=c.find((function(e){return e.width>=t&&e.height>=i}))||c[c.length-1];return s.set(n,l),l};function ve(e,t,i,r){var o,n,s;if(void 0===r&&(r=F.DEFAULT),null===(s=e.render)||void 0===s?void 0:s.images){var a=e.render.images;a.sort((function(e,t){return e.width-t.width||e.height-t.height}));var c=void 0;try{for(var l=(0,_e.__values)(a),_=l.next();!_.done;_=l.next()){var d=_.value;if(d.width>=t&&d.height>=i){if(d.theme===r)return d.url;c=d}}}catch(e){o={error:e}}finally{try{_&&!_.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}if(c)return c.url}return function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,i){return void 0===i&&(i=F.DEFAULT),he(ue,e,t,i)}(t,i,r))}var pe=function(e,t,i,r){return void 0===r&&(r=F.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,i){return void 0===i&&(i=F.DEFAULT),he(de,e,t,i)}(t,i,r))},ge=function(e){return-1===e.recipient_id},ke=i(93680),we=i(26330),Se=function(){if(!window.stickersCache){var e=we.default.get("stickers_cache");window.stickersCache=(0,_e.__assign)((0,_e.__assign)({},fe),e)}return window.stickersCache},Ee=function(e){window.stickersCache=(0,_e.__assign)((0,_e.__assign)({},Se()),e)},be=function(e){return Se().stickers.get(e)},ye=function(e){var t=be(e);if(!t||!t.pack_id)return null;var i=je(t.pack_id);return i&&ie(i)?i:null},Te=function(e,t){var i,r,o,n,s,a;void 0===t&&(t=[]);var c=Se();if(e.stickers){var l=c.stickers;try{for(var _=(0,_e.__values)(e.stickers),d=_.next();!d.done;d=_.next()){var u=d.value;l.has(u.id)?l.set(u.id,(0,_e.__assign)((0,_e.__assign)({},l.get(u.id)),u)):l.set(u.id,u)}}catch(e){i={error:e}}finally{try{d&&!d.done&&(r=_.return)&&r.call(_)}finally{if(i)throw i.error}}}if(e.products)try{for(var m=(0,_e.__values)(e.products),f=m.next();!f.done;f=m.next()){var h=f.value;c.products.set(h.id,h),c.productPromises.delete(h.id)}}catch(e){o={error:e}}finally{try{f&&!f.done&&(n=m.return)&&n.call(m)}finally{if(o)throw o.error}}try{for(var v=(0,_e.__values)(t),p=v.next();!p.done;p=v.next()){var g=p.value;c.products.has(g)||c.products.set(g,null),c.productPromises.delete(g)}}catch(e){s={error:e}}finally{try{p&&!p.done&&(a=v.return)&&a.call(v)}finally{if(s)throw s.error}}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),Ee(c)},je=function(e){return Se().products.get(e)},Ce=function(e){var t=Se().products;return e.map((function(e){return t.get(e)}))};var Pe=function(e){var t,i;if(!e.length)return Promise.resolve([]);var r,o=Se(),n=o.productPromises,s=o.productIdsQueue,a=new Set;try{for(var c=(0,_e.__values)(e),l=c.next();!l.done;l=c.next()){var _=l.value;if(n.has(_)){(d=n.get(_))&&a.add(d)}else{s.add(_);var d=(r=void 0,(r=Se().productsPromise)||(r=new Promise((function(e){return setTimeout((function(){var t=Se().productIdsQueue,i=Array.from(t);t.clear(),Ee({productIdsQueue:t,productsPromise:void 0}),ke.ajax.post("stickers.php",{act:"get_products",product_ids:i},{onDone:function(t){Te(t,i),e([])},onFail:function(t){return console.error(t),Te({},i),e([]),!0}})}),300)})),Ee({productsPromise:r})),r);n.set(_,d),a.add(d)}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(t)throw t.error}}return Ee({productIdsQueue:s,productPromises:n}),Promise.all(a).then((function(){return Ce(e)}))},Ie=function(e,t){void 0===t&&(t=!0);var i=t?e.filter((function(e){return void 0===je(e)})):e;return i.length?Pe(i).then((function(){return Ce(e)})):Promise.resolve(Ce(e))},xe=function(e,t,i,r){return void 0===r&&(r=!0),new Promise((function(o){ke.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:i},{onDone:function(e){r&&Te(e),o()},onFail:function(e){return console.error(e),o(),!0}})}))},Oe=i(85893),Re=i(73935),Me=i(54722),Ae=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,i){return void 0===i&&(i=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),i)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return Ie(t).then((function(){var t,i;try{for(var r=(0,_e.__values)(Array.from(e.items.values())),o=r.next();!o.done;o=r.next()){var n=o.value;n.product=je(n.product_id)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}}))},e.prototype.getProducts=function(){return Ce(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var i={product_id:e,amount:1};t?this.setItems((0,_e.__spreadArray)((0,_e.__spreadArray)([],(0,_e.__read)(this.getItems()),!1),[i],!1)):this.setItems((0,_e.__spreadArray)([i],(0,_e.__read)(this.getItems()),!1)),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[-1]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){var t,i;if(this._order=e,e){this.recipientIds.clear();try{for(var r=(0,_e.__values)(e.items),o=r.next();!o.done;o=r.next()){var n=o.value;-1!==n.recipient_id&&this.recipientIds.add(n.recipient_id)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return Ie(t).then((function(t){return(0,_e.__assign)((0,_e.__assign)({},e),{items:e.items.map((function(e,i){return(0,_e.__assign)((0,_e.__assign)({},e),{product:t[i]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map((0,_e.__spreadArray)((0,_e.__spreadArray)([],(0,_e.__read)(this.getRecipients()),!1),(0,_e.__read)(e),!1).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return(0,_e.__assign)((0,_e.__assign)({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(i){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new Me.AjaxCancellationToken,ke.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){Te(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(r){var o=(0,_e.__read)(r,2)[1];t.setOrder(o),e.recipients&&t.addRecipients(e.recipients),i(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),i(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(i){var r;ke.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),hash:e.hash||(null===(r=t.getOrder())||void 0===r?void 0:r.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){Te(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var r=(0,_e.__read)(e,2),o=r[0],n=r[1];t.setOrder(o),i(n)}),(function(){}))},onFail:function(e){return e&&console.error(e),i(null),!0}})}))},e}(),Be=i(67294),Le=i(41650),De=i(13984),Ne=i(88420),He=i(18690),Ke=i(33024);const We=(0,i(63192).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Ve=i(11417),Fe=Le.default.getLang;function Ue(){return document.querySelector("#box_loader")}function $e(){return document.querySelector("#box_layer_wrap")}function ze(e){var t=new le(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),i=t.getPack(),r=t.getStyles();if(i)return r.length?(0,q.langStr)(Fe("purchases_stickers_purchase_result_pack_and_styles",r.length),"pack_title",i.title,"n",r.length):(0,q.langStr)(Fe("purchases_stickers_purchase_result_pack"),"title",i.title);if(r.length)switch(r.length){case 1:return(0,q.langStr)(Fe("purchases_stickers_purchase_result_1_style"),"title",r[0].title);case 2:return(0,q.langStr)(Fe("purchases_stickers_purchase_result_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,q.langStr)(Fe("purchases_stickers_purchase_result_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,q.langStr)(Fe("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:var o=r.length-3;return(0,q.langStr)(Fe("purchases_stickers_purchase_result_3_styles_and_n_more",o),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",o)}return null}var Ge=function(e){var t=(0,_e.__read)((0,Be.useState)({}),2)[1],i=je(e);return void 0===i?(function(e,t){if(void 0===t&&(t=!0),t){var i=je(e);if(void 0!==i)return Promise.resolve(i)}return Pe([e]).then((function(){return je(e)}))}(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]},qe=function(e){var t=(0,_e.__read)(Ge(e),2),i=t[0],r=t[1];return i&&oe(i)?[i,r]:[void 0===i?void 0:null,r]},Ye=function(e){var t=(0,_e.__read)((0,Be.useState)({}),2)[1],i=Ce(e);return i.some((function(e){return void 0===e}))?(Ie(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]},Xe=function(e){var t,i,r=(0,_e.__read)(Ye(e),2),o=r[0],n=r[1],s=[];try{for(var a=(0,_e.__values)(o),c=a.next();!c.done;c=a.next()){var l=c.value;l&&re(l)&&s.push(l)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return[s,n]};var Je=function(e){var t=(0,_e.__read)((0,Be.useState)(e),2),i=t[0],r=t[1],o=(0,_e.__read)((0,Be.useState)(null),2),n=o[0],s=o[1],a=(0,Be.useCallback)((function(){var e=i.load();s(e),e.then((function(t){r(t),s((function(t){return t===e?null:t}))}),(function(){}))}),[i]);return(0,Be.useEffect)((function(){return i.onChange=a,i.isLoaded()||a(),function(){i.onChange=null,i.cancelLoad()}}),[i]),[i,null!==n]},Ze="Invariant failed";const Qe=function(e,t){if(!e)throw new Error(Ze)};function et(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function tt(){return tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},tt.apply(this,arguments)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rt=new Map,ot=new Map,nt=new Map,st=0;function at(e,t,i){void 0===i&&(i={}),i.threshold||(i.threshold=0);var r=i,o=r.root,n=r.rootMargin,s=r.threshold;if(rt.has(e)&&Qe(!1),e){var a=function(e){return e?nt.has(e)?nt.get(e):(st+=1,nt.set(e,st.toString()),nt.get(e)+"_"):""}(o)+(n?s.toString()+"_"+n:s.toString()),c=ot.get(a);c||(c=new IntersectionObserver(lt,i),a&&ot.set(a,c));var l={callback:t,element:e,inView:!1,observerId:a,observer:c,thresholds:c.thresholds||(Array.isArray(s)?s:[s])};return rt.set(e,l),c.observe(e),l}}function ct(e){if(e){var t=rt.get(e);if(t){var i=t.observerId,r=t.observer,o=r.root;r.unobserve(e);var n=!1,s=!1;i&&rt.forEach((function(t,r){r!==e&&(t.observerId===i&&(n=!0,s=!0),t.observer.root===o&&(s=!0))})),!s&&o&&nt.delete(o),r&&!n&&r.disconnect(),rt.delete(e)}}}function lt(e){e.forEach((function(e){var t=e.isIntersecting,i=e.intersectionRatio,r=e.target,o=rt.get(r);if(o&&i>=0){var n=o.thresholds.some((function(e){return o.inView?i>e:i>=e}));void 0!==t&&(n=n&&t),o.inView=n,o.callback(n,e)}}))}var _t=function(e){var t,i;function r(){for(var t,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return et(it(t=e.call.apply(e,[this].concat(r))||this),"state",{inView:!1,entry:void 0}),et(it(t),"node",null),et(it(t),"handleNode",(function(e){t.node&&(ct(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),et(it(t),"handleChange",(function(e,i){(e!==t.state.inView||e)&&t.setState({inView:e,entry:i}),t.props.onChange&&t.props.onChange(e,i)})),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var o=r.prototype;return o.componentDidMount=function(){this.node||Qe(!1)},o.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(ct(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(ct(this.node),this.node=null)},o.componentWillUnmount=function(){this.node&&(ct(this.node),this.node=null)},o.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,i=e.root,r=e.rootMargin;at(this.node,this.handleChange,{threshold:t,root:i,rootMargin:r})}},o.render=function(){var e=this.state,t=e.inView,i=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:i,ref:this.handleNode});var r=this.props,o=r.children,n=r.as,s=r.tag,a=(r.triggerOnce,r.threshold,r.root,r.rootMargin,r.onChange,function(e,t){if(null==e)return{};var i,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(o[i]=e[i]);return o}(r,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,Be.createElement)(n||s||"div",tt({ref:this.handleNode},a),o)},r}(Be.Component);et(_t,"displayName","InView"),et(_t,"defaultProps",{threshold:0,triggerOnce:!1});var dt={inView:!1,entry:void 0};const ut=function(e){var t=e.className,i=e.sticker,r=e.theme,o=e.width,n=e.height,s=e.isInView,a=void 0===s||s,c=(0,Be.useRef)(null),l=ve(i,o,n,r);return(0,Be.useLayoutEffect)((function(){c.current&&c.current.src!==l&&a&&(c.current.src=l)}),[a,l]),(0,Oe.jsx)("div",(0,_e.__assign)({className:(0,Y.classNames)("StickerImage",t),style:{width:o,height:n}},{children:(0,Oe.jsx)("img",{className:"StickerImage__image",ref:c},void 0)}),void 0)};var mt=i(11248),ft=i.n(mt);const ht=function(e){var t=e.className,i=e.sticker,r=e.theme,o=e.width,n=e.height,s=e.isInView,a=void 0===s||s,c=e.play,l=void 0!==c&&c,_=(0,Be.useRef)(null),d=(0,_e.__read)((0,Be.useState)(null),2),u=d[0],m=d[1],f=function(e,t){return void 0===t&&(t=F.DEFAULT),e.animation?e.animation.base_url+"/"+me[t]+(e.animation.version?"?"+e.animation.version:""):""}(i,r);return(0,Be.useEffect)((function(){if(u&&u.isLoaded){var e=l&&a;e&&!u.playing&&(u.item.play(),m((0,_e.__assign)((0,_e.__assign)({},u),{playing:!0}))),!e&&u.playing&&(u.item.pause(),m((0,_e.__assign)((0,_e.__assign)({},u),{playing:!1})))}}),[u,l,a]),(0,Be.useEffect)((function(){if(!u||u.url!==f)if(u&&u.item.destroy(),f&&a){var e=ft().loadAnimation({container:_.current,path:f,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:f,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){m((0,_e.__assign)((0,_e.__assign)({},t),{isLoaded:!0}))})),m(t)}else m(null)}),[f,a]),(0,Oe.jsx)("div",{className:(0,Y.classNames)("StickerAnimation",t),style:{width:o,height:n},ref:_},void 0)};const vt=function(e){var t=e.className,i=e.sticker,r=e.theme,o=void 0===r?F.LIGHT:r,n=e.width,s=e.height,a=(0,_e.__read)(function(e){void 0===e&&(e={});var t=(0,Be.useRef)(),i=(0,Be.useState)(dt),r=i[0],o=i[1],n=(0,Be.useCallback)((function(i){t.current&&ct(t.current),i&&at(i,(function(t,r){o({inView:t,entry:r}),t&&e.triggerOnce&&ct(i)}),e),t.current=i}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,Be.useEffect)((function(){t.current||r===dt||e.triggerOnce||o(dt)})),[n,r.inView,r.entry]}({threshold:0}),2),c=a[0],l=a[1],_=void 0!==i.animation,d=(0,_e.__read)((0,Be.useState)(!1),2),u=d[0],m=d[1];return(0,Oe.jsx)("div",(0,_e.__assign)({className:(0,Y.classNames)("Sticker",t),ref:c,onMouseEnter:function(){m(!0)},onMouseLeave:function(){m(!1)}},{children:_?(0,Oe.jsx)(ht,{sticker:i,theme:o,width:n,height:s,isInView:l,play:u},void 0):(0,Oe.jsx)(ut,{sticker:i,theme:o,width:n,height:s,isInView:l},void 0)}),void 0)};var pt=i(47560),gt=i(99940),kt=i(79806),wt={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function St(e,t){switch(t.type){case"updateState":return(0,_e.__assign)((0,_e.__assign)({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,_e.__assign)((0,_e.__assign)({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var Et=function(e){for(var t=Array.from(e.entries()),i=0;i<t.length;i++){var r=(0,_e.__read)(t[i],2),o=r[0],n=r[1];if(n&&n.intersectionRatio)return n.intersectionRatio<1?o:t[i-1]?t[i-1][0]:null}return null},bt=function(e){for(var t=Array.from(e.entries()),i=t.length-1;i>=0;i--){var r=(0,_e.__read)(t[i],2),o=r[0],n=r[1];if(n&&n.intersectionRatio)return n.intersectionRatio<1?o:t[i+1]?t[i+1][0]:null}return null};const yt=function(e){var t=(0,Be.useRef)(null),i=(0,_e.__read)((0,Be.useReducer)(St,wt),2),r=i[0],o=i[1],n=(0,Be.useCallback)((function(e){o({type:"updateState",state:e})}),[o]),s=(0,Be.useCallback)((function(i){if(t.current&&r.onMouseWheel&&t.current.removeEventListener("mousewheel",r.onMouseWheel),i){var s=i.querySelector(e.wrapperSelector);if(s){var a,c={x:0,y:0},l=new Map,_=function(t){var r=0;s.offsetWidth>i.offsetWidth&&(r=Math.max(0,Math.min(s.offsetWidth-i.offsetWidth,t.x)));var o=0;s.offsetHeight>i.offsetHeight&&(o=Math.max(0,Math.min(s.offsetHeight-i.offsetHeight,t.y))),s.style.transform="translate3d(-"+r+"px, -"+o+"px, 0)",s.style.transitionDuration=t.noTransition?"0s":"",c={x:r,y:o},e.onScroll&&e.onScroll(r,o)},d=function(e){_((0,_e.__assign)((0,_e.__assign)({},e),{x:c.x+e.x,y:c.y+e.y}))},u=function(e){e.deltaX&&e.preventDefault()};i.addEventListener("mousewheel",u),n((0,_e.__assign)((0,_e.__assign)({},r),{onMouseWheel:u,updateItems:function(){var t,r;a&&a.disconnect(),a=new IntersectionObserver((function(e){var t,i;try{for(var r=(0,_e.__values)(e),n=r.next();!n.done;n=r.next()){var s=n.value;l.has(s.target)&&l.set(s.target,s)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}o({type:"updateNav",hasPrev:null!==Et(l),hasNext:null!==bt(l)})}),{root:i,threshold:[0,1]}),l.clear();try{for(var n=(0,_e.__values)(i.querySelectorAll(e.itemSelector)),s=n.next();!s.done;s=n.next()){var c=s.value;l.set(c,null),a.observe(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},getOffset:function(){return c},scrollTo:_,scrollBy:d,onWheel:function(e){d({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=Et(l);if(e){var t=getComputedStyle(s),i=parseInt(t.paddingLeft)||0,r=parseInt(t.paddingTop)||0,o=s.getBoundingClientRect(),n=e.getBoundingClientRect();_({x:n.left-o.left-i,y:n.top-o.top-r})}},next:function(){var e=bt(l);if(e){var t=getComputedStyle(s),r=parseInt(t.paddingBottom)||0,o=parseInt(t.paddingRight)||0,n=i.getBoundingClientRect(),a=s.getBoundingClientRect(),c=e.getBoundingClientRect();_({x:c.left-a.left-n.width+c.width+o,y:c.top-a.top-n.height+c.height+r})}}}))}}t.current=i}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,Be.useLayoutEffect)((function(){r.updateItems()})),(0,_e.__assign)({ref:s},r)};var Tt=Le.default.getLang;const jt=function(e){var t,i=e.className,r=e.style,o=e.isAdded,n=void 0!==o&&o,s=e.add,a=e.remove,c=e.gift,l=e.isActive,_=e.isSelected,d=e.select;t=r.is_new?r.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):r.title;var u=be(r.style_sticker_ids[0]),m=function(e){return function(t){t.stopPropagation(),e()}};return(0,Oe.jsxs)("div",(0,_e.__assign)({className:(0,Y.classNames)("StickerStylesMenuItem",i,{"StickerStylesMenuItem--selected":Boolean(_),"StickerStylesMenuItem--added":Boolean(n),"StickerStylesMenuItem--new":r.is_new}),onClick:function(){d?d():n?a&&a():s&&s()}},{children:[u&&(0,Oe.jsx)(vt,{className:"StickerStylesMenuItem__icon",sticker:u,width:100,height:100},void 0),(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"div",className:"StickerStylesMenuItem__title"},{children:t}),void 0),r.is_purchased?void 0===l?(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenuItem__notice"},{children:Tt("purchases_stickers_you_have_it")}),void 0):l&&(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenuItem__notice"},{children:Tt("purchases_stickers_active_style")}),void 0):r.price.purchase.regular?(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenuItem__price"},{children:Tt("global_n_votes",r.price.purchase.current)}),void 0):(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenuItem__price"},{children:Tt("purchases_for_free_btn")}),void 0),(s||a||c&&r.can_gift)&&(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerStylesMenuItem__actions"},{children:[n?a&&(0,Oe.jsx)(Ne.default,(0,_e.__assign)({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:m(a)},{children:Tt("purchases_stickers_preview_remove_item")}),void 0):s&&(0,Oe.jsx)(Ne.default,(0,_e.__assign)({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:m(s)},{children:Tt("purchases_stickers_preview_add_item")}),void 0),c&&r.can_gift&&(0,Oe.jsx)(Ne.default,(0,_e.__assign)({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:m(c)},{children:(0,Oe.jsx)(We,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)};var Ct=Le.default.getLang;const Pt=function(e){var t=e.className,i=e.styles,r=e.isLoading,o=e.isAdded,n=e.add,s=e.remove,a=e.gift,c=e.activeStyle,l=e.selectedStyle,_=e.select,d=yt({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(r)return(0,Oe.jsx)("section",(0,_e.__assign)({className:(0,Y.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},{children:(0,Oe.jsx)(pt.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);var u=[{title:Ct("purchases_stickers_purchased_styles"),styles:i.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:Ct("purchases_stickers_other_styles"),styles:i.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:Ct("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return u.length?(0,Oe.jsxs)("section",(0,_e.__assign)({className:(0,Y.classNames)("StickerStylesMenu",t),ref:d.ref,onWheel:function(e){return d.onWheel(e)}},{children:[(0,Oe.jsx)("a",{className:(0,Y.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!d.hasPrev}),onClick:function(){return d.prev()}},void 0),(0,Oe.jsx)("a",{className:(0,Y.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!d.hasNext}),onClick:function(){return d.next()}},void 0),(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenu__wrapper"},{children:u.map((function(e,t){return(0,Oe.jsxs)("section",(0,_e.__assign)({className:"StickerStylesMenu__group"},{children:[(0,Oe.jsxs)("h2",(0,_e.__assign)({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,Oe.jsx)(gt.default,(0,_e.__assign)({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,Oe.jsx)(kt.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((function(e){return(0,Oe.jsx)(jt,{className:"StickerStylesMenu__item",style:e,isLoading:r,isAdded:o&&o(e),add:n&&function(){return n(e)},remove:s&&function(){return s(e)},gift:a&&function(){return a(e)},isActive:void 0===c?void 0:e===c,isSelected:void 0===l?void 0:e===l,select:_&&function(){return _(e)}},e.id)}))}),void 0)]}),t)}))}),void 0)]}),void 0):null};const It=function(e){var t=e.className,i=e.product;if(!oe(i)&&!re(i))return null;var r=function(e){var t=Se().stickers;return e.map((function(e){return t.get(e)}))}(re(i)?i.style_sticker_ids:i.sticker_ids),o=Ve.colorScheme.isDarkScheme()?F.DARK:F.LIGHT;return(0,Oe.jsx)("div",(0,_e.__assign)({className:(0,Y.classNames)("StickersProductPreview",t)},{children:(0,Oe.jsx)("ul",(0,_e.__assign)({className:"StickersProductPreview__stickers"},{children:r.map((function(e){return e&&(0,Oe.jsx)(vt,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:o},e.id)}))}),void 0)}),void 0)};var xt=Le.default.getLang;const Ot=function(e){var t=e.item,i=e.showHeader,r=void 0!==i&&i,o=e.remove;if(!t.product)return null;var n="";return oe(t.product)?n=(0,q.langStr)(xt("purchases_stickers_product_preview_title_pack"),"title",t.product.title):re(t.product)&&(n=(0,q.langStr)(xt("purchases_stickers_product_preview_title_style"),"title",t.product.title)),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickersCartItem"},{children:[r&&(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickersCartItem__header"},{children:[(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"span",className:"StickersCartItem__title"},{children:n}),void 0),o&&(0,Oe.jsx)("span",(0,_e.__assign)({className:"StickersCartItem__actions"},{children:(0,Oe.jsx)("button",(0,_e.__assign)({className:"StickersCartItem__remove",onClick:function(){return o()}},{children:xt("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,Oe.jsx)(It,{className:"StickersCartItem__preview",product:t.product},void 0)]}),void 0)};var Rt=Le.default.getLang,Mt=function(e){var t=e.className,i=e.price,r=e.text,o=e.placeholder,n=(0,_e.__rest)(e,["className","price","text","placeholder"]),s=(0,Be.useMemo)((function(){if(i){var e;i.current!==i.regular&&i.regular&&(e=(0,Oe.jsx)("span",(0,_e.__assign)({className:"StickersPriceButton__regular"},{children:i.current?i.regular:(0,q.langStr)(Rt("purchases_stickers_n_for_m"),"%n","","%m",Rt("global_n_votes",i.regular))}),"regular"));var t=(0,Oe.jsx)("span",(0,_e.__assign)({className:"StickersPriceButton__current"},{children:i.current?Rt("global_n_votes",i.current):Rt("purchases_for_free_btn").toLowerCase()}),"current");return r?r.split(/(\{regular_price\}|\{price\})/).map((function(i,r){return"{regular_price}"===i?e:"{price}"===i?t:i?(0,Oe.jsx)("span",(0,_e.__assign)({className:"StickersPriceButton__label"},{children:i}),"label"+r):void 0})):[e,t]}return[o]}),[r,o,null==i?void 0:i.regular,null==i?void 0:i.current]);return(0,Oe.jsx)(He.default,(0,_e.__assign)({className:(0,Y.classNames)("StickersPriceButton",t)},n,{children:s}),void 0)};Mt.defaultProps=(0,_e.__assign)({},He.default.defaultProps);const At=Mt;var Bt=i(43927),Lt=i(39664),Dt=i(73947),Nt=i(74041),Ht={s:56,m:96,l:168};const Kt=function(e){var t,i,r,o,n,s=e.order,a=e.forceValid,c=void 0!==a&&a,l=new Map,_=new Map;if(s)try{for(var d=(0,_e.__values)(s.items),u=d.next();!u.done;u=d.next()){var m=u.value,f=m.product;f&&(oe(f)?l.has(f)?null===(r=l.get(f))||void 0===r||r.push(m):l.set(f,[m]):re(f)&&(_.has(f)?null===(o=_.get(f))||void 0===o||o.push(m):_.set(f,[m])))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(t)throw t.error}}var h=l.keys().next().value,v=(h?1:0)+_.size,p=v>1?v>2?"s":"m":"l",g=Ht[p],k=Array.from(_.entries());c||k.sort((function(e,t){var i=(0,_e.__read)(e,2)[1];return(0,_e.__read)(t,2)[1].filter((function(e){return!e.error})).length-i.filter((function(e){return!e.error})).length}));var w=k.slice(0,3),S=k.slice(3),E=!0;if(!c){var b=S.filter((function(e){return(0,_e.__read)(e,2)[1].find((function(e){return!e.error}))}));b.length?S=b:E=!1}return(0,Oe.jsxs)("ul",(0,_e.__assign)({className:"StickerProductsGiftIcons"},{children:[h&&(0,Oe.jsx)("li",{className:(0,Y.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!c&&!(null===(n=l.get(h))||void 0===n?void 0:n.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+pe(h,g,g)+")"}},h.id),w.map((function(e){var t=(0,_e.__read)(e,2),i=t[0],r=t[1];return(0,Oe.jsx)("li",{className:(0,Y.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!c&&!r.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+pe(i,g,g)+")"}},i.id)})),S.length?(0,Oe.jsxs)("li",(0,_e.__assign)({className:(0,Y.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!E})},{children:["+",S.length]}),"more"):null]}),void 0)};var Wt=Le.default.getLang;function Vt(e){var t=e.getPack(),i=e.getStyles(),r="";return i.length&&(r=i.map((function(e){return(0,q.langStr)(Wt("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", ")),t?r?(0,q.langStr)(Wt("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",r):(0,q.langStr)(Wt("purchases_stickers_gift_details_recipient_pack"),"title",t.title):r?(0,q.langStr)(Wt("purchases_stickers_gift_details_recipient_styles"),"style_titles",r):null}const Ft=function(e){var t,i,r=e.order,o=e.recipients,n=function(e){var t,i;if(!e)return null;var r=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),o=r.filter((function(e){return!e.error&&!ge(e)}));o.length&&(r=o);var n=[],s=[];try{for(var a=(0,_e.__values)(r),c=a.next();!c.done;c=a.next()){var l=c.value,_=l.product;_&&(oe(_)?n.push(l):re(_)&&s.push(l))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}var d=s.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(n.length){var u=n.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return s.length?(0,q.langStr)(Wt("purchases_stickers_gift_details_summary_pack_with_styles",s.length),"pack_price_sum",Wt("global_n_votes",u),"styles_num",s.length,"styles_price_sum",Wt("global_n_votes",d)):(0,q.langStr)(Wt("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",Wt("global_n_votes",u))}if(s.length)return(0,q.langStr)(Wt("purchases_stickers_gift_details_summary_styles",s.length),"styles_num",s.length,"styles_price_sum",Wt("global_n_votes",d));return null}(r),s=new Map;try{for(var a=(0,_e.__values)(r.items),c=a.next();!c.done;c=a.next()){var l=c.value,_=l.error,d=l.product,u=l.recipient_id;if(!_){var m=o.get(u);if(m){var f=s.get(m);f||(f=new le,s.set(m,f)),f.add(d)}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}var h=Array.from(s.entries()),v=(0,Be.useRef)(null);return(0,Be.useEffect)((function(){var e=v.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerProductsGiftDetails",ref:v},{children:[n&&(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"p",className:"StickerProductsGiftDetails__summary"},{children:n}),void 0),h.length>0&&(0,Oe.jsx)("ul",(0,_e.__assign)({className:"StickerProductsGiftDetails__recipients"},{children:h.map((function(e){var t=(0,_e.__read)(e,2),i=t[0],r=t[1];return(0,Oe.jsxs)("li",(0,_e.__assign)({className:"StickerProductsGiftDetails__recipient"},{children:[(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"div",className:"StickerProductsGiftDetails__recipientName"},{children:i[1]}),void 0),(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerProductsGiftDetails__recipientProducts"},{children:Vt(r)}),void 0)]}),i[0])}))}),void 0)]}),void 0)};var Ut=Le.default.getLang;const $t=function(e){var t=e.cart,i=e.options,r=i.ref,o=i.gift_ref,n=e.closeBox,s=e.updateBox,a=(0,_e.__read)(Je(t),2),l=a[0],_=a[1],d=!l.isLoaded()&&_;(0,Be.useEffect)((function(){s()}),[d]);var u=l.getRecipientIds(),m=l.getOrder(),f=m&&!m.error&&m.items.find((function(e){return!e.error&&!ge(e)})),h=(0,_e.__read)(function(e){var t,i,r;if(!e)return[null,null];try{for(var o=(0,_e.__values)(e.items),n=o.next();!n.done;n=o.next()){var s=n.value.product;if(s&&oe(s)){r=s;break}}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}var a=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),c=a.filter((function(e){return!e.error&&!ge(e)}));c.length&&(a=c);var l=new le(a.map((function(e){return e.product}))),_=l.pack.values().next().value,d=Array.from(l.style),u="",m="";if(1===d.length)u=(0,q.langStr)(Ut("purchases_stickers_gift_title_1_style"),"title",d[0].title),_?m=(0,q.langStr)(Ut("purchases_stickers_gift_description_with_pack"),"title",_.title):r&&(m=(0,q.langStr)(Ut("purchases_stickers_gift_description_for_pack"),"title",r.title));else if(_){if(u=(0,q.langStr)(Ut("purchases_stickers_gift_title_pack"),"title",_.title),d.length)switch(d.length){case 2:m=(0,q.langStr)(Ut("purchases_stickers_gift_description_with_2_styles"),"title1",d[0].title,"title2",d[1].title);break;case 3:m=(0,q.langStr)(Ut("purchases_stickers_gift_description_with_3_styles"),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title);break;case 4:m=(0,q.langStr)(Ut("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title);break;default:var f=d.length-3;m=(0,q.langStr)(Ut("purchases_stickers_gift_description_with_3_styles_and_n_more",f),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title,"n",f)}}else if(d.length){switch(d.length){case 2:u=(0,q.langStr)(Ut("purchases_stickers_gift_title_2_styles"),"title1",d[0].title,"title2",d[1].title);break;case 3:u=(0,q.langStr)(Ut("purchases_stickers_gift_title_3_styles"),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title);break;case 4:u=(0,q.langStr)(Ut("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title);break;default:f=d.length-3;u=(0,q.langStr)(Ut("purchases_stickers_gift_title_3_styles_and_n_more",f),"title1",d[0].title,"title2",d[1].title,"title3",d[2].title,"n",f)}r&&(m=(0,q.langStr)(Ut("purchases_stickers_gift_description_for_pack"),"title",r.title))}d.length?m+=" "+Ut("purchases_stickers_gift_description_styles"):m+=" "+Ut("purchases_stickers_gift_description");return[u,m]}(m),2),v=h[0],p=h[1],g=(0,_e.__read)((0,Be.useState)(null),2)[1];(0,Be.useLayoutEffect)((function(){var e,t,i=l.getRecipients();if(g(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:i,items:i,noResult:Ut("gifts_nobody_found"),introText:Ut("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?l.addRecipientId(+t):l.removeRecipientId(+t)}})),u.length)try{for(var r=(0,_e.__values)(u),o=r.next();!o.done;o=r.next()){var n=o.value,s=l.getRecipientById(n);s&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[d]);var k=(0,_e.__read)((0,Be.useState)(""),2),w=k[0],S=k[1],E=(0,_e.__read)((0,Be.useState)(!1),2),b=E[0],y=E[1],T=(0,_e.__read)((0,Be.useState)(!1),2),j=T[0],C=T[1],P=function(){j||(C(!0),l.order({message:w,is_private:b,ref:r,gift_ref:o}).then((function(e){C(!1),e&&!e.error&&((0,c.showDoneBox)(function(e,t){var i,r,o=new le(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),n=function(e){var t=e.getPack(),i=e.getStyles();if(t)return i.length?(0,q.langStr)(Ut("purchases_stickers_gift_result_products_pack_and_styles",i.length),"title",t.title,"styles_num",i.length):(0,q.langStr)(Ut("purchases_stickers_gift_result_products_pack"),"title",t.title);if(i.length)switch(i.length){case 1:return(0,q.langStr)(Ut("purchases_stickers_gift_result_products_1_style"),"title",i[0].title);case 2:return(0,q.langStr)(Ut("purchases_stickers_gift_result_products_2_styles"),"title1",i[0].title,"title2",i[1].title);case 3:return(0,q.langStr)(Ut("purchases_stickers_gift_result_products_3_styles"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);case 4:return(0,q.langStr)(Ut("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);default:var r=i.length-3;return(0,q.langStr)(Ut("purchases_stickers_gift_result_products_3_styles_and_n_more",r),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title,"n",r)}return null}(o);if(!n)return null;var s=new Set;try{for(var a=(0,_e.__values)(e.items),c=a.next();!c.done;c=a.next()){var l=c.value,_=l.error,d=l.recipient_id;if(!_){var u=t(d);u&&s.add(u)}}}catch(e){i={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}var m=function(e,t){var i=Array.from(e.values());switch(i.length){case 0:return null;case 1:var r=1===t?"purchases_stickers_gift_result_1_recipient_single":"purchases_stickers_gift_result_1_recipient_multiple";return(0,q.langStr)((0,q.langSex)(i[0][7],Ut(r,!0)),"name",i[0][8]);case 2:return(0,q.langStr)(Ut("purchases_stickers_gift_result_2_recipients",t),"name1",i[0][8],"name2",i[1][8]);case 3:return(0,q.langStr)(Ut("purchases_stickers_gift_result_3_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8]);case 4:return(0,q.langStr)(Ut("purchases_stickers_gift_result_4_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8]);case 5:return(0,q.langStr)(Ut("purchases_stickers_gift_result_5_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"name5",i[4][8]);default:var o=i.length-4;r=1===t?"purchases_stickers_gift_result_4_recipients_and_n_more_single":"purchases_stickers_gift_result_4_recipients_and_n_more_multiple";return(0,q.langStr)(Ut(r),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"n",o)}return null}(s,o.getCount());if(!m)return null;return(0,q.langStr)(m,"products",n)}(e,(function(e){return l.getRecipientById(e)}))),n())}),(function(){})))};return(0,Be.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",j)}),[j]),(0,Oe.jsxs)("article",(0,_e.__assign)({className:"StickerProductsGift"},{children:[(0,Oe.jsx)(Bt.ModalHeader,{className:"StickerProductsGift__header",title:Ut("purchases_stickers_gift_box_title"),onClose:n},void 0),d?(0,Oe.jsx)("section",(0,_e.__assign)({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,Oe.jsx)(Lt.default,{size:24},void 0)}),void 0):(0,Oe.jsxs)(Be.Fragment,{children:[(0,Oe.jsxs)("section",(0,_e.__assign)({className:"StickerProductsGift__content"},{children:[(0,Oe.jsx)(Kt,{order:m,forceValid:!f},void 0),(0,Oe.jsx)("h1",(0,_e.__assign)({className:"StickerProductsGift__productsTitle"},{children:v}),void 0),(0,Oe.jsx)("p",(0,_e.__assign)({className:"StickerProductsGift__productsDescription"},{children:p}),void 0),m&&(0,Oe.jsxs)(Be.Fragment,{children:[(0,Oe.jsxs)("dl",(0,_e.__assign)({className:"StickerProductsGift__price"},{children:[(0,Oe.jsx)("dt",(0,_e.__assign)({className:"StickerProductsGift__priceLabel"},{children:Ut("purchases_gift_price_label")}),void 0)," ",(0,Oe.jsx)("dd",(0,_e.__assign)({className:"StickerProductsGift__priceValue"},{children:Ut("global_n_votes",m.price.current)}),void 0)]}),void 0),(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerProductsGift__balance"},{children:(0,q.langStr)(Ut("gifts_you_have_X_votes"),"votes",Ut("global_n_votes",m.balance))}),void 0)]},void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerProductsGift__recipients"},{children:[(0,Oe.jsx)("label",(0,_e.__assign)({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:Ut("gifts_receiver")}),void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,Oe.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,Oe.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:Ut("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerProductsGift__message"},{children:[(0,Oe.jsx)("label",(0,_e.__assign)({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:Ut("purchases_gift_your_message")}),void 0),(0,Oe.jsx)(Dt.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:w,onChange:function(e){return S(e.currentTarget.value)},onResize:function(){return s()},style:{height:80},disabled:j},void 0)]}),void 0),(0,Oe.jsx)(Nt.default,(0,_e.__assign)({className:"StickerProductsGift__isPrivate",checked:b,disabled:j,onChange:function(){return y(!b)}},{children:Ut("gifts_receiver_only")}),void 0)]}),void 0),(0,Oe.jsxs)("footer",(0,_e.__assign)({className:"StickerProductsGift__footer"},{children:[(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerProductsGift__footerNote"},{children:!_&&m&&(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerProductsGift__details"},{children:[Ut("purchases_stickers_gift_details_label"),(0,Oe.jsx)(gt.default,(0,_e.__assign)({className:"StickerProductsGift__detailsTooltip",text:(0,Oe.jsx)(Ft,{order:m,recipients:l.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,Oe.jsx)(kt.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerProductsGift__footerButtons"},{children:(0,Oe.jsx)(At,{className:"StickerProductsGift__gift",appearance:f?"primary":"secondary",size:"m",loading:_||j,disabled:!f,price:null==m?void 0:m.price,text:f?(0,q.langStr)(Ut("purchases_stickers_gift_send_for"),"price",Ut("global_n_votes",null==m?void 0:m.price.current)):Ut("purchases_stickers_gift_send"),onClick:function(){return P()}},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};function zt(e,t){var i;if(Se().productsGiftLock)return null;Ee({productsGiftLock:!0});var r,o=(0,_e.__assign)({},t);function n(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductsGift")}function s(){null==i||i.hide()}function a(){null==i||i.updateBoxCoords()}return r=Ue(),(0,c.boxRefreshCoords)(r),(0,k.show)(r),(0,k.show)($e()),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=(0,_e.__read)(e,1)[0];(0,k.hide)(Ue()),i=new z.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=n();t&&Re.render((0,Oe.jsx)($t,{cart:e,options:o,closeBox:s,updateBox:a},void 0),t)}(t),requestAnimationFrame((function(){a()}))},onHideAttempt:function(){var e;return(e=n())&&Re.unmountComponentAtNode(e),!0},onHide:function(){Ee({productsGiftLock:!1})}}),i.content('<div class="StickersProductsGift"></div>'),i.show()}),(function(){})),{hide:s}}function Gt(e,t,i){return void 0===t&&(t=[]),zt(Ae.create(e,t),i)}var qt=i(59397),Yt=Le.default.getLang;const Xt=function(e){var t=e.pack,i=e.cart,r=e.options,o=r.recipientIds,n=void 0===o?[]:o,s=r.ref,a=r.gift_ref,l=e.closeBox,_=(0,_e.__read)(qe(t.id),1)[0];_&&(t=_);var d=(0,_e.__read)(Xe(t.style_ids||[]),2),u=d[0],m=d[1],f=(0,_e.__read)(Je((function(){return i})),2),h=f[0],v=f[1],p=(0,_e.__read)(function(e){var t=(0,_e.__read)(Ye(e.map((function(e){return e.product_id}))),2),i=t[0],r=t[1];return[(0,Be.useMemo)((function(){return e.map((function(e,t){return(0,_e.__assign)((0,_e.__assign)({},e),{product:i[t]})}))}),[e]),r]}(h.getItems()),1),g=p[0],k=h.getProducts(),w=h.getOrder(),S=be(t.sticker_ids[0]),E=function(e){var t,i;if(!e)return null;var r=[],o=[];try{for(var n=(0,_e.__values)(e.items),s=n.next();!s.done;s=n.next()){var a=s.value,c=a.product,l=a.error;c&&!l&&(oe(c)?r.push(a):re(c)&&o.push(a))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}var _=o.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(r.length){var d=r.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return d?o.length?_?(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_for_styles_for",o.length),"pack_price",Yt("global_n_votes",d),"styles_num",o.length,"styles_price_sum",_):(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_for_styles_free",o.length),"pack_price",Yt("global_n_votes",d),"styles_num",o.length):(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_for"),"pack_price",Yt("global_n_votes",d)):o.length?_?(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_free_styles_for",o.length),"styles_num",o.length,"styles_price_sum",Yt("global_n_votes",_)):(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_free_styles_free",o.length),"styles_num",o.length):(0,q.langStr)(Yt("purchases_stickers_order_summary_pack_free"))}if(o.length)return _?(0,q.langStr)(Yt("purchases_stickers_order_summary_styles_for",o.length),"styles_num",o.length,"styles_price_sum",Yt("global_n_votes",_)):(0,q.langStr)(Yt("purchases_stickers_order_summary_styles_free",o.length),"styles_num",o.length);return null}(w),b=!v&&w&&!w.error,y=(0,_e.__read)((0,Be.useState)(!1),2),T=y[0],j=y[1],C=null;if(w)if(w.error){if(w.error===ae.NOT_SIGNED_IN){C=(0,Oe.jsx)(He.default,(0,_e.__assign)({className:"StickerPackPreview__purchase",size:"m",loading:v,onClick:function(){(0,c.showDoneBox)(Yt("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},{children:Yt("purchases_stickers_get_pack_btn")}),void 0)}else if(w.error===ae.NO_VALID_ITEMS){if(1===w.items.length){var P=w.items[0],I=P.product,x=P.error;if(I&&x!==ce.DUPLICATE_PRODUCT&&I.purchase_details){var O=I.purchase_details,R=O.label,M=O.title,A=O.text,B=O.button_title,L=O.button_url;C=(0,Oe.jsx)(He.default,(0,_e.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"primary",loading:v,onClick:function(){(0,z.showFastBox)(M||Yt("purchases_stickers_catalog_purchase_details_title"),A,L&&B||null,L?function(){window.location.href=L}:null)}},{children:R||Yt("purchases_stickers_product_unavailable")}),void 0)}}if(!C){var D=!w.items.find((function(e){return e.error!==ce.DUPLICATE_PRODUCT}));C=(0,Oe.jsx)(He.default,(0,_e.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"secondary",loading:v,disabled:!0},{children:Yt(D?"purchases_stickers_product_purchased":"purchases_stickers_product_unavailable")}),void 0)}}}else{var N=v||T;C=(0,Oe.jsx)(At,{className:"StickerPackPreview__purchase",size:"m",loading:N,disabled:N,price:w.price,text:w.price.current?Yt("purchases_stickers_buy_for"):Yt("purchases_stickers_get_for_free"),onClick:function(){T||(j(!0),h.order({ref:s,gift_ref:a}).then((function(e){j(!1),e&&!e.error&&(0,c.showDoneBox)(ze(e))}),(function(){})))}},void 0)}var H=!v&&void 0!==k.find((function(e){return null==e?void 0:e.can_gift})),K=g.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set),W=Ve.colorScheme.isDarkScheme()?F.DARK:F.LIGHT;return(0,Oe.jsxs)("article",(0,_e.__assign)({className:"StickerPackPreview"},{children:[(0,Oe.jsxs)("header",(0,_e.__assign)({className:"StickerPackPreview__header"},{children:[(0,Oe.jsx)("a",(0,_e.__assign)({className:"StickerPackPreview__close",onClick:l},{children:(0,Oe.jsx)(Ke.default,{},void 0)}),void 0),S&&(0,Oe.jsx)(vt,{className:"StickerPackPreview__icon",sticker:S,theme:W,width:128,height:128},void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerPackPreview__info"},{children:[(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"h1",className:"StickerPackPreview__title"},{children:t.title}),void 0),(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"div",className:"StickerPackPreview__author"},{children:t.author}),void 0),(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"div",className:"StickerPackPreview__description"},{children:t.description}),void 0)]}),void 0)]}),void 0),u.length>0&&(0,Oe.jsx)(Pt,{className:"StickerPackPreview__styles",styles:u,isLoading:m,isAdded:function(e){return h.hasProduct(e.id)},add:function(e){return h.addProduct(e.id)},remove:function(e){return h.removeProduct(e.id)},gift:function(e){Gt([e.id],n)}},void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerPackPreview__footerContainer"},{children:[(0,Oe.jsx)("section",(0,_e.__assign)({className:"StickerPackPreview__items"},{children:g.map((function(e){return(0,Oe.jsx)(Ot,{item:e,showHeader:u.length>0,remove:e.product&&re(e.product)?function(){return h.removeProduct(e.product_id)}:void 0},e.product_id)}))}),void 0),K.size>0&&(0,Oe.jsx)("section",(0,_e.__assign)({className:"StickerPackPreview__copyrights"},{children:Array.from(K).map((function(e,t){return(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerPackPreview__copyright"},{children:(0,qt.decodeHTMLEntities)(e)}),t)}))}),void 0),(0,Oe.jsxs)("footer",(0,_e.__assign)({className:"StickerPackPreview__footer"},{children:[!v&&(b||H)&&(0,Oe.jsx)("div",(0,_e.__assign)({className:"StickerPackPreview__footerNote"},{children:E}),void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerPackPreview__footerButtons"},{children:[H&&(0,Oe.jsxs)(Ne.default,(0,_e.__assign)({className:"StickerPackPreview__gift",appearance:"primary",size:"m",onClick:function(){return(e=h.copy()).setRecipientIds(n),void zt(e);var e}},{children:[(0,Oe.jsx)(We,{width:20,height:20,className:"StickerPackPreview__giftIcon"},void 0),Yt("purchases_stickers_gift")]}),void 0),C]}),void 0)]}),void 0)]}),void 0)]}),void 0)};var Jt=Le.default.getLang;const Zt=function(e){var t=e.pack,i=e.options,r=e.closeBox,o=e.updateBox,n=(0,_e.__read)(qe(t.id),2),s=n[0],a=n[1];s&&(t=s);var c=(0,_e.__read)(Xe(t.style_ids||[]),2),l=c[0],_=c[1],d=a||_;(0,Be.useEffect)((function(){o()}),[d]);var u=(0,_e.__assign)((0,_e.__assign)({},t),{base_id:t.id,title:Jt("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),m=(0,_e.__spreadArray)([u],(0,_e.__read)(l),!1),f=m.find((function(e){return e&&e.is_active}))||u,h=(0,_e.__read)((0,Be.useState)(),2),v=h[0],p=h[1],g=v&&m.find((function(e){return e&&e.id===v})),k=function(e){p(e&&e.id)},w=g||f,S=w===u?Jt("purchases_stickers_product_preview_title_base_pack"):(0,q.langStr)(Jt("purchases_stickers_product_preview_title_style"),"title",w.title);(0,Be.useEffect)((function(){w.is_new&&xe(w.id,Z.IsNew,0).finally((function(){}))}),[w,w.is_new]);var E=(0,_e.__read)((0,Be.useState)(!1),2),b=E[0],y=E[1],T=(0,_e.__read)((0,Be.useState)(!1),2),j=T[0],C=T[1],P=function(e){j||(C(!0),function(e){return new Promise((function(t){ke.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){Te(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))}(e).then((function(){C(!1),k(void 0)}),(function(){})))};return(0,Oe.jsxs)("article",(0,_e.__assign)({className:"StickerPackSettings"},{children:[(0,Oe.jsx)(Bt.ModalHeader,{className:"StickerPackSettings__header",title:t?(0,q.langStr)(Jt("purchases_stickers_style_selection_for_pack"),"title",t.title):"",onClose:r},void 0),d?(0,Oe.jsx)("section",(0,_e.__assign)({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,Oe.jsx)(Lt.default,{size:24},void 0)}),void 0):(0,Oe.jsxs)(Be.Fragment,{children:[m.length>0&&(0,Oe.jsx)(Pt,{className:"StickerPackSettings__styles",styles:m,isLoading:_,activeStyle:f,selectedStyle:w,select:function(e){return k(e)}},void 0),(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerPackSettings__footerContainer"},{children:[(0,Oe.jsxs)("section",(0,_e.__assign)({className:"StickerPackSettings__stylePreview"},{children:[(0,Oe.jsx)(De.default,(0,_e.__assign)({element:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:S}),void 0),(0,Oe.jsx)(It,{product:w},void 0)]}),void 0),(0,Oe.jsx)("footer",(0,_e.__assign)({className:"StickerPackSettings__footer"},{children:(0,Oe.jsxs)("div",(0,_e.__assign)({className:"StickerPackSettings__footerButtons"},{children:[w.can_gift&&(0,Oe.jsx)(Ne.default,{className:"StickerPackSettings__gift",appearance:"secondary",size:"m",onClick:function(){Gt([w.id],i.recipientIds||[])}},void 0),w.is_purchased?(0,Oe.jsx)(He.default,(0,_e.__assign)({className:"StickerPackSettings__activate",appearance:"primary",size:"m",disabled:w===f,loading:j,onClick:function(){return P(w)}},{children:Jt("purchases_stickers_product_settings_save")}),void 0):(0,Oe.jsx)(At,{className:"StickerPackSettings__buy",appearance:"primary",size:"m",price:w.price.purchase,text:Jt(w.price.purchase.current?"purchases_stickers_buy_for":"purchases_stickers_get_for_free"),loading:b,onClick:function(){return e=w,void(b||(y(!0),Ae.create([e.id]).load().then((function(e){return e.order()})).then((function(){y(!1)}),(function(){}))));var e}},void 0)]}),void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};var Qt=Le.default.getLang;const ei=function(e){var t=e.style,i=e.options.add,r=e.closeBox;return(0,Oe.jsxs)("article",(0,_e.__assign)({className:"StickerStylePreview"},{children:[(0,Oe.jsx)(Bt.ModalHeader,{className:"StickerStylePreview__header",title:(0,q.langStr)(Qt("purchases_stickers_stickers_of_style"),"title",t.title),onClose:r},void 0),(0,Oe.jsx)(It,{className:"StickerStylePreview__content",product:t},void 0),(0,Oe.jsxs)("footer",(0,_e.__assign)({className:"StickerStylePreview__footer"},{children:[(0,Oe.jsx)(Ne.default,(0,_e.__assign)({className:"StickerStylePreview__cancel",appearance:"tertiary",size:"m",onClick:r},{children:Qt("global_cancel")}),void 0),i&&(0,Oe.jsx)(Ne.default,(0,_e.__assign)({className:"StickerStylePreview__add",appearance:"primary",size:"m",onClick:function(){return i(t)}},{children:Qt("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)};var ti=new Map;function ii(e,t){var i=(0,c.showBoxLoader)();(function(e){var t=ye(e);return t?Promise.resolve(t):new Promise((function(t){ke.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(i){Te(i),t(ye(e))},onFail:function(e){return console.error(e),t(null),!0}})}))})(e).then((function(e){!(0,c.isBoxLoadingCancelled)(i)&&e&&((0,c.hideBoxLoader)(),ri(e.id,t))}),(function(){}))}function ri(e,t){var i,r=(0,_e.__assign)({},t);function o(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductPreviewBox")}function n(){null==i||i.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function s(){null==i||i.updateBoxCoords()}function a(e,t){var i=null,c=null;if(oe(e))i=e.is_purchased&&(null==r?void 0:r.settings)?(0,Oe.jsx)(Zt,{pack:e,options:r,closeBox:n,updateBox:s},void 0):(0,Oe.jsx)(Xt,{pack:e,cart:t,options:r,closeBox:n,updateBox:s},void 0),c=e.name;else if(re(e)){var l=je(e.base_id);if(l)return t.addProduct(l.id,!0),void a(l,t);i=(0,Oe.jsx)(ei,{style:e,options:r,closeBox:n,updateBox:s},void 0),c=e.name}var _=o();if(_&&i&&(Re.render(i,_),c)){var d=window.nav.objLoc[0].split("/");"stickers"===d[0]&&d[1]!==c&&window.nav.setLoc({0:"stickers/"+c})}}var l=(0,c.showBoxLoader)(!1),_=Ae.create([e]);return Promise.all([_.load(),window.stManager.add(["stickers.css"])]).then((function(t){var r=(0,_e.__read)(t,1)[0];if(!(0,c.isBoxLoadingCancelled)(l)){(0,c.hideBoxLoader)();var n=je(e);n&&!n.is_disabled?((i=new z.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){a(n,r),requestAnimationFrame((function(){s(),function(){if(ti.has(e)){var t=(0,c.getBoxLayerWrap)();t&&(t.scrollTop=ti.get(e)||0),ti.delete(e)}}()}))},onBeforeHide:function(){!function(){var t=(0,c.getBoxLayerWrap)();t&&ti.set(e,t.scrollTop)}()},onHideAttempt:function(){var e;return(e=o())&&Re.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),i.show()):(0,z.showFastBox)((0,q.getLang)("global_box_error_title"),(0,q.getLang)("purchases_stickers_product_not_found"))}}),(function(){})),{hide:n}}var oi,ni=i(53262),si=i(89798);!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(oi||(oi={}));var ai=i(51620),ci=i(99392),li=i(91047),_i="stickers_keywords",di=(0,li.createStore)("emoji-db-v1","emoji-cache"),ui=function(){return(0,p.partConfigEnabled)("stickers_keywords_idb_cache")&&"indexedDB"in window.self};function mi(){return ui()?(0,li.get)(_i,di):Promise.resolve(we.default.get(_i))}function fi(){window.stickersKeywordsData?hi(window.stickersKeywordsData):mi().then((function(e){if(e){var t=e.keywords;e.time>(0,M.vkNow)()-Si.stickersKeywordsExpire&&(window.stickersKeywordsData=t),window.stickersKeywordsData&&hi(window.stickersKeywordsData)}}))}function hi(e,t){if(e){window.stickersKeywords={};var i,r,o,n="",s=e.reduce((function(e,t){var i=t.words,r=t.user_stickers,o=t.promoted_stickers.map((function(e){return-e})),s=r.concat(o);return i.forEach((function(t){n+="\n"+t,e.push(s)})),e}),[]);if(i=n,r=document.createElement("div"),(0,k.val)(r,i),(n=r.textContent||r.innerText)&&n.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=s[t]})),!Si.stickers[Si.TAB_RECENT_STICKERS]){var a=we.default.get("recent_stickers");a&&(Si.stickers[Si.TAB_RECENT_STICKERS]=a)}t&&(o={time:(0,M.vkNow)(),keywords:e},ui()?(0,li.set)(_i,o,di).then((function(){we.default.remove(_i)})):Promise.resolve(we.default.set(_i,o))).then((function(){Si.updateStickersHints(!0)}))}}function vi(){return vi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},vi.apply(this,arguments)}function pi(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return gi(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return gi(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gi(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function ki(){return(0,p.partConfigEnabled)("stickers_web_new_ui")}function wi(){return(0,p.partConfigEnabled)("new_sticker_picker")}var Si={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,isStickersPreloading:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,TAB_NEW_CONVO_STICKERS:-3,TAB_VMOJI:-4,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",NEW_CONVO:"new_convo",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},SHOW_STICKER_PACK_VIEWS_DELAY:32,STICKER_PACK_VIEW_MARGIN_TOP:3,STICKERS_IN_RAW:4,STICKER_SIDE_SIZE:70,STICKER_PACK_HEADER_HEIGHT:30,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),PACK_FIELD_ID:0,PACK_FIELD_IS_ACTIVE:1,PACK_FIELD_COUNT:6,STICKER_FIELD_IMAGES:6,STICKER_FIELD_IS_FAVORITE:4,STICKER_PACKS_CONTAINER_CLASS:"sticker_pack_views_container",init:function(e,t){var i=Si.last;Si.tabDefaultId=Si.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=(0,k.gpeByClass)("_emoji_field_wrap",e),t.emojiWrap=(0,k.domByClass)(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=(0,k.domByClass)(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&(0,k.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=(0,M.vkNow)(),t.suggestions=new V(t.suggestionsConfig),t.packViews=new Map,t.activePackViews=new Map,t.packViewsTotalHeight=0,t.renderedPackViews=new Map,t.packsToShow=new Set,t.packsToHide=new Set;var r=(0,g.isRetina)()?128:64;if(Si.stickerSizes[r]=!0,wi()&&window.stManager.add([window.jsc("web/sticker_picker.js"),"sticker_picker.css"]),t.forceTxt)t.editable=0,(0,a.placeholderInit)(e);else{if(t.editable=1,setTimeout((function(){(0,a.placeholderInit)(e,{editable:1,editableFocus:Si.editableFocus,global:t.global}),t.shouldFocus&&Si.editableFocus(e,!1,!0)}),0),o.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}(0,d.addEvent)(window,"mousemove",Si.preventMouseOverHandle),(0,d.addEvent)(e,o.browser.opera&&!o.browser.chrome?"click":"mousedown",(function(r){if(r.target&&"IMG"==r.target.tagName&&Si.getCode(r.target))return Si.editableFocus(e,r.target,r.offsetX>8),(0,d.cancelEvent)(r);Si.shown&&Si.ttClick(i,(0,k.geByClass1)("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&(0,d.addEvent)(e,"blur",(function(t){e.textContent||e.innerText||(0,g.each)((0,k.geByTag)("br",e),(function(e,t){(0,k.re)(t)}))})),(0,d.addEvent)(e,"keypress keydown keyup input paste",(function(r){if(r.canceled)return!1;if("keydown"===r.type){t.onChange&&(Si.raw[i]=e.innerHTML);var n=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(r.keyCode==d.KEY.RETURN||10==r.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),(0,d.cancelEvent)(r);var s=cur.ctrl_submit&&!t.noCtrlSend;if((s||n)&&(r.ctrlKey||o.browser.mac&&r.metaKey)||!s&&!r.shiftKey&&!(r.ctrlKey||o.browser.mac&&r.metaKey)){var a=(0,k.data)(e,"composer");if(!Si.emojiEnter(i,r)||!Si.stickerHintMove(r)||a&&a.wdd&&(0,k.isVisible)(a.wdd.listWrap))return!1;if(!n||r.ctrlKey||o.browser.mac&&r.metaKey)return Si.ttClick(i,(0,k.geByClass1)("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),(0,d.cancelEvent)(r)}if(t.noLineBreaks)return(0,d.cancelEvent)(r)}if(r.ctrlKey&&r.keyCode==d.KEY.RETURN){var c=this.value;if(t.editable)Si.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var l=this.selectionStart;this.value=c.slice(0,l)+"\n"+c.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=l+1}else if(document.selection&&document.selection.createRange){this.focus();var _=document.selection.createRange();_.text="\r\n",_.collapse(!1),o.browser.opera&&!o.browser.chrome&&(_.moveEnd("character",0),_.moveStart("character",0)),_.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var u=(0,U.hasAccessibilityMode)()&&(0,p.partConfigEnabled)("emoji_tooltip_a11y_mode");if(r.keyCode===d.KEY.TAB&&!(r.ctrlKey||o.browser.mac&&r.metaKey)&&!u){var m=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(t.txt));if(m&&(0,k.isVisible)(m)){var f=(0,k.geByClass1)("over",m);if(f?Si.stickerHintKeyOut(i,f):Si.stickerHintKeyOver(i,(0,k.geByClass1)("emoji_sticker_item",m)),!Si.shown)return(0,d.cancelEvent)(r)}var h=(0,k.geByClass1)("emoji_smile",t.controlsCont);return wi()?Si.shown?(Si.editableFocus(e,!1,!0,!1,!0),Si.hide()):Si.show(h):Si.shown?(Si.editableFocus(e,!1,!0,!1,!0),Si.ttClick(i,h,!0)):Si.ttClick(i,h,!1,!0,void 0,!0),(0,d.cancelEvent)(r)}if(r.keyCode==d.KEY.ESC){var v=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(t.txt)),w=!1;if(v&&(0,k.isVisible)(v)&&(Si.stickerHintKeyOut(i,(0,k.geByClass1)("emoji_sticker_item",v)),Si.stickersHintsHide(v,t,100),w=!0),Si.shown&&(Si.editableFocus(e,!1,!0,!1,!0),wi?Si.hide():Si.ttClick(i,(0,k.geByClass1)("emoji_smile",t.controlsCont),!0),w=!0),w)return(0,d.cancelEvent)(r);if(t.onEsc)return t.onEsc(r)}}return"paste"===r.type?(Si.onEditablePaste(e,t,i,r),t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),Si.checkStickersKeywords(i,t)):"keyup"===r.type?(!t.noLineBreaks||e.textContent||e.innerText||(0,g.each)((0,k.geByTag)("br",e),(function(e,t){(0,k.re)(t)})),t.checkEditable&&t.checkEditable(i,e),Si.checkStickersKeywords(i,t),t.onChange&&(Si.raw[i]!=e.innerHTML&&Si.onChange(t),delete Si.raw[i])):"keydown"!==r.type&&"input"!==r.type||(t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),Si.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(r),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(r),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,Si.lcRecv,!0),fi(),Si.initPromotedStickerUrls(),Si.checkNewStickers(t),Si.opts[Si.last]=t,Si.last++},setSuggestionsConfig:function(e,t){Si.opts[e].suggestions.setConfig(t)},onChange:function(e){(0,M.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){Si.preventMouseOver=!1},lcRecv:function(e){if("updateTabs"===e.act)Si.updateTabs(e.newStickers,e.keywords)},correctCaret:function(e){var t=e?function(e){var t=e.getBoundingClientRect(),i=null,r=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(r=document.selection.createRange()).getClientRects()||[]).length||(r.text="_",r.moveStart("character",-1),i=r.getClientRects(),r.text=""),i=i[i.length-1];else if(window.getSelection){var o=getSelection();if(o.anchorNode){if((r=o.getRangeAt(0)).collapsed){var n=r.startOffset;r.setStart(r.startContainer,0),i=r.getClientRects(),r.setStart(r.startContainer,n)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),r=(0,k.ce)("div",{innerHTML:i});Si.cleanCont(r),Si.insertHTML(r.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),r=(0,k.ce)("div",{innerHTML:i});Si.cleanCont(r),Si.insertHTML(r.innerHTML)}},focusTrick:function(e,t,i,r,o){o||(o=e);var n=(0,k.ce)("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(n),n.focus(),setTimeout((function(){var s=o.scrollTop;(0,k.re)(n),e.focus(),o.scrollTop=s,Si.setRange(r),t((0,g.clean)((0,k.val)(n))),i(e)}),0)},finalizeInsert:function(e){Si.cleanCont(e),setTimeout((()=>Si.correctCaret(e)),10)},getClipboard:function(e){return e.clipboardData?(0,g.clean)(e.clipboardData.getData("text")):!!window.clipboardData&&(0,g.clean)(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,r){if(null!=e.clipboardData){var o=function(){var o=e.clipboardData;function n(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var o=new Image;return o.crossOrigin="anonymous",o.onload=function(){var e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var r,o;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+(0,M.irand)(0,100)+".png",(0,k.hasClass)(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else r="post_field"==t.id?cur.wallAddMedia:(o=(0,k.data)(t,"composer"))&&o.addMedia;r&&(0,M.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,r,e)}(e)}),"image/png"),r(!0)},o.src=e}}if(o.items){var s=!1,a=o.types;if((0,p.partConfigEnabled)("emoji_disable_new_html_processing")||a.includes("Files")||a.includes("text/plain"))for(var c=0,l=o.items.length;c<l;c++){var _=o.items[c];if(_.type.match(/^image\//)&&"file"===_.kind){var d=new FileReader;d.onload=function(e){return n(e.target.result)},d.readAsDataURL(_.getAsFile()),s=!0}else if("text/plain"===_.type)return{v:r()}}else if(o.types.includes("text/html")){var u=(0,k.se)(`<div>${o.getData("text/html")}</div>`).querySelectorAll("img");s=u.length>0,u.forEach((e=>{n(e.src)}))}return{v:s}}if(-1!==Array.prototype.indexOf.call(o.types,"text/plain"))return{v:r()};!function(e){for(var i=Math.floor(1e3*Math.random()),o=(0,k.geByTag)("img",t),n=0,s=o.length;n<s;n++)o[n]["_before_paste_"+i]=!0;setTimeout((function(){for(var o=(0,k.geByTag)("img",t),n=!1,s=0,a=o.length;s<a;s++){var c=o[s];c["_before_paste_"+i]||(e(c.src),(0,k.re)(c),n=!0)}n||r()}),1)}((function(e){return n(e)}))}();if("object"==typeof o)return o.v}else r()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,r,o){var n=!1;"true"===e.getAttribute("contenteditable")&&(n=Si.getRange());var s=this.getClipboard(r),a=s&&n&&!o;this.detectInvalidClipboardData(r)&&(0,d.cancelEvent)(r),(this.processImagePaste(r,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(n,s):this.insertWithBr(n,s),setTimeout(this.finalizeInsert.bind(this,e),0)):n&&this.focusTrick(e,t.noLineBreaks?()=>this.insertWithoutNL(n):()=>this.insertWithBr(n),this.finalizeInsert.bind(this,e),n))}.bind(this))||a)&&(0,d.cancelEvent)(r),Si.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",Si.cleanCont(t);else if("IMG"==t.tagName)Si.getCode(t)||(0,k.re)(t);else if("BR"!=t.tagName){var o=Si.editableVal(t,{saveEmoji:!0}),n=(0,k.cf)((0,g.clean)(o).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var s=(0,g.clean)(t.textContent||t.innerText),a=(0,r.emojiRegex)();s&&s.match(a)&&(s=s.replace(a,m.emojiReplace),t.parentNode.replaceChild((0,k.cf)(s),t))}t=i}},focus:function(e,t,i){void 0===i&&(i=!1),Si.editableFocus(e,!1,!0);var r=i||e.parentNode;if(t){var o=(0,k.getXY)(r)[1],n=(0,_.scrollGetY)(),s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=(0,k.getSize)(r)[1];n+s<o+a?(0,_.scrollToY)(o-s+a+60,100):n>o&&(0,_.scrollToY)(o-60,100)}},destroy:function(e){var t=Si.opts[e];t&&(t.txt&&t.txt.blur(),e===Si.shownId&&(Si.shownId=!1,Si.shown=!1),delete Si.opts[e])},editableFocus:function(e,t,i,r,n){if(!e||n&&document.activeElement===e)return!1;if((e=(0,k.ge)(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var s=window.getSelection();if(!o.browser.opera||o.browser.chrome||i){var a=document.createRange();t?a.selectNode(t):a.selectNodeContents(e),o.browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),r||a.collapse(!i),(s=window.getSelection()).removeAllRanges(),s.addRange(a)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(t||e),c.collapse(!i),c.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return Si.editableVal(e);t=(t=(0,m.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,Si.updateStickersHints();var i=(0,k.data)(e,"composer");return i&&window.Composer&&setTimeout((()=>Composer.updateAutoComplete(i))),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return(0,k.val)(e);for(var i,r=e.firstChild,o="",n=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");r;){switch(r.nodeType){case 3:o+=i=r.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=Si.editableVal(r),r.tagName&&r.tagName.match(n)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var s=r.previousSibling;s&&3==s.nodeType&&""==(0,g.trim)(s.nodeValue);)s=s.previousSibling;!s||s.tagName&&(s.tagName.match(n)||"BR"==s.tagName)||(i="\n"+i)}else if("IMG"==r.tagName){var a=Si.getCode(r);a&&(t&&t.saveEmoji?i+=Si.getEmojiHTML(a):i+=Si.codeToChr(a))}else"BR"==r.tagName&&(i+="\n");o+=i}r=r.nextSibling}return o},cssEmoji:r.EMOJI_HINTS,getEmojiHTML:m.getEmojiHTML,codeToChr:u.emojiByteHexToSymbol,checkEditable:function(e,t,i){var r=t.scrollHeight,n=Si.opts[e];if(!n)return!1;n.scPaddings||(n.scPaddings=(0,g.intval)((0,k.getStyle)(t,"paddingTop"))+(0,g.intval)((0,k.getStyle)(t,"paddingBottom"))),r-=n.scPaddings;var s=n.tt;if(r>i.height+(o.browser.mozilla&&n.isChat?0:5)){if(!n.isSized){(0,k.setStyle)(t,{height:i.height+"px",overflowY:"auto"});var a=(0,k.geByClass1)("emoji_smile",n.controlsCont),c=(0,k.geByClass1)("emoji_smile_icon_promo",n.controlsCont),l=(0,k.ge)("im_upload"),_=(0,$.sbWidth)();n.ttWrap&&(_+=(0,k.getSize)(n.ttWrap)[0]-((0,k.getXY)(n.emojiBtn)[0]-(0,k.getXY)(n.ttWrap)[0])),(0,k.setStyle)(a,vk.rtl?{left:1+_}:{right:1+_}),c&&(0,k.setStyle)(c,vk.rtl?{left:2+_}:{right:2+_}),l&&(0,k.setStyle)(l.parentNode,vk.rtl?{left:1+_}:{right:1+_}),s&&(0,k.setStyle)(s,vk.rtl?{left:(n.ttDiff||31)+_}:{right:(n.ttDiff||31)+_}),n.isSized=!0}}else if(n.isSized){(0,k.setStyle)(t,{height:"auto",overflowY:"hidden"});var d=(0,k.geByClass1)("emoji_smile",n.controlsCont),u=(0,k.geByClass1)("emoji_smile_icon_promo",n.controlsCont),m=(0,k.ge)("im_upload");(0,k.setStyle)(d,vk.rtl?{left:1}:{right:1}),u&&(0,k.setStyle)(u,vk.rtl?{left:2}:{right:2}),m&&(0,k.setStyle)(m.parentNode,vk.rtl?{left:1}:{right:1}),s&&(0,k.setStyle)(s,vk.rtl?{left:n.ttDiff||31}:{right:n.ttDiff||31}),n.isSized=!1}n.onResize&&n.onResize()},stickersHintsShow:function(e,t,i){((0,k.isVisible)(e)||(0,l.fadeIn)(e,i),t.stickerEventsInited)||((e&&(0,k.geByClass1)("_sticker_hints_inner",e)).addEventListener("wheel",Si.onWheelStickersHints),(0,d.addEvent)(document,"keydown",Si.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},(0,d.addEvent)(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&((0,d.removeEvent)(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(r){if(t.hintsClicked)return(0,d.cancelEvent)(r),!0;Si.stickersHintsHide(e,t,i)},(0,d.addEvent)(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);Si.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){((0,l.fadeOut)(e,i),(0,d.removeEvent)(document,"keydown",Si.stickerHintMove),t.onHintsMouseDown&&(0,d.removeEvent)(e,"mousedown",Si.onHintsMouseDown),t.onHintsWheel)&&(e&&(0,k.geByClass1)("_sticker_hints_inner",e)).removeEventListener("wheel",Si.onWheelStickersHints);t.txt&&(t.onTxtBlur&&((0,d.removeEvent)(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&(0,d.removeEvent)(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(t.txt));e&&!(0,k.isVisible)(e)&&(delete t.stickerHintsString,Si.checkStickersKeywords(t.id,t,!1))},(0,d.addEvent)(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete Si.shownHintId,Si.sendHintsLog()},stickerHintOver:function(e){Si.stickerHintOut(e),(0,k.addClass)(e,"over")},stickerHintOut:function(e){(0,g.each)((0,k.geByClass)("over",(0,k.domPN)(e)),(function(){(0,k.removeClass)(this,"over")}))},stickerHintClick:function(e,t,i,r){var o=Si.opts[e]||{},n=o.txt,s=n&&(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(n)),a="suggestion_"+Si.stickerSuggestionQuery;return"stories"===o.ref&&(a="story_suggestion_"+Si.stickerSuggestionQuery),t<0?Si.previewSticker(!1,r,{stickerId:-t,sticker_referrer:a}):((0,k.val)(n,""),Si.stickerClick(e,t,null,a),o.checkEditable&&o.checkEditable(e,n)),Si.stickersHintsHide(s,o,0),!1},stickerHintKeyOver:function(e,t){Si.stickerHintOver(t),Si.shownHintId=e},stickerHintKeyOut:function(e,t){Si.stickerHintOut(t),delete Si.shownHintId},stickerHintMove:function(e){var t=Si.shownHintId;if(void 0===t)return!0;var i=Si.opts[t],r=i&&(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(i.txt));if(r&&(0,k.isVisible)(r)){var o=(0,k.geByClass1)("over",r)||(0,k.geByClass1)("emoji_sticker_item",r);switch(e.keyCode){case d.KEY.LEFT:return(o=(0,k.domPS)(o))&&(Si.stickerHintOver(o),Si.checkStickersHintsScroll(o)),(0,d.cancelEvent)(e),!1;case d.KEY.RIGHT:return(o=(0,k.domNS)(o))&&(Si.stickerHintOver(o),Si.checkStickersHintsScroll(o)),(0,d.cancelEvent)(e),!1;case d.KEY.ENTER:return o.click(),(0,d.cancelEvent)(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&((0,k.addClass)(e,"_margin_transition"),(0,k.removeClassDelayed)(e,"_margin_transition")),(0,k.setStyle)(e,{marginLeft:0});var r=(0,k.getXY)(e),o=(0,k.getSize)(e),n=Si.getEmojiTtXY(t.tt);t.tt&&n&&n[0]&&r[0]+o[0]+10>n[0]&&r[1]+o[1]>n[1]&&(0,k.setStyle)(e,{marginLeft:n[0]-r[0]-o[0]-10}),(0,k.domFC)(e)||Si.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&(0,k.hasClass)(e,Si.SHOWN_TT_CLS)?(0,k.getXY)(e):[0,0]},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,i){if((0,p.partConfigEnabled)("hintach"))return Si.hintachCache[e]?requestAnimationFrame((()=>Si.renderHintach(e,t,i,Si.hintachCache[e]))):void ajax.post("/hintach",{query:e},{onDone:r=>{Si.hintachCache[e]=r,Si.renderHintach(e,t,i,Si.hintachCache[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var r=Si.opts[i]||{},o=r.txt,n=o&&(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(o)),s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],r=parseInt(t[2]),o=parseInt(t[3]),n=[r,o].join("_");return{type:i,ownerId:r,id:o,rawId:n}}(t);return s&&r.onHintachSend&&((0,k.val)(o,""),r.onHintachSend(s.type,s.rawId),r.checkEditable&&r.checkEditable(i,o),Si.stickersHintsHide(n,r,0)),!1}},renderHintach:function(e,t,i,r){var o=t.txt,n=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(o)),s=(0,M.isArray)(r.photos)&&r.photos.length||(0,M.isArray)(r.docs)&&r.docs.length;if(e&&t.stickerHintsString&&s){var a=n&&(0,k.geByClass1)("_sticker_hints_inner",n);if(!a||t.noStickers)return!1;Si.clearHintsLog(),Si.hintachNotFoundStickers[e]&&(a.innerHTML="");var c=a.querySelector(".Hintach");c||(c=a.appendChild((0,k.ce)("div",{className:"Hintach"}))),c.setAttribute("data-opt",t.id),c.innerHTML="";var l=64*window.devicePixelRatio,_=64*window.devicePixelRatio;(r.photos||[]).forEach((e=>{var t=function(e,t,i){if(!e||!t||!i)return null;var r=Object.values(e).sort(((e,t)=>e[1]-t[1]||e[2]-t[2]));return r.find((e=>e[1]>=t&&e[2]>=i))||r[parseInt(r.length/2)]||r[0]}(e.sizes,l,_);if(t){var i=t[0],r=v(t[1],t[2]),o=r[0],n=r[1],s=(0,k.ce)("div",{className:"Hintach__item Hintach__item--photo"});s.setAttribute("data-hint","photo"+e.id),s.appendChild((0,k.ce)("div",{className:"Hintach__itemThumb"},{width:o,height:n,backgroundImage:`url(${i})`})),s.onclick=Si.onHintachItemClick,c.appendChild(s)}})),(r.docs||[]).forEach((e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=e.preview.video||e.preview.graffiti,i=t[0],r=v(t[1],t[2]),o=r[0],n=r[1],s=(0,k.ce)("div",{className:"Hintach__item Hintach__item--doc"});s.setAttribute("data-hint","doc"+e.id);var a=s.appendChild((0,k.ce)(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:o,height:n}));e.preview.video&&(s.appendChild((0,k.ce)("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),s.onclick=Si.onHintachItemClick,c.appendChild(s)}})),c.childElementCount>0&&(Si.stickersHintsShow(n,t,100),a.scrollLeft=0,Si.checkStickersHintsScroll(n,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var r=Si.opts[e],o=r.txt.parentNode.querySelector("._sticker_hints");if(Si.stickersHintsHide(o,r,0),"send"===t&&r.suggestions.isMoneySendEnabled()||"request"===t&&r.suggestions.isMoneyRequestEnabled()){var n=r.suggestions.config,a=n.fromId,c=n.peer;R.onClick(a,c,t,i,{onSendStart:()=>{r.clearText&&r.clearText()}});var l=Si.moneyTransferTextMatch&&Si.moneyTransferTextMatch.input||"";(0,s.statlogsValueEvent)("stickers_money_transfer_suggestions","select",[t],l)}},renderMoneyTransferSuggestions:function(e,t){var i=Si.opts[e],r=(0,g.isRetina)()?128:64,o={};return i.suggestions.isMoneyRequestEnabled()?o.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${r}.png" />\n      </a>`:o.request="",i.suggestions.isMoneySendEnabled()?o.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${r}.png" />\n      </a>`:o.send="",t.request?o.request+o.send:o.send+o.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var r=i?0:100,o=t.txt,n=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(o)),s=function(i,r){if(Si.stickers[Si.TAB_RECENT_STICKERS]){var o=Si.sortStickersHints(window.stickersKeywords[i]),s=Si.stickers[Si.TAB_RECENT_STICKERS].promoted,a="";r&&(a+=Si.renderMoneyTransferSuggestions(e,r)),(0,g.each)(o,(function(){a+=Si.render.stickerHintRs(e,this,s[this])})),t.suggestions.isBotLinkEnabled()&&(a+=Si.renderSuggestionsBotLink(e)),Si.showStickersHints(n,t,a)}},a=function(){var a=t.suggestions.getQueries(Si.val(o));if(a.length){var c=a[0],l=t.suggestions.isMoneyTransferEnabled()&&R.match(c,1);if(l&&(a=[R.DEFAULT_QUERY]),Si.moneyTransferTextMatch=l,!n&&!(n=Si.initStickersHints(o)))return!1;if(c!=t.stickerHintsString){var _=a.find((e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length||l));if(Si.stickerSuggestionQuery=_,_)if(Si.stickers[Si.TAB_RECENT_STICKERS])s(_,l);else{var d=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){d&&d(),e&&(d?t.onRecentEmojiUpdate=d:delete t.onRecentEmojiUpdate,s(_,l))},Si.emojiLoadMore(e)}else Si.hintachNotFoundStickers[c]=!0,Si.stickersHintsHide(n,t,r);!l&&c&&c.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout((()=>{Si.checkHintach(c,t,i)}),160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,n&&(0,k.isVisible)(n)?0:200))},showStickersHints:function(e,t,i){var r=e&&(0,k.geByClass1)("_sticker_hints_inner",e);if(!r||t.noStickers)return!1;Si.clearHintsLog(),(0,k.val)(r,i),Si.stickersHintsShow(e,t,100),r.scrollLeft=0,Si.checkStickersHintsScroll(e,r.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=(0,k.domClosest)("_sticker_hints",e),r=i&&(0,k.geByClass1)("_sticker_hints_inner",i),o=i&&(0,k.geByClass1)("_sticker_left",i),n=i&&(0,k.geByClass1)("_sticker_right",i);if(!r)return!1;var a=(0,k.getSize)(o)[0],c=(0,k.getSize)(n)[0];if((0,k.hasClass)(e,"emoji_sticker_item")){var l=e.offsetLeft-8-a,_=e.offsetLeft+(0,k.getSize)(e)[1]+2+c-r.clientWidth;r.scrollLeft>l&&(r.scrollLeft=l),r.scrollLeft<_&&(r.scrollLeft=_),t=r.scrollLeft}var d=t>0,u=t+r.clientWidth<r.scrollWidth;(0,k.toggle)(o,d),(0,k.toggleClass)(i,"sticker_hints_left_pad",d),(0,k.toggle)(n,u),(0,k.toggleClass)(i,"sticker_hints_right_pad",u),t=void 0===t?r.scrollLeft:t;var m=r.querySelectorAll(".emoji_sticker_item"),f=d?a+8:0,h=u?c+2:0,v=Array.from(m).filter((e=>e.offsetLeft-f>=t&&e.offsetLeft+e.offsetWidth+h-r.clientWidth<=t));Si.logHints(v.map((e=>(0,g.intval)(e.getAttribute("data-sticker-id")))).filter((e=>e)));var p=v.map((e=>e.getAttribute("data-money-transfer-type"))).filter((e=>e));if(p.length){var w=Si.moneyTransferTextMatch&&Si.moneyTransferTextMatch.input||"";(0,s.statlogsValueEvent)("stickers_money_transfer_suggestions","show",p,w)}},logHints:function(e){Si.logHintsTimeout&&clearTimeout(Si.logHintsTimeout),Si.logHintsTimeout=setTimeout((()=>{Si.hintsLogBuffer=e.reduce(((e,t)=>(e[t]=1,e)),Si.hintsLogBuffer||{})}),Si.logHintsDelay)},clearHintsLog:function(){Si.logHintsTimeout&&clearTimeout(Si.logHintsTimeout),Si.hintsLogBuffer={}},sendHintsLog:function(){var e=Si.hintsLogBuffer&&Object.keys(Si.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),Si.clearHintsLog()},scrollStickersHints:function(e,t,i){var r=(0,k.domClosest)("_sticker_hints",e),o=r&&(0,k.geByClass1)("_sticker_hints_inner",r),n=r&&(0,k.geByClass1)("_sticker_left",r),s=r&&(0,k.geByClass1)("_sticker_right",r);if(!o)return!1;var a=o.scrollLeft+t*(o.clientWidth-2*(0,k.getSize)(e)[0]),c=(0,k.geByClass)("emoji_sticker_item",o);(0,g.each)(c,(function(e,i){return t>0&&i.offsetLeft-8-(0,k.getSize)(n)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-(0,k.getSize)(n)[0]||a,!1):t<0&&i.offsetLeft+(0,k.getSize)(i)[1]+2+(0,k.getSize)(s)[0]-o.clientWidth>a?(a=i.offsetLeft+(0,k.getSize)(i)[1]+2+(0,k.getSize)(s)[0]-o.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(o.scrollWidth-o.clientWidth,a)),(0,l.animate)(o,{scrollLeft:a},{duration:Math.abs(o.scrollLeft-a)+50,transition:l.Fx.Transitions.easeOutCubic}),Si.checkStickersHintsScroll(o,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,Si.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];Si.stickers[-1]&&(t=Si.stickers[-1].stickers);var i={},r=[];return(0,g.each)(t,(function(){(0,g.inArray)(this[0],e)&&!i[this[0]]&&(r.push(this[0]),i[this[0]]=1)})),(0,g.each)(e,(function(){i[this]||r.push(this)})),r},initStickersHints:function(e){return!!e&&(0,k.domPN)(e).insertBefore((0,k.se)('<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.88 18.12a1.25 1.25 0 0 1-1.76 1.76l-7-7a1.25 1.25 0 0 1 0-1.76l7-7a1.25 1.25 0 0 1 1.76 1.76L9.77 12z" fill="currentColor"/></svg>\n      </div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.23 12 8.12 5.88a1.25 1.25 0 1 1 1.76-1.76l7 7c.5.48.5 1.28 0 1.76l-7 7a1.25 1.25 0 0 1-1.76-1.76z" fill="currentColor"/></svg>\n      </div>\n    </div>'),e)},updateStickersHints:function(e){Si.opts&&(0,g.each)(Si.opts,(function(t,i){e&&delete i.stickerHintsString,Si.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){var t=Si.opts[e].suggestions,i=(0,g.isRetina)()?128:64,r=Ve.colorScheme.isDarkScheme()?"dark":"light";return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i,r)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=Si.opts[t].suggestions;(0,s.statlogsValueEvent)(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>(0,M.vkNow)()-Si.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:(0,M.vkNow)(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},emojiEnter:function(e,t){var i=Si.opts[e],r=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(r?!(t.ctrlKey||o.browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var n=(0,k.geByTag1)("img",i.emojiOvered)||(0,k.geByTag1)("i",i.emojiOvered);Si.addEmoji(e,Si.getCode(n),i.emojiOvered)}return(0,d.cancelEvent)(t)}return!0},insertHTML:function(e){if(o.browser.msie&&parseInt(o.browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),r=document.createElement("span");i.surroundContents(r),r.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,i){if(!1===e||!1===t)return!1;var r=Si.opts[e];if(!((0,M.vkNow)()-r.ttShowT<Si.CLICK_DELAY)){if(r.editable){var n=Si.getEmojiHTML(t,Si.codeToChr(t),!0),s=r.txt,a=!!window.getSelection&&window.getSelection(),c=!1;if(a&&a.rangeCount){var l=a.getRangeAt(0);c=l.commonAncestorContainer?l.commonAncestorContainer:l.parentElement?l.parentElement():l.item(0)}for(var _=c;_&&_!=s;)_=_.parentNode;var d=s.lastChild||{};o.browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&(0,k.re)(s.lastChild),_||Si.editableFocus(s,!1,!0),Si.insertHTML(n);var u=(0,k.geByClass)("emoji",s);for(var m in u.push.apply(u,(0,k.geByClass)("emoji_css",s)),u)if(u.hasOwnProperty(m)){var f=u[m].previousSibling;if(f&&3==f.nodeType&&f.textContent&&32==f.textContent.charCodeAt(0)){var h=f.previousSibling;h&&3==h.nodeType&&h.textContent&&160==h.textContent.charCodeAt(h.textContent.length-1)&&(0,k.re)(f)}}s.check&&s.check(),setTimeout((()=>Si.correctCaret(s)),5),Si.onChange(r);var v=(0,k.data)(s,"composer");v&&window.Composer&&Composer.updateAutoComplete(v)}else{var p,g,w,S=r.txt,E=S.value;p=o.browser.iphone||o.browser.ipad?Si.codeToChr(t):Si.cssEmoji[t][1]+" ",null!=S.selectionStart&&null!=S.selectionEnd?(g=S.selectionEnd,S.value=E.slice(0,S.selectionStart)+p+E.slice(g),S.selectionStart=S.selectionEnd=g+p.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(S.focus(),(w=document.selection.createRange()).text=p,w.select())}r.checkEditable&&r.checkEditable(e,r.txt),Si.checkStickersKeywords(e,r),r.saveDraft&&r.saveDraft(),r.onEmojiAdded&&r.onEmojiAdded(),Si.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(o.browser.msie&&o.browser.version<10)},scrollTabsTo(e,t,i){void 0===i&&(i=!1);var r=Si.opts[e];if(r.tt){var o=r.tt.querySelector(".emoji_tabs_wrap"),n=o.querySelector(".emoji_tabs_cont"),s=n.getBoundingClientRect().width-o.getBoundingClientRect().width,a=Math.max(0,Math.min(t,s));o.parentNode.classList.toggle("emoji_tabs--scrollable-left",a>0),o.parentNode.classList.toggle("emoji_tabs--scrollable-right",a<s),n.classList.toggle("emoji_tabs_cont--no-transition",i),n.style.setProperty("--scroll-left",-a+"px"),r.tabsScrollLeft=a,Si.vmojiTooltipCheckVisibilityByScroll(a,r.tt,e)}},scrollTabsBy(e,t,i){void 0===i&&(i=!1);var r=Si.opts[e].tabsScrollLeft,o=void 0===r?0:r;Si.scrollTabsTo(e,o+t,i)},throwTabsScroll(e){Si.scrollTabsBy(e,0,!0)},scrollTabsLeft(e){Si.destroyVmojiOnboardingTooltip(),Si.scrollTabsBy(e,-170)},scrollTabsRight(e){Si.scrollTabsBy(e,170)},tabsWheel:function(e,t){(0,d.cancelEvent)(e);var i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;Si.scrollTabsBy(t,i,!0)},scrollToTab:function(e,t){var i=Si.opts[t].tt.querySelector(`.emoji_tab_${e}`);if(i){var r=i.getBoundingClientRect(),o=i.closest(".emoji_tabs_cont").getBoundingClientRect(),n=i.closest(".emoji_tabs_wrap").getBoundingClientRect(),s=r.left-o.left-(n.width-r.width)/2;Si.scrollTabsTo(t,s),Si.selectTab(t,e,i)}},selectTab:function(e,t,i){var r,o=Si.opts[e];if(void 0===i&&(i=(0,k.geByClass1)("emoji_tab_"+t,o.tt)),void 0!==i){var n=i.closest(".emoji_tabs");null==(r=n.querySelector(".emoji_tab_sel"))||r.classList.remove("emoji_tab_sel"),i.classList.add("emoji_tab_sel"),o.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t);var s=i.closest(".emoji_tabs_group");s&&(s.classList.add("emoji_tabs_group--expanded"),s.style.setProperty("--width",s.scrollWidth+"px")),n.querySelectorAll(".emoji_tabs_group").forEach((e=>{e!==s&&e.classList.remove("emoji_tabs_group--expanded")}))}},show:function(e,t){wi()?window.stManager.add([window.jsc("web/sticker_picker.js"),"sticker_picker.css"],(()=>{var t;null==(t=window.StickerPicker)||t.show(e),Si.shown=!0})):Si.showOldPicker(e,t)},showOldPicker:function(e,t){var i=(0,k.data)((0,k.domPN)(e),"optId");void 0!==i&&Si.ttShow(i,e,t)},hide:function(e,t,i){var r;if(wi())return null==(r=window.StickerPicker)||r.hide(),void(Si.shown=!1);Si.hideOldPicker(e,t,i)},hideOldPicker:function(e,t,i){var r=(0,k.data)((0,k.domPN)(e),"optId");void 0!==r&&Si.ttHide(r,e,t,i)},ttShow:function(e,t,i){var r=Si.opts[e];clearTimeout(r.ctt),clearTimeout(r.stt),r.scrolling&&(r.afterScrollFn=!1),r.ttShown||(t?r.obj=t:t=r.obj,r.stt=setTimeout((function(){Si.ttClick(e,t,!1,!0,i)}),Si.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,r){var o=Si.opts[e];if(clearTimeout(o.stt),o.ttShown)if(o.scrolling)o.afterScrollFn=()=>Si.ttHide(e,t,i,r);else{t=t||o.obj||(0,k.geByClass1)("emoji_smile",o.controlsCont);var n=function(){Si.ttClick(e,t,!0,!1,i)};r?n():(clearTimeout(o.ctt),o.ctt=setTimeout(n,Si.HIDE_TT_TIMEOUT))}},isVmojiStubIconVisibile(e){var t=e.querySelector(".emoji_tabs_wrap"),i=e.querySelector(".emoji_tab--vmoji-stub");if(i&&t){var r=t.getBoundingClientRect(),o=i.getBoundingClientRect();return r.x<o.x}},destroyVmojiOnboardingTooltip(){Si.vmojiOnboardingTooltipTimer&&(clearTimeout(Si.vmojiOnboardingTooltipTimer),Si.vmojiOnboardingTooltipTimer=null),Si.vmojiOnboardingTooltip&&(Si.vmojiOnboardingTooltip.destroy&&Si.vmojiOnboardingTooltip.destroy(),Si.vmojiOnboardingTooltip=null);var e=document.querySelector(".emoji_tab--vmoji-stub");e&&e.removeEventListener("click",Si.vmojiOnboardingToltipSendHideRequest)},buildVmojiOnboardingTooltip(e,t){if(!Si.vmojiOnboardingTooltipWasDone){var i=Si.stickers[Si.TAB_VMOJI]&&Si.stickers[Si.TAB_VMOJI].vmoji_tooltip_info;if(e&&i){var r=e.querySelector(".emoji_tab--vmoji-stub");r&&(Si.vmojiOnboardingTooltipTimer||(Si.vmojiOnboardingTooltipTimer=setTimeout((()=>{var o;Si.vmojiOnboardingTooltipTimer=null,Si.vmojiOnboardingTooltip=new ci.default(r,{content:i.content,autoShow:!1,width:"auto",forceSide:"top",appendTo:e,withCloseButton:!0,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!0,cls:"EmojiTab__onboardingTooltip",delay:0,onClick:function(e){e.stopPropagation(),Si.vmojiOnboardingToltipSendHideRequest(),Si.tabSwitch(Si.TAB_VMOJI,Si.TAB_VMOJI,t)}}),Si.vmojiOnboardingTooltip.show&&Si.vmojiOnboardingTooltip.show(),r.addEventListener("click",Si.vmojiOnboardingToltipSendHideRequest,!0),null==(o=window.cur.destroy)||o.push(Si.destroyVmojiOnboardingTooltip)}),500)))}}},vmojiTooltipCheckVisibilityByScroll(e,t,i){0===e?Si.buildVmojiOnboardingTooltip(t,i):Si.destroyVmojiOnboardingTooltip()},vmojiOnboardingToltipSendHideRequest(){var e=Si.stickers[Si.TAB_VMOJI]&&Si.stickers[Si.TAB_VMOJI].vmoji_tooltip_info;if(e&&!Si.vmojiOnboardingTooltipWasDone){var t=e.vmojiOnboardingHintHash,i=e.vmojiOnboardingHintId;window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t,hint_id:i}),Si.vmojiOnboardingTooltipWasDone=!0,Si.destroyVmojiOnboardingTooltip()}},ttClick:function(e,t,i,r,n,s){var a=Si.opts[e];if(a&&!(i&&!Si.shown||r&&Si.shown)&&(t||(t=Si.shown||(0,k.ge)(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!a.tt&&a.sharedTT&&a.sharedTT.emojiTT&&(a.tt=a.sharedTT.emojiTT,a.emojiScroll=a.sharedTT.emojiScroll,a.allEmojiId=a.sharedTT.emojiAllId);var c,l=a.tt;if(!l){var _=Si.getPrevTab(a.noStickers);a.curTab=cur.stickersTab=_,_==Si.TAB_EMOJI||a.noStickers||(Si.stickers[Si.TAB_RECENT_STICKERS]=ls.get("recent_stickers"));var u='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabsLeft('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabsRight('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';u+=Si.getTabsCode([[0,1]],e),u+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',a.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(u+=Si.getTabsCode(window.emojiStickers,e));var m="",f='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',h="showTooltip(this, {text: '"+(0,q.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";a.rPointer?f+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+h+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':f+=' onmouseover="'+h+'"',u+="</span></span>",a.noStickers||(u+='<a class="emoji_shop" '+f+'><div class="emoji_sprite emoji_shop_icon">'+(Si.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(Si.hasNewStickers)+"</div>":"")+"</div></a>"),Si.showShadow()||(m+=" emoji_no_opacity"),a.noStickers&&(m+=" emoji_no_tabs"),l=(0,k.ce)("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+m,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs">'+u+"</div></div>",onmouseenter:function(t){(0,k.hasClass)(l,"emoji_animated")||Si.ttShow(e,!1,t)},onmouseleave:function(t){(0,k.hasClass)(l,"emoji_animated")||Si.ttHide(e,!1,t)}}),a.tt=l,Si.reappendEmoji(e,l),Si.emojiOver(e,(0,k.geByClass1)("emoji_scroll_smiles",l).firstChild),(0,g.each)(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){(0,d.addEvent)((0,k.geByClass1)(this,a.tt),"DOMMouseScroll wheel",(function(t){Si.tabsWheel(t,e)}))})),a.sharedTT&&(a.sharedTT.emojiTT=l),Si.throwTabsScroll(e)}if(!1!==Si.shownId&&Si.shownId!=e&&Si.ttClick(Si.shownId,(0,k.geByClass1)("emoji_smile",Si.opts[Si.shownId].controlsCont),!0),Si.preventMouseOver=!1,a.emojiExpanded||Si.emojiUIScroll(e,l),Si.shown)Si.hideTt(l),(c=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(a.txt)))&&(0,k.isVisible)(c)&&Si.checkStickersHintsSize(c,a,!0),Si.shown=!1,Si.shownId=!1,a.ttShown=!1,a.emojiFocused=!1,a.emojiOvered=!1,cur.onMouseClick=!1,(0,d.removeEvent)(document,"keydown",Si.emojiMove),(0,k.removeClass)(t,"emoji_smile_on"),a.onHide&&a.onHide(),Si.destroyVmojiOnboardingTooltip();else{if(!(0,k.getXY)(a.emojiBtn)[0]||!(0,k.getXY)(a.emojiBtn)[1])return;a.openedByTabKey=!!s,Si.showTt(l),Si.buildVmojiOnboardingTooltip(l,e),Si.repositionEmoji(e,t,l),(c=(0,k.geByClass1)("_sticker_hints",(0,k.domPN)(a.txt)))&&(0,k.isVisible)(c)&&Si.checkStickersHintsSize(c,a,!0),Si.shownId=e,Si.shown=t,cur.emojiList=(0,k.geByClass1)("emoji_list",l),a.ttShown=!0,a.ttShowT=(0,M.vkNow)(),a.emojiFocused=!0,(0,d.removeEvent)(document,"keydown",Si.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||(0,k.hasClass)(i,"emoji_tt_wrap")||(0,k.hasClass)(i,"imw_emoji_wrap"))return!1;i=i.parentNode}Si.ttClick(e,!1,!0)},(0,d.addEvent)(document,"keydown",Si.emojiMove)}),0),(0,k.addClass)(t,"emoji_smile_on"),a.emojiScroll&&a.emojiExpanded&&(a.emojiScroll.update(),o.browser.msie&&0===a.curTab&&a.emojiOvered&&Si.scrollToListEl(e,a.emojiOvered)),a.currentPeerId=void 0,window.emojiStickers&&Si.resetStickerPackViews(e),Si.tabSwitch(a.curTab,a.curTab,e,!1,!0),a.onRecentEmojiUpdate&&a.onRecentEmojiUpdate(!0),a.onShow&&a.onShow(),a.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return Si.hideStickersStoreNotification(),Si.noNewStickers=!0,a.noStickersStore?(0,k.addClass)((0,k.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):(0,k.removeClass)((0,k.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),(0,d.cancelEvent)(n)}},getPrevTab:e=>e?Si.TAB_EMOJI:ls.get("stickers_tab")||Si.TAB_EMOJI,curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId(e){var t=Si.opts[e];if(window.curFastChat){var i=window.curFastChat.activeBox;if(i&&i.content&&i.content.compareDocumentPosition(t.emojiBtn)&Node.DOCUMENT_POSITION_CONTAINED_BY)return window.curFastChat.peer}return cur.peer},getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!(0,X.isUserPeer)(e))return Promise.resolve(null);var t=new Promise(((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}})));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e,t,i){void 0===t&&(t={});var r=Si.opts[e];r.emojiMoreSt||(r.emojiMoreSt=1,Si.emojiFetchMore(t).then((t=>{var o=t.stickers,n=t.recentEmoji;Si.updateEmojiList(o,n,e,r),(0,M.isFunction)(i)&&i()}),(e=>{console.error("Emoji.emojiLoadMore error ",e),r.emojiMoreSt=0})),Si.curEmojiRecent&&r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate())},emojiFetchMore(e){void 0===e&&(e={}),e.act="get_emoji_list",Si.stickerPacksToLoad&&(e.sticker_packs_to_load=Si.stickerPacksToLoad.join(",")),Si.hasNewStickers<0&&(e.new_shown=1);var t=Object.assign(e.sizes||{},Si.stickerSizes);return e.sizes=t&&Object.keys(t).join(","),new Promise(((t,i)=>{ajax.post("al_im.php",e,{onDone:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];t(i)},onFail:function(e){return i(e),!0}})})).then((e=>{var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5];if(Si.buildStickersIndex(i),void 0!==i[Si.TAB_FAVORITE_STICKERS]){var c=i[Si.TAB_FAVORITE_STICKERS];Si.tabDefaultId=Si.TAB_FAVORITE_STICKERS,Si.favoriteAvailable=!0,Si.favoriteRemindOn=!!c.remind_on,Si.favoriteRemindOff=!!c.remind_off,Si.favoriteLimit=c.limit,Si.favoriteLimitNoticed=c.limit_noticed,Si.sendHintsLogHash=s,R.setIntroViewed(a)}n&&(0,g.extend)(cur.lang,n),Object.assign(Si.stickerSizes,t);var l=[];return void 0!==Object.values(i).find((e=>e.vmoji_character_id))&&l.push(window.jsc("web/vmoji.js")),o&&l.push(window.jsc("web/stickers.js")),window.stManager.add(l).then((()=>({stickers:i,recentEmoji:r})))}))},emojiPreloadMore(e,t){Si.isStickersPreloading||(Si.isStickersPreloading=!0,Si.emojiFetchMore(e).then((e=>{var i=e.stickers,r=e.recentEmoji;Si.stickers=i,Si.stickers[Si.TAB_RECENT_STICKERS]&&ls.set("recent_stickers",Si.stickers[Si.TAB_RECENT_STICKERS]);var o=Si.emojiGetRecentFromStorage();o?Si.curEmojiRecent=Si.filterEmoji(o):Si.emojiOldRecentPrepare(r),t&&t()}),(e=>{console.error("Emoji.emojiPreloadMore error ",e)})).finally((()=>{Si.isStickersPreloading=!1})))},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var r=e[i].stickers,o=r.length;o--;){var n=r[o];t[n[0]]={sticker:n,packId:i}}Si.stickersById=t},updateEmojiList:function(e,t,i,r){Si.stickers=e,r.emojiMoreSt=0,Si.stickers[-1]&&(ls.set("recent_stickers",Si.stickers[-1]),Si.updateRecentEmoji(i)),r.allEmojiId=0,r.sharedTT&&(r.sharedTT.emojiAllId=0),Si.onStickersLoad&&(r.afterLoad=1),Si.onStickersLoad&&window.emojiStickers&&(Si.onStickersLoad(),Si.onStickersLoad=!1);var o=Si.emojiGetRecentFromStorage();o?Si.curEmojiRecent=Si.filterEmoji(o):(Si.emojiOldRecentPrepare(t,i),Si.updateEmojiCont(i)),Si.updateRecentEmoji(i),r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in h)if(h.hasOwnProperty(i))for(var r in h[i])if(h[i].hasOwnProperty(r)){var o=h[i][r],n=t.indexOf(o);if(-1!=n&&(t.splice(n,1),0==t.length))break e}var s={};for(var a in e)e.hasOwnProperty(a)&&-1==t.indexOf(a)&&(s[a]=e[a]);return t.length>0&&Si.setRecentEmojiList(s),s},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],o=void 0,n=void 0;(0,M.isString)(r)?(o=1,n=r):(o=r,n=i),t[n]=o}Si.setRecentEmojiList(Si.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in Si.curEmojiRecent)if(Si.curEmojiRecent.hasOwnProperty(t)){var i=Si.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(e[o][0]);return r.slice(0,20)},incrRecentEmojiRate:function(e,t){Si.emojiRecentRateTime||(Si.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-Si.emojiRecentRateTime;if(i>=6){var r=Math.min(100,Math.floor(i/6));for(var o in Si.curEmojiRecent)if(Si.curEmojiRecent.hasOwnProperty(o)){if(o==t)continue;Si.curEmojiRecent[o]*=Math.pow(.998076,r)}Si.emojiRecentRateTime+=6*r}Si.curEmojiRecent[t]||(Si.curEmojiRecent[t]=0),Si.curEmojiRecent[t]+=1;var n=Si.getRecentEmojiSorted();h[-1]=n,n.length>=20&&-1==n.indexOf(t)&&(n.splice(-1),n.push(t));var s={};for(var a in n)if(n.hasOwnProperty(a)){var c=n[a];s[c]=Si.curEmojiRecent[c]}Si.setRecentEmojiList(s),window.Notifier&&Notifier.lcSend("recent_emoji_set",s)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),Si.curEmojiRecent=e},updateEmojiCont:function(e){var t=Si.opts[e];t&&0==t.curTab&&((0,k.val)((0,k.geByClass1)("emoji_scroll_smiles",t.tt),Si.getInitEmojiContent(e)),Si.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",r=Si.emojiGetRecentFromStorage();r&&Si.setRecentEmojiList(r),h[-1]=Si.getRecentEmojiSorted();var o=t||Si.SORTED_EMOJI_SECTIONS_CODES;for(var n in o)if(o.hasOwnProperty(n)){var s=o[n];i+=Si.getEmojiCategoryHtml(e,s)}return i},getInitEmojiContent:function(e){Si.setEmojiLastAddedCategoryIdx(e,1);return Si.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",r=h[t];if(!r.length)return i;var o=-1==t?"recent":t,n='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+(0,q.getLang)("global_emoji_cat_"+o)+"</div></div>";return i+=n+=Si.emojiGetCatCont(e,r)},getEmojiLastAddedCategoryIdx:function(e){return Si.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){Si.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=Si.opts[e],i=t.tt,r=Si.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,r){var o=(0,k.geByClass1)("emoji_scroll_smiles",i);if(r++,Si.SORTED_EMOJI_SECTIONS_CODES.length>r){var s=Si.SORTED_EMOJI_SECTIONS_CODES[r];o.insertAdjacentHTML("beforeEnd",Si.getEmojiCategoryHtml(e,s)),Si.setEmojiLastAddedCategoryIdx(e,r),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else(0,n.debugLog)("No emoji last category idx")},hideTt:function(e){(0,k.removeClass)(e,Si.SHOWN_TT_CLS)},showTt:function(e){(0,k.addClass)(e,Si.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",r="",o=t.length-1,n=0;n<=o;n++)r+=Si.emojiWrapItem(e,t[n],n),(n>0&&n%10==9||n>=o)&&(i+='<div class="emoji_smiles_row">'+r+"</div>",r="");return i},updateRecentEmoji:function(e){var t=Si.getRecentEmojiSorted(),i=Si.emojiGetCatCont(e,t),r=(0,k.ge)("emoji_recent_list"+e+"_-1");if(r){for(var o=r.nextSibling;o&&(o=o.nextSibling,(0,k.hasClass)(o.previousSibling,"emoji_smiles_row"));)(0,k.re)(o.previousSibling);for(var n=(0,k.ce)("div",{innerHTML:i}),s=r.nextSibling,a=r.parentNode;o=n.firstChild;)a.insertBefore(o,s)}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,r=i.length;r--;)if(String(i[r][0])===String(t))return r;return-1},findSticker:function(e,t){var i=Si.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return Si.findStickerIndex(Si.stickers[Si.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return Si.findSticker(Si.stickers[Si.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return Si.findStickerIndex(Si.stickers[Si.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return Si.findSticker(Si.stickers[Si.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(Si.stickersById&&Si.stickersById.hasOwnProperty(e))return Si.stickersById[e].sticker},isStickersLoaded:function(){if(Si.stickers)for(var e in Si.stickers)if(Si.stickers.hasOwnProperty(e)&&e!==String(Si.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i,r,o=Si.TAB_FAVORITE_STICKERS,n="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+o;return cur.stickersTab===o&&(n+=" emoji_tab_sel"),Si.isStickersLoaded()?(0!==t&&0!==(null==(i=Si.stickers[o])||null==(r=i.stickers)?void 0:r.length)||(n+=" unshown"),'<a class="'+n+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'):""}},favorite:{reminder:function(e){var t=(0,k.hasClass)(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!Si[i]){var r={text:function(){return(0,q.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},o=(0,k.domClosest)("ui_scroll_container",e);r.appendEl=o;var n=(0,k.domClosest)("ui_scroll_overflow",e),s=(0,k.getXYRect)(e),a=(0,k.getXYRect)(n),c=s.top-a.top,l=(a.right,s.right,a.bottom-s.bottom),_=s.left-a.left,d=(a.width||a.right-a.left)/2;(!vk.rtl&&_>d||vk.rtl&&_<d)&&(r.needLeft=!0,r.shift[0]=9),r.forcetodown=c<Si.FAV_ICON_TT_MIN_HEIGHT,r.forcetoup=l<Si.FAV_ICON_TT_MIN_HEIGHT,(0,G.showTooltip)(e,r),Si[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},markStickerAsFavorite:function(e){e[Si.STICKER_FIELD_IS_FAVORITE]=1},markStickerAsUnfavorite:function(e){e[Si.STICKER_FIELD_IS_FAVORITE]=0},addFavoriteSticker:function(e,t){var i,r=null==(i=Si.stickers[Si.TAB_FAVORITE_STICKERS])?void 0:i.stickers,o=Si.findPackSticker(t);if(r&&o){Si.favorite.markStickerAsFavorite(o),r.unshift(o),Si.favorite.increaseFavoritePackSize();var n=Si.findRecentSticker(t);n&&Si.favorite.markStickerAsFavorite(n),ls.set("recent_stickers",Si.stickers[Si.TAB_RECENT_STICKERS]);for(var s=0,a=Object.entries(Si.opts);s<a.length;s++){var c=a[s],l=c[0],_=c[1];if(!_.noStickers){Si.favorite.changeRenderedPackViewsByStickerId(l,t,!0);var d=_.activePackViews.has(Si.TAB_FAVORITE_STICKERS);Si.resetStickerPackViews(l,!d),Si.favorite.showFavoriteTab(_.tt)}}}},deleteFavoriteSticker:function(e,t){var i=Si.stickers[Si.TAB_FAVORITE_STICKERS];if(i){var r=Si.findFavoriteStickerIndex(t);if(-1!==r){i.stickers.splice(r,1),Si.favorite.reduceFavoritePackSize();var o=Si.findRecentSticker(t);o&&Si.favorite.markStickerAsUnfavorite(o),ls.set("recent_stickers",Si.stickers[Si.TAB_RECENT_STICKERS]);var n=Si.findPackSticker(t);n&&Si.favorite.markStickerAsUnfavorite(n);for(var s=0,a=Object.entries(Si.opts);s<a.length;s++){var c=a[s],l=c[0],_=c[1];if(!_.noStickers){if(!i.stickers.length){Si.favorite.hideFavoriteTab(_.tt);var d=_.tt.querySelector(".emoji_favorite_stickers_cont");d&&d.parentElement.remove(),_.renderedPackViews.delete(Si.TAB_FAVORITE_STICKERS),Si.selectTab(l,Si.TAB_RECENT_STICKERS)}Si.favorite.changeRenderedPackViewsByStickerId(l,t,!1),Si.resetStickerPackViews(l,!_.activePackViews.has(Si.TAB_FAVORITE_STICKERS))}}}}},reduceFavoritePackSize:function(){var e=window.emojiStickers.find((e=>e[0]===Si.TAB_FAVORITE_STICKERS));e&&e[Si.PACK_FIELD_COUNT]&&(e[Si.PACK_FIELD_COUNT]=e[Si.PACK_FIELD_COUNT]-1)},increaseFavoritePackSize:function(){var e=window.emojiStickers.find((e=>e[0]===Si.TAB_FAVORITE_STICKERS));e&&(e[Si.PACK_FIELD_COUNT]=e[Si.PACK_FIELD_COUNT]+1)},showFavoriteTab:function(e){var t=e.querySelector(`.emoji_tab_${Si.TAB_FAVORITE_STICKERS}`);t&&t.classList.remove("unshown")},hideFavoriteTab:function(e){var t=e.querySelector(`.emoji_tab_${Si.TAB_FAVORITE_STICKERS}`);t&&t.classList.add("unshown")},changeRenderedPackViewsByStickerId:function(e,t,i){for(var r,o=Si.opts[e],n=Si.findPackSticker(t),s=pi(o.renderedPackViews);!(r=s()).done;){var a,c,l=r.value,_=l[0],d=l[1],u=d.querySelector(`[data-sticker-id="${t}"]`);if(i){if(u)u.classList.add("faved"),null==(a=u.querySelector(".emoji_sticker_item_fav"))||a.classList.add("on");else if(_===Si.TAB_FAVORITE_STICKERS){var m=Si.renderStickerView(e,_,n),f=d.querySelector("[data-sticker-id]");f?f.parentNode.insertBefore(m,f):d.appendChild(m)}}else if(u)if(_===Si.TAB_FAVORITE_STICKERS)u.parentNode.removeChild(u);else u.classList.remove("faved"),null==(c=u.querySelector(".emoji_sticker_item_fav"))||c.classList.remove("on")}}},updateEmojiCatTitle:function(e){var t=Si.opts[e];if(t&&t.emojiScroll){var i,r,o,s=(0,k.ge)("emoji_block_"+e),a=(0,k.geByClass)("emoji_cat_title_helper",s),c=t.emojiScroll.data.scrollTop,l=(0,k.geByClass1)("emoji_cats_title_helper",t.tt);if(a.length){var _=a[0];i=Si.getSizeCached(_)[1]}for(var d=a.length-1;d>=0;d--)if(c>a[d].offsetTop-i){r=a[d],o=d;break}if(!r)return(0,n.debugLog)("title not found");var u=(0,g.intval)((0,k.attr)(r,"data-id"));if(t.curEmojiCatId!=u){t.curEmojiCatId=u;var m=[r],f=a[o-1];f&&((0,k.addClass)(f,"emoji_cat_title_fix"),(0,k.setStyle)(f.firstChild,"transform","translateY("+(r.offsetTop-f.offsetTop-i)+"px)"));for(var h=r.nextSibling;h;)(0,k.hasClass)(h,"emoji_cat_title_fix")&&m.push(h),h=h.nextSibling;for(var v in m)m.hasOwnProperty(v)&&((0,k.removeClass)(m[v],"emoji_cat_title_fix"),(0,k.setStyle)(m[v].firstChild,"transform","translateY(0px)"));(0,k.val)(l,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&c>=r.offsetTop&&c>0?((0,k.val)(l,(0,k.val)(r)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(c<r.offsetTop||0==c)&&((0,k.val)(l,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var r,n=Si.cssEmoji[t];r=n?' title="'+n[1]+'"':"";var s="";return o.browser.mobile||(s=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+r+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+s+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+Si.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=Si.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),Si.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||(0,k.ge)("page_header")&&Si.getSizeCached((0,k.ge)("page_header"))[1]||0;var r=(window.pageNode&&window.browser.mozilla?Math.min((0,k.getSize)(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||(0,k.getScroll)()[3],o=window.scrollGetY?(0,_.scrollGetY)():(0,k.getScroll)()[1],n=(0,k.getXY)(t)[1],s=Si.getSizeCached(t)[1],a=(0,k.geByClass1)("emoji_list",i),c=Si.opts[e].emojiSmileHeigh,l=window.headH,d=Si.opts[e].emojiRowsCount;(0,k.isAncestor)(t,pageNode)||(l=0),(0,k.setStyle)(a,{height:d*c+8});for(var u,m,f,h,v=o+l,p=o+r,g=i,w=(0,k.getSize)(i)[1];g!==bodyNode&&(g=(0,k.domClosestOverflowHidden)(g));){var S=(0,k.getXY)(g)[1];v=Math.max(v,S),p=Math.min(p,S+(0,k.getSize)(g)[1])}for(f=p-n-s-9,u=(m=n-9-v)<w&&f<w?m>=f:m>=w,Si.opts[e].forceUp&&(u=!0),h=u?m:f;h<w&&d>3;)d--,w-=c;Si.opts[e].emojiRowsCount=d,Si.opts[e].emojiSmileHeigh=c,(0,k.setStyle)(a,{height:d*c+8}),(0,k.toggleClass)(i,"tt_down",u),(0,k.toggleClass)(i,"tt_up",!u)},repositionEmoji:function(e,t,i){var r,o=Si.opts[e];if(o){if(i.parentNode&&k.getXY&&k.getStyle&&k.setStyle&&k.geByClass&&(r=(0,k.geByClass1)("emoji_rpointer",i))){var n=parseInt((0,k.getStyle)(i,"width")),s=(0,k.getXY)(t)[0],a=parseInt((0,k.getStyle)(t,"width")),c=(0,k.getXY)(i.parentNode)[0];s+a/2<283?((0,k.setStyle)(i,"left",-n-c),(0,k.setStyle)(r,"left",s+a/2-20+"px")):((0,k.setStyle)(i,"left",""),(0,k.setStyle)(r,"left",""))}else(0,k.setStyle)(i,"left","");var l=(0,k.geByClass1)("emoji_list",i),_=(0,k.geByClass1)("emoji_smile_cont",l);if(Si.opts[e].emojiSmileHeigh=_&&Si.getSizeCached(_)[1]||26,Si.opts[e].emojiRowsCount=9,Si.ttCalcHeight(e,t,i),o.ttWrap){var d=(0,k.getSize)(o.ttWrap)[0]-((0,k.getXY)(o.emojiBtn)[0]-(0,k.getXY)(o.ttWrap)[0]);(0,k.setStyle)(i,"right",d-o.ttDiff+"px")}}},emojiOver:function(e,t,i){if(o.browser.mobile||i&&Si.preventMouseOver)return!0;var r=Si.opts[e];(0,k.addClass)(t,"emoji_over"),r.emojiOvered&&r.emojiOvered!=t&&(0,k.removeClass)(r.emojiOvered,"emoji_over"),r.emojiOvered=t},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-Si.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){Si.addNextEmojiCategoty(i),Si.updateEmojiCatTitle(i)}),0),Si.updateEmojiCatTitle(i)},calcStickerPackViews(e){var t=this.opts[e],i=new Map,r=0,o=r,n=t.forceStickerPack,s=t.emojiScroll;if(window.emojiStickers){for(var a,c=[],l=pi(window.emojiStickers);!(a=l()).done;){var _=a.value,d=_[0];if(this.stickers.hasOwnProperty(d)){var u=_[1],m=_[4]&&n===d,f=d===Si.TAB_VMOJI;if(u||m)(this.stickers[d].stickers.length||f)&&c.push(_)}}for(var h=[],v=[],p=0,g=c;p<g.length;p++){var k=g[p],w=k[0],S=k[9];w<0||S?h.push(k):v.push(k)}[...h,...v].forEach((e=>{var t=e[0],n=t===Si.TAB_VMOJI,a=this.stickers[t].stickers,c=Math.ceil(a.length/Si.STICKERS_IN_RAW)*Si.STICKER_SIDE_SIZE;c+=Si.STICKER_PACK_HEADER_HEIGHT,n&&s&&(c+=s.data.viewportHeight);var l={id:t,top:r,bottom:r+c};i.set(t,l),r+=c,o+=c})),t.packViews=i,t.packViewsTotalHeight=o}},renderStickerPackView(e,t){var i=this.opts[e],r=t.id,o=i.renderedPackViews.get(r);if(o)return o;var n=window.emojiStickers.find((e=>e[0]===r));if(!n)return"";if(!Si.stickers.hasOwnProperty(r))return"";var s=Si.stickers[r],a=s.stickers,c=s.images,l=r===this.TAB_RECENT_STICKERS,_=r===this.TAB_FAVORITE_STICKERS,d=r===this.TAB_VMOJI,u="";if(u+=Si.getStickerPackBlockHeaderHtml(e,n),l)u+=`<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont${e}">`;else if(_)u+=`<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont${e}">`;else if(d&&!vk.widget){var m=c[Ve.colorScheme.isDarkScheme()?"dark":"light"]||Object.values(c)[0];u+=Si.getVmojiStubHtml(m)}for(var f,h=pi(a);!(f=h()).done;){var v=f.value;u+=this.renderStickerViewHtml(e,r,v)}(l||_)&&(u+="</div>");var p=(0,k.se)(`\n     <div style="\n        position: absolute;\n        width: 100%;\n     ">${u}</div>\n  `);return i.renderedPackViews.set(r,p),p},getStickerPackBlockHeaderHtml:function(e,t){var i=t[0],r=t[8],o=t[9],n=Si.stickers[i],s=n.title,a=n.base_id,c=n.can_gift,l="";if(l+=`\n    <div class="clear emoji_stickers_pack_header">\n      <div class="emoji_stickers_pack_header_main">\n        <div class="emoji_stickers_pack_title">${s}</div>`,a&&!vk.widget){var _="emoji_stickers_pack_settings";r&&(_+=" emoji_stickers_pack_settings--new"),l+=`<a class="${_}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${a});" title="${(0,q.getLang)("purchases_stickers_select_style")}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg></a>`}(o&&!vk.widget&&(l+=`\n      <a\n        class="emoji_stickers_pack_settings"\n        href="javascript:void(0);"\n        onclick="Vmoji.showAvatar(${vk.id}, '${o}', ${i});"\n        title="${(0,q.getLang)("purchases_stickers_keyboard_pack_setup")}"\n      >\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg>\n      </a>\n    `),l+='\n    </div>\n    <div class="emoji_stickers_pack_header_aside">',c&&!vk.widget)&&(l+=`\n      <div\n        class="emoji_stickers_pack_peer_info"\n        data-product-id="${i}"\n        ${a&&a!==i?"data-is-style":""}\n      ></div>\n      <a\n        class="emoji_stickers_pack_gift"\n        onclick="Emoji.giftStickerToCurrentPeer(${e}, ${i}, event, { sticker_referrer: &quot;stickers_keyboard2&quot; });"\n      >\n        <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 0 1 3 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 0 1-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 0 1-1.32-1.32l-.1-.2A5.12 5.12 0 0 1 3 14.3V12.4a1.88 1.88 0 0 1-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 0 1 3-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26ZM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5Zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5ZM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09Zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5ZM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04Zm1.56 0-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78Z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>\n      </a>`);return l+="\n    </div>\n  </div>"},getVmojiStubHtml:function(e){return`\n    <div class="emoji_vmoji_stub">\n      <div class="emoji_vmoji_create_avatar">\n        <img class="emoji_vmoji_create_avatar__image" src="${e}" alt="" />\n        ${J.FlatButton.render({className:"emoji_vmoji_create_avatar__button",appearance:J.FlatButtonAppearance.TERTIARY,size:J.FlatButtonSize.M,children:(0,q.getLang)("vmoji_keyboard_create_avatar"),restAttrs:{onclick:"Emoji.createVmojiAvatar();"}}).outerHTML}\n      </div>\n    </div>\n  `},mountStickerPackView(e,t){var i=this.opts[e].tt.querySelector(`.emoji_scroll_stickers .${Si.STICKER_PACKS_CONTAINER_CLASS}`);if(i){var r=this.renderStickerPackView(e,t);r.parentNode!==i&&i.appendChild(r);var o=t.top,n=t.bottom;r.style.cssText+=`height: ${n-o}px; top: ${o}px;`}},showStickerPackView(e,t){var i=this.opts[e],r=i.packViews,o=i.activePackViews,n=r.get(t);n&&n!==o.get(t)&&(this.mountStickerPackView(e,n),o.set(n.id,n))},unmountStickerPackView(e,t){var i=this.opts[e].renderedPackViews.get(t);i&&i.parentNode&&(i.querySelectorAll(".sticker_animation").forEach((e=>{ni.StickersAnimation.stopAnimation(e,!0)})),i.parentNode.removeChild(i))},hideStickerPackView(e,t){var i=this.opts[e];this.unmountStickerPackView(e,t),i.activePackViews.delete(t)},resetStickerPackViews(e,t){void 0===t&&(t=!1);var i=this.opts[e];Si.calcStickerPackViews(e);var r=document.querySelector(`.${Si.STICKER_PACKS_CONTAINER_CLASS}`);r&&(r.style.height=i.packViewsTotalHeight+"px");var o=0;if(t)for(var n,s=i.packViews,a=i.activePackViews,c=pi(s.values());!(n=c()).done;){var l=n.value,_=l.id,d=l.top,u=a.get(_);u&&u.top!==d&&(o=d-u.top)}Si.calcStickerPacksToShowHide(e),o?Si.updateStickerPackViews(e,(()=>{i.emojiScroll.scrollTop(i.emojiScroll.data.scrollTop+o)})):Si.updateStickerPackViews(e)},calcStickerPacksToShowHide:function(e){var t=this.opts[e];if(t.emojiScroll){var i=t.emojiScroll.data,r=i.scrollTop,o=i.viewportHeight,n=t.packViews,s=t.activePackViews;t.packsToShow=new Set,t.packsToHide=new Set([...s.keys()]);for(var a,c=pi(n.values());!(a=c()).done;){var l=a.value,_=l.id,d=l.top;if(!(l.bottom<=r)){if(d>r+o)break;t.packsToShow.add(_),t.packsToHide.delete(_)}}}},hideStickerPacksViews:function(e){for(var t,i=pi(this.opts[e].packsToHide);!(t=i()).done;){var r=t.value;this.hideStickerPackView(e,r)}},showStickerPacksViews:function(e){for(var t,i=pi(this.opts[e].packsToShow);!(t=i()).done;){var r=t.value;this.showStickerPackView(e,r)}},updateStickerPackViews:function(e,t){Si.hideStickerPacksViews(e),Si.showStickerPacksViews(e),t&&t(e)},scrollToFirstShownPackTab:function(e){var t=this.opts[e].packsToShow.values().next().value;t&&this.scrollToTab(t,e)},scrollToStickerPackView:function(e,t,i){var r=this.opts[e],o=r.packViews.get(t);o&&r.emojiScroll.scrollTop(o.top,i?0:200)},emojiUIScroll:function(e,t){var i=Si.opts[e];(0,k.addClass)(t,"emoji_expanded"),Si.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll((0,k.geByClass1)("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,(0,M.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&ai.tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i&&(i.curTab==Si.TAB_EMOJI?Si.updateEmojiCategories(t,i,e):(Si.calcStickerPacksToShowHide(e),Si.scrollToFirstShownPackTab(e),Si.updateStickerPackViews(e)))},onresize:e=>{var t=e.container,i=e.data;t.style.setProperty("--scroll-viewport-height",i.viewportHeight+"px")}}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},renderStickerViewHtml(e,t,i){var r=i[0],n=i[2],s=i[3],a=i[4],c=i[5]||"",l=this.getStickerReferrer(t,e),_="";this.favoriteAvailable&&(_=`<span\n      role="link"\n      onmouseover="Emoji.favorite.reminder(this)"\n      class="emoji_sticker_item_fav ${a?"on":""}"\n      data-sticker-id="${r}"\n      data-hash="${c}"\n      onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n      onclick="cancelEvent(event)"></span>`);var d="";if(o.browser.msie&&!o.browser.msie_edge||!s)d=`<a\n      id="emoji_sticker_item${e}_${t}_${r}"\n      data-opt-id="${e}"\n      data-sticker-id="${r}"\n      data-pack-id="${t}"\n      data-src="${n}"\n      data-fav="${a}"\n      data-fav-hash="${c}"\n      class="emoji_sticker_item sticker_item_${r} ${a?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${r}, ${t}, &quot;${l}&quot;);">\n      <img class="emoji_sticker_image" src="${n}" />\n      ${_}\n    </a>`;else{var u=(0,M.rand)(1,1e5);d=`<a\n      id="emoji_sticker_item${e}_${t}_${r}"\n      data-opt-id="${e}"\n      data-sticker-id="${r}"\n      data-pack-id="${t}"\n      data-src="${n}"\n      data-animation-path="${s}"\n      data-uniq-id="${u}"\n      data-fav="${a}"\n      data-fav-hash="${c}"\n      class="emoji_sticker_item sticker_item_${r} ${a?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${r}, ${t}, &quot;${l}&quot;);">\n      <div\n        data-uniq-id="${u}"\n        onmouseenter="StickersAnimation.loadAndPlaySticker(this, true);"\n        class="sticker_animation"\n        data-sticker-id="${r}"\n        data-animation-path="${s}">\n        <img class="sticker_img emoji_sticker_image" src="${n}" />\n      </div>\n      ${_}\n    </a>`}return d},renderStickerView:(e,t,i)=>(0,k.se)(Si.renderStickerViewHtml(e,t,i)),emojiMove:function(e){var t=Si.shownId,i=Si.opts[t];if(Si.shown&&i&&i.emojiFocused&&i.openedByTabKey){var r=null;if(i.emojiOvered)switch(e.keyCode){case d.KEY.LEFT:r=Si.getEmojiEl(i.emojiOvered,"left"),(0,d.cancelEvent)(e);break;case d.KEY.RIGHT:r=Si.getEmojiEl(i.emojiOvered,"right"),(0,d.cancelEvent)(e);break;case d.KEY.UP:r=Si.getEmojiEl(i.emojiOvered,"up");break;case d.KEY.DOWN:r=Si.getEmojiEl(i.emojiOvered,"down");break;case d.KEY.ENTER:if(!Si.emojiEnter(t,e))return(0,d.cancelEvent)(e),!1;break;default:return!0}else r=Si.getFirstEmojiEl(t);if(r)return Si.preventMouseOver=!0,Si.emojiOver(t,r),Si.scrollToListEl(t,r),!1}return!0},scrollToListEl:function(e,t){var i=Si.opts[e];if(i&&i.emojiScroll){var r=t.offsetTop,o=Math.max(r+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,r-30));i.emojiScroll.data.scrollTop!=o&&i.emojiScroll.scrollTop(o)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),r=0,o=(0,k.domLC)(e),n=(0,k.domFC)(e),s=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var _=++r>=i?a:s+1.95*r*(t?1:-1),d=_-45,u=r>=i?l:c+.043333333333333335*r*(t?-1:1),m=1-u;o.style.WebkitTransform=o.style.OTransform=o.style.transform="rotate("+_+"deg)",n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+d+"deg)",o.style.opacity=u,n.style.opacity=m,r>=i&&(clearInterval(cur._imAnim),(t?k.addClass:k.removeClass)(e,"emoji_smile_on"),o.style.WebkitTransform=o.style.OTransform=o.style.transform=n.style.WebkitTransform=n.style.OTransform=n.style.transform=o.style.opacity=n.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:m.emojiToHTML,emojiReplace:m.emojiReplace,emojiRegex:(0,r.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){ri(e,{settings:!0})},updatePeerInfo(e,t){void 0===t&&(t=!1);var i=Si.opts[e];if("im"===cur.module&&cur.gid)this.renderPeerInfo(e,null);else{var r=this.getPeerId(e);(r!==i.currentPeerId||t)&&(i.currentPeerId=r,r?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(r).then((t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),r===i.currentPeerId&&this.renderPeerInfo(e,t)}))):this.renderPeerInfo(e,null))}},renderPeerInfo(e,t){var i=Si.opts[e];if(t){i.tt.classList.remove("emoji_tt_peer_info_unavailable");var r=t.product_ids.reduce(((e,t)=>(e[t]=1,e)),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach((e=>{var i=e.dataset.productId;if(r.hasOwnProperty(i)){var o=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 1 0 6 0a6 6 0 0 0 0 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 0 1 1.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${o?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""}))}else i.tt.classList.add("emoji_tt_peer_info_unavailable")},showPeerInfoTooltip(e){(0,G.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e){Si.calcStickerPackViews(e);var t=Si.opts[e];return`<div class="${Si.STICKER_PACKS_CONTAINER_CLASS}" style="height: ${t.packViewsTotalHeight}px;"></div>`},updateStickersCont:function(e){var t=Si.opts[e],i=Si.getTabCont(e);(0,k.geByClass1)("emoji_scroll_stickers",t.tt).innerHTML=i,t.initedStickers=1},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i){if(null!=e){var r=Si.opts[i],o=r.tt;"number"==typeof e&&(e=(0,k.geByClass1)("emoji_tab_"+e,o)),r.curEmojiCatId=null,t==Si.TAB_EMOJI?Si.showEmojiTab(i,t,e):Si.showStickersTab(i,t,e)}},showEmojiTab:function(e,t,i){var r=Si.opts[e],o=r.tt,n=(0,k.geByClass1)("emoji_scroll_smiles",o),s=(0,k.geByClass1)("emoji_scroll_stickers",o),a=(0,k.geByClass1)("emoji_cats_title_helper",o);(0,k.hide)(s),(0,k.show)(n),(0,k.show)(a),r.emojiInited||((0,k.val)(n,Si.getInitEmojiContent(e)),r.emojiInited=!0),r.imagesLoader&&r.imagesLoader.processLoad(),r.emojiOvered&&r.curTab===Si.TAB_EMOJI&&Si.emojiOver(e,Si.getFirstEmojiEl(e)),r.curTab!=Si.TAB_EMOJI&&r.emojiScroll&&r.emojiScroll.scrollTop(0),Si.updateRecentEmoji(e),Si.updateEmojiCatTitle(e),Si.selectTab(e,t,i)},showStickersTab:function(e,t,i){var r=Si.opts[e],o=r.tt,n=(0,k.geByClass1)("emoji_scroll_smiles",o),s=(0,k.geByClass1)("emoji_scroll_stickers",o),a=(0,k.geByClass1)("emoji_cats_title_helper",o);if((0,k.hide)(n),(0,k.show)(s),(0,k.hide)(a),Si.shouldLoadStickers(t))Si.onStickersLoad=function(){var i;Si.updateTabsOpt(e,void 0,!1),(null==(i=Si.stickers)?void 0:i[t])||(t=Si.TAB_RECENT_STICKERS),Si.tabSwitch(t,t,e)},Si.stickersLoadingProgress(e,t,i),r.stickersInited=!1,r.curTab=null,Si.emojiLoadMore(e);else{var c=window.emojiStickers.find((e=>e[0]===t));c&&c[7]&&xe(t,Z.IsNew,0,!1).then((()=>{Array.from(document.querySelectorAll(`.emoji_tab_${t}`)).forEach((e=>{e.classList.remove("emoji_tab_is_new")}))})),r.stickersInited||(Si.updateStickersCont(e),r.stickersInited=!0),Si.calcStickerPackViews(e),Si.calcStickerPacksToShowHide(e),Si.scrollToStickerPackView(e,t,!0),Si.updateStickerPackViews(e),Si.selectTab(e,t,i)}r.afterLoad&&(r.afterLoad=0),r.stickersInited&&Si.updatePeerInfo(e)},shouldLoadStickers:function(e){var t=Si.stickers&&(0,g.clone)(Si.stickers);return t&&delete t[Si.TAB_RECENT_STICKERS],!window.emojiStickers||!t||(0,M.isEmpty)(t)||!t[e]&&e!=Si.TAB_RECENT_STICKERS},getFirstEmojiEl:function(e){for(var t=Si.opts[e],i=(0,k.geByClass1)("emoji_scroll_smiles",t.tt).firstChild;i;){if((0,k.hasClass)(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,r=0,o=e.parentNode,s=0,a=o.firstChild;a&&(s++,a!==e);)a=a.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",s=10):(t="down",s=1));else{if("up"!=t&&"down"!=t)break;for(var c=o;c&&(c="up"==t?c.previousSibling:c.nextSibling)&&!(0,k.hasClass)(c,"emoji_smiles_row"););if(!c)break;if(s&&c)for(var l=0,_=c.firstChild;_&&l<s;){if(++l>=s){i=_;break}_=_.nextSibling}if(i||!c)break;i="up"==t||s&&"down"==t?c.lastChild:c.firstChild}if(++r>20){(0,n.debugLog)("ERR!!");break}}return i},addRecentSticker(e){var t=this.stickers[this.TAB_RECENT_STICKERS];if(t){var i=this.findPackSticker(e);if(i){var r=t.stickers.findIndex((t=>{var i=t[0];return String(i)===String(e)}));-1!==r&&t.stickers.splice(r,1),t.stickers.unshift(i);for(var o=0,n=Object.entries(this.opts);o<n.length;o++){var s=n[o],a=s[0],c=s[1];if(!c.noStickers){var l=c.renderedPackViews.get(this.TAB_RECENT_STICKERS);if(l){var _=l.querySelector(`[data-sticker-id="${e}"]`)||this.renderStickerView(a,this.TAB_RECENT_STICKERS,i),d=l.querySelector("[data-sticker-id]");d&&d!==_&&d.parentNode.insertBefore(_,d)}if(c.tt){var u=c.tt.querySelector(`.emoji_tab_${this.TAB_RECENT_STICKERS}.unshown`);u&&u.classList.remove("unshown")}Si.resetStickerPackViews(a,!c.activePackViews.has(Si.TAB_RECENT_STICKERS))}}ls.set("recent_stickers",this.stickers[this.TAB_RECENT_STICKERS])}}},stickerClick:function(e,t,i,r){var o=Si.opts[e];if(!(Date.now()-o.ttShowT<Si.CLICK_DELAY||o.preventDoubleClick&&Date.now()-o.preventDoubleClick<Si.CLICK_DELAY)){o.preventDoubleClick=Date.now();var n,a,c=!0;if(i)c=null==(n=window.emojiStickers)||null==(a=n.find((e=>e[0]===i)))?void 0:a[1];if(c&&Si.addRecentSticker(t),o.onStickerSend){var l,_,d=null==(l=Si.stickersById)||null==(_=l[t])?void 0:_.sticker[Si.STICKER_FIELD_IMAGES];o.onStickerSend(t,r,"animation",d)}(0,s.statlogsValueEvent)("stickers_usage",o.ref,t,r),Si.ttHide(e,!1,!1,!0),o.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if((0,M.isObject)(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var r=(cur.tooltips||[]).length,o=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+r,e.image?"":"tt_text_only"];if(o=o.join(" "),e.show){var n={index:r,className:o,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=(0,k.getSize)(e.container)[1];if(!(i>=225)){var r=(0,g.intval)((225-i)/2)+10,o=(0,g.intval)((0,k.getStyle)(t,"top",!0))+r;(0,k.setStyle)(t,"top",o)}}};(0,k.gpeByClass)("_im_peer_history_w",t)&&(n.appendParentCls="_im_peer_history_w"),(0,G.showTooltip)(t,n)}}})},selectPeer:function(e){if(void 0!==e){var t=Si.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var r=0;for(var o in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(o)&&(i=cur.wdd.imw_dd.selected[o][0],r+=1);r>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=(0,z.showBox)("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",window.jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){var e=document.querySelector("#im_stickers_tabs");if(e){var t=e.querySelector(".ui_tab_sel");if(t)return(t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[])[1]}},showStickersStore:function(e,t,i,r){void 0===i&&(i={}),void 0===r&&(r={});var o=Si.selectPeer(!1!==e?e:void 0),n=Si.opts[e];i=vi({},i,{act:"stickers_store",peer:o,box:1}),t&&(i.ref=t),cur.boxStickersStore=(0,z.showBox)("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy(){n&&n.onStoreHide&&n.onStoreHide(),cur.boxStickersStore=null}},onDone(){void 0!==r.scrollTop&&($e().scrollTop=r.scrollTop)}}),cur.boxStickersStore.reload=()=>{if(cur.boxStickersStore){var i=Si.getSelectedStickersStoreTabId(),r=$e().scrollTop;cur.boxStickersStore.hide(),Si.showStickersStore(e,t,{tab:i},{scrollTop:r})}},Si.hideStickersStoreNotification(),(0,g.each)((0,k.geByClass)("emoji_shop_icon_badge"),(function(e,t){(0,k.re)(t)})),Si.hasNewStickers=!1},previewSticker:function(e,t,i,r){if(ki()){var o=(i=i||{}).peerId||Si.selectPeer(),n={recipientIds:o?[o]:[],preview_ref:i.sticker_referrer||"store"};return i.stickerId?ii(i.stickerId,n):ri(e,n),(0,d.cancelEvent)(r),!1}if(i=i||{},r&&(0,d.checkEvent)(r))return!0;var s={act:"sticker_preview",pack_id:e},a=Si.selectPeer();if(i.peer?s.peer=i.peer:a&&(s.peer=a),i.preview&&(s.preview=1),i.gift&&(s.gift=1),i.giftTo&&(s.gift_to=i.giftTo),i.stickerId&&(s.sticker_id=i.stickerId),s.sticker_referrer=i.sticker_referrer||"store",i.name){var c=nav.objLoc[0].split("/");"stickers"==c[0]&&c[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=(0,z.showBox)("al_im.php",s,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),(0,d.cancelEvent)(r),!1},getStickerPack(e){if(window.emojiStickers){var t=window.emojiStickers.find((t=>t[Si.PACK_FIELD_ID]===e))||null;return Promise.resolve(t)}return new Promise(((t,i)=>{ajax.post("al_im.php",{act:"a_stickers_list"},{onDone(i){window.emojiStickers=i,t(i?Si.getStickerPack(e):null)},onFail:()=>(i(),!0)})}))},getClosestTextInput(e){if(e.getAttribute("contenteditable"))return e;var t=e.closest(".js-im-page, .fc_tab, .mv_chat");return t?t.matches(".fc_tab")?t.querySelector(".fc_editable"):t.matches(".js-im-page")?document.querySelector("._im_text"):t.matches(".mv_chat")?t.querySelector(".mv_chat_reply_input"):null:null},showPackInKeyboard(e,t){var i=Si.getClosestTextInput(t);if(i&&void 0!==i.emojiId){var r=Si.opts[i.emojiId];Si.ttClick(i.emojiId,i.parentNode.parentNode.querySelector("._emoji_btn"),!1,!0);var o=r.tt.querySelector(`.emoji_tab_${e}`),n=void 0!==Object.keys(Si.stickers||{}).find((e=>e!==Si.TAB_RECENT_STICKERS));n?(r.initedStickers=0,Si.tabSwitch(o,e,i.emojiId)):(Si.onStickersLoad=()=>Si.tabSwitch(e,e,i.emojiId),Si.stickersLoadingProgress(i.emojiId,e,o))}},clickSticker:function(e,t,i,r){var o;if(void 0===r&&(r={}),null==(o=window.cur.emojiStickersDisabled)?void 0:o[e])return!0;var n=r.vmoji;if(n&&(0,p.partConfigEnabled)("vmoji")&&!window.vk.widget){var s=n.avatarOwnerId,a=n.avatarCharacterId;return s?(s===window.vk.id&&t?Promise.all([Si.getStickerPack(e),Si.getVmojiAvatar()]).then((i=>{var r=i[0],o=i[1],n=Boolean(null==r?void 0:r[Si.PACK_FIELD_IS_ACTIVE]);o&&o.character_id===a&&n?Si.showPackInKeyboard(e,t):Si.showVmojiAvatar(s,a,e)})):Si.showVmojiAvatar(s,a,e),!1):(window.vk.widget||Si.previewSticker(e,!1,{sticker_referrer:"message"}),!1)}return t?(Si.getStickerPack(e).then((i=>{Boolean(i&&i[Si.PACK_FIELD_IS_ACTIVE])?Si.showPackInKeyboard(e,t):Si.previewSticker(e,!1,{sticker_referrer:"message"})})),!1):(window.vk.widget||Si.previewSticker(e,!1,{sticker_referrer:"message"}),!1)},stickersLoadingProgress:function(e,t,i){var r=Si.opts[e];(0,k.removeClass)((0,k.geByClass1)("emoji_tab_sel",r.tt),"emoji_tab_sel"),(0,k.addClass)(i,"emoji_tab_sel"),(0,k.geByClass1)("emoji_scroll_stickers",r.tt).innerHTML='<div class="emoji_scroll_progress">'+(0,k.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,r,o){if(i&&J.FlatButton.getAppearance(i)===J.FlatButtonAppearance.SECONDARY)return!0;if(ki())return J.FlatButton.lock(i),Ae.create([e]).order({hash:r,ref:o}).then((t=>{if(J.FlatButton.unlock(i),t&&!t.error){(0,c.showDoneBox)(ze(t));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===o&&window.Videoview&&window.Videoview.onStickersPurchased(e),(0,p.partConfigEnabled)("stickers_catalog_reload_after_buy")&&(cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:Si.getSelectedStickersStoreTabId()},preventScroll:!0}))}})),(0,d.cancelEvent)(t);var n=Si.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:r,peer:n,sticker_referrer:(0,M.unclean)(o)},{onDone:function(t,i,r,n,s,a){if((0,g.each)((0,k.geByClass)("_sticker_btn_"+e),(function(){this.innerHTML=n,this.onmouseover="",this.onclick="",J.FlatButton.setAppearance(this,J.FlatButtonAppearance.SECONDARY)})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),s&&cur.boxStickersStore&&cur.boxStickersStore.hide(),(0,c.showDoneBox)(t),i){Si.stickers[Si.TAB_RECENT_STICKERS].promoted=a,Si.updateTabs(i,r,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===o&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var l=cur.tabbedStickersBox;if(l&&l.tbUpdate)for(var _ in l.tbUpdate)l.tbUpdate.hasOwnProperty(_)&&(l.tbUpdate[_]=1);var d=cur.emojiId&&cur.emojiId[cur.peer];if(d){var u=(0,k.geByClass1)("emoji_tab_"+e,Si.opts[d].tt);u&&Si.tabSwitch(u,e,d)}(0,p.partConfigEnabled)("stickers_catalog_reload_after_buy")&&nav.reload({preventScroll:!0})},showProgress:()=>J.FlatButton.lock(i),hideProgress:()=>J.FlatButton.unlock(i),onFail:function(e){return e&&setTimeout((0,z.showFastBox)((0,q.getLang)("global_error"),e).hide,3e3),!0}}),(0,d.cancelEvent)(t)},stickerAct:function(e,t,i,r,o){var n=J.FlatButton.getAppearance(e)===J.FlatButtonAppearance.SECONDARY;if(o&&n)return!0;var s=(o?n:(0,k.hasClass)(e,"_im_sticker_activated"))?1:0,a=cur.tabbedStickersBox;if(a)for(var c in a.tbUpdate)a.tbUpdate.hasOwnProperty(c)&&(a.tbUpdate[c]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:s,from_btn:o?1:0},{onDone:function(i,r,n,a){o||(J.FlatButton.setLabel(e,i),e.onmouseover="",(0,k.setStyle)(e,{width:"auto"}),(0,k.toggleClass)(e,"_im_sticker_activated",!s)),(0,g.each)((0,k.geByClass)("_sticker_btn_"+t),(function(){J.FlatButton.setLabel(this,a),this.onmouseover="";var e=s?J.FlatButtonAppearance.PRIMARY:J.FlatButtonAppearance.SECONDARY;J.FlatButton.setAppearance(this,e)})),Si.updateTabs(r,n,!0);var c=e.parentNode.parentNode;if(!o){if(cur.stickersSorter.destroy(),s){(0,k.show)("im_stickers_deact");var l=(0,k.ge)("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),(0,k.setStyle)(c,{cursor:"default"})}else{(0,k.geByTag1)("div","im_stickers_my_wrap").appendChild(c),(0,k.ge)("im_stickers_deact_wrap").childNodes.length||(0,k.hide)("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:()=>J.FlatButton.lock(e),hideProgress:()=>J.FlatButton.unlock(e)}),(0,d.cancelEvent)(r)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(Si.hasNewStickers=!1);for(var r=Si.opts[t].forceStickerPack,o="",n="",s="",a=0,c=i;a<c.length;a++){var l=c[a],_=l[0],d=l[1],u=l[3],m=l[4]&&_===r,f=l[5];if(d||u||m){var h=l[6],v=l[7],p=l[8],g=l[9],k=void 0;if(d||m?(_>0&&-1===Si.stickerPacksToLoad.indexOf(_)&&Si.stickerPacksToLoad.push(_),k="Emoji.tabSwitch(this, "+_+", "+t+"); return cancelEvent(event);"):k="Emoji.previewSticker("+_+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",l[2]&&(Si.hasNewStickers=l[2]),_===Si.TAB_VMOJI)o+=`\n        <a class="${(0,Y.classNames)(`emoji_tab emoji_tab_${_} emoji_tab--vmoji-stub`,{emoji_tab_sel:cur.stickersTab==_})}" onmousedown="${k}" onclick="return cancelEvent(event);">\n          <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M14.46 10.3a2.39 2.39 0 0 1 2.76.31c.35.3.38.8.06 1.13a.88.88 0 0 1-1.19.06l-.08-.07c-.26-.18-.48-.16-.75-.02a.97.97 0 0 0-.15.09l-.08.06a.88.88 0 0 1-1.11-.12.77.77 0 0 1 .06-1.13c.1-.09.26-.2.48-.3zM8.5 9.55a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13.45 14c.55 0 1 .45.9 1-.02.13-.05.26-.09.34a2.44 2.44 0 0 1-3.2 1.32 2.45 2.45 0 0 1-1.32-1.32c-.04-.08-.07-.2-.1-.35-.1-.54.36-.99.91-.99zM9.1 3.8a.9.9 0 0 0 0-1.8zM2 9.1a.9.9 0 0 0 1.8 0z"/><path clip-rule="evenodd" d="M2 9.1A7.1 7.1 0 0 1 9.1 2v1.8a5.3 5.3 0 0 0-5.3 5.3z" fill-rule="evenodd"/><path d="M9.1 20.2a.9.9 0 1 1 0 1.8zM2 14.9a.9.9 0 0 1 1.8 0z"/><path clip-rule="evenodd" d="M2 14.9A7.1 7.1 0 0 0 9.1 22v-1.8a5.3 5.3 0 0 1-5.3-5.3z" fill-rule="evenodd"/><path d="M14.9 3.8a.9.9 0 1 1 0-1.8zM22 9.1a.9.9 0 1 1-1.8 0z"/><path clip-rule="evenodd" d="M22 9.1A7.1 7.1 0 0 0 14.9 2v1.8a5.3 5.3 0 0 1 5.3 5.3z" fill-rule="evenodd"/><path d="M14.9 20.2a.9.9 0 1 0 0 1.8zm7.1-5.3a.9.9 0 0 0-1.8 0z"/><path clip-rule="evenodd" d="M22 14.9a7.1 7.1 0 0 1-7.1 7.1v-1.8a5.3 5.3 0 0 0 5.3-5.3z" fill-rule="evenodd"/></g></svg>\n        </a>\n      `;else if(_===Si.TAB_RECENT_STICKERS){var w="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+_;cur.stickersTab==_&&(w+=" emoji_tab_sel"),o+='<a class="'+w+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(_===Si.TAB_FAVORITE_STICKERS)o+=Si.tabs.favoriteTabContent(k,h);else if(_){var S="emoji_tab emoji_tab_img_cont emoji_tab_"+_;(v||p)&&(S+=" emoji_tab_is_new"),cur.stickersTab==_&&(S+=" emoji_tab_sel"),d||m||(S+=" emoji_tab_promo"),g&&(S+=" emoji_tab--vmoji");var E='<a class="'+S+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+f+'" class="emoji_tab_img" /></a>';g?s+=E:m?n=E+n:n+=E}else{var b="emoji_tab emoji_tab_"+_;cur.stickersTab==_&&(b+=" emoji_tab_sel"),d||(b+=" emoji_tab_promo"),o+='<a class="'+b+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+_+'"></div></a>'}}}return s&&(s=`<span class="emoji_tabs_group emoji_tabs_group--vmoji">${s}</span>`),o+s+n},updateTabsOpt:function(e,t,i){void 0===i&&(i=!0);var r=Si.opts[e];if(!r.noStickers){var o=(0,k.ge)("emoji_tabs_cont_"+e);o&&(o.innerHTML=Si.getTabsCode(window.emojiStickers,e)),i&&Si.throwTabsScroll(e),Si.checkNewStickers(r),void 0!==typeof t&&(r.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var r=0;for(var o in void 0===t?(fi(),window.stickersKeywordsData||(r=1)):(window.stickersKeywordsData=t,hi(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||mi().then((function(e){var t=(null==e?void 0:e.time)||0;return Math.floor(t/1e3)})).then((e=>{ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:r,cache_time:e},{onDone:Si.updateTabs})})):window.emojiStickers=e,Si.opts)Si.opts.hasOwnProperty(o)&&Si.updateTabsOpt(o,!1);var n=Si.stickers&&(0,g.clone)(Si.stickers);n&&delete n[Si.TAB_RECENT_STICKERS],Si.onStickersLoad&&window.emojiStickers&&!(0,M.isEmpty)(n)&&(Si.onStickersLoad(),Si.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter((e=>!e.querySelector(".emoji_smile_icon_promo"))).forEach((e=>{e.appendChild((0,k.ce)("div",{className:"emoji_smile_icon_promo"}))}));var e=document.querySelector("#l_stickers");e&&e.classList.add("AppLeftMenuWithNotify")},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach((e=>{e.parentNode.removeChild(e)}));var e=document.querySelector("#l_stickers");e&&e.classList.remove("AppLeftMenuWithNotify")},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){Si.hasNewStickers=window.emojiStickers[i][2];break}Si.hasNewStickers<0&&!Si.noNewStickers&&setTimeout((()=>Si.showStickersStoreNotification()),(0,k.hasClass)(t,"fc_editable")?200:0)}},giftStickerToCurrentPeer(e,t,i,r){var o=this.getPeerId(e);(0,X.isUserPeer)(o)||(0,X.isChatPeer)(o)?this.giftSticker(t,o,i,r):this.giftSticker(t,"",i,r)},giftSticker:function(e,t,i,r){if(ki())return Gt([e],t?String(t).split(",").map((e=>Number(e))):[],{ref:r.sticker_referrer||"store",gift_ref:r.ref}),(0,d.cancelEvent)(i);var o={act:"stickers_gift_box",pack_id:e,peers:t,ref:(r=r||{}).ref};return r.from&&(o.from=r.from),o.sticker_referrer=r.sticker_referrer||"store",boxLayerWrap.scrollTop=0,(0,z.showBox)("/al_im.php",o,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),(0,d.cancelEvent)(i)},toggleStickers:function(e,t){var i=Si.opts[e];i&&(i.noStickers=t,i.tt&&((0,k.toggleClass)(i.tt,"emoji_no_tabs",t),i.curTab&&Si.tabSwitch(0,0,e)))},getSizeCached:function(e){return(e=(0,k.ge)(e))?(void 0!==e[Si.CACHED_WIDTH_PROP]&&void 0!==e[Si.CACHED_HEIGHT_PROP]||(e[Si.CACHED_WIDTH_PROP]=e.offsetWidth,e[Si.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[Si.CACHED_WIDTH_PROP],e[Si.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=(0,k.ge)(e))&&(e[Si.CACHED_WIDTH_PROP]=void 0,e[Si.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e,t){void 0===t&&(t=null);var i=Si.opts[t];return i&&"stories"===i.ref?Si.STICKER_REFERRERS.STORY_KEYBOARD:e===Si.TAB_RECENT_STICKERS?Si.STICKER_REFERRERS.RECENT:e===Si.TAB_FAVORITE_STICKERS?Si.STICKER_REFERRERS.FAVORITE:e===Si.TAB_NEW_CONVO_STICKERS?Si.STICKER_REFERRERS.NEW_CONVO:Si.STICKER_REFERRERS.KEYBOARD},render:{stickerHintRs:function(e,t,i){var r=t,n="";if(t<0)n=window.promotedStickerUrls&&window.promotedStickerUrls[-r];else if(i)n=i[2];else{var s=be(r);s&&(n=ve(s,64,64))}var a=i?i[3]:"",c={optId:e,selId:0,stickerId:r,stickerUrl:n,class:r<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+r+", '"+n+"', this)"},l="";return(!o.browser.msie||o.browser.msie_edge)&&a&&n?(l=Si.hintsStickerItemAnimation(),c.animationUrl=a,c.class+=" sticker_animation"):n&&(l=Si.hintsStickerItem()),(0,k.rs)(l,c)}},resetStickersCache(){Si.stickers={},Si.resetVmojiAvatarCache(),cur.boxMyStickers&&(cur.boxMyStickers.isVisible()||cur.boxMyStickers.setOptions({onShow(){cur.boxMyStickers.hide(),Si.showMyStickers()}}))},_vmojiAvatarCache:void 0,showVmojiAvatar(e,t,i){var r=(0,c.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,c.isBoxLoadingCancelled)(r)||((0,c.hideBoxLoader)(),window.Vmoji.showAvatar(e,t,i))}))},getVmojiAvatar(){return void 0!==Si._vmojiAvatarCache?Promise.resolve(Si._vmojiAvatarCache):(t={},e&&Object.assign(t,{avatar_id:e}),(0,si.api)("vmoji.getAvatar",t)).then((e=>{var t=e.avatar,i=void 0===t?null:t;return Si._vmojiAvatarCache=i,i}));var e,t},resetVmojiAvatarCache(){Si._vmojiAvatarCache=void 0},createVmojiAvatar(){var e=(0,c.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,c.isBoxLoadingCancelled)(e)||((0,c.hideBoxLoader)(),window.Vmoji.createAvatar())}))},__eof:1}},53262:(e,t,i)=>{"use strict";i.d(t,{StickersAnimation:()=>o.StickersAnimation});i(40851),i(91181),i(56997),i(96253);var r=i(91963),o=i(2215);o.StickersAnimation.init({animatorLoader:()=>Promise.all([Promise.all([i.e(75514),i.e(68592),i.e(79344)]).then(i.bind(i,86621)).then((e=>e.LottieManager)),Promise.resolve(r.default)])})},51620:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{tooltips:()=>tooltips});var _shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(40906),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49535),_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(35676),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(95724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(15544),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(87481),tooltips={show:function show(el,options){if(window.AudioPage&&window.AudioPage.forceFix&&window.AudioPage.forceFix(),el.hidetimer)return el.hidetimer&&clearTimeout(el.hidetimer),void(el.hidetimer=0);if(el.tt){if("object"==typeof el.tt&&(el.tt.shown=!1),el.ttimer&&clearTimeout(el.ttimer),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(options.text)){var ttText=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domByClass)(el.tt.container,"tt_text");if(ttText){var text=options.text();if(!text)return;ttText.innerHTML=text}}var opts=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(el.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(el.tt.opts):{},options||{}),isNewTT=void 0!==opts.dir,canshow;if(!el.tt.el)return el.tt="show",void(el.ttimer=setTimeout((function(){if(el.tt.el)return opts.showdt=0,void tooltips.show(el,opts);el.tt="shownow"}),opts.showdt||0));if(opts.js){var evalString="(function(){return function(){var tip=this;"+opts.js+"};})()";try{var evalResult=eval(evalString),evalApply=evalResult.apply(el.tt);canshow=!1!==evalApply}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalString)}}else canshow=!0;canshow&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(el.tt.container)?el.tt.showing||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(el.tt.container,{opacity:1},void 0!==opts.showsp?opts.showsp:200):el.ttimer=setTimeout((function(){var e=el.tt.container;if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e)){var t=opts.forcexy?opts.forcexy:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(el),i=opts.forcesize?opts.forcesize:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(el,!1,!0),r=opts.toup,o=vk.rtl&&!opts.asrtl||opts.asrtl&&!vk.rtl,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("page_header_wrap")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(el,"page_layout")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("page_header_wrap"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("ads-app-header")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("ads-app-header"):[0,0];if(i[0]||i[1]){e.style.opacity=0,opts.width&&(e.style.width=opts.width+"px"),opts.maxWidth&&(e.style["max-width"]=opts.maxWidth+"px"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e),isNewTT||(e.firstChild.className="toup"+(opts.toup?1:""));var s=opts.shift;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(s)&&(s=s()),void 0!==s&&2==s.length&&s.push(s[1]);var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e),c=bodyNode.scrollTop||htmlNode.scrollTop||0,l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e),_=t[1]-l[1]-s[1]-n[1]-c,d=lastWindowHeight-(t[1]+i[1]+l[1]+s[2])+c,u=_<0,m=d<0,f=_<0;u&&m?(_>d&&_+c>0&&(r=!0,f=!1),r&&f?r=!1:r||!m||f||(r=!0)):r&&u?r=!1:r||!m||u||(r=!0);var h=opts.needLeft||(opts.black||opts.checkLeft)&&window.lastWindowWidth&&lastWindowWidth-(t[0]+(o?i[0]+s[0]:l[0]-s[0]))<1,v="";opts.forceright&&(h=0),opts.forcetodown&&(r=!1),opts.forcetoup&&(r=!0),isNewTT?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_down"),v=opts.dir&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["up","down","left","right"])?"tt_"+opts.dir:"tt_"+(r?"down":"up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,v),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.toggleClass)(e,"toleft",!!h),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)):(v="toup"+(r?1:""),(r!=opts.toup||h)&&(v+=h?" toleft":"",l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)),e.firstChild.className=v,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,r?"tt_toup":""));var p,g=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(a);if(t[0]-=g[0],t[1]-=g[1],el.tt.zIndexEls=[],!opts.noZIndex)for(;a&&a!=bodyNode&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(a,"scroll_fix");){var k=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getStyle)(a,"zIndex")),w=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(a.ttCount);if(k&&!w)break;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(a,"zIndex",opts.zIndex||100),el.tt.zIndexEls.push(a),a.ttCount=w+1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(a)}var S=(p=isNewTT?!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["left","right"])||opts.forcetoup||opts.forcetodown?r?t[1]-(l[1]+s[1]):t[1]+i[1]+s[2]:t[1]-Math.floor(l[1]/2)-s[1]:t[1]+(r?-(l[1]+s[1]):i[1]+s[2]))+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slide)*(r?-1:1),E=t[0]+(o?s[0]+i[0]-l[0]:r?-s[0]:-(s[3]||s[0]));h&&(E-=(l[0]-(opts.reverseOffset||39))*(o?-1:1)),opts.center&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,"tocenter"),l[0]!=i[0]&&(E-=o?0:(l[0]-i[0])/2));var b=E+(o?-1:1)*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slideX);if(opts.showIfFit&&(E+g[0]<0||E+g[0]+l[0]>lastWindowWidth||p+g[1]<0||p+g[1]+l[1]>lastWindowHeight))return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);el.tt.showing=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e,{top:S,left:b});var y={opacity:1};b!=E&&(y.left=E),S!=p&&(y.top=p),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(e,y,void 0!==opts.showsp?opts.showsp:200,(function(){el.tt&&el.tt.showing&&(el.tt.showing=!1),opts.onShowEnd&&opts.onShowEnd(),"object"==typeof el.tt&&el.tt&&(el.tt.shown=!0)})),opts.onShowStart&&opts.onShowStart(el.tt)}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container)}}),opts.showdt||0))}},clearZindex:function(e){e.tt&&e.tt.opts&&e.tt.zIndexEls&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e.tt.zIndexEls,(function(){var e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(this.ttCount);e<=1?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(this,"zIndex",""),this.ttCount=0):this.ttCount=e-1}))},hide:function(e,t){if("shownow"!==e.tt){if(e.tt&&"object"==typeof e.tt&&(e.tt.shown=!1),(t||{}).fasthide)return clearTimeout(e.hidetimer),clearTimeout(e.ttimer),e.hidetimer=0,e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);e.hidetimer||(e.hidetimer=setTimeout((function(){if(e.hidetimer=0,clearTimeout(e.ttimer),!e.tt||"hide"==e.tt||e.tt.el&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e.tt.container))return e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(e.tt.opts):{},t||{});e.tt.el?e.ttimer=setTimeout((function(){i.hasover||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"none"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.fadeOut)(e.tt.container,void 0!==i.showsp?i.showsp:200,(function(){e.tt&&e.tt.container&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"auto"}),tooltips.clearZindex(e)})),i.onHide&&i.onHide()}),i.hidedt||0):e.tt="hide"}),1))}},hideAll:function(e){if(cur.tooltips)for(var t=0;t<cur.tooltips.length;++t){var i=cur.tooltips[t];e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(i.el,e)||(i.opts.forceNoHide||(i.el&&i.el.ttimer&&clearTimeout(i.el.ttimer),i.hide({fasthide:!0})))}},rePositionTT:function(e){if(e){var t=e.opts,i=e.el,r=e.container,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(i),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(i,!1,!0);if(n[0]||n[1]){var s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(r),a=t.needLeft||t.black&&lastWindowWidth&&lastWindowWidth-(o[0]+s[0])<1,c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(r.firstChild,"toup1")||t.toup||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(r,"tt_down"),l=t.shift,_=vk.rtl&&!t.asrtl||t.asrtl&&!vk.rtl;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(l)&&(l=l());var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(r));o[0]-=d[0],o[1]-=d[1];var u=o[0]+(_?l[0]+n[0]-s[0]:c?-l[0]:-(l[3]||l[0]));a&&(u-=s[0]-39),t.center&&s[0]!=n[0]&&(u-=(s[0]-n[0])/2);var m=o[1]+(c?-(s[1]+l[1]):n[1]+l[2]);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(r,{left:u,top:m})}}},rePositionAll:function(){if(cur.tooltips)for(var e=0;e<cur.tooltips.length;++e){var t=cur.tooltips[e].opts;t&&(t.nohideover||t.nohide)&&tooltips.rePositionTT(cur.tooltips[e])}},destroy:function(e){if(e){if(clearTimeout(e.ttimer),clearTimeout(e.hidetimer),e.tt&&e.tt.el){if(e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.cleanElems)(e.tt.container),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"click",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(window,"scroll",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(document,"click",e.tthide),e.tt.container){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e.tt.container);t&&t.removeChild(e.tt.container)}tooltips.clearZindex(e),e.tt.el=!1}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeAttr)(e,"tt","tthide","ttimer","hidetimer")}},destroyAll:function(e){if(cur.tooltips){for(var t=0;t<cur.tooltips.length;++t)e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(cur.tooltips[t].el,e)||cur.tooltips[t].destroy();e||delete cur.tooltips}},create:function(e,t){var i;void 0!==t.shift&&2==t.shift.length&&t.shift.push(t.shift[1]);var r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({shift:t.black?[11,8,8]:void 0!==t.dir?[2,8,8]:[2,3,3],toup:!0},t);t.black&&!r.dir&&(r.dir="auto",r.typeClass="tt_black"),e.tthide||(e.tthide=tooltips.hide.pbind(e),t.nohide||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(window,"scroll",e.tthide),t.hideOnTooltipContainerClick||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"click",e.tthide),t.hasover||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(document,"click",e.tthide)));var o=r.no_shadow?" tt_no_shadow":"";if(!r.content){if(e.tt&&!r.force)return e.hidetimer?(clearTimeout(e.hidetimer),void(e.hidetimer=0)):void 0;if(!r.text){if(!r.url)return;return clearTimeout(e.ttimer),void(e.ttimer=setTimeout((function(){e.tt="show",ajax.post(r.url,r.params||{},{onDone:function(t,i){var o=e.tt,n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(r);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{content:t||"",js:i}),tooltips.create(e,n),"shownow"==o&&tooltips.show(e,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{showdt:0}))},onFail:function(){return!0},cache:r.cache||0}),tooltips.show(e,r)}),r.ajaxdt||0))}r.content='<div class="tt_text">'+((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(r.text)?r.text():r.text),r.link&&(r.content+='<br /><a style="display: flex; margin-top: 8px" target="_blank" href="'+r.link.link+'">'+r.link.text+"</a>"),r.content+="</div>"}var n=(void 0!==r.dir?"tt_w":"tt")+" "+(void 0!==r.dir?r.typeClass||"tt_default":"")+" "+(r.className||"");if(e.tt&&e.tt.el){var s=e.tt.container;e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.geByClass1)("wrapped",s).innerHTML=r.content,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt,{opts:r,show:tooltips.show.pbind(e,t)}),s.className=n,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(s)}else{var a;a=r.black?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:r.content,className:n},{display:"none"}):void 0!==r.dir?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:'<div class="wrapped">'+r.content+"</div>",className:n+o},{display:"none"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:`<table cellspacing="0" cellpadding="0">\n    <tr><td colspan="3" class="tt_top"><div class="top_pointer"></div></td></tr>\n    <tr>\n      <td class="side_sh"></td>\n      <td class="outer"><table cellspacing="0" cellpadding="0">\n        <tr><td class="side_sh"></td>\n          <td class="wrapped">${r.content}</td>\n        <td class="side_sh"></td></tr>\n        <tr><td colspan="3"><div class="bottom_sh"></div></td></tr>\n      </table></td>\n      <td class="side_sh"></td>\n    </tr>\n    <tr><td colspan="3" class="tt_bottom"><div class="bottom_sh"></div><div class="bottom_pointer${o}"></div></td></tr>\n  </table>`,className:n},{display:"none"});var c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);if(t.appendEl)c=t.appendEl;else if(t.appendParentCls)c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)(t.appendParentCls,c);else if(!(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_w",c)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_default",c)))do{c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosestPositioned)(c||e,{noOverflow:!0})}while((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"tt_noappend"));c||(c=bodyNode),c.appendChild(a),i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({el:e,opts:r,show:tooltips.show.pbind(e,t),hide:e.tthide,destroy:tooltips.destroy.pbind(e),container:a},r.tip||{}),r.nohideover||r.text&&!r.hasover||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"mouseover",i.show),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"mouseout",i.hide)),r.hideOnTooltipContainerClick&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"click",i.hide),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(i.container,"fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(i.container,{position:"absolute"}),e.tt=i,cur.tooltips||(cur.tooltips=[]),cur.tooltips.push(i)}r.init&&r.init(i)},addAudio:function(e,t,i,r){ajax.post("audio.php",{act:"a_add",oid:t,aid:i,hash:r},{onDone:function(){e.parentNode.replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{className:"fl_r add_audio_plus done"}),e)},onFail:function(){return!0},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.nextSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.previousSibling)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.previousSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.nextSibling)}})}}}}]);try{stManager.done("dist/a1258c00747aa03727abf8c40b9e7df9.58db6bfa7b1a30782641.js")}catch(e){}