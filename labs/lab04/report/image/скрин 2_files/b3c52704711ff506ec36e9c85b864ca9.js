(self.webpackChunkvk=self.webpackChunkvk||[]).push([[68069],{95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},47934:(e,n,t)=>{"use strict";t.d(n,{default:()=>a});const a=(0,t(63192).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="add_20"><path clip-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v6.499h6.499a.75.75 0 0 1 0 1.5H10.75v6.499a.75.75 0 0 1-1.5 0v-6.5H2.751a.75.75 0 0 1 0-1.5H9.25V2.75A.75.75 0 0 1 10 2z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20,!1,void 0)},11099:(e,n,t)=>{"use strict";var a=t(95318);n.classNames=function(){for(var e=[],n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return t.forEach((function(n){if(n)switch((0,i.default)(n)){case"string":e.push(n);break;case"object":Object.keys(n).forEach((function(t){n[t]&&e.push(t)}));break;default:e.push("".concat(n))}})),e.join(" ")};var i=a(t(50008))},25805:(e,n,t)=>{"use strict";t.d(n,{init:()=>Uu});var a,i=t(70655),o=t(85893),r=t(73935),s=t(59397),l=t(67294),c=t(35886),d=t(73674),u=function(){return(0,c.useDispatch)()};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(a||(a={}));var _=(0,l.forwardRef)((function(e,n){var t=e.icon,r=e.text,l=e.type,c=e.className,d=(0,i.__rest)(e,["icon","text","type","className"]),u=(0,s.classNames)("CallButton","CallButton--"+l,c,{"CallButton--withText":!!r},"CallButton--withAnimation"),_=(0,s.classNames)("CallButton__icon","CallButton__icon--withAnimation"),v=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsxs)("button",(0,i.__assign)({className:u},v,{disabled:l===a.DISABLED,ref:n},{children:[(0,o.jsx)("figure",(0,i.__assign)({className:_},{children:t}),void 0),r]}),void 0)})),v=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"},void 0)}),void 0)},h=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"},void 0)}),void 0)},p=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"},void 0)}),void 0)},f=function(e){var n=e.id,t=e.className,a=e.children,r=(0,l.useMemo)((function(){return"radial-gradient(circle, rgb("+(48+Math.abs(n)%3*4)+","+(48+Math.abs(n)%4*5)+","+(52+Math.abs(n)%5*6)+") 40%, #0a0a0a 100%)"}),[]),c=(0,s.classNames)("BlurredBackground",t);return(0,o.jsx)("div",(0,i.__assign)({className:c,style:{background:r}},{children:a}),void 0)},m=t(3065);function A(e){var n=e.title,t=e.description,a=e.className;return(0,o.jsxs)("header",(0,i.__assign)({className:(0,s.classNames)("IncomingCallHeader",a)},{children:[(0,o.jsx)("h1",(0,i.__assign)({className:"IncomingCallHeader__title"},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"IncomingCallHeader__description"},{children:t}),void 0)]}),void 0)}var g=(0,l.forwardRef)((function(e,n){var t,a=e.type,r=e.isActive,l=e.icon,c=e.className,d=(0,i.__rest)(e,["type","isActive","icon","className"]),u=(0,s.classNames)("CallIconButton",c,"CallIconButton--withAnimation",((t={"CallIconButton--active":r})["CallIconButton--"+a]=!!a,t)),_=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsx)("button",(0,i.__assign)({},_,{className:u,ref:n},{children:l}),void 0)})),C=t(97404),E=t(71192);function S(e){var n=e.id,t=e.photo,a=e.title,r=e.description,s=e.onCollapseCall,c=e.children,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("section",(0,i.__assign)({className:"IncomingCall"},{children:[(0,o.jsx)(f,{id:n},void 0),(0,o.jsx)(C.default,(0,i.__assign)({position:"b",text:d("calls_collapse"),marginTop:-6},{children:(0,o.jsx)(g,{type:"collapse",className:"IncomingCall__collapse",onClick:s},void 0)}),void 0),(0,o.jsx)(A,{title:a,description:r},void 0),(0,o.jsx)(m.CallPhoto,{id:n,waves:!0,photo:t,alt:a||"",className:"IncomingCall__photo"},void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"IncomingCall__footer"},{children:c}),void 0)]}),void 0)}var T=t(30365),I=function(){function e(e,n,t){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=t||function(){},this.prepareFunc=n||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),n=this.iterCur;n<e;n++){var t=this.list[n];try{t._order=n}catch(e){}this.add(t)}this.iterCur=n,n>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var n,t={},a=(n=e,n.replace(/&#(\d\d+);/g,(function(e,n){return(n=!0===(t=n)?1:parseInt(t)||0)>=32?String.fromCharCode(n):e;var t})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=a.length;i--;){var o=a[i],r="";if(o){for(var s=0;s<6;s++){var l=o.charCodeAt(s);if(l){var c=this.toTranslit[l],d=o.substr(s,1);r+=null!=c?c:d}}t[r]=1}}return t},e.prototype.strToSearchPrefixes=function(e){for(var n=[],t=e.toLowerCase().split(this.delimiter),a=t.length;a--;){var i={},o=t[a],r="",s="",l="",c=o.length>1;if(o){for(var d=0;d<6;d++){var u=o.charCodeAt(d);if(u){var _=this.toTranslit[u],v=o.substr(d,1);if(r+=null!=_?_:v,c){var h=this.toLocalCase[v],p=this.toLocalTranslit[u];s+=null!=h?h:v,l+=null!=p?p:v}}}i[r]=1,c&&(i[s]=2,i[l]=3),n.push(i)}}return n},e.prototype.toIndexTree=function(e,n){for(var t=this.index,a=0;a<6;a++){var i=e.substr(a,1)||-1;t=t[i]?t[i]:t[i]=5==a?[]:{}}t.push(n)},e.prototype.remove=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)if(t.hasOwnProperty(a)){for(var i=this.index,o=0;o<6;o++){var r=a.substr(o,1)||-1;if(!i[r])break;i=i[r]}if(i.length)for(var o in i)if(this.equals(i[o],e)){i.splice(o,1);break}}},e.prototype.equals=function(e,n){for(var t in e)if(e.hasOwnProperty(t))switch(typeof e[t]){case"object":if(!this.equals(e[t],n[t]))return!1;break;case"function":if(void 0===e[t]||e[t].toString()!=n[t].toString())return!1;break;default:if(e[t]!=n[t])return!1}for(var t in n)if(void 0===n[t])return!1;return!0},e.prototype.intersect=function(e,n){var t=[];if(x(e[0])||x(n[0]))return e.filter((function(e){return-1!==n.indexOf(e)}));for(;e.length>0&&n.length>0;)if(e[0]._order<n[0]._order)e.shift();else if(e[0]._order>n[0]._order)n.shift();else{if(this.equals(e[0],n[0])){var a=e.shift();a&&t.push(a)}n.shift()}return t},e.prototype.add=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)t.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var n=this.index,t=this.strToSearchPrefixes(e),a=[],i=!1;for(var o in t)if(t.hasOwnProperty(o)){if(i&&!a)break;var r=this.localSearch(t[o],0,n);r.sort((function(e,n){return e._order-n._order})),a=i?this.intersect(a,r):r,i=!0}for(var s=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=s&&(c.push(s),s=u)}return c},e.prototype.localSearch=function(e,n,t){if(!t)return[];var a={};for(var i in e)e.hasOwnProperty(i)&&(a[r=i.substr(n,1)||-1]||(a[r]={}),a[r][i]=1);if(6==n++)return t;var o=[];for(var r in a)if("-1"===r)for(var s in t)t.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(a[r],n,t[s]));else{var l=this.localSearch(a[r],n,t[r]);o.push.apply(o,l)}return o},e}();function x(e){return!isNaN(e)}var N=function(e,n,t){var a=(0,l.useRef)(null);a.current=a.current?a.current:new I(e,n);var o=a.current,r=(0,l.useCallback)((function(e){return e.reduce((function(e,n){return e[t(n)]=!0,e}),{})}),[]),s=(0,i.__read)((0,l.useState)(e),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(r(e)),2),_=u[0],v=u[1];return(0,l.useEffect)((function(){var n=r(e),a=e.filter((function(e){return!_[t(e)]})),i=c.filter((function(e){return!n[t(e)]}));(a.length||i.length)&&(a.forEach((function(e){o.add(e)})),i.forEach((function(e){o.remove(e)})),d(e),v(n))}),[e]),o};var y=t(10930),b=function(e){var n=e.onClose,t=e.onBackdropClick,a=e.isIncoming,r=void 0!==a&&a,c=e.isCautionBoxShown,_=void 0!==c&&c,v=e.children,h=u(),p=(0,l.useContext)(y.ConfigContext).withAnimation,f=(0,s.classNames)("CallModal",{"CallModal--withAnimation":p,"CallModal--isIncoming":r});(0,l.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var m=(0,l.useCallback)((function(){return _?void h({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:r||!1}):n()}),[_]);return(0,o.jsx)(T.default,(0,i.__assign)({className:f,disableBodyScroll:!0,onClose:m,onBackdropClick:t},{children:v}),void 0)},O=t(67921),w=t(73294);function L(e){var n=e.SDK,t=e.bridge,r=(0,c.useSelector)((function(e){return e})),s=r.peer,f=r.callData,m=r.participants,A=r.caller,g=u(),C=(0,l.useContext)(E.LangContext).getLang,T=A;T||(T=(0,O.isGroupCallByPeer)(s)?f.conversation:m[s]);var I=f.type===d.CallType.VIDEO,x=C(I?"calls_incoming_videocall":"calls_incoming_audiocall"),N=C(I?"calls_reply_with_audio":"calls_reply"),y=C(I?"calls_reject_call":"calls_reject"),L=function(){n.declineCall(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:f.callId,peer_id:s,is_group_call:(0,O.isGroupCallByPeer)(s),reason:"none"})};return(0,o.jsx)(b,(0,i.__assign)({onClose:L,isIncoming:!0,isCautionBoxShown:!0},{children:(0,o.jsx)(S,(0,i.__assign)({id:s,title:(null==T?void 0:T.tab)||"",description:x,photo:(null==T?void 0:T.photo)||"",onCollapseCall:function(){g({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED})}},{children:(0,o.jsxs)(o.Fragment,{children:[I&&(0,o.jsx)(_,{text:C("calls_reply_with_video"),type:a.POSITIVE,icon:(0,o.jsx)(v,{},void 0),onClick:function(){return t.acceptCall(!0,!0)}},void 0),(0,o.jsx)(_,{text:N,type:I?a.REGULAR:a.POSITIVE,icon:(0,o.jsx)(h,{},void 0),onClick:function(){return t.acceptCall(!1,!0)}},void 0),(0,o.jsx)(_,{text:y,type:a.NEGATIVE,icon:(0,o.jsx)(p,{},void 0),onClick:L},void 0)]},void 0)}),void 0)}),void 0)}var k=c.useSelector,P=t(15464);function M(){var e=k((0,l.useCallback)((function(e){return e.devices}),[])),n=k((0,l.useCallback)((function(e){return e.participantsChunk}),[]));return(0,l.useMemo)(P.getActiveDevicesCount,[e,n])}function D(e,n){return"/video"+e+"_"+n}function j(e){var n=document.createElement("video"),t=function(){n.classList.add("Video--visible"),n.removeEventListener("loadeddata",t)};return n.addEventListener("loadeddata",t),n.autoplay=!0,n.controls=!1,n.crossOrigin="anonymous",n.playsInline=!0,n.preload="metadata",n.srcObject=e,n.volume=0,n}var R=new WeakMap,Z=(0,l.memo)((function(e){var n=e.stream,t=e.participantId,a=e.isMirrored,i=void 0!==a&&a,r=e.isContained,c=void 0!==r&&r,d=e.isStartWithVisible,u=void 0!==d&&d,_=e.isLocalSchreenShare,v=void 0!==_&&_,h=e.className,p=(0,l.useRef)(null),f=(0,l.useRef)(null),m=(0,l.useRef)(n);return(0,l.useEffect)((function(){var e,a,o,r;if(!(null===(e=p.current)||void 0===e?void 0:e.lastElementChild)||m.current!==n){var l=u;if(n&&(R.has(n)?null===(null===(a=R.get(n))||void 0===a?void 0:a.closest("body"))?(f.current=null!==(o=R.get(n))&&void 0!==o?o:null,l=!0):(f.current=j(n),f.current.dataset.participantId=t):(f.current=j(n),f.current.dataset.participantId=t,R.set(n,f.current))),f.current&&f.current.dataset.participantId!==t){var d=f.current;d.dataset.participantId=t,d.srcObject=null,d.srcObject=n;var _=function(){d.classList.add("Video--visible"),d.removeEventListener("loadeddata",_)};d.addEventListener("loadeddata",_),l=!1,d.classList.remove("Video--visible")}if(f.current&&p.current&&p.current.lastElementChild!==f.current){var h=(0,s.classNames)("Video",{"Video--contain":c,"Video--mirrored":i,"Video--visible":l||(null===(r=f.current)||void 0===r?void 0:r.classList.contains("Video--visible"))});p.current.lastElementChild&&(p.current.innerHTML=""),f.current.className=h,p.current.appendChild(f.current),f.current.play()}var A=function(){if(!v)return function(){return null};var e=n.getVideoTracks()[0],t=function(){f.current&&(f.current.srcObject=f.current.srcObject)};return null==e||e.addEventListener("mute",t),function(){return null==e?void 0:e.removeEventListener("mute",t)}}();return function(){A(),f.current&&f.current!==R.get(n)&&(f.current.srcObject=null,f.current.src="",f.current.pause(),f.current.removeAttribute("src"),f.current.load()),p.current&&(p.current.innerHTML="")}}}),[n,p.current,t]),(0,l.useEffect)((function(){f.current&&f.current.classList.toggle("Video--mirrored",i)}),[i]),(0,o.jsx)("div",{ref:p,className:h},void 0)})),B=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},n,{children:(0,o.jsx)("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"},void 0)}),void 0)},U=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"},void 0)}),void 0)},H=t(4495),V=t(13984),G=t(70226),F=function(e){var n=e.item,t=e.setOpen,a=n.disabled,r=void 0!==a&&a,l=(0,s.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":r});return"href"in n?(0,o.jsx)("a",(0,i.__assign)({href:n.href,rel:"noopener noreferrer",target:"_blank",onClick:r?void 0:function(e){e.stopPropagation(),"onClick"in n&&void 0!==n.onClick&&n.onClick(e),t(!1)},className:l},{children:n.text}),void 0):"onClick"in n?(0,o.jsxs)("button",(0,i.__assign)({onClick:r?void 0:function(e){e.stopPropagation(),n.onClick(e),t(!1)},className:l},{children:[(0,o.jsx)(V.default,{children:String(n.text)},void 0),void 0!==n.isEnabled&&(0,o.jsx)(G.default,{className:"CallsDropdown__switch",checked:n.isEnabled},void 0)]}),void 0):null},W=function(e){var n=e.isListEdge;return(0,o.jsx)("div",{className:(0,s.classNames)({CallsDropdown__separator:!n})},void 0)},z=function(e){var n=e.children,t=e.items,a=e.open,r=void 0!==a&&a,s=e.setOpen,c=e.placement;return(0,o.jsx)(H.Dropdown,(0,i.__assign)({placement:c,onShownChange:s,content:(0,o.jsx)("ul",(0,i.__assign)({className:"CallsDropdown"},{children:t.map((function(e,n,t){return(0,o.jsx)("li",(0,i.__assign)({className:"CallsDropdown__item"},{children:"separator"in e?(0,o.jsx)(W,{isListEdge:!n||t.length-1===n},void 0):(0,o.jsx)(F,{item:e,setOpen:s},void 0)}),e.key||n)}))}),void 0),shown:r},{children:(0,l.cloneElement)(n,(0,i.__assign)((0,i.__assign)({},n.props),{"data-active":r}))}),void 0)},K=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"25",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M10 8a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"},void 0),(0,o.jsx)("path",{d:"M6.558 10a.024.024 0 00-.017.04l3.254 3.255-2.947 2.948a1 1 0 001.414 1.414l2.948-2.948 3.25 3.25c.015.015.04.005.04-.017v-2.114c0-1.81.72-3.547 2-4.828l1.658-.414a.2.2 0 00.093-.336l-4-4a.2.2 0 00-.336.093L13.5 8a6.828 6.828 0 01-4.829 2H6.558z"},void 0)]}),void 0)},Q=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"56",height:"56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("path",{d:"M28.5 37.5A1.5 1.5 0 0030 36V22.622l4.94 4.939a1.5 1.5 0 002.007.103l.114-.103a1.5 1.5 0 000-2.122l-7.5-7.5a1.5 1.5 0 00-2.122 0l-7.5 7.5a1.5 1.5 0 002.122 2.122l4.938-4.939L27 36a1.5 1.5 0 001.355 1.493l.145.007z"},void 0),(0,o.jsx)("path",{d:"M19.883 8c-5.019 0-7.117.465-9.244 1.603a10.924 10.924 0 00-4.536 4.536C4.965 16.266 4.5 18.364 4.5 23.383v9.234c0 5.019.465 7.117 1.603 9.244a10.924 10.924 0 004.536 4.536C12.766 47.535 14.864 48 19.883 48h17.234c5.019 0 7.117-.465 9.244-1.603a10.924 10.924 0 004.536-4.536c1.138-2.127 1.603-4.225 1.603-9.244v-9.234c0-5.019-.465-7.117-1.603-9.244a10.924 10.924 0 00-4.536-4.536C44.234 8.465 42.136 8 37.117 8H19.883zm-7.83 4.248c1.486-.794 3-1.248 7.83-1.248h17.234c4.83 0 6.344.454 7.83 1.248a7.925 7.925 0 013.305 3.306c.794 1.485 1.248 3 1.248 7.83v9.233c0 4.83-.454 6.344-1.248 7.83a7.925 7.925 0 01-3.306 3.305c-1.485.794-3 1.248-7.83 1.248H19.884c-4.83 0-6.344-.454-7.83-1.248a7.925 7.925 0 01-3.305-3.306c-.794-1.485-1.248-3-1.248-7.83v-9.233c0-4.83.454-6.344 1.248-7.83a7.925 7.925 0 013.306-3.305z"},void 0)]}),void 0)};function Y(e){var n=e.isInverted,t=(0,s.classNames)("CallingStatus",{"CallingStatus--inverted":!!n}),a=(0,s.classNames)("CallingStatus__part","CallingStatus__part--withAnimation");return(0,o.jsxs)("div",(0,i.__assign)({className:t},{children:[(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0)]}),void 0)}var J=t(53996),X=t(63192);const q=(0,X.makeIcon)("Icon16Connection","connection_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="connection_16"><path d="M12 2a1 1 0 0 0-1 1v10a1 1 0 1 0 2 0V3a1 1 0 0 0-1-1ZM7 5.5a1 1 0 0 1 2 0V13a1 1 0 1 1-2 0V5.5ZM3 8a1 1 0 0 1 2 0v5a1 1 0 1 1-2 0V8Z" /></symbol>',16,16,!1,void 0);var $,ee;!function(e){e.VkCalls="vkcalls",e.Sferum="sferum"}(ee||(ee={}));var ne=function(){function e(){}return e.setAppType=function(n){e._appType=n},e.getAppType=function(){return e._appType},e.getLsKeys=function(){return e._lsKeysMap[e._appType]},e._appType=ee.VkCalls,e._lsKeysMap=(($={})[ee.VkCalls]=d.LS_KEYS,$[ee.Sferum]=d.LS_SFERUM_KEYS,$),e}(),te={queryOption:function(e){return te.getOptions()[e]},getOptions:function(){try{var e=ne.getLsKeys(),n=localStorage.getItem(e.VIDEO_OPTIONS);if("string"!=typeof n)throw new Error("no value stored");return JSON.parse(n)}catch(e){return te.getDefaultOptions()}},saveOption:function(e,n){var t,a=(0,i.__assign)((0,i.__assign)({},te.getOptions()),((t={})[e]=n,t)),o=ne.getLsKeys();return localStorage.setItem(o.VIDEO_OPTIONS,JSON.stringify(a)),a},saveOptions:function(e){var n=ne.getLsKeys();return localStorage.setItem(n.VIDEO_OPTIONS,JSON.stringify(e)),e},getDefaultOptions:function(){return{calls_is_video_mirrored:!0}}},ae=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT);return"string"!=typeof n?d.EVideoEffectType.NONE:/^\d+$/.test(n)?+n:n},ie=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT,""+e)},oe=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS);return"string"!=typeof n?0:+n},re=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS,""+e)},se=function(){var e=ne.getLsKeys();localStorage.removeItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS)},le=function(){var e=(0,c.useSelector)((function(e){return e.virtualBackgroundSettings.videoOptions})),n=u(),t=(0,i.__read)((0,l.useState)(te.getOptions),2),a=t[0],o=t[1],r=(0,l.useCallback)((function(){o(te.getOptions())}),[]),_=(0,l.useCallback)((function(){te.saveOptions(a),n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[a]),v=(0,l.useCallback)((function(e,n){o((function(t){var a;return(0,i.__assign)((0,i.__assign)({},t),((a={})[e]=n,a))}))}),[]);return(0,l.useEffect)((function(){(0,s.isEqual)(e,a)||n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[]),{videoOptions:a,storedVideoOptions:e,setVideoOptions:o,onRestoreSettings:r,onSaveSettings:_,onChangeVideoOption:v}},ce=(0,l.memo)((function(e){var n=e.externalId,t=e.isVisible,a=void 0===t||t,r=e.isOrator,c=void 0!==r&&r,u=e.isInfoShown,_=e.isPinned,v=e.isPinnedByAdmin,h=e.isHandRaised,p=e.photo,A=e.hasVideo,g=e.hasAudio,C=e.isSharingScreen,S=e.isSpeaking,T=void 0!==S&&S,I=e.stream,x=void 0===I?null:I,N=e.isMe,b=void 0!==N&&N,O=e.name,w=e.letter,L=e.status,k=void 0===L?J.ParticipantStatus.CONNECTED:L,M=e.wasConnected,D=void 0===M||M,j=e.networkStatus,R=void 0===j?1:j,H=e.onClickParticipant,V=e.onDblClickParticipant,G=e.onStopScreenShare,F=e.allowContain,W=e.actions,X=(0,l.useContext)(E.LangContext).getLang,$=(0,l.useContext)(y.ConfigContext),ee=$.withAnimation,ne=$.anonymPhoto,te=(0,l.useRef)(null),ae=(0,P.isParticipantAnonym)(n),ie=le().storedVideoOptions,oe=(0,P.externalIdToString)(n),re=!!H||!!V,se=c&&C&&b,ce=(0,s.classNames)("Participant",{"Participant--isInteractive":re,"Participant--isPinned":_,"Participant--isSpeaking":T,"Participant--isOrator":c,"Participant--withAnimation":ee}),de=(0,s.classNames)("Participant__more",{"Participant__more--withAnimation":ee}),ue=(0,i.__read)((0,l.useState)(!1),2),_e=ue[0],ve=ue[1],he=(0,l.useCallback)((function(e){H&&H(e,n)}),[H]),pe=(0,l.useCallback)((function(e){V&&V(e,n)}),[V]),fe=(0,s.classNames)({Participant__offsetCard:u,Participant__oratorPhoto:c});return(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__wrapper"},{children:[a&&W&&W.length>0&&(0,o.jsx)(z,(0,i.__assign)({items:W,open:_e,setOpen:ve},{children:(0,o.jsx)("button",(0,i.__assign)({className:de,"aria-label":X("calls_actions")},{children:(0,o.jsx)(U,{},void 0)}),void 0)}),void 0),(0,o.jsxs)("article",(0,i.__assign)({ref:te,className:ce,onClick:he,onDoubleClick:pe,"participant-id":oe},{children:[!a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(m.CallPhoto,{id:+n.id,photo:!ne&&ae?"":p,alt:O||"",letter:w,className:fe},void 0)}),void 0),u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!g&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),a&&(0,o.jsxs)(o.Fragment,{children:[!(A&&c)&&(0,o.jsx)(f,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(m.CallPhoto,{id:+n.id,photo:!ne&&ae?"":p,alt:O||"",className:fe},void 0)}),void 0),h&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(B,{className:"Participant__handIcon"},void 0)}),void 0),se&&(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__screenSharer"},{children:[(0,o.jsx)(Q,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"Participant__screenSharerText"},{children:X("calls_you_are_screen_sharer")}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"Participant__screenSharerButton",onClick:G},{children:X("calls_screen_share_stop")}),void 0)]}),void 0),x&&A&&!se&&(0,o.jsx)(Z,{className:"Participant__main",participantId:oe,stream:x,isMirrored:b&&!C&&ie[d.EVideoOptionType.IS_VIDEO_MIRRORED],isContained:F||C,isStartWithVisible:b,isLocalSchreenShare:b&&C},void 0),k!==J.ParticipantStatus.CONNECTED&&!b&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__status"},{children:(0,o.jsx)(Y,{isInverted:!0},void 0)}),void 0),!c&&u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(g||x||C)&&R<.6&&(0,o.jsx)(q,{fill:R<=.3?"#ff5c5c":"#FECE00"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!g&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),!v&&_&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),v&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(K,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)]}),void 0)})),de=(0,l.memo)((function(e){var n=(0,P.externalIdToString)(e.externalId),t=k((0,l.useCallback)((function(e){var t;return null===(t=e.speakers)||void 0===t?void 0:t[n]}),[n])),a=e.hasAudio&&t&&e.isVisible;return(0,o.jsx)(ce,(0,i.__assign)({},e,{isSpeaking:a}),void 0)})),ue=t(25685),_e=function(){var e,n,t,a,r=(0,ue.useLang)().getLang,l=k((function(e){var n=e.localDevice,t=e.externalId,a=e.me,i=e.peer,o=e.devices,r=e.participants;return{localDevice:n,peerDevice:(0,P.getPeerIdDeviceInfo)(i,o),meParticipant:t&&r[a],peerParticipant:r[i],externalId:t}})),c=l.externalId,d=l.localDevice,u=l.meParticipant,_=l.peerDevice,v=l.peerParticipant,h=(0,P.isParticipantWithVideo)(d),p=!(!_||!(0,P.isParticipantWithVideo)(_)),f=(0,s.classNames)("OneToOne",{"OneToOne--hasVideo":h,"OneToOne--opponentHasVideo":p});return(0,o.jsxs)("div",(0,i.__assign)({className:f},{children:[(0,o.jsx)("aside",(0,i.__assign)({className:"OneToOne__local"},{children:c&&u&&(0,o.jsx)(ce,{externalId:c,hasVideo:h,hasAudio:!!(null===(e=d.mediaSettings)||void 0===e?void 0:e.isAudioEnabled),isSharingScreen:!!(null===(n=d.mediaSettings)||void 0===n?void 0:n.isScreenSharingEnabled),stream:(0,P.getStream)(d),isMe:!0,name:r("calls_own_label"),letter:null==u?void 0:u.name.slice(0,1),wasConnected:d.wasConnected,allowContain:!0,networkStatus:d.networkStatus},void 0)}),void 0),(0,o.jsx)("main",(0,i.__assign)({className:"OneToOne__remote"},{children:v&&_&&(0,o.jsx)(ce,{externalId:_.externalId,hasVideo:p,hasAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isSharingScreen:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,P.getStream)(_),photo:v.photo,name:v.name,allowContain:!0,wasConnected:_.wasConnected,networkStatus:_.networkStatus},void 0)}),void 0)]}),void 0)},ve=(0,l.forwardRef)((function(e,n){var t=e.children,a=e.className,r=e.alignX,l=e.alignY,c=e.size,d=void 0===c?"m":c,u=(0,i.__rest)(e,["children","className","alignX","alignY","size"]),_=(0,s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+l,"CallIconButtonGroup--size-"+d,a);return(0,o.jsx)("div",(0,i.__assign)({className:_,ref:n},u,{children:t}),void 0)})),he=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"},void 0)}),void 0)},pe=(0,l.forwardRef)((function(e,n){var t=e.unreadCount,a=void 0===t?0:t,r=(0,i.__rest)(e,["unreadCount"]),c=(0,l.useContext)(y.ConfigContext).withAnimation,d="",u="";switch(!0){case!a:d="none";break;case a<=9:d="single",u=a.toString();break;case a<=99:d="double",u=a.toString();break;case a>99:d="max",u="99+"}var _=(0,s.classNames)("ChatIconButton","ChatIconButton--"+d,{"ChatIconButton--withAnimation":c});return(0,o.jsx)("button",(0,i.__assign)({className:_},r,{ref:n},{children:u&&(0,o.jsx)("div",(0,i.__assign)({className:"ChatIconButton__count "},{children:u}),void 0)}),void 0)})),fe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M20.465 4.4c-.489-.26-.974-.4-2.31-.4H5.844c-1.336 0-1.821.14-2.31.4A2.726 2.726 0 002.4 5.536C2.139 6.024 2 6.509 2 7.845v8.31c0 1.336.14 1.821.4 2.31.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h12.31c1.336 0 1.821-.14 2.31-.4a2.726 2.726 0 001.134-1.135c.262-.489.401-.974.401-2.31v-8.31c0-1.336-.14-1.821-.4-2.31A2.726 2.726 0 0020.464 4.4zm-11.81 5.728l2.97-2.978c.207-.2.543-.2.75 0l2.97 2.978c.33.318.077.872-.376.872H13v4.979c0 .564-.442 1.021-1 1.021s-1-.457-1-1.021V11H9.031c-.44 0-.715-.545-.375-.872z"},void 0)}),void 0)},me=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"},void 0)}),void 0)},Ae=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"},void 0)}),void 0)},ge=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"},void 0)}),void 0)},Ce=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"},void 0)}),void 0)},Ee=t(51013),Se=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.49 4.293a4.402 4.402 0 116.225 6.225l-1.072 1.072a.9.9 0 01-1.273-1.273l1.071-1.072a2.601 2.601 0 10-3.678-3.678l-3.537 3.537a2.601 2.601 0 000 3.678.9.9 0 01-1.274 1.273 4.402 4.402 0 010-6.225l3.537-3.537zm-.708 5.66a.9.9 0 011.273 0 4.402 4.402 0 010 6.225l-3.537 3.537a4.402 4.402 0 11-6.225-6.226l1.122-1.121a.9.9 0 111.273 1.273l-1.121 1.122a2.601 2.601 0 103.678 3.678l3.537-3.537a2.601 2.601 0 000-3.678.9.9 0 010-1.274z",fill:"#fff"},void 0)}),void 0)};const Te=(0,X.makeIcon)("Icon24Live","live_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="live_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M12 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5Zm0-2a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0-2a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13Zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Zm0-2a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Ie=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"},void 0)}),void 0)},xe=(0,l.forwardRef)((function(e,n){var t=e.participantCount,r=e.onClick,l=e.isParticipantControlActive,c=(0,o.jsx)(Ie,{},void 0);if(t&&t>0){var d="";(d=t>99?"99+":null==t?void 0:t.toString())&&(c=(0,o.jsxs)("div",{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)({ParticipantIconButton__count:!0,"ParticipantIconButton__count--lt99":t<=99})},{children:d}),void 0),c]},void 0))}return(0,o.jsx)(_,{type:l?a.OFF:a.ON,icon:c,onClick:r,className:"Call__footerButton",ref:n},void 0)})),Ne=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"},void 0)]}),void 0)},ye=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"},void 0)}),void 0)},be=t(11099),Oe=function(){var e=(0,be.classNames)({MicIconWithSpeakingIndicator__scale:!0});return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},{children:[(0,o.jsx)("mask",(0,i.__assign)({id:"MicIconWithSpeakingIndicatorMask"},{children:(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0)}),void 0),(0,o.jsx)("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"},void 0),(0,o.jsx)("g",(0,i.__assign)({mask:"url(#MicIconWithSpeakingIndicatorMask)"},{children:(0,o.jsxs)("g",(0,i.__assign)({className:e},{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"},void 0)]}),void 0)}),void 0)]}),void 0)},we=(0,l.forwardRef)((function(e,n){var t=e.isAudioAllowed,i=e.isAudioEnabled,r=e.onToggleAudio,s=k((function(e){return!(!e.externalId||!e.speakers[(0,P.externalIdToString)(e.externalId)])})),l=i?s?(0,o.jsx)(Oe,{},void 0):(0,o.jsx)(Ne,{},void 0):(0,o.jsx)(ye,{},void 0),c=t?i?a.ON:a.OFF:a.DISABLED;return(0,o.jsx)(_,{type:c,icon:l,onClick:r,className:"Call__footerButton",ref:n},void 0)}));const Le=(0,X.makeIcon)("Icon24Settings","settings_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418ZM12 16.75a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var ke=function(e){var n=e.tooltips,t=e.onTooltipChange,a=e.getRootRef,r=e.isDropdownOpen,s=e.tooltipTitle,l=(0,i.__rest)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","tooltipTitle"]);return(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:s,open:n.settings,delay:300,onOpen:function(){return t("settings",!0)},onClose:function(){return t("settings",!1)},forceClose:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallSettingsButton__outer"},{children:(0,o.jsx)("div",(0,i.__assign)({},l,{ref:a,className:"CallSettingsButton__inner"},{children:(0,o.jsx)(g,{icon:(0,o.jsx)(Le,{},void 0)},void 0)}),void 0)}),void 0)}),void 0)};function Pe(e){var n,t,r=e.info,c=e.chatUnreadCount,u=void 0===c?0:c,h=e.callMenuActions,p=e.isAudioAllowed,f=void 0!==p&&p,m=e.isVideoAllowed,A=void 0!==m&&m,C=e.isVideoEnabled,S=void 0!==C&&C,T=e.isAudioEnabled,I=void 0!==T&&T,x=e.isScreenSharingEnabled,N=void 0!==x&&x,b=e.isOratorMode,O=void 0===b||b,w=e.isFullScreen,L=void 0!==w&&w,k=e.onToggleVideo,P=e.onToggleAudio,M=e.onLeaveCall,D=e.onCollapseCall,j=e.onToggleOratorMode,R=e.onChat,Z=e.onHandClick,B=e.onToggleScreenShare,U=e.onFullScreenToggle,H=e.onDeferredStreamStart,V=e.isParticipantControlActive,G=void 0!==V&&V,F=e.isLayoutSwitchShown,W=void 0!==F&&F,K=e.isScreenShareControlShown,Q=void 0!==K&&K,Y=e.isHandRaised,J=void 0!==Y&&Y,X=e.isHandControlShown,q=void 0!==X&&X,$=e.isChatControlShown,ee=void 0!==$&&$,ne=e.isStreamingControlShown,te=void 0!==ne&&ne,ae=e.isChainControlShown,ie=void 0!==ae&&ae,oe=e.onParticipantsClick,re=e.onTooltipChange,se=e.onHidePanel,le=e.notification,ce=e.tooltips,de=e.onChainClick,ue=e.notificationWithButton,_e=e.withoutPadding,Ie=void 0!==_e&&_e,Ne=e.participantCount,ye=void 0===Ne?0:Ne,be=e.children,Oe=e.isPopupOrModalOpen,Le=(0,l.useContext)(y.ConfigContext),Pe=Le.withAnimation,Me=Le.isModalView,De=(0,l.useContext)(E.LangContext).getLang,je=(0,s.classNames)("Call",{"Call--fullscreen":L||!Me}),Re=(0,s.classNames)("Call__content",{"Call__content--withoutPadding":Ie}),Ze=300,Be=null===(t=null===(n=window.location)||void 0===n?void 0:n.host)||void 0===t?void 0:t.includes(d.VK_HOST),Ue=(0,l.useRef)(null),He=(0,l.useRef)(null),Ve=(0,l.useRef)(null),Ge=(0,l.useRef)(null),Fe=(0,i.__read)((0,l.useState)(!1),2),We=Fe[0],ze=Fe[1],Ke=(0,i.__read)(function(e,n,t,a,o,r){var c=(0,i.__read)((0,l.useState)(!0),2),d=c[0],u=c[1],_=(0,l.useRef)(null),v=(0,l.useRef)(!1),h=(0,l.useRef)(!1),p=(0,l.useRef)(!1);p.current!==r&&(p.current=r);var f=(0,l.useRef)(!1),m=function(){v.current||f.current?f.current=!1:(_.current&&window.clearTimeout(_.current),u(!0),h.current||p.current||(_.current=window.setTimeout((function(){u(!1),_.current=null,o&&o()}),5e3)))};return(0,l.useEffect)((function(){m();var i=(0,s.throttle)((function(){m()}),1e3),o=function(){h.current=!0},r=function(){h.current=!1};return n.current.addEventListener("mouseenter",o),n.current.addEventListener("mouseleave",r),t.current.addEventListener("mouseenter",o),t.current.addEventListener("mouseleave",r),a.current.addEventListener("mouseenter",o),a.current.addEventListener("mouseleave",r),e.current.addEventListener("mousemove",i),function(){v.current=!0,_.current&&window.clearTimeout(_.current),n.current&&(n.current.removeEventListener("mouseenter",o),n.current.removeEventListener("mouseleave",r)),t.current&&(t.current.removeEventListener("mouseenter",o),t.current.removeEventListener("mouseleave",r)),a.current&&(a.current.removeEventListener("mouseenter",o),a.current.removeEventListener("mouseleave",r)),e.current&&e.current.removeEventListener("mousemove",i)}}),[h,p.current]),[d,function(e){e?u(!0):(u(!1),f.current=!0)}]}(Ue,He,Ve,Ge,se,We),2),Qe=Ke[0],Ye=Ke[1],Je=(0,s.classNames)({"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),Xe=(0,s.classNames)({"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"Call__curtain"),qe=(0,s.classNames)("Call__buttons",{"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),$e=(0,l.useCallback)((function(){return Ye(!0)}),[]),en=(0,l.useCallback)((function(){Oe||(Ye(!1),ce.streaming&&re("streaming",!1))}),[Oe,ce.streaming]);return(0,o.jsxs)("section",(0,i.__assign)({className:je,onMouseEnter:$e,onMouseLeave:en,ref:Ue},{children:[r,le,(0,o.jsx)("div",(0,i.__assign)({className:Re,"data-calls-id":"content"},{children:be}),void 0),(0,o.jsx)("div",{className:Xe},void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",className:Je,ref:Ve},{children:(0,o.jsxs)(o.Fragment,{children:[ee&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_chat"),open:ce.chat,delay:Ze,onOpen:function(){return re("chat",!0)},onClose:function(){return re("chat",!1)}},{children:(0,o.jsx)(pe,{unreadCount:u,onClick:R},void 0)}),void 0),q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(J?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:ce.hand,delay:Ze,onOpen:function(){return re("hand",!0)},onClose:function(){return re("hand",!1)}},{children:(0,o.jsx)(g,{icon:(0,o.jsx)(me,{},void 0),type:"hand",isActive:J,onClick:Z},void 0)}),void 0),Q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(N?"calls_stop_screen_share":"calls_start_screen_share"),open:ce.screenShare,delay:Ze,onOpen:function(){return re("screenShare",!0)},onClose:function(){return re("screenShare",!1)}},{children:(0,o.jsx)(g,{icon:(0,o.jsx)(fe,{},void 0),isActive:N,onClick:B},void 0)}),void 0),te&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_call_menu_translation"),open:ce.streaming,delay:Ze,onOpen:function(){return re("streaming",!0)},onClose:function(){return re("streaming",!1)}},{children:(0,o.jsx)(g,{icon:(0,o.jsx)(Te,{},void 0),isActive:te,onClick:H},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",style:L&&Be?{right:"78px"}:void 0,className:Je,ref:Ge},{children:(0,o.jsxs)(o.Fragment,{children:[W&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(O?"calls_show_grid":"calls_show_orator"),open:ce.layout,delay:Ze,onOpen:function(){return re("layout",!0)},onClose:function(){return re("layout",!1)}},{children:(0,o.jsx)(g,{type:O?"changeToGrid":"changeToOrator",onClick:j},void 0)}),void 0),h&&(0,o.jsx)(z,(0,i.__assign)({items:h,open:We,setOpen:ze,placement:"top-end"},{children:(0,o.jsx)(ke,{onTooltipChange:re,tooltips:ce,isDropdownOpen:We,tooltipTitle:De("calls_settings")},void 0)}),void 0),D&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_collapse"),open:ce.collapse,delay:Ze,onOpen:function(){return re("collapse",!0)},onClose:function(){return re("collapse",!1)}},{children:(0,o.jsx)(g,{type:"collapse",onClick:D},void 0)}),void 0),U&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(L?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:ce.fullscreen,delay:Ze,onOpen:function(){return re("fullscreen",!0)},onClose:function(){return re("fullscreen",!1)}},{children:(0,o.jsx)(g,{onClick:U,icon:L?(0,o.jsx)(Ae,{},void 0):(0,o.jsx)(ge,{},void 0)},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"Call__footer",ref:He},{children:(0,o.jsxs)("div",(0,i.__assign)({className:qe},{children:[ie&&de&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_menu_link"),open:ce.chainlink,delay:Ze,onOpen:function(){return re("chainlink",!0)},onClose:function(){return re("chainlink",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.ON,icon:(0,o.jsx)(Se,{},void 0),onClick:de,className:"Call__footerButton"},void 0)}),void 0),oe&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_participants"),open:ce.participants,delay:Ze,onOpen:function(){return re("participants",!0)},onClose:function(){return re("participants",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(xe,{isParticipantControlActive:G,onClick:oe,participantCount:ye},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(S?"calls_camera_turn_off":"calls_camera_turn_on"),open:ce.video,delay:Ze,onOpen:function(){return re("video",!0)},onClose:function(){return re("video",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:A?S?a.ON:a.OFF:a.DISABLED,icon:S?(0,o.jsx)(v,{},void 0):(0,o.jsx)(Ce,{},void 0),onClick:k,className:"Call__footerButton"},void 0)}),void 0),P&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(I?"calls_mic_turn_off":"calls_mic_turn_on"),open:ce.audio,delay:Ze,onOpen:function(){return re("audio",!0)},onClose:function(){return re("audio",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(we,{isAudioAllowed:f,isAudioEnabled:I,onToggleAudio:P},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_exit"),open:ce.leaveCall,delay:Ze,onOpen:function(){return re("leaveCall",!0)},onClose:function(){return re("leaveCall",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.NEGATIVE,icon:(0,o.jsx)(he,{},void 0),onClick:M,className:"Call__footerButton"},void 0)}),void 0)]}),void 0)}),void 0),ue&&ue]}),void 0)}var Me=t(39664),De=function(e){var n=e.onScroll,t=e.scrollPosition,a=e.participantsCount,r=e.participantsShiftCount,c=e.children,d=l.Children.toArray(c),u=(0,s.classNames)("CallGridNew","CallGridNew--c"+a),_=(0,l.useRef)(null);(0,l.useEffect)((function(){var e=function(){null!==_.current&&n(_.current.scrollTop)};return null!==_.current&&_.current.addEventListener("scroll",e),function(){_.current&&_.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;n(t),null===(e=_.current)||void 0===e||e.scrollTo(0,t)}),[_.current]);var v=(0,l.useMemo)((function(){return new Array(r).fill(0).map((function(e,n){return(0,o.jsx)("article",{className:"CallGridNew__item CallGridNew__item--empty"},-n)}))}),[r]),h=a-r-d.length>0;return(0,o.jsxs)("section",(0,i.__assign)({className:u,ref:_},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallGridNew__in"},{children:[v,d.map((function(e,n){return(0,o.jsx)("article",(0,i.__assign)({className:"CallGridNew__item","data-calls-id":"grid-item"},{children:e}),e.key||n)}))]}),void 0),h&&(0,o.jsx)(Me.default,{color:"white",size:64,duration:1,className:"CallGridNew__spinner"},void 0)]}),void 0)},je=function(e){var n=e.children,t=e.orator,a=e.oratorTitle,r=e.onToggleParticipantsAside,c=e.isShownParticipantsAside,d=e.onScroll,u=e.scrollPosition,_=e.participantsAsideCount,v=e.participantsAsideShift,h=l.Children.toArray(n),p=(0,s.classNames)({CallOrator__toggleIcon:!0,"CallOrator__toggleIcon--withAnimation":!0}),f=(0,s.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!c}),m=(0,s.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!c}),A=(0,s.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":c,"CallOrator__toggleArrow--toRight":!c}),g=(0,l.useRef)(null);return(0,l.useEffect)((function(){var e=function(){null!==g.current&&d(g.current.scrollTop)};return null!==g.current&&g.current.addEventListener("scroll",e),function(){g.current&&g.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;d(u),null===(e=g.current)||void 0===e||e.scrollTo(0,u)}),[g.current]),(0,o.jsxs)("article",(0,i.__assign)({className:f,ref:g},{children:[(0,o.jsx)("main",(0,i.__assign)({className:"CallOrator__orator"},{children:t}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"CallOrator__toggleOthers",onClick:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:p},{children:(0,o.jsx)("div",{className:A},void 0)}),void 0)}),void 0),(0,o.jsx)("aside",(0,i.__assign)({className:m},{children:(0,o.jsxs)("ul",(0,i.__assign)({className:"CallOrator__list",style:{height:148*_-8+"px"}},{children:[v>0&&(0,o.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",style:{height:v+"px"}},-1),h.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallOrator__participant","data-calls-id":"participant"},{children:e}),"key"in e?e.key:void 0)}))]}),void 0)}),void 0),a]}),void 0)},Re=t(41118);function Ze(e,n){var t=e.browser.hasMicrophonePermission(),a=e.browser.hasCameraPermission(),o=n.includes(J.MediaOption.AUDIO)&&!t,r=n.includes(J.MediaOption.VIDEO)&&!a;return o||r?function(e,n,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){return(0,i.__generator)(this,(function(a){return[2,e.browser.getUserMedia(n,t).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))]}))}))}(e,r,o):Promise.resolve()}var Be=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"14",height:"12",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"},void 0)}),void 0)},Ue=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("CallNotification",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},He=function(e){var n=e.duration;return(0,o.jsx)("div",{className:"CallTimer","aria-label":n,"data-duration":n},void 0)},Ve=t(78658),Ge=t(90355),Fe=function(e){var n=e.status,t=(0,l.useContext)(E.LangContext).getLang;switch(n){case J.ParticipantStatus.WAITING:return(0,o.jsx)(Ge.default,{children:t("calls_status_waiting")},void 0);case J.ParticipantStatus.CONNECTING:case J.ParticipantStatus.RECONNECT:return(0,o.jsx)(Ge.default,{children:t("calls_status_connecting")},void 0);case J.ParticipantStatus.ERROR:return t("calls_error");case J.ParticipantStatus.HANGUP:return(0,o.jsx)(Ge.default,{children:t("calls_status_hangup")},void 0);case J.ParticipantStatus.PERMISSIONS:return t("calls_status_no_permissions");case J.ParticipantStatus.CONNECTED:default:return null}};function We(e){return e?(0,o.jsx)(He,{duration:(0,Ve.calculateCallDuration)(e)},void 0):null}function ze(e,n){if(e.hangupType)switch(e.hangupType){case d.HANGUP_TYPE_BUSY:return n("calls_busy");case d.HANGUP_TYPE_CALLEE_IS_OFFLINE:return n("calls_callee_is_offline");case d.HANGUP_TYPE_REJECTED:return n("calls_rejected_status");case d.HANGUP_TYPE_CANCELED:case d.HANGUP_TYPE_MISSED:case d.HANGUP_TYPE_HUNGUP:case d.HANGUP_TYPE_REMOVED:return null;case d.HANGUP_TYPE_CALLER_IS_BLOCKED:case d.HANGUP_TYPE_EXTERNAL_API_ERROR:case d.HANGUP_TYPE_FAILED:case d.HANGUP_TYPE_NOT_FRIENDS:case d.HANGUP_TYPE_OLD_VERSION:case d.HANGUP_TYPE_SERVICE_DISABLED:case d.HANGUP_TYPE_UNKNOWN_ERROR:case d.HANGUP_TYPE_UNSUPPORTED:return n("calls_error")}return null}var Ke=function(e,n){return e?ze(e,n)||function(e,n){var t,a=null;return(a=n===e.me?e.localDevice:(0,P.getPeerIdDeviceInfo)(n,e.devices))&&a.status===J.ParticipantStatus.CONNECTED||a&&a.status===J.ParticipantStatus.WAITING_HALL||(0,P.getActiveParticipantsCount)(e)<2?null:(0,o.jsx)(Fe,{status:null!==(t=null==a?void 0:a.status)&&void 0!==t?t:J.ParticipantStatus.WAITING},void 0)}(e,(0,O.isGroupCallByPeer)(e.peer)?e.me:e.peer)||function(e,n){return void 0===((0,O.isGroupCallByPeer)(e.peer)?e.callData.ts:e.callData.localTimeStamp)?(0,o.jsx)(Ge.default,{children:n("calls_status_waiting")},void 0):null}(e,n):""},Qe=function(e){var n=e.dispatch,t=e.notification,a=e.participant,r=(0,l.useContext)(E.LangContext),s=r.getLang,u=r.langSex,_=(0,c.useSelector)((function(e){return e})),v=(0,l.useMemo)((function(){return function(e,n,t,a){void 0===a&&(a={name:"",sex:"0",shortName:""});if(!e)return null;switch(e.type){case d.NotificationType.SPEAKING_ON_MUTE:return n("calls_notification_mic_is_mute");case d.NotificationType.SCREEN_SHARING_STARTED:if(!a||!a.name)return(0,o.jsx)("span",{children:n("calls_notification_screen_sharing_started")},void 0);var r=t(a.sex,"calls_notification_user_started_screen_sharing",n("calls_notification_user_started_screen_sharing",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.RAISED_HAND:if(!a||!a.name)return null;r=t(a.sex,"calls_notification_raised_hand",n("calls_notification_raised_hand",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION:return(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection")},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[(0,o.jsx)(Be,{},"icon"),(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection_disable_camera")},"text")];case d.NotificationType.ADMIN_ROLE_GRANTED:return(0,o.jsx)("span",{children:n("calls_notification_admin_role_granted")},"text");case d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:if(!a||!a.name&&!a.shortName)return null;var s=n("calls_notification_user_granted_with_admin_role").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PINNED_BY_ADMIN:return(0,o.jsx)("span",{children:n("calls_notification_admin_pinned_self")},"text");case d.NotificationType.USER_PINNED_BY_ADMIN:if(!a||!a.name&&!a.shortName)return null;s=n("calls_notification_admin_pinned_user").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PUSH_TO_TALK:s=n("calls_notification_push_to_talk_enabled");return[e.data?(0,o.jsx)(Oe,{},"icon"):(0,o.jsx)(Ne,{},"icon"),(0,o.jsx)("div",(0,i.__assign)({className:"CallNotification__pushToTalkText"},{children:s}),"text")];case d.NotificationType.LINK_COPIED_TO_CLIPBOARD:s=n("calls_create_call_by_link_copied");return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.ADMIN_MUTE:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute")},"text");case d.NotificationType.ADMIN_MUTE_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_video")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_video")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_audio")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_video")},"text");default:return null}}(t,s,u,a)}),[t,a]),h=(0,l.useRef)(0);(0,l.useEffect)((function(){return h.current&&window.clearTimeout(h.current),t&&0!==t.timer&&(h.current=window.setTimeout((function(){n({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),h.current=0}),t.timer||d.defaultNotificationLifeSpan)),function(){h.current&&window.clearTimeout(h.current)}}),[t]);var p=(0,l.useMemo)((function(){return(0,P.getActiveDevices)(_).activeDevices}),[_.devices,_.participantsChunk,_.me,_.groupId,_.meGroup]),f=(0,l.useMemo)((function(){return(0,O.isGroupCallByPeer)(_.peer)}),[_.peer]),m=p.length>1,A=f||p.length>2,g=m||(0,P.isParticipantWithVideo)(_.localDevice),C=A&&g&&_.isOratorMode,S=(0,be.classNames)("",{CallNotification__pushToTalk:(null==t?void 0:t.type)===d.NotificationType.PUSH_TO_TALK,CallNotification__orator:C&&_.isShownParticipantsAside}),T=_.peer,I=(0,O.isGroupCallByPeer)(T)?_.callData.conversation:(0,P.getPeerIdDeviceInfo)(T,_.devices),x=(0,i.__read)((0,l.useState)(),2),N=x[0],y=x[1],b=(0,i.__read)((0,l.useState)(""),2),w=b[0],L=b[1];return(null==I?void 0:I.status)!==N&&(L(Ke(_,s)),y(null==I?void 0:I.status)),(0,l.useEffect)((function(){L(Ke(_,s))}),[_]),t||w?(0,o.jsx)(Ue,(0,i.__assign)({className:S},{children:w||v}),void 0):null};var Ye=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},n,{children:(0,o.jsx)("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"},void 0)}),void 0)},Je=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C4.546 0 1.596 2.073.4 5c1.196 2.927 4.146 5 7.6 5 3.455 0 6.405-2.073 7.6-5-1.195-2.927-4.145-5-7.6-5zm3.5 5a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zM8 7a2 2 0 100-4 2 2 0 000 4z",fill:"#F5F5F5"},void 0)}),void 0)},Xe=t(53449),qe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({xmlns:"http://www.w3.org/2000/svg",width:"8",height:"4",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},n,{children:(0,o.jsx)("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"},void 0)}),void 0)};const $e=(0,X.makeIcon)("Icon12Hand","hand_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="hand_12"><path d="M2.5 2.5A.5.5 0 0 1 3 3v2.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0V5a.5.5 0 0 0 1 0V1a.5.5 0 0 1 1 0v4.063a.5.5 0 0 0 1 0V1.938a.5.5 0 0 1 1 0V7.5l-.28-.032 1.774-1.898a.67.67 0 0 1 .995.9c-.677.774-2.013 2.306-2.615 3.029C7.935 10.624 6.56 11 5.526 11 2.15 11 2 8.727 2 7.958V3a.5.5 0 0 1 .5-.5Z" /></symbol>',12,12,!1,void 0),en=(0,X.makeIcon)("Icon20RecordingCircleFill","recording_circle_fill_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="recording_circle_fill_20"><path d="M10 14a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" /><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-1.657 0a6.343 6.343 0 1 1-12.686 0 6.343 6.343 0 0 1 12.686 0Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var nn=function(e){var n=e.translationTimer,t=e.viewersCount,a=void 0===t?0:t,r=e.isLiveIndicatorOff,l=void 0!==r&&r,c=e.actions,d=void 0===c?[]:c,u=e.tooltipText,_=void 0===u?"":u,v=(0,s.classNames)({TranslationStatus__translationIndicator:!0,"TranslationStatus__translationIndicator--disabled":l}),h=(null==d?void 0:d.length)>0,p=(0,s.classNames)({TranslationStatus__translationTimer:!0,"TranslationStatus__translationTimer--hasIndicator":!l}),f=(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translation"},{children:[(0,o.jsx)(Ye,{className:v},void 0),(0,o.jsxs)(o.Fragment,{children:[!!n&&(0,o.jsx)("div",(0,i.__assign)({className:p},{children:n}),void 0),!l&&(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCount"},{children:[(0,o.jsx)(Je,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCountNumber"},{children:a}),void 0)]}),void 0),h&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationDropdown"},{children:(0,o.jsx)(qe,{},void 0)}),void 0)]},void 0)]}),"translation");return h?f=(0,o.jsx)(Xe.default,(0,i.__assign)({position:"b",align:"center",horizontalPosition:"right",trigger:"hover",marginLeft:-10,data:d,className:"TranslationStatus_dropdown"},{children:f}),void 0):_&&(f=(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:(0,o.jsx)(o.Fragment,{children:_},void 0)},{children:f}),void 0)),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus"},{children:f}),void 0)},tn=function(e){var n=e.translationTimer,t=e.hands,a=e.isMeAuthor,r=e.recordStartTimeMs,l=e.recordAuthorDisplayName,c=e.onStopRecord,d=e.isCanStopRecord,u=(0,ue.useLang)().getLang,_=Date.now()-(r||0)>5e3,v=!!n&&_,h=!!n&&!_,p=!n&&!a&&!!l,f=(t||0)>0,m=!(!a&&!d);return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TranslationStatus","TranslationStatus--is-record")},{children:[f&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__hands"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__hands CallHeader__hands--visible"},{children:[(0,o.jsx)($e,{},void 0)," ",t]}),void 0)}),void 0),(0,o.jsx)("div",{className:"TranslationStatus__divider"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({TranslationStatus__translation:!0,"TranslationStatus__translation--is-not-author":!m})},{children:[(0,o.jsx)(en,{fill:"#FF3347",width:16,height:16},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationTimer"},{children:[v&&n,h&&u("calls_recording_in_progress"),p&&u("calls_name_is_recording").replace("{name}",l)]}),void 0),m&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationStatus__endRecord",onClick:c},{children:u("calls_end_recording")}),void 0)]}),"translation")]}),void 0)},an=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.978 3.423a1.792 1.792 0 00-1.645 1.785v1.765l-.1.021a8.254 8.254 0 00-6.44 8.917.75.75 0 001.343.379l.175-.22a7.577 7.577 0 015.022-2.721v2.08a1.792 1.792 0 002.897 1.41l6.52-5.11a1.792 1.792 0 000-2.82l-6.52-5.11a1.791 1.791 0 00-1.105-.382l-.147.006zm.147 1.494c.065 0 .129.021.18.062l6.52 5.11a.292.292 0 010 .459l-6.52 5.11a.292.292 0 01-.472-.23v-2.873a.75.75 0 00-.767-.75l-.215.005-.305.016a9.065 9.065 0 00-5.162 2.056l-.037.032.004-.027a6.752 6.752 0 015.823-5.533.75.75 0 00.659-.744V5.208c0-.16.13-.291.292-.291z",fill:"#99A2AD"},void 0)}),void 0)},on=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.72 4.72a.75.75 0 011.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z",fill:"#99A2AD"},void 0)}),void 0)},rn=t(82280),sn=t(71618);function ln(e){var n,t,a,i;return!(!(0,P.isAdmin)(e.localDevice)&&!(0,P.isCreator)(e.localDevice))||!!(null===(t=null===(n=e.translation)||void 0===n?void 0:n.host)||void 0===t?void 0:t.id)&&+(null===(i=null===(a=e.translation)||void 0===a?void 0:a.host)||void 0===i?void 0:i.id)===(0,P.getMeId)(e)}function cn(e){return!(!(0,P.isAdmin)(e.localDevice)&&!(0,P.isCreator)(e.localDevice))||dn(e)}function dn(e){return(0,P.isParticipantGroup)(e.groupId)?e.groupId===e.translation.ownerId:e.me===e.translation.ownerId}var un=function(e){var n=e.hands,t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langNumeric,c=k((function(e){return e})),_=u(),v=(0,i.__read)((0,l.useState)(null),2),h=v[0],p=v[1],f=(0,i.__read)((0,l.useState)(!1),2),m=f[0],A=f[1],g=(0,i.__read)((0,l.useState)(""),2),C=g[0],S=g[1],T=(0,i.__read)((0,l.useState)(0),2),I=T[0],x=T[1],N=(0,i.__read)((0,l.useState)([]),2),y=N[0],b=N[1],O=(0,i.__read)((0,l.useState)((function(){return fn(c.translation.startTime)})),2),w=O[0],L=O[1],M=(0,i.__read)((0,l.useState)(pn(w)),2),D=M[0],j=M[1],R=(0,i.__read)((0,l.useState)(""),2),Z=R[0],B=R[1],U=(0,i.__read)((0,l.useState)(!1),2),H=U[0],V=U[1],G=(0,l.useMemo)((function(){return(0,P.isAdmin)(c.localDevice)||(0,P.isCreator)(c.localDevice)}),[c.localDevice]),F=function(e){var n=(0,i.__read)((0,l.useState)(),2),t=n[0],a=n[1],o=k((function(n){return e.ownerId?n.participants[e.ownerId]:void 0}));(0,l.useEffect)((function(){if(e.isRecord&&e.ownerId&&e.videoId&&!o){var n=new AbortController,t=e.ownerId+"_"+e.videoId;return(0,sn.videoGet)({videos:t},{signal:n.signal}).then(a),function(){n.abort()}}}),[e.ownerId,e.videoId,e.isRecord,o]);var r=(0,l.useMemo)((function(){var e="";if(o)e=o.shortName||o.name||e;else{var n=null==t?void 0:t.items[0].owner_id;if(!(0,s.isUndefined)(n)&&(0,P.isParticipantGroup)(n)&&(null==t?void 0:t.groups)){var a=t.groups.find((function(e){return e.id===-n}));e=(null==a?void 0:a.name)||e}}return e}),[t,o]);return{data:t,recordAuthorDisplayName:r}}({isRecord:c.translation.isRecord,ownerId:c.translation.ownerId,videoId:c.translation.videoId}),W=(0,P.isParticipantGroup)(c.groupId)?c.groupId===c.translation.ownerId:c.me===c.translation.ownerId,z=(0,l.useCallback)((function(){_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]);return(0,l.useEffect)((function(){var e=ln(c);A(e)}),[c.translation,c.localDevice]),(0,l.useEffect)((function(){var e,n;if(null===(e=c.translation.host)||void 0===e?void 0:e.id){var t=c.participants[null===(n=c.translation.host)||void 0===n?void 0:n.id],a=(null==t?void 0:t.shortName)||(null==t?void 0:t.name);a!==h&&p(a)}else h&&p(null)}),[c.translation,c.participants]),(0,l.useEffect)((function(){var e=[];if(m){if(D){var n={text:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemWillStartSoon"},{children:a("calls_info_translation_will_start_soon")}),void 0)};e.push(n)}e.push(_n((0,o.jsx)(an,{},void 0),a("calls_info_translation_share_menu_item"),(function(){return _({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}))),e.push(_n((0,o.jsx)(on,{},void 0),a("calls_translation_stop_menu_item"),z))}b(e)}),[m,D]),(0,l.useEffect)((function(){var e=pn(w);e&&w>-4&&m&&!H&&(V(!0),_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})),j(e)}),[w]),(0,l.useEffect)((function(){var e=fn(c.translation.startTime);L(e);var n=setInterval((function(){return L(fn(c.translation.startTime))}),rn.SECOND_JS);return function(){return clearInterval(n)}}),[c.translation.startTime]),(0,l.useEffect)((function(){var e="";if(D){var n=Math.abs(w);if(n>rn.DAY){var t=Math.floor(n/rn.DAY);e=r(t,"calls_translation_upcoming_time_more_day_short",a("calls_translation_upcoming_time_more_day_short",t)).replace("%s",t)}else e=vn("-"+hn(n))}else e=vn(hn(w));S(e)}),[w,D]),(0,l.useEffect)((function(){var e,n=c.translation,t=n.ownerId,a=n.videoId;if(t&&a&&!D){var i=function(){var e={owner_id:t,video_id:a};(0,sn.videoLiveGetSpectators)(e).then((function(e){var n;x(null===(n=e.spectators)||void 0===n?void 0:n.count)}))};i(),e=setInterval(i,15*rn.SECOND_JS)}return function(){return clearInterval(e)}}),[D,c.translation.ownerId,c.translation.videoId]),(0,l.useEffect)((function(){if(!m){var e="";e=D?a("calls_info_translation_will_start_soon"):h?a("calls_translation_host_info").replace("{name}",h):a("calls_translation_host_info_unknown"),B(e)}}),[D,h,m]),c.translation.isRecord?W?(0,o.jsx)(tn,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isMeAuthor:W,translationTimer:C},void 0):(0,o.jsx)(tn,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isCanStopRecord:G,recordAuthorDisplayName:F.recordAuthorDisplayName},void 0):(0,o.jsx)(nn,{translationTimer:C,viewersCount:I,isLiveIndicatorOff:D,actions:y,tooltipText:Z},void 0)};function _n(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}}function vn(e){return(0,o.jsx)(He,{duration:e},void 0)}function hn(e){return 0===e?"00:00":e<=599?"0"+(0,s.formatDuration)(e):(0,s.formatDuration)(e)}function pn(e){return e<0}function fn(e){var n=Date.now();return Math.floor((n-e)/1e3)}var mn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},n,{children:(0,o.jsx)("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"},void 0)}),void 0)},An=(0,l.memo)((function(e){var n=e.translation,t=e.speakers,a=e.hands,r=e.time,l=e.network,c=e.networkTooltipText,d=e.isTranslationRecord,u=(0,s.classNames)("CallHeader__hands",{"CallHeader__hands--visible":a>0});return(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__main"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({CallHeader__timeAndNetwork:!0,"CallHeader__timeAndNetwork--is-record":d})},{children:[l<.6&&(0,o.jsx)(C.default,(0,i.__assign)({text:c,align:"left",className:"Call__oldTooltip"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__network"},{children:(0,o.jsx)(q,{fill:l<=.3?"#ff5c5c":"#FECE00"},void 0)}),void 0)}),void 0),r]}),void 0),n&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__translation"},{children:n}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__aside"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__participants"},{children:t}),void 0),!d&&(0,o.jsxs)("div",(0,i.__assign)({className:u},{children:[(0,o.jsx)(mn,{},void 0)," ",a]}),void 0)]}),void 0)]}),void 0)}));function gn(e){var n,t=e.onHandCountChanged,a=(0,c.useSelector)((function(e){return e})),r=(0,O.isGroupCallByPeer)(a.peer),s=(0,l.useContext)(E.LangContext),d=s.getLang,u=s.langNumeric,_=(0,i.__read)((0,l.useState)(null),2),v=_[0],h=_[1],p=(0,i.__read)((0,l.useState)(0),2),f=p[0],m=p[1],A=(0,i.__read)((0,l.useState)(null),2),g=A[0],C=A[1];(0,l.useEffect)((function(){var e=(0,O.isGroupCallByPeer)(a.peer)?a.callData.ts:a.callData.localTimeStamp;C(We(e));var n=setInterval((function(){return C(We(e))}),1e3);return function(){return clearInterval(n)}}),[a.peer,a.callData.localTimeStamp,a.callData.ts]),(0,l.useEffect)((function(){var e=(0,P.getRaisedHands)(a.devices,a.localDevice,a.handState);e!==f&&(m(e),t&&t(e))}),[a.devices,a.localDevice,a.handState]),(0,l.useEffect)((function(){if(r){var e=a.speakersInHeader.reduce((function(e,n){var t=a.devices[n],i=t&&a.participants[t.externalId.id];return i&&(i.shortName||i.name)&&e.push(i),e}),[]);if(e.length>0){var n=d("calls_participants_speak",e.length).split(" ");h((0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",(0,i.__assign)({className:"CallHeader__speak"},{children:[n[0]," "]}),void 0),(0,Ve.getParticipantsListLabel)(e,e.slice(0,2),(function(e){return e.shortName||e.name}),d,u,0,2)]},void 0))}else h(null)}}),[a.participants,a.speakersInHeader,a.devices]);var S=(0,l.useMemo)((function(){return a.translation.isOn&&a.translation.isRecord?(0,o.jsx)(un,{hands:f},void 0):a.translation.isOn?(0,o.jsx)(un,{},void 0):""}),[a.translation.isOn,f,a.translation.isRecord]);return(0,o.jsx)(An,{translation:S,isTranslationRecord:!(!a.translation.isOn||!a.translation.isRecord),speakers:r?v:null,hands:f,time:g,network:null!==(n=a.localDevice.networkStatus)&&void 0!==n?n:1,networkTooltipText:d("calls_status_bad_internet_connection")},void 0)}var Cn=t(74351),En=t(27814),Sn=function(e){var n=e.title,t=e.onCloseModal,a=e.hint,r=e.actionButtons,s=e.isWithBackButton,c=e.onBackClick,d=e.children,u=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"CallManagementModal",onClose:t,actionButtons:r||[],footerHint:a,backText:s?u("calls_back"):void 0,onBack:c,title:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__content"},{children:l.Children.toArray(d).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)},Tn=t(2291),In=t(87255),xn=t(80044),Nn=t(48206),yn=t(78981),bn=function(e){var n=e.isLinkBlockShown,t=e.linkBlockTitle,a=e.onLinkBlockClick,r=e.callUrlLink,s=(0,l.useContext)(y.ConfigContext).allowWaitingHall,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Tn.default,{children:n&&(0,o.jsxs)(In.default,(0,i.__assign)({onClick:a,chevron:!0,icon:(0,o.jsx)(xn.ListIcon,{icon:(0,o.jsx)(Nn.LinkIcon,{},void 0),color:xn.ListIconColors.GREEN},void 0),aside:s?(0,o.jsx)("span",(0,i.__assign)({className:"CallManagementMenu__asideHint"},{children:c("calls_menu_link_setup")}),void 0):""},{children:[t,r&&(0,o.jsx)(yn.ListCopyControl,{value:r,copyText:c("calls_menu_link_copy"),doneText:c("calls_menu_link_copied")},void 0)]}),void 0)},void 0)},On=t(89366),wn=t(69666),Ln=t(25633),kn=t(47560),Pn=function(e){var n=e.link,t=void 0===n?"":n,a=e.isLinkLoading,r=e.isCopied,s=e.hideCopiedText,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"CallLink__info"},{children:c("calls_management_link_info_desc")}),void 0),a?(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallLink__input"},{children:(0,o.jsx)(kn.default,{},void 0)}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__input"},{children:[(0,o.jsx)(On.default,{readOnly:"readonly",value:t},void 0),(0,o.jsx)("div",{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__hint"},{children:[c("calls_management_add_warning"),(0,o.jsx)(wn.default,(0,i.__assign)({className:"CallLink__copied",shown:r,callback:s},{children:c("calls_link_copied")}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)},Mn=t(78517),Dn=t(63205),jn=function(e){var n=e.searchQuery,t=e.onSearchChange,a=e.length,r=e.children,s=e.waitingHallList,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList"},{children:[(0,o.jsx)(Mn.BlockSearchInput,{value:n,placeholder:c("calls_search_participants_placeholder"),onChange:t,onInput:t,onPaste:t,className:"CallParticipantList__input"},void 0),!!s&&s,(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:a||""},{children:c("calls_participant_list_header")}),void 0),(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list"},{children:r}),void 0)]}),void 0)},Rn=t(39132),Zn=t(19316),Bn=t(88420),Un=function(e){var n=e.members,t=void 0===n?[]:n,a=e.totalCount,r=void 0===a?0:a,s=e.navigateToProfile,c=e.onPromote,d=e.onForbid,u=(0,l.useContext)(E.LangContext).getLang;return 0===t.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:r||""},{children:u("calls_waiting_hall_list_header")}),void 0),(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list CallParticipantList__list--waitingList"},{children:t.map((function(e){return(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return d(e.peerId)},appearance:"secondary"},{children:u("calls_waiting_hall_forbid")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return c(e.peerId)}},{children:u("calls_waiting_hall_join")}),void 0)]},void 0)},{children:(0,o.jsx)(Zn.default,{onLinkClick:s,photo:(0,o.jsx)(m.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||""},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.peerId)}))}),void 0)]},void 0)},Hn=t(42194),Vn=t(93385);function Gn(e,n,t){var a=(0,Vn.getExternalIdByUserId)(e);return(0,J.promoteParticipant)(a).then((function(){Fn(e,n,t)}))}function Fn(e,n,t){n&&(n.totalCount-=1,n.members.delete(e),t({type:d.E_ACTION.SET_WAITING_HALL,data:n}))}function Wn(e,n,t,a){return function(e,n){if(0===n.length)return Promise.resolve([]);if(e>n.length)return(0,J.getWaitingHall)(null,e).then((function(e){return e.participants}));return Promise.resolve(n)}(e,n).then((function(n){var a=t.waitingHall||{members:new Map,hasNew:!1},o=a.members,r=a.hasNew,s=(0,i.__read)(function(e,n){return e.reduce((function(e,t){var a=(0,i.__read)(e,2),o=a[0],r=a[1],s=+t.id;return n.has(s)?r.push(s):o.push(s),[o,r]}),[[],[]])}(n,o),2),l=s[0],c=s[1],d=l.length>0,u=c.reduce((function(e,n){var t=o.get(n);return t&&e.set(n,t),e}),new Map),_={totalCount:e,members:u,hasNew:!!d||r};return d?function(e,n){var t=e.me,a=e.callData,o=e.anonymSecret,r=a.callId||"",s=t<0,l=s?t:0;return(0,sn.getCallParticipantsApiCall)(r,n,s,o,l).then((function(e){var n=e.profiles,t=void 0===n?[]:n,a=e.anonyms,o=void 0===a?[]:a,r=e.groups,s=void 0===r?[]:r;return(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o.map(Vn.normalizeUser)),!1),(0,i.__read)(t.map(Vn.normalizeUser)),!1),(0,i.__read)(s.map(Vn.normalizeGroup)),!1)}))}(t,l).then((function(e){return e.forEach((function(e){e&&e.peerId&&_.members.set(e.peerId,e)})),_})).catch((function(){return _})):_})).then((function(e){e.members&&a({type:d.E_ACTION.SET_WAITING_HALL,data:e})}))}function zn(e,n){if(!e.waitingHall)return Promise.resolve();var t=e.waitingHall.totalCount;return t>e.waitingHall.members.size?new Promise((function(a){(0,J.getWaitingHall)(null,t).then((function(t){Wn(t.totalCount,t.participants,e,n).then((function(){a()}))}))})):Promise.resolve()}var Kn=function(e){var n,t,a,r,s,_=e.isModal,v=e.onMore,h=e.navigateToProfile,p=e.isWithBackButton,f=e.onBackClick,m=p?f:function(){},A=(0,c.useSelector)((function(e){return e})),g=u(),C=(0,l.useContext)(E.LangContext).getLang,S=(0,i.__read)((0,l.useState)(Qn(A,_)),2),T=S[0],I=S[1],x=(0,i.__read)((0,l.useState)(""),2),y=x[0],b=x[1],O=A.waitingHall?Array.from(null===(n=A.waitingHall)||void 0===n?void 0:n.members.values()):[],w=(0,l.useCallback)((function(e){return e.name}),[]),L=(0,l.useCallback)((function(e){return e.peerId}),[]),k=N(_?O:[],w,L),P=(0,l.useCallback)((function(e){b(e.target.value)}),[]),M=_?O:O.slice(0,5);y&&(M=k.search(y)),(0,l.useEffect)((function(){I(Qn(A,_))}),[null===(t=A.waitingHall)||void 0===t?void 0:t.totalCount]);var D=(0,l.useCallback)((function(e){var n,t=null===(n=A.waitingHall)||void 0===n?void 0:n.members.get(e);t&&g({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(a=A.waitingHall)||void 0===a?void 0:a.members,A.participants]),j=(0,l.useCallback)((function(e){A.waitingHall&&Gn(e,A.waitingHall,g)}),[null===(r=A.waitingHall)||void 0===r?void 0:r.members]),R=(0,l.useCallback)((function(){v&&v()}),[A.waitingHall]),Z=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un,{members:M,totalCount:null===(s=A.waitingHall)||void 0===s?void 0:s.totalCount,navigateToProfile:h,onPromote:j,onForbid:D},void 0),T&&(0,o.jsx)(Hn.ListMore,(0,i.__assign)({onClick:R},{children:C("calls_waiting_hall_more_text")}),void 0)]},void 0);return _?(0,o.jsx)(Sn,(0,i.__assign)({title:C("calls_waiting_hall_title"),onCloseModal:function(){g({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),g({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},isWithBackButton:p,onBackClick:m},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList CallParticipantList--waiting-hall"},{children:[O.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Mn.BlockSearchInput,{value:y,placeholder:C("calls_search_participants_placeholder"),onChange:P,onInput:P,onPaste:P,className:"CallParticipantList__input"},void 0),Z,y&&0===M.length&&(0,o.jsx)(Re.default,{children:C("calls_participants_not_found")},void 0)]},void 0),0===O.length&&(0,o.jsx)(Re.default,{children:C("calls_waiting_hall_not_users")},void 0)]}),void 0)}),void 0):Z};function Qn(e,n){if(n)return!1;var t=e.waitingHall;return!!t&&t.totalCount>5}var Yn=t(17179),Jn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"},void 0)}),void 0)},Xn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"},void 0)}),void 0)},qn=function(){var e=(0,be.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return(0,o.jsx)("div",{className:e},void 0)},$n=function(e){var n=e.showSpeaking,t=e.showAudioDisabled,a=e.showRaisedHand,r=e.showConnecting,c=e.showRaisedHandTooltip,d=e.onRaisedHandClick,u=(0,l.useContext)(E.LangContext).getLang,_=(0,o.jsx)("span",(0,i.__assign)({className:(0,s.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==d}),onClick:null!=d?d:void 0},{children:(0,o.jsx)(Xn,{className:"ParticipantIndicators__hand"},void 0)}),void 0);return(0,o.jsxs)("span",(0,i.__assign)({className:"ParticipantIndicators"},{children:[n&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(qn,{},void 0)}),void 0),t&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Jn,{className:"ParticipantIndicators__muted"},void 0)}),void 0),a?c?(0,o.jsx)(C.default,(0,i.__assign)({className:"ParticipantIndicators__tooltip",text:u("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},{children:_}),void 0):_:null,r&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Y,{},void 0)}),void 0)]}),void 0)},et=t(67406),nt=function(e){var n=e.position,t=e.align,a=e.trigger,r=e.marginTop,s=e.marginLeft,l=e.actions;return l.length>0?(0,o.jsx)(Xe.default,(0,i.__assign)({position:n,align:t,trigger:a,marginTop:r,marginLeft:s,className:"ParticipantMenu__dropdown",data:l},{children:(0,o.jsx)(et.ListActionsControl,{},void 0)}),void 0):null},tt=function(e){var n=e.SDK,t=e.participant,a=e.navigateToConvo,i=e.navigateToProfile,r=e.device,s=(0,c.useSelector)((function(e){return e})),d=u(),_=(0,l.useContext)(E.LangContext).getLang,v=t&&(0,P.getParticipantActions)({state:s,SDK:n,dispatch:d,participant:t,addProfileLink:!1,getLang:_,navigateToConvo:a,navigateToProfile:i,separatedList:!0,device:r});return(null==v?void 0:v.length)?(0,o.jsx)(nt,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:v},void 0):null},at=(0,l.memo)((function(e){var n,t,a,r,s=e.device,l=e.canMute,c=e.onUnmuteDevice,d=e.SDK,u=e.navigateToConvo,_=e.navigateToProfile,v=e.deviceId,h=k((function(e){return e.me})),p=k((function(e){return e.participants[s.externalId.id]})),f=k((function(e){return e.externalId})),A=k((function(e){return e.speakers[v]})),g=(0,P.isSameExternalId)(s.externalId,f),C=g?Yn.GlobalStore.getCallsState().localDevice:p,E=(null==p?void 0:p.peerId)!==h&&s.status===J.ParticipantStatus.WAITING,S=!E&&!(null===(n=s.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),T=!E&&!(null===(t=s.mediaSettings)||void 0===t?void 0:t.isVideoEnabled),I=!E&&!!(null===(r=null===(a=s.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state),x=E||S||I||A,N=!E&&(S||T)&&l&&!g;return(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[x&&(0,o.jsx)($n,{showSpeaking:A,showRaisedHand:I,showAudioDisabled:S,showConnecting:E,showRaisedHandTooltip:N,onRaisedHandClick:N?function(){return c(s)}:void 0},"indicators"),(0,o.jsx)(tt,{SDK:d,participant:p,device:s,navigateToConvo:u,navigateToProfile:_},"menu")]},void 0)},{children:(0,o.jsx)(Zn.default,{onLinkClick:_,photo:(0,o.jsx)(m.CallPhoto,{id:null==p?void 0:p.peerId,photo:null==p?void 0:p.photo,alt:(null==p?void 0:p.name)||"",showCreatorBadge:(0,P.isCreator)(C),showAdminBadge:(0,P.isAdmin)(C)},void 0),title:null==p?void 0:p.name,href:null==p?void 0:p.link,target:"_blank"},void 0)}),v)})),it={acc:{},timer:0,tasks:0};function ot(e,n,t,a){!function(e,n,t,a,o){void 0===a&&(a=100);var r=(0,P.externalIdToString)(e),s=(0,i.__assign)((0,i.__assign)({},n),{externalId:e});o.acc[r]=o.acc[r]&&"object"==typeof o.acc[r]?(0,i.__assign)((0,i.__assign)({},o.acc[r]),s):s,o.tasks++,o.timer&&clearTimeout(o.timer);o.timer=window.setTimeout((function(){o.tasks>0&&(t(o.acc),o.acc={},o.tasks=0),o.timer=0}),a)}(n,t,(function(n){e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:n})}),a,it)}function rt(e,n,t){var a,o,r,s,l;if(t)try{for(var c=(0,i.__values)(t),d=c.next();!d.done;d=c.next()){var u=d.value;ot(n,u.uid,{mediaSettings:u.mediaSettings,markers:u.markers,status:u.status||J.ParticipantStatus.CONNECTING,statusData:u.participantState?(0,P.convertParticipantStateFromSDK)(u.participantState):void 0,wasConnected:!1});var _=e.devices[(0,P.externalIdToString)(u.uid)],v=(null===(r=null==_?void 0:_.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||!1;(null===(s=null==u?void 0:u.mediaSettings)||void 0===s?void 0:s.isScreenSharingEnabled)!==v&&(0,P.toggleScreenSharing)(e,n,null===(l=null==u?void 0:u.mediaSettings)||void 0===l?void 0:l.isScreenSharingEnabled,u.uid,!0)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}}function st(e){return new Promise((function(n,t){var a=new Image;a.src=e,a.onload=n,a.onerror=t}))}function lt(e){return Promise.resolve(e)}function ct(e,n,t){if(e.authorizedGroupId)return Promise.resolve();if((0,Ve.unpackState)(n).friends.length>0)return Promise.resolve();if(e.getFriends){var a=e.getFriends();if(null!==a)return t({type:d.E_ACTION.SET_FRIENDS,data:a}),Promise.resolve()}return(0,sn.loadFriends)().then((function(e){var n=e.items,t=e.count;return{friends:n.map(Vn.normalizeUser),count:t}})).then((function(e){var n=e.count,a=e.friends;t({type:d.E_ACTION.SET_FRIENDS,data:a,friendsCount:n})}))}function dt(e,n,t,a){return(0,sn.loadChatMembers)(t).then((function(t){t.profiles&&n({type:d.E_ACTION.SET_CHAT_INFO,data:ut(t).sort((function(n,t){var a=(0,Ve.unpackState)(e).me;return n.peerId===a?-1:t.peerId===a?1:0})),conversation:a})}))}function ut(e){var n,t,a=function(e){var n,t,a={};if(!e)return a;try{for(var o=(0,i.__values)(e),r=o.next();!r.done;r=o.next()){var s=r.value;a[s.id]=s}}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return a}(e.profiles),o=[];try{for(var r=(0,i.__values)(e.items),s=r.next();!s.done;s=r.next()){var l=a[s.value.member_id];l&&o.push((0,Vn.normalizeUser)(l))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}return o}function _t(e,n,t){return e.authorizedGroupId?n.groupMembers.length>0?Promise.resolve():(0,sn.getGroupMembers)(-e.authorizedGroupId,0,d.COUNT_OF_GROUP_MEMBERS_TO_LOAD).then((function(e){var n=e.items,t=e.count,a=[],i=[];return n.forEach((function(e){e.deactivated||(a.push((0,Vn.normalizeUser)(e)),e.can_call_from_group||i.push(e.id))})),{groupMembers:a,unableToCallGroupMembersIds:i,count:t}})).then((function(e){var n=e.groupMembers,a=e.unableToCallGroupMembersIds,i=e.count;return t({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:i,groupMembers:n,unableToCallGroupMembersIds:a}),Promise.resolve()})):Promise.resolve()}function vt(e,n,t){return(0,sn.retryLoadCallPeers)(t).then((function(e){var t=(0,i.__read)((0,Ve.convertServerData)(e),3),a=t[0],o=t[1],r=t[2];return gt(n,r),lt({conversation:a,members:o})})).then((function(e){var a=e.conversation,i=e.members;n({type:d.E_ACTION.LOAD_PEERS,conversation:a,members:i,peerId:t})}))}function ht(e,n,t){return t?(0,sn.loadCallPeers)(t).then((function(e){var t=e.items,a=(0,i.__read)(t,1)[0];gt(n,a)})):Promise.resolve()}var pt,ft={acc:[],timer:0,promise:null,promiseResolve:null,tasks:0,timeout:300};function mt(e,n,t,a,o,r){var s,l;return(s=ft.acc).push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(o),!1)),ft.timer&&clearTimeout(ft.timer),ft.timer=window.setTimeout((function(){var o=ft.acc,s=ft.promiseResolve;ft.promise=null,ft.promiseResolve=null,ft.acc=[],function(e,n,t,a,o,r){var s=(0,Ve.unpackState)(e).me,l=(0,Ve.unpackState)(e).anonymSecret,c=s<0?s:void 0;return(0,sn.getCallParticipants)(a,o,c,s<0,l).then((function(e){var s=e.profiles,l=void 0===s?[]:s,c=e.anonyms,u=void 0===c?[]:c,_=e.secret,v=e.groups,h=void 0===v?[]:v;_&&n({type:d.E_ACTION.UPDATE_ANON_SECRET,secret:_});var p=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(u),!1),(0,i.__read)(h),!1),f=o.filter((function(e){var n=p.find((function(n){return n&&n.id===e}));return!n}));f.length>0&&t.eventHandlers.onError&&t.eventHandlers.onError(new Error("callId: "+a+", timestamp: "+Date.now()+", cant find in participants: "+f.join(", ")));var m=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(u),!1),(0,i.__read)(l),!1).map(Vn.normalizeUser);(null==h?void 0:h.length)>0&&(m=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(m),!1),(0,i.__read)(h.map(Vn.normalizeGroup)),!1));var A=lt([{},m]);return r.awaitImages?A.then((function(){return[null,m]})):[null,m]})).then((function(e){var t=(0,i.__read)(e,2)[1];t.length>0&&n({type:d.E_ACTION.LOAD_PEERS,members:t})})).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}(e,n,t,a,o,r).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})).finally(s)}),ft.timeout),ft.promise=null!==(l=ft.promise)&&void 0!==l?l:new Promise((function(e){ft.promiseResolve=e}))}function At(e,n,t,a){return void 0===a&&(a=0),(0,sn.getCallUrlLink)(n,t,a).then((function(n){var t=n.join_link;return e({type:d.E_ACTION.CALL_STATE,callData:{callUrlLink:t}}),t}))}function gt(e,n){if(n&&n.call_in_progress){var t=n.unread_count,a=n.last_message_id,i=n.call_in_progress.has_link,o=n.call_in_progress.can_finish_call;e({type:d.E_ACTION.CALL_STATE,callData:{canFinishCall:o,hasUrlLink:i}}),(t||a)&&e({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t,chatUpToMsgId:a})}}function Ct(e,n){return void 0===n&&(n=!1),(0,J.startStream)(n,null,e).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}function Et(e,n,t){void 0===t&&(t=0),At(e,n,!1,t).then((function(n){(0,s.copyTextToClipboard)(n).then((function(n){n&&e({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.LINK_COPIED_TO_CLIPBOARD}})}))})).catch(console.log)}function St(e,n,t,a){n(t),Mt(e)&&jt(a,n,t)}!function(e){e.CONTAIN="cn",e.COVER="cv"}(pt||(pt={}));function Tt(e,n,t){return(0,O.isGroupCallByPeer)(e.peer)?e.uiMode===d.UIMode.COLLAPSED?function(e){var n=(0,Ve.isAnyoneWithVideo)(e),t=(0,P.getCallVisibleParticipant)(e,n),a=(0,P.getActiveDevices)(e).activeDevices,i=e.config,o=i.enableScreenTrack,r=i.enableProducerScreenTrack;return a.reduce((function(n,a){var i=a.externalId,s=a.mediaSettings;if((0,P.isSameExternalId)(a.externalId,e.externalId))return n;var l=(0,P.externalIdToString)(i);if(o||r){var c=!!(null==s?void 0:s.isScreenSharingEnabled),d=!!(null==s?void 0:s.isVideoEnabled),u=(0,P.isSameExternalId)(i,null==t?void 0:t.externalId);u&&c&&(n.set(Lt(l,J.MediaType.SCREEN),Nt(t,J.MediaType.SCREEN)),n.set(Lt(l,J.MediaType.CAMERA),xt(a,J.MediaType.CAMERA))),u&&!c&&d&&(n.set(Lt(l,J.MediaType.CAMERA),Nt(t,J.MediaType.CAMERA)),n.set(Lt(l,J.MediaType.SCREEN),xt(a,J.MediaType.SCREEN))),u&&(c||d)||(n.set(Lt(l,J.MediaType.SCREEN),xt(a,J.MediaType.SCREEN)),n.set(Lt(l,J.MediaType.CAMERA),xt(a,J.MediaType.CAMERA)))}else(0,P.isSameExternalId)(null==t?void 0:t.externalId,i)&&wt(s)?n.set(l,Nt(t)):n.set(l,xt(a));return n}),new Map)}(e):e.isOratorMode?function(e,n,t){var a,i,o=(0,P.getSelectedDevice)(e),r=o.externalId,s=(0,P.externalIdToString)(r),l=(0,P.getActiveDevices)(e).activeDevices,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;if((_||v)&&s){var h=new Map,p=!!(null===(a=null==o?void 0:o.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),f=!!(null===(i=null==o?void 0:o.mediaSettings)||void 0===i?void 0:i.isVideoEnabled),m=e.uiMode===d.UIMode.FULLSCREEN,A=!(0,P.isSameExternalId)(r,e.externalId);return p&&A&&(c++,h.set(Lt(s,J.MediaType.SCREEN),bt(o,m,!1,n,t,J.MediaType.SCREEN))),p&&f&&A&&(c++,h.set(Lt(s,J.MediaType.CAMERA),Ot(o,J.MediaType.CAMERA))),p&&!f&&A&&h.set(Lt(s,J.MediaType.CAMERA),xt(o,J.MediaType.CAMERA)),!p&&f&&A&&(c++,h.set(Lt(s,J.MediaType.CAMERA),bt(o,m,!1,n,t,J.MediaType.CAMERA)),h.set(Lt(s,J.MediaType.SCREEN),xt(o,J.MediaType.SCREEN))),p||f||!A||(h.set(Lt(s,J.MediaType.CAMERA),xt(o,J.MediaType.CAMERA)),h.set(Lt(s,J.MediaType.SCREEN),xt(o,J.MediaType.SCREEN))),l.reduce((function(n,t){var a=t.externalId,i=t.mediaSettings;if((0,P.isSameExternalId)(a,e.externalId)||(0,P.isSameExternalId)(a,r))return n;var o=(0,P.externalIdToString)(a),s=!!(null==i?void 0:i.isScreenSharingEnabled),l=!!(null==i?void 0:i.isVideoEnabled),d=t.visible&&c<e.config.videoSlotsCount;return d&&l&&(c++,n.set(Lt(o,J.MediaType.CAMERA),Ot(t,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),xt(t,J.MediaType.SCREEN))),d&&!l&&s&&(c++,n.set(Lt(o,J.MediaType.SCREEN),Ot(t,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),xt(t,J.MediaType.CAMERA))),d&&(l||s)||(n.set(Lt(o,J.MediaType.SCREEN),xt(t,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),xt(t,J.MediaType.CAMERA))),n}),h),h}return l.reduce((function(a,i){var o=i.externalId,s=i.mediaSettings;if((0,P.isSameExternalId)(o,e.externalId))return a;var l=(0,P.externalIdToString)(o);if((0,P.isSameExternalId)(r,o)&&wt(s)){var u=bt(i,e.uiMode===d.UIMode.FULLSCREEN,!1,n,t);a.set(l,u)}else wt(s)&&i.visible&&c<e.config.videoSlotsCount?(c++,a.set(l,Ot(i))):a.set(l,xt(i));return a}),new Map)}(e,n,t):function(e,n,t){var a=e.uiMode===d.UIMode.FULLSCREEN,i=a?n:900,o=a?t:504,r=(0,P.getActiveDevices)(e).activeDevices,s=function(e,n,t){switch(t){case 1:return n;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(n/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(n/3);default:return Math.round(e/6)}}(i,o,r.length),l=s<200?1:2,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;return r.reduce((function(n,t){if((0,P.isSameExternalId)(t.externalId,e.externalId))return n;var a=t.externalId,i=t.mediaSettings,o=(0,P.externalIdToString)(a);if(_||v){var r=!!(null==i?void 0:i.isScreenSharingEnabled),d=!!(null==i?void 0:i.isVideoEnabled),u=t.visible&&c<e.config.videoSlotsCount;return u&&r&&(c++,n.set(Lt(o,J.MediaType.SCREEN),yt(t,s,l,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),xt(t,J.MediaType.CAMERA))),u&&!r&&d&&(c++,n.set(Lt(o,J.MediaType.CAMERA),yt(t,s,l,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),xt(t,J.MediaType.SCREEN))),u&&(r||d)||(n.set(Lt(o,J.MediaType.CAMERA),xt(t,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),xt(t,J.MediaType.SCREEN))),n}return wt(i)&&t.visible&&c<e.config.videoSlotsCount?(n.set(o,yt(t,s,l)),c++):n.set(o,xt(t)),n}),new Map)}(e,n,t):function(e,n,t){var a=new Map,i=(0,P.getPeerIdDeviceInfo)(e.peer,e.devices);if(!i)return a;var o=e.config,r=o.enableScreenTrack,s=o.enableProducerScreenTrack,l=e.uiMode===d.UIMode.FULLSCREEN,c=e.uiMode===d.UIMode.COLLAPSED,u=i.externalId,_=i.mediaSettings;if((0,P.isSameExternalId)(u,e.externalId))return a;var v=(0,P.externalIdToString)(u);if(r||s){var h=!!(null==_?void 0:_.isScreenSharingEnabled),p=!!(null==_?void 0:_.isVideoEnabled);if(h&&p&&(a.set(Lt(v,J.MediaType.SCREEN),bt(i,l,c,n,t,J.MediaType.SCREEN)),a.set(Lt(v,J.MediaType.CAMERA),Ot(i,J.MediaType.CAMERA))),h!==p){var f=h?J.MediaType.SCREEN:J.MediaType.CAMERA,m=h?J.MediaType.CAMERA:J.MediaType.SCREEN;a.set(Lt(v,f),bt(i,l,c,n,t,f)),a.set(Lt(v,m),xt(i,m))}return h||p||(a.set(Lt(v,J.MediaType.SCREEN),xt(i,J.MediaType.SCREEN)),a.set(Lt(v,J.MediaType.CAMERA),xt(i,J.MediaType.CAMERA))),a}return a.set(v,wt(_)?bt(i,l,c,n,t):xt(i)),a}(e,n,t)}function It(e){return e&&!e.stopStream}function xt(e,n){return void 0===n&&(n=null),{stopStream:!0,uid:e.externalId,mediaType:n}}function Nt(e,n){return void 0===n&&(n=null),{fit:pt.CONTAIN,width:265,height:200,priority:2,uid:e.externalId,mediaType:n}}function yt(e,n,t,a){return void 0===a&&(a=null),{fit:pt.COVER,width:n,height:n,priority:t,uid:e.externalId,mediaType:a}}function bt(e,n,t,a,i,o){return void 0===o&&(o=null),{fit:pt.CONTAIN,width:n?a:t?265:900,height:n?i:t?200:504,priority:3,uid:e.externalId,mediaType:o}}function Ot(e,n){void 0===n&&(n=null);var t=e.mediaSettings;return{fit:(null==t?void 0:t.isScreenSharingEnabled)?pt.CONTAIN:pt.COVER,width:140,height:140,priority:1,uid:e.externalId,mediaType:n}}function wt(e){var n;return null!==(n=!!(null==e?void 0:e.isVideoEnabled)||!!(null==e?void 0:e.isScreenSharingEnabled))&&void 0!==n&&n}function Lt(e,n){return void 0===n&&(n=null),n?e+":"+n:e}var kt="GRID";function Pt(e){var n=1*e;return Math.min(n+e+n,128)}function Mt(e){var n;return Boolean(null===(n=e.config)||void 0===n?void 0:n.enableParticipantListChunk)}function Dt(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(Mt(e)&&r){var s=(0,P.externalIdToString)(i),l=$t(e,s),c=Wt(Kt(o),e),d=c>-1,u=-1===c;if(Xt(n,i,!1),d){var _=sa(c,r),v={countBefore:r.countBefore,ids:_,countAfter:r.countAfter};la(n,v),function(e,n,t,a){if(0===a.countAfter&&0===a.countBefore||Aa(a,e))return Promise.resolve();Ca(e,n,t)}(e,n,t,v)}else u?(la(n,{countBefore:r.countBefore-1}),Ea(e,n,t)):la(n,{countAfter:r.countAfter-1});l&&qt(e,n,s)}}function jt(e,n,t){var a=t.numberOfVisible,o=t.firstVisible;return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(i){return t=Yn.GlobalStore.getCallsState(),o=_a(Math.max(0,o)),a=Math.ceil(a),function(e,n,t){var a=e.participantsChunk;if(!a)return!0;var i=a.countBefore,o=a.countAfter,r=i,s=r+a.ids.length,l=n+t,c=Math.ceil(1*t*.2);if((0===i||n-r>=c)&&(0===o||s-l>=c))return!1;return!0}(t,o,a)?[2,Ca(t,n,e,{firstVisible:o,numberOfVisible:a})]:[2]}))}))}function Rt(e,n,t,a,o){var r=o.externalId,s=o.markers,l=o.mediaSettings,c=l.isScreenSharingEnabled,d=e.participantsChunk,u=oa(d,ia(e,s));c||u?(!function(e,n,t){t&&ta(e,n,{markers:t})}(n,r,s),Ht(e,n,a,r,{mediaSettings:l})):qt(e,n,(0,P.externalIdToString)(r));var _=0===(null==d?void 0:d.countBefore);(0,P.getOrator)(e).device!==e.localDevice||_||function(e,n,t){(0,i.__awaiter)(this,void 0,void 0,(function(){var a,o;return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Bt(e,{count:1,fromIdx:0})];case 1:return a=i.__read.apply(void 0,[r.sent().participants,1]),(o=a[0])?((0,P.toggleScreenSharing)(n,t,o.mediaSettings.isScreenSharingEnabled,o.uid),[2]):[2]}}))}))}(t,e,n),Yt(e,n,t,a,{externalId:r,markers:s})}var Zt=[];function Bt(e,n,t){var a=n.count,o=n.fromIdx,r=void 0===o?0:o,s=n.fromMarker,l=(void 0===t?{}:t).signal,c=void 0===l?null:l;return(0,i.__awaiter)(this,void 0,void 0,(function(){var n,t;return(0,i.__generator)(this,(function(i){return n=!1,t=function(){return n=!0},c&&c.addEventListener("abort",t,{once:!0}),[2,e.getParticipantListChunk({count:a,fromIdx:s?void 0:r,fromMarker:s,listType:kt}).then((function(e){return n?Promise.reject(new Error("aborted")):e})).finally((function(){c&&c.removeEventListener("abort",t)}))]}))}))}function Ut(e,n,t,a){var i=na(e,n,t,a.map((function(e){return e.externalId})));return Ft(n,a),i}function Ht(e,n,t,a,o){Ut(e,n,t,[(0,i.__assign)({externalId:a},o)])}function Vt(e){var n;if(e){var t=null!==(n=e.countBefore)&&void 0!==n?n:0;return t?va(t,1):t}return 0}function Gt(e,n){var t=ua(e),a=pa(e),i=t+a,o=n.countBefore;return n.ids.reduce((function(e,n,a){var r=o+a,s=r>=t&&r<i;return e.push({externalId:n,visible:s}),e}),[])}function Ft(e,n){var t=n.reduce((function(e,n){return e[(0,P.externalIdToString)(n.externalId)]=n,e}),{});e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:t})}function Wt(e,n){var t=n.participantsChunk,a=(null==t?void 0:t.ids)||[];return(0,Ve.binarySearch)(a,(function(t){var a=(0,P.externalIdToString)(t),i=ea(n,a);if(!i)return 1;var o=Kt(i.markers);return J.Utils.participantMarkerCompare(e,o)}))}function zt(e,n,t){var a;!function(e,n,t){var a,i,o=null!==(i=null===(a=e.participantsChunk)||void 0===a?void 0:a.ids)&&void 0!==i?i:[];if(!o.length)return;var r=t.participants.reduce((function(e,n){return e[(0,P.externalIdToString)(n.uid)]=!0,e}),{});fa(e,n,o.filter((function(e){var n=(0,P.externalIdToString)(e);return!r[n]})))}(e,n,t);var i=null!==(a=null==t?void 0:t.participants)&&void 0!==a?a:[],o={countBefore:t.countBefore,ids:i.map((function(e){return e.uid})),countAfter:t.countAfter};la(n,o);var r=i.map((function(e){return{externalId:e.uid,markers:e.markers}}));Ft(n,r),rt(e,n,i),Gt(e,o).forEach((function(e){ot(n,e.externalId,e)}))}function Kt(e){return null==e?void 0:e.GRID}function Qt(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(r){var s=aa(e,i),l=ia(e,o),c=s>-1,d=oa(r,l);if(d&&!c){var u=0===r.countBefore&&r.countAfter?r.countAfter-1:r.countAfter;ma(e,n,t,{externalId:i,markers:o,countBefore:0===r.countAfter&&r.countBefore?r.countBefore-1:r.countBefore,countAfter:u})}else{if(c&&!d)!function(e,n,t,a){if(!a)return;var i=sa(n,a),o=0===t;function r(e,n){return e?n+1:n}la(e,{countBefore:r(o,a.countBefore),ids:i,countAfter:r(!o,a.countAfter)})}(n,s,l,r);else c&&d&&s!==l&&function(e,n,t,a,i){var o=Array.from(i);o.splice(t,0,a);var r=n+(t<=n?1:0);o.splice(r,1),la(e,{ids:o})}(n,s,l,i,r.ids)}}}function Yt(e,n,t,a,i){Qt(e,n,a,{externalId:i.externalId,markers:i.markers}),Ea(e,n,t)}function Jt(e,n,t){(null==t?void 0:t.hand)&&Xt(e,n,t.hand.state)}function Xt(e,n,t){e({type:d.E_ACTION.SET_PARTICIPANT_HAND_STATE,key:(0,P.externalIdToString)(n),value:t})}function qt(e,n,t){$t(e,t)&&n({type:d.E_ACTION.REMOVE_DEVICE_FROM_CACHE,id:t})}function $t(e,n){return Boolean(ea(e,n))}function ea(e,n){return e.devices[n]}function na(e,n,t,a){return(0,i.__awaiter)(this,void 0,Promise,(function(){var o,r,s;return(0,i.__generator)(this,(function(i){return(o=a.reduce((function(n,t){var a=Number(t.id);return e.participants[a]||n.push(a),n}),[])).length?(r=e.callData.callId||"",s={withConversation:!e.callData.conversation,awaitImages:!1},[2,mt(e,n,t,r,o,s)]):[2,Promise.resolve()]}))}))}function ta(e,n,t){Ft(e,[(0,i.__assign)({externalId:n},t)])}function aa(e,n){var t=ea(e,(0,P.externalIdToString)(n));return t?Wt(Kt(t.markers),e):-1}function ia(e,n){var t=Wt(Kt(n),e);return t>-1?t:-(t+1)}function oa(e,n){if(!e)return!1;var t=e.ids;return 0===n&&0===e.countBefore||n===t.length&&0===e.countAfter||n>0&&n<t.length}function ra(e,n,t,a,o){var r=o.externalId,s=o.marker;return(0,i.__awaiter)(this,void 0,void 0,(function(){var o;return(0,i.__generator)(this,(function(i){return o=(0,P.externalIdToString)(r),[2,Bt(t,{count:1,fromMarker:s}).then((function(t){var i=t.participants[0];(0,P.externalIdToString)(i.uid)===o&&Ht(e,n,a,i.uid,{markers:i.markers,mediaSettings:i.mediaSettings})}))]}))}))}function sa(e,n){if(!n)return[];var t=n.ids,a=Array.from(t);return a.splice(e,1),a}function la(e,n){e({type:d.E_ACTION.SET_PARTICIPANTS_CHUNK,data:n})}function ca(e,n,t,a){var i=(0,P.externalIdToString)(t);(a.stream||a.screenSharingStream||$t(e,i))&&ot(n,t,a)}function da(e,n){var t=1*n;return Math.max(0,e-t)}function ua(e){return _a(ha(e))}function _a(e){return va(e,-1)}function va(e,n){return Math.max(e+n,0)}function ha(e){var n;return null!==(n=e.isOratorMode?e.oratorScrollFirstVisible:e.gridScrollFirstVisible)&&void 0!==n?n:0}function pa(e){return e.isOratorMode?Math.ceil(e.oratorScrollNumberOfVisible):d.GRID_SCROLL_NUMBER_OF_VISIBLE}function fa(e,n,t){var a=[e.adminPinnedParticipant,e.screenSharingPinnedParticipant,e.pinnedParticipant].filter(Boolean).map((function(e){return(0,P.externalIdToString)(e)})).reduce((function(e,n){return e[n]=!0,e}),{});t.filter((function(e){var n=(0,P.externalIdToString)(e);return!a[n]})).forEach((function(t){var a=(0,P.externalIdToString)(t);qt(e,n,a)}))}function ma(e,n,t,a){var o=a.externalId,r=a.markers,s=a.countBefore,l=a.countAfter,c=e.participantsChunk;if(c){s=null!=s?s:c.countBefore,l=null!=l?l:c.countAfter;var d=Sa(Kt(r),e),u=ga(e),_=da(ua(e),pa(e)),v=Math.max(_-s,0),h=c.ids,p=Array.from(h);p.splice(d,0,o);var f=p.splice(0,v),m=p.splice(u),A={countBefore:s+f.length,ids:p,countAfter:l+m.length};Ht(e,n,t,o,{markers:r,status:J.ParticipantStatus.CONNECTED}),la(n,A),function(e,n,t){t&&Ft(n,Gt(e,t))}(e,n,A),fa(e,n,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(m),!1))}}function Aa(e,n){var t=ga(n);return e.ids.length>=t}function ga(e){return Pt(pa(e))}function Ca(e,n,t,a){var i=void 0===a?{}:a,o=i.firstVisible,r=void 0===o?ua(e):o,s=i.numberOfVisible,l=void 0===s?pa(e):s,c=Pt(l),d=function(e,n,t){return e.participantsChunk?da(n,t):0}(e,r,l);return Bt(t,{count:c,fromIdx:d}).then((function(t){zt(Yn.GlobalStore.isSet()?Yn.GlobalStore.getCallsState():e,n,t)}))}function Ea(e,n,t){return jt(t,n,{firstVisible:ha(e),numberOfVisible:pa(e)})}function Sa(e,n){return-(Wt(e,n)+1)}var Ta=100,Ia=function(e){var n=e.SDK,t=e.bridge,a=e.onAddClick,r=e.navigateToProfile,s=e.navigateToConvo,d=e.onShowMoreWaitingHall,u=(0,c.useSelector)((function(e){return e})),_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(""),2),h=v[0],p=v[1],f=(0,i.__read)((0,l.useState)(Ta),2),m=f[0],A=f[1],g=(0,P.canMuteParticipants)(u.localDevice),C=function(e,n,t,a){var o=k((function(e){return e})),r=Mt(o),s=(0,l.useMemo)((function(){return o.externalId?(0,i.__assign)((0,i.__assign)({},o.localDevice),{externalId:o.externalId}):null}),[o.localDevice,o.externalId]);return(r?xa:Na)(e,n,t,s,{offset:a})}(h,n,t,m-Ta),S=C.participants,T=C.isLoading,I=(0,l.useCallback)((function(e){p(e.target.value)}),[]),x=!(0,P.isParticipantAnonym)(u.me),N=M(),y=(0,l.useCallback)((function(e){n.muteParticipant(e.externalId,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log)}),[]);return(0,o.jsxs)(jn,(0,i.__assign)({searchQuery:h,onSearchChange:I,length:N,waitingHallList:u.waitingHall&&(0,o.jsx)(Kn,{isModal:!1,navigateToProfile:r,onMore:d},void 0)},{children:[!h&&x&&(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1},{children:(0,o.jsx)(Rn.ListAddControl,(0,i.__assign)({onClick:a},{children:_("calls_add_participants")}),void 0)}),"add"),!!S.length&&S.slice(0,m).map((function(e){var t=(0,P.externalIdToString)(e.externalId);return(0,o.jsx)(at,{deviceId:t,SDK:n,canMute:g,device:e,navigateToConvo:s,navigateToProfile:r,onUnmuteDevice:y},t)})),T&&(0,o.jsx)(Me.default,{},void 0),!T&&N>m&&(0,o.jsx)(In.default,{children:(0,o.jsx)(Hn.ListMore,(0,i.__assign)({className:"CallParticipantList__more",onClick:function(){A((function(e){return e+Ta}))}},{children:_("calls_participants_show_more").replace("{n}",String(Ta))}),void 0)},"limit"),h&&0===S.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0)]}),void 0)};function xa(e,n,t,a,o){var r,s=(void 0===o?{}:o).offset,c=void 0===s?0:s,_=k((function(e){return e.devices})),v=k((function(e){return e.participants})),h=k((function(e){return e.participantsChunk})),p=k((function(e){var n;return null!==(n=e.callData.callId)&&void 0!==n?n:""})),f=u(),m=(0,i.__read)((0,l.useState)([]),2),A=m[0],g=m[1],C=(0,i.__read)((0,l.useState)(!1),2),E=C[0],S=C[1],T=(r=h)?r.countBefore+r.ids.length+r.countAfter:0,I=0===c&&T<=Ta?T:null;return(0,l.useEffect)((function(){var a=new AbortController,o=!1;return a.signal.addEventListener("abort",(function(){o=!0}),{once:!0}),S(!0),(e?new Promise((function(t,i){var r=setTimeout((function(){t(function(){function t(e,n){return{id:String(e.id),type:n}}(0,sn.searchCallParticipants)(p,{search:e},{signal:a.signal}).then((function(e){var n=e.profiles,a=void 0===n?[]:n,i=e.anonyms,o=void 0===i?[]:i,r=e.groups,s=void 0===r?[]:r,l=[],c=[];return o.forEach((function(e){l.push((0,Vn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.ANONYM))})),a.forEach((function(e){l.push((0,Vn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.USER))})),s.forEach((function(e){l.push((0,Vn.normalizeGroup)(e)),c.push(t(e,J.ExternalIdType.GROUP))})),lt([{},l]),f({type:d.E_ACTION.LOAD_PEERS,members:l}),c})).then((function(e){return n.getParticipants({externalIds:e})})).then((function(e){if(!o){var n=Yn.GlobalStore.getCallsState(),t=e.map((function(e){var n=e.uid;return(0,P.externalIdToString)(n)}));rt(n,f,e),g(t)}}))}())}),1e3);a.signal.addEventListener("abort",(function(){clearTimeout(r),i()}),{once:!0})})):Bt(n,{fromIdx:c,count:100},{signal:a.signal}).then((function(e){var n=Yn.GlobalStore.getCallsState(),a=e.participants.map((function(e){var n=e.uid,t=(0,i.__rest)(e,["uid"]);return(0,i.__assign)({externalId:n},t)})),o=a.map((function(e){var n=e.externalId;return(0,P.externalIdToString)(n)})),r=Ut(n,f,t,a);return g((function(e){return c>=e.length?e.concat(o):o})),r}))).finally((function(){S(!1)})),function(){return a.abort()}}),[p,e,c,I]),{participants:A.reduce((function(e,n){var t=_[n];if(t){var a=t.externalId.id,i=v[a];i&&i.name&&e.push(t)}return e}),e||!a?[]:[a]),isLoading:E}}function Na(e){var n,t,a=(0,i.__read)((n=k((function(e){return e})),t=(0,l.useMemo)((function(){if(n.externalId)return(0,i.__assign)((0,i.__assign)({},n.localDevice),{externalId:n.externalId})}),[n.localDevice,n.externalId]),(0,l.useMemo)((function(){var e=[[],[]],a=function(e,t){var a=n.participants[t.externalId.id];return a&&t.status?(e[0].push(t),a.name&&e[1].push(t),e):e};return t&&a(e,t),(0,Ve.objectReduce)(n.devices,a,e)}),[n.devices,n.participants,n.localDevice,n.externalId])),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){var n;return null===(n=Yn.GlobalStore.getCallsState().participants[e.externalId.id])||void 0===n?void 0:n.name}),[]),c=(0,l.useCallback)((function(e){return(0,P.externalIdToString)(e.externalId)}),[]),d=N(r,s,c);return{participants:e?d.search(e):o,isLoading:!1}}var ya,ba=t(58346);!function(e){e.Participants="participants",e.Friends="friends",e.Community="community"}(ya||(ya={}));var Oa,wa=t(88822),La=t(71831);function ka(e,n,t){return t&&t[e]||(0,P.isParticipantInCall)(n,e)}function Pa(e){var n=e.member,t=e.state,a=e.selectedMap,i=(null==n?void 0:n.peerId)||0;if((0,P.isParticipantInCall)(t,i))return!0;if(ka(i,t,a))return!1;if((0,O.isAuthedByGroupId)(t)){if((0,P.isParticipantUnavailableToCallFromGroup)(t,i))return!0}else if(!(null==n?void 0:n.canCall))return!0;return!(0,La.isUserPeer)(i)}!function(e){e.Friends="friends",e.CommunityMembers="groupMembers",e.Members="members"}(Oa||(Oa={}));var Ma=function(e){return e?(0,wa.escape)(e.replace(/\t/g,"\n")):""},Da=function(e){return e.name},ja=t(70720),Ra=function(e){var n=e.tokens,t=e.onRemoveToken,a=e.value,i=e.onChange,r=e.onSelect,s=e.renderSuggest,c=e.data,d=e.hideInputWithName,u=(0,l.useRef)((function(){})),_=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(ja.default,{className:"CallsMultiSelect",tokens:n,removeTokenPlaceholder:_("calls_remove_token"),onRemoveToken:t,placeholder:_("calls_search_participants_placeholder"),value:a,onChange:i,onSelect:r,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:u.current,notFoundText:_("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:s,data:c,hideInputWithName:d},void 0)};const Za=(0,X.makeIcon)("Icon20CheckCircleOn","check_circle_on_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="check_circle_on_20"><path fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm5.35-12.72a.75.75 0 1 0-1.062-1.06l-5.955 5.968L5.81 9.66a.75.75 0 1 0-1.062 1.06l3.054 3.06a.75.75 0 0 0 1.062 0l6.486-6.5Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),Ba=(0,X.makeIcon)("Icon20CheckCircleOff","check_circle_off_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" viewBox="0 0 20 20" id="check_circle_off_20"><defs><path id="check_circle_off_20_a" fill="currentColor" fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm0-1a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" clip-rule="evenodd" /></defs><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);function Ua(e){var n=e.member,t=e.selected,a=void 0!==t&&t,r=e.disabled,l=void 0!==r&&r,c=(0,s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":a,"ParticipantSuggest--disabled":l}),d=a?Za:Ba;return(0,o.jsxs)("div",(0,i.__assign)({className:c,"data-id":n.id},{children:[(0,o.jsx)(Zn.default,{className:"ParticipantSuggest__entity",size:"34",title:n.name,photo:n.photo},void 0),(0,o.jsx)(d,{className:"ParticipantSuggest__checkIcon"},void 0)]}),void 0)}var Ha=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"},void 0)}),void 0)},Va=(0,l.memo)((function(e){var n=e.data,t=e.onClick,a=e.selected,r=e.disabled;if("type"in n)switch(n.type){case d.SearchResultType.HEADER:return(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--header",extra:n.count},{children:n.text}),void 0);case d.SearchResultType.CALL_ALL_IN_CHAT:return(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--select"},{children:(0,o.jsxs)(Bn.default,(0,i.__assign)({appearance:"secondary",wide:!0,onClick:t},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"CallsSearchResult__icon"},{children:(0,o.jsx)(Ha,{},void 0)}),void 0),n.text]}),void 0)}),void 0);case d.SearchResultType.MEMBERS_MORE:case d.SearchResultType.FRIENDS_MORE:case d.SearchResultType.GROUP_MEMBERS_MORE:return(0,o.jsx)(Hn.ListMore,(0,i.__assign)({onClick:t},{children:n.text}),void 0)}return(0,o.jsx)(In.default,(0,i.__assign)({"data-id":n.peerId,onClick:t,selectable:!r},{children:(0,o.jsx)(Ua,{member:n,selected:a,disabled:r},void 0)}),void 0)})),Ga=function(e){var n=e.onChange,t=e.initMembers,a=e.selected,r=e.personCache,s=e.memberType,_=(0,l.useRef)(!1),v=(0,l.useRef)(),h=(0,c.useSelector)((function(e){return e})),p=u(),f=(0,ue.useLang)().getLang,m=(0,i.__read)((0,l.useState)(t),2),A=m[0],g=m[1],C=(0,i.__read)((0,l.useState)(""),2),E=C[0],S=C[1],T=(0,i.__read)((0,l.useState)(!1),2),x=T[0],N=T[1],y=(0,i.__read)((0,l.useState)(!1),2),b=y[0],O=y[1],w=(0,l.useMemo)((function(){return a.reduce((function(e,n){return e[n]=!0,e}),{})}),[a]),L=h.groupMembersCount>d.COUNT_OF_GROUP_MEMBERS_TO_LOAD,k=(0,l.useMemo)((function(){return new I(A,Da)}),[]),P=(0,l.useCallback)((function(e){if(e){var n=k.search(e);if(_.current){var t={};return n.forEach((function(e){t[e.id]=e})),Object.values(t)}return n}return function(e){var n=e.getLang,t=e.members,a=e.showMore,o=e.memberType,r={type:d.SearchResultType.MEMBERS_MORE,text:n("calls_show_all_members")},s={type:d.SearchResultType.FRIENDS_MORE,text:n("calls_show_all_friends")},l={type:d.SearchResultType.GROUP_MEMBERS_MORE,text:n("calls_show_all_group_members")},c=[];switch(o){case Oa.Members:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(var u=0;u<10;u++)c.push(t[u]);c.push(r)}break;case Oa.Friends:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(s)}break;case Oa.CommunityMembers:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(l)}}return c}({getLang:f,members:A,showMore:x,memberType:s})}),[A,k,f,x,s]),M=(0,i.__read)((0,l.useState)((function(){return P(E)})),2),D=M[0],j=M[1],R=(0,l.useCallback)((function(e){var t=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a),!1),[+e],!1);n(t)}),[a,n]),Z=(0,l.useCallback)((function(e){var t=a.filter((function(n){return n!==+e}));n(t)}),[a,n]);(0,l.useEffect)((function(){j(P(E))}),[x]),(0,l.useEffect)((function(){var e=E;return L&&(e.length>=3&&!b?v.current=setTimeout((function(){(function(e,n,t,a){return void 0===n&&(n=""),(0,sn.searchGroupMembers)(e,n).then((function(e){var n=e.items,o=[],r=[];return n&&n.forEach((function(e){e.deactivated||e.id in t.groupMembersCache||(o.push((0,Vn.normalizeUser)(e)),e.can_call_from_group||r.push(e.id))})),o.length>0&&a({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:t.groupMembersCount,groupMembers:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.groupMembers),!1),(0,i.__read)(o),!1),unableToCallGroupMembersIds:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.unableToCallGroupMembersIds),!1),(0,i.__read)(r),!1)}),o}))})(-h.groupId,e,h,p).then((function(n){var t,a;if(O(!1),n.length){_.current=!0;var o=(0,i.__spreadArray)([],(0,i.__read)(A),!1);try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;o.push(l),k.add(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}g(o),j(P(e))}}))}),1e3):v.current&&(O(!1),clearTimeout(v.current))),function(){v.current&&clearTimeout(v.current)}}),[E]);var B=(0,l.useCallback)((function(e){S(e.target.value),j(P(e.target.value))}),[P]),U=(0,l.useCallback)((function(e){return Z(e),Promise.resolve()}),[Z]),H=(0,l.useCallback)((function(e){return ka(e,h,w)?Z(e):Pa({member:r.current.get(+e),state:h,selectedMap:w})||(R(e),S(""),j(P(""))),Promise.resolve()}),[h,w,P,R,Z]),V=(0,l.useCallback)((function(e,n){return"type"in e?function(){return N(!0)}:n}),[]),G=(0,l.useCallback)((function(e,n){var t="peerId"in e?e.peerId:0;return(0,o.jsx)(Va,{data:e,onClick:V(e,n),selected:ka(t,h,w),disabled:Pa({member:r.current.get(+t),state:h,selectedMap:w})},t||"text"in e&&e.text||void 0)}),[w,h.groupId,h.participants,h.me,h.unableToCallGroupMembersIds]);return{query:E,found:D,onRemoveToken:U,onChangeHandler:B,onSelect:H,renderSuggest:G}},Fa=function(e){var n=e.tokens,t=e.onChange,a=e.selected,i=e.personCache,r=e.initMembers,s=e.memberType,l=Ga({selected:a,onChange:t,personCache:i,initMembers:r,memberType:s});return(0,o.jsx)(Ra,{tokens:n,onRemoveToken:l.onRemoveToken,value:l.query,onChange:l.onChangeHandler,onSelect:l.onSelect,renderSuggest:l.renderSuggest,data:l.found,hideInputWithName:!0},void 0)},Wa=function(e){var n=e.onChange,t=e.onChangeTab,a=e.tab,r=e.tabs,d=e.selected,u=(0,c.useSelector)((function(e){return e.friends})),_=(0,c.useSelector)((function(e){return e.chatMembers})),v=(0,c.useSelector)((function(e){return e.groupMembers})),h=function(){var e=(0,c.useSelector)((function(e){return e.groupMembers})),n=(0,c.useSelector)((function(e){return e.chatMembers})),t=(0,c.useSelector)((function(e){return e.friends})),a=(0,l.useRef)({}),i=(0,l.useRef)();i.current||(i.current=new Map);var o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){e.forEach((function(e){i.current.set(e.id,e)}))}))};return a.current.chatMembers!==n&&(o(n),a.current.chatMembers=n),a.current.groupMembers!==e&&(o(e),a.current.groupMembers=e),a.current.friends!==t&&(o(t),a.current.friends=t),(0,l.useEffect)((function(){return function(){i.current.clear(),a.current={}}}),[]),{personCache:i}}().personCache,p=function(e){var n=e.selected,t=e.personCache,a=(0,c.useSelector)((function(e){return e})),o=(0,l.useMemo)((function(){var e,o,r,s,l=(0,P.getActiveDevices)(a).activeDevices,c=new Map;try{for(var d=(0,i.__values)(l),u=d.next();!u.done;u=d.next()){var _=u.value,v=a.participants[_.externalId.id];v&&c.set(v.peerId,{id:v.peerId.toString(),text:Ma(v.name),locked:!0})}}catch(n){e={error:n}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(e)throw e.error}}try{for(var h=(0,i.__values)(n),p=h.next();!p.done;p=h.next()){var f=p.value,m=a.participants[f]||t.current.get(f);c.set(f,{text:Ma(null==m?void 0:m.name),id:f.toString(),locked:!1})}}catch(e){r={error:e}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(r)throw r.error}}return(0,i.__spreadArray)([],(0,i.__read)(c.values()),!1)}),[n,a.participants,a.me,a.groupId,a.meGroup,a.adminPinnedParticipant,a.isOratorMode,a.oratorScrollFirstVisible,a.gridScrollFirstVisible,a.oratorScrollNumberOfVisible]);return o}({selected:d,personCache:h});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ba.ConfigProvider,(0,i.__assign)({platform:ba.Platform.VKCOM,scheme:"inherit"},{children:(0,o.jsx)(ba.Tabs,(0,i.__assign)({className:"AddParticipants__tabs"},{children:r.map((function(e){var n,r=e.id,l=e.label,c=e.counter;return(0,o.jsx)(ba.TabsItem,(0,i.__assign)({className:"AddParticipants__tabsItem",onClick:function(){return t(r)},selected:r===a,after:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("AddParticipants__count",(n={},n["AddParticipants__count--inactive"]=r!==a,n))},{children:c}),void 0)},{children:l}),r)}))}),void 0)}),void 0),a===ya.Participants&&(0,o.jsx)(Fa,{onChange:n,personCache:h,selected:d,tokens:p,initMembers:_,memberType:Oa.Members},ya.Participants),a===ya.Friends&&(0,o.jsx)(Fa,{onChange:n,personCache:h,selected:d,tokens:p,initMembers:u,memberType:Oa.Friends},ya.Friends),a===ya.Community&&(0,o.jsx)(Fa,{onChange:n,personCache:h,selected:d,tokens:p,initMembers:v,memberType:Oa.CommunityMembers},ya.Community)]},void 0)};const za=(0,X.makeIcon)("Icon16Phone","phone_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="phone_16"><path d="m5.443 2.64.575.684c.796.943.713 2.365-.19 3.268l-.49.49a.475.475 0 0 0-.11.499c.179.487.634 1.096 1.364 1.827.732.731 1.34 1.185 1.827 1.364.174.064.369.02.5-.11l.489-.49c.903-.902 2.324-.985 3.269-.19l.683.574c.779.656.858 1.839.175 2.64-.372.431-.896.702-1.463.756-2.182.294-4.471-.758-6.868-3.155-2.398-2.398-3.45-4.688-3.156-6.87a2.213 2.213 0 0 1 .756-1.464c.802-.68 1.984-.602 2.64.178z" fill="currentColor" /></symbol>',16,16,!1,void 0);var Ka=function(e){var n=e.isAddSubmitDisabled,t=e.onAdd,a=e.onAddAll,r=e.tab,s=e.showCallAll,l=(0,ue.useLang)().getLang;return(0,o.jsxs)(o.Fragment,{children:[r===ya.Participants&&s&&(0,o.jsxs)(Bn.default,(0,i.__assign)({className:"CallManagementModal__callAllButton",appearance:"secondary",onClick:a},{children:[(0,o.jsx)(za,{height:15,className:"CallManagementModal__callAllButton__icon"},void 0),(0,o.jsx)("div",{children:l("calls_call_all")},void 0)]}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({disabled:n,onClick:t},{children:l("calls_add")}),void 0)]},void 0)},Qa=function(e){var n=e.SDK,t=e.isWithBackButton,a=e.onBackClick,r=(0,c.useSelector)((function(e){return e})),s=(0,c.useSelector)((function(e){return e.me})),_=(0,c.useSelector)((function(e){return e.participants})),v=u(),h=(0,l.useContext)(E.LangContext).getLang,p=(0,i.__read)((0,l.useState)(r.preselectedIds||[]),2),f=p[0],m=p[1],A=(0,c.useSelector)((function(e){return e.chatMembers.length})),g=(0,c.useSelector)((function(e){return e.friendsCount||0})),C=(0,c.useSelector)((function(e){return e.groupMembersCount})),S=(0,c.useSelector)((function(e){return 0!==e.groupId})),T=(0,l.useMemo)((function(){return(0,P.getParticipantsInfo)({me:s,participants:_,excludeAnonymFromCount:!0})}),[_,s]),I=T.creatorPeerId,x=T.membersCount,N=(0,P.isParticipantGroup)(I),y=x+f.length,b=function(e){var n=e.friendsCount,t=e.membersCount,a=e.defaultTab,o=e.groupMembersCount,r=e.displayTabs,s=(0,ue.useLang)().getLang,c=(0,i.__read)((0,l.useState)(a||ya.Participants),2),d=c[0],u=c[1],_=function(e){switch(e){case ya.Participants:return{id:ya.Participants,label:s("calls_call_patricipants"),counter:t};case ya.Friends:return{id:ya.Friends,label:s("calls_call_friends"),counter:n};case ya.Community:return{id:ya.Community,label:s("calls_call_community_members"),counter:o}}},v=(0,l.useMemo)((function(){var e,n,t=[];try{for(var a=(0,i.__values)(r),o=a.next();!o.done;o=a.next()){var s=o.value;s&&t.push(_(s))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return t}),[s,t,n,d,o,r]);return{tab:d,tabs:v,onChangeTab:(0,l.useCallback)((function(e){u(e)}),[])}}({membersCount:x,friendsCount:g,groupMembersCount:C,displayTabs:(0,l.useMemo)((function(){return[!S&&!N&&ya.Participants,S?ya.Community:ya.Friends]}),[S]),defaultTab:S?ya.Community:N?ya.Friends:A>1?ya.Participants:ya.Friends}),L=b.onChangeTab,k=b.tab,M=b.tabs,D=function(){v({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),v({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},j=0===f.length,R=function(e){D(),v({type:d.E_ACTION.MANUAL_ADD_PARTICIPANTS,participants:e});var t=e.map((function(e){return new Promise((function(t){n.addParticipant(String(e)).then(t).catch((function(n){"auth.banned"===n.message?t(e):"vk-participant-is-rejected-error"===n.message?v({type:d.E_ACTION.ERROR,text:h("calls_error_cant_add_because_of_privacy")}):t(null)}))}))}));Promise.all(t).then((function(e){if((e=e.filter((function(e){return void 0!==e}))).length){var n=function(e,n){var t=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.friends),!1),(0,i.__read)(e.chatMembers),!1),(0,i.__read)(e.groupMembers),!1),a=[];return t.filter((function(e){var t=e.id;return!(!n.includes(t)||a.includes(t))&&(a.push(t),!0)}))}(r,e);v({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:{members:n}})}}));var a=(0,i.__read)((0,Ve.convertClientData)(function(e,n){var t=e.chatData||e.callData.conversation,a=n.reduce((function(n,t){return e.participants[t]||n.set(t,!0),n}),new Map);if(0===a.size)return[t,[]];var o=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,r=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,s=o.reduce((function(e,n){return a.get(n.id)&&(e.smallerListData.push(n),e.smallerListMap.set(n.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=s.smallerListData,c=s.smallerListMap;if(l.length===a.size)return[t,l];var d=r.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[t,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(d),!1)]}(r,e)),2),o=a[0],s=a[1];v({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:s}),w.callStats.logEvent({call_event_type:d.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:r.callData.callId,peer_id:r.peer.toString(),is_group_call:(0,O.isGroupCallByPeer)(r.peer),group_call_users_count:f.length})};return(0,o.jsx)(Sn,(0,i.__assign)({title:h("calls_add_participants_to_call"),onCloseModal:D,actionButtons:(0,o.jsx)(Ka,{isAddSubmitDisabled:j,onAdd:function(){R(f)},onAddAll:function(){var e=function(e){var n=e.state,t=e.selectedMap,a=(0,P.getActiveDevices)(n).activeDevices.reduce((function(e,n){return e[n.externalId.id]=!0,e}),{});return n.chatMembers.reduce((function(e,i){var o=i.peerId;return a[o]||Pa({member:i,state:n,selectedMap:t})||e.push(o),e}),[])}({state:r});R(e)},tab:k,showCallAll:A>x},void 0),hint:k!==ya.Participants?Ya(y,h):void 0,isWithBackButton:t,onBackClick:t?a:function(){}},{children:(0,o.jsx)(Wa,{onChange:m,tab:k,tabs:M,onChangeTab:L,selected:f},void 0)}),void 0)};function Ya(e,n){if(e<2)return n("calls_management_add_warning")}var Ja=t(63035),Xa=function(e,n,t){var a=null,i=e;return e===d.EVideoEffectType.BLUR?(a=Ja.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED,i=d.VIRTUAL_BACKGROUND_BLUR_ID):"number"==typeof e&&(a=e>4e3?Ja.CallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DISABLED:Ja.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED),{prevSendValue:i,disabledActionType:a,effectDuration:Math.round((n-t)/1e3)}},qa=function(e){var n=oe();if(n){se();var t=ae(),a=Date.now(),i=e.callData.callId,o=e.peer,r=(0,O.isGroupCallByPeer)(o),s=Xa(t,a,n),l=s.disabledActionType,c=s.effectDuration,d=s.prevSendValue;null!==l&&w.callStats.logEvent({call_event_type:l,is_group_call:r,peer_id:o,session_id:i,background_duration:c,background_id:d})}};function $a(e,n,t,a){var i=n.callData.callId||"";t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),t({type:d.E_ACTION.SET_LAST_CALL_DATA,data:{isMeEndedCallForAll:!0}}),(0,sn.forceCallFinish)(i).catch((function(e){console.error(e),t({type:d.E_ACTION.ERROR,text:a("calls_error_force_call_finish"),handleType:d.ErrorHandleType.FATAL}),t({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})})).finally((function(){t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})),qa(n)}var ei=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#paint0_linear)"},void 0),(0,o.jsx)("path",{d:"M6.746 14.391c-.165-1.078-.204-1.206-.493-1.614-.363-.513-.415-1.1.38-1.255 2.042-.397 4.252-.1 6.265.268a5.546 5.546 0 002.204 0c2.013-.368 4.223-.665 6.264-.268.796.154.744.742.38 1.255-.288.408-.327.536-.492 1.614-.248 1.617-1.607 2.275-3.29 2.276-1.85 0-2.465-1.055-3.04-2.494-.557-1.398-1.29-1.398-1.849 0-.574 1.439-1.19 2.494-3.038 2.494-1.684 0-3.043-.66-3.29-2.276z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"paint0_linear",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},ni=function(e){var n=e.hint,t=e.className,a=e.children,r=(0,i.__rest)(e,["hint","className","children"]),s=!!n,l={"ListItem--withHint":s};return(0,o.jsxs)(In.default,(0,i.__assign)({},r,{className:(0,be.classNames)(l,t)},{children:[a,s&&(0,o.jsx)("div",(0,i.__assign)({className:"ListItem--hint"},{children:n}),void 0)]}),void 0)};const ti=(0,X.makeIcon)("Icon24DoorArrowLeftOutline","door_arrow_left_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="door_arrow_left_outline_24"><path d="M18.754 20.366c-.763.407-1.512.534-3.082.534H13a.9.9 0 1 1 0-1.8h2.672c1.487 0 1.87-.128 2.233-.322.336-.18.594-.438.773-.773.194-.362.322-.746.322-2.233V8.228c0-1.487-.128-1.871-.322-2.233a1.847 1.847 0 0 0-.773-.774c-.362-.193-.746-.321-2.233-.321H13a.9.9 0 1 1 0-1.8h2.672c1.57 0 2.32.127 3.082.534.65.347 1.164.863 1.512 1.512.407.762.534 1.512.534 3.082v7.544c0 1.57-.127 2.32-.534 3.082a3.647 3.647 0 0 1-1.512 1.512Z" /><path d="m9.364 15.364 2.463-2.464H3.9a.9.9 0 0 1 0-1.8h7.927L9.364 8.636a.9.9 0 1 1 1.272-1.272l4 4a.9.9 0 0 1 0 1.272l-4 4a.9.9 0 0 1-1.272-1.272Z" /></symbol>',24,24,!1,void 0);var ai,ii=function(e){var n=e.requireAuthToJoin,t=void 0!==n&&n,a=e.onRequireAuthToJoinChanged,r=e.isWaitingHallBlockShown,s=void 0!==r&&r,c=e.isWaitingHallEnabled,d=void 0!==c&&c,u=e.onWaitingHallEnabledChanged,_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(!t),2),h=v[0],p=v[1],f=(0,i.__read)((0,l.useState)(d),2),m=f[0],A=f[1],g=!1,C=(0,l.useCallback)((function(){if(!g){g=!0;var e=!h;p(e),a&&a(!e)}}),[t]),S=!1,T=(0,l.useCallback)((function(){if(!S){S=!0;var e=!m;A(e),u&&u(e)}}),[d]);return(0,o.jsxs)(Tn.default,{children:[s&&(0,o.jsx)(ni,(0,i.__assign)({onClick:T,canBeHovered:!1,icon:(0,o.jsx)(xn.ListIcon,{icon:(0,o.jsx)(ti,{width:20,height:20},void 0),color:xn.ListIconColors.BLUE},void 0),hint:_("calls_menu_waiting_hall_description"),selectable:!0,aside:(0,o.jsx)(G.default,{onChange:T,checked:m},void 0)},{children:_("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,onClick:C,selectable:!0,icon:(0,o.jsx)(ei,{},void 0),aside:(0,o.jsx)(G.default,{onChange:C,checked:h},void 0)},{children:_("calls_management_link_allow_anonymous")}),void 0)]},void 0)},oi=t(9670);!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS",e[e.WAITING_HALL=3]="WAITING_HALL"}(ai||(ai={}));var ri=function(e){var n,t,a=e.bridge,r=e.SDK,s=e.navigateToConvo,_=e.navigateToProfile,v=e.allowAddMembers,h=void 0!==v&&v,p=(0,c.useSelector)((function(e){return e})),f=u(),m=k((function(e){return e.callData.callUrlLink||""})),A=(0,l.useContext)(y.ConfigContext).allowWaitingHall,g=p.managementView||ai.MAIN,C=(0,i.__read)((0,l.useState)(g),2),S=C[0],T=C[1],I=(0,i.__read)((0,l.useState)(!1),2),x=I[0],N=I[1],b=(0,i.__read)((0,l.useState)(!1),2),w=b[0],L=b[1],M=(0,i.__read)((0,l.useState)(!1),2),D=M[0],j=M[1],R=(0,i.__read)((0,l.useState)(!1),2),Z=R[0],B=R[1],U=(0,i.__read)((0,l.useState)(!1),2),H=U[0],V=U[1],G=h||!!(null===(n=p.callData.conversation)||void 0===n?void 0:n.canAddMembers),F=(null===(t=p.callData)||void 0===t?void 0:t.canFinishCall)||0!==p.groupId&&m,W=(0,l.useContext)(E.LangContext).getLang,z=(0,O.isRequireAuthToJoin)(p),K=(0,O.isWaitingHallEnabled)(p),Q=(0,l.useCallback)((function(){f({type:d.E_ACTION.MANAGEMENT,isOpen:!1})}),[]),Y=(0,l.useCallback)((function(){T(ai.MAIN)}),[]),X=function(e){var n=p.callData.callId||"";return N(!0),At(f,n,e,(0,O.isAuthedByGroupId)(p)?p.groupId:0).catch((function(e){console.error(e),f({type:d.E_ACTION.ERROR,text:W("calls_get_url_link_error_text")})})).finally((function(){N(!1)}))},q=(0,l.useCallback)((function(){T(ai.CALL_LINK),m||X(!1).catch((function(){T(ai.MAIN)}))}),[p.callData.callId,m]),$=(0,l.useCallback)((function(){f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[ct(a,p,f)].concat((0,La.isChatPeer)(p.peer)?[dt(p,f,p.peer,p.callData.conversation)]:[]).concat(a.authorizedGroupId?[_t(a,p,f)]:[]);return Promise.all(e).then((function(){f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),T(ai.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[p.peer,p.callData,p.friends,p.groupMembers]),ee=(0,l.useCallback)((function(){f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[zn(p,f)];return Promise.all(e).then((function(){f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),T(ai.WAITING_HALL)})).catch((function(e){console.error(e),f({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[p.waitingHall]),ne=(0,l.useCallback)((function(){f({type:d.E_ACTION.TOGGLE_POPUP}),$a(0,p,f,W)}),[p.callData.callId,p.imHash]);(0,l.useEffect)((function(){g===ai.CALL_LINK&&q()}),[]),(0,l.useEffect)((function(){var e=(0,P.participantIsAdmin)(p.localDevice),n=e;j(e),B(n),V(A&&e)}),[p.localDevice,A]);var te=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=e,n))}(e)}),[]),ae=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.WAITING_HALL]=e,n))}(e)}),[]),ie=(0,l.useCallback)((function(){return L(!0)}),[]),oe=(0,l.useCallback)((function(){return L(!1)}),[]),re=(0,l.useCallback)((function(){X(!0).catch((function(){T(ai.MAIN)}))}),[p.callData.callId,m]);return(0,o.jsxs)(o.Fragment,{children:[S===ai.MAIN&&(0,o.jsxs)(Sn,(0,i.__assign)({title:W("calls_management_participants"),actionButtons:(0,o.jsxs)(o.Fragment,{children:[F&&(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:ne,appearance:"secondary"},{children:W("calls_force_call_finish")}),"forceCallFinish"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:r.hangup},{children:W("calls_leave_call")}),"leave")]},void 0),onCloseModal:Q},{children:[(0,o.jsx)(bn,{isLinkBlockShown:G,linkBlockTitle:W("calls_menu_link"),onLinkBlockClick:q,callUrlLink:m},void 0),(0,o.jsx)(Ia,{SDK:r,bridge:a,onAddClick:$,onShowMoreWaitingHall:ee,navigateToProfile:_,navigateToConvo:s},void 0)]}),void 0),S===ai.CALL_LINK&&(0,o.jsxs)(Sn,(0,i.__assign)({title:W("calls_management_link"),hint:z?W("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:Q,isWithBackButton:g!==ai.CALL_LINK,onBackClick:Y,actionButtons:(Z?[(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"tertiary",onClick:re},{children:W("calls_link_invalidate")}),"invalidate-link")]:[]).concat([(0,o.jsx)(oi.CopyText,(0,i.__assign)({text:m},{children:(0,o.jsx)(Bn.default,(0,i.__assign)({className:"CallManagementModal__copyTextButton",disabled:x,onClick:ie},{children:W("calls_link_copy")}),void 0)}),"copy-link")])},{children:[(0,o.jsx)(Pn,{link:m,isLinkLoading:x,isCopied:w,hideCopiedText:oe},void 0),D&&(0,o.jsx)(ii,{onRequireAuthToJoinChanged:te,requireAuthToJoin:z,isWaitingHallBlockShown:H,onWaitingHallEnabledChanged:ae,isWaitingHallEnabled:K},void 0)]}),void 0),S===ai.ADD_PARTICIPANTS&&(0,o.jsx)(Qa,{SDK:r,isWithBackButton:!0,onBackClick:Y},void 0),S===ai.WAITING_HALL&&(0,o.jsx)(Kn,{isModal:!0,isWithBackButton:!0,onBackClick:Y,navigateToProfile:_},void 0)]},void 0)};const si=(0,X.makeIcon)("Icon12CancelOutline","cancel_outline_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="cancel_outline_12"><path clip-rule="evenodd" d="M9.03 2.97a.75.75 0 0 1 0 1.06L7.06 6l1.97 1.97a.75.75 0 0 1-1.06 1.06L6 7.06 4.03 9.03a.75.75 0 0 1-1.06-1.06L4.94 6 2.97 4.03a.75.75 0 0 1 1.06-1.06L6 4.94l1.97-1.97a.75.75 0 0 1 1.06 0z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,12,!1,void 0);var li=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("NotificationWithButton",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},ci=t(87854),di=t.n(ci);var ui,_i=l.createContext({}),vi=t(62548),hi=t.n(vi),pi=!("undefined"==typeof window||!window.document||!window.document.createElement);if(pi){var fi="__SVG_SPRITE_NODE__";ui=new(hi())({attrs:{id:fi}});var mi=function(){var e=document.getElementById(fi);e?ui.attach(e):ui.mount(),document.removeEventListener("DOMContentLoaded",mi)};document.querySelector("body")?mi():document.addEventListener("DOMContentLoaded",mi)}else ui=null;var Ai=pi?l.useLayoutEffect:l.useEffect;function gi(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Ci(){return Ci=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Ci.apply(this,arguments)}function Ei(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){gi(e,n,t[n])}))}return e}function Si(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function Ti(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var Ii={display:"block"};var xi=function(e){var n=e.width,t=e.height,a=e.viewBox,i=e.id,o=e.className,r=void 0===o?"":o,s=e.style,c=void 0===s?{}:s,d=e.fill,u=e.getRootRef,_=e.Component,v=void 0===_?"div":_,h=e.role,p=e["aria-label"],f=e["aria-hidden"],m=Ti(e,["width","height","viewBox","id","className","style","fill","getRootRef","Component","role","aria-label","aria-hidden"]),A=Math.max(n,t),g=l.useContext(_i),C=function(e,n){for(var t=n.classPrefix,a=n.globalClasses,i="",o=0;o<e.length;o++)t&&(i+=" "+(t+e[o])),t&&!a||(i+=" "+e[o]);return i}(["Icon","Icon--".concat(A),"Icon--w-".concat(n),"Icon--h-".concat(t),"Icon--".concat(i)],g);return l.createElement(v,Ci({role:"presentation"},m,{ref:u,className:"".concat(C," ").concat(r),style:Si(Ei({},c),{width:n,height:t})}),l.createElement("svg",{viewBox:a,width:n,height:t,style:Ii,role:h,"aria-label":p,"aria-hidden":f},l.createElement("use",{xlinkHref:"#".concat(i),style:{fill:"currentColor",color:d}})))};function Ni(e,n,t,a,i,o){var r=!1;function s(){var e;r||(e=new(di())({id:n,viewBox:t,content:a}),ui&&ui.add(e),r=!0)}var c=function(e){return Ai(s,[]),l.createElement(xi,Ci({},e,{viewBox:t,id:n,width:isNaN(e.width)?i:+e.width,height:isNaN(e.height)?o:+e.height}))};return c.mountIcon=s,c.displayName=e,c}const yi=Ni("Icon56LogoSferumColor","logo_sferum_color_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="logo_sferum_color_56"><path fill="#07F" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_a)" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_b)" d="M41.468 19.586c-.898-.897-2.067-1.436-3.412-1.643-.206-1.344-.745-2.513-1.642-3.411-6.042-6.043-15.84-6.043-21.882 0-6.043 6.042-6.043 15.84 0 21.882.898.898 2.067 1.436 3.411 1.643.207 1.345.745 2.514 1.643 3.411 6.042 6.043 15.84 6.043 21.882 0 6.043-6.042 6.043-15.84 0-21.882Z" /><path fill="url(#logo_sferum_color_56_c)" d="M24.12 24.12c4.51-4.511 9.98-6.785 13.937-6.177-.206-1.344-.745-2.514-1.642-3.411-3.539-3.539-11.306-1.51-17.348 4.534-6.043 6.042-8.073 13.81-4.534 17.348.898.898 2.067 1.436 3.411 1.643-.609-3.956 1.665-9.427 6.176-13.938Z" /><defs><radialGradient id="logo_sferum_color_56_a" cx="0" cy="0" r="1" gradientTransform="matrix(29.98957 -32.53844 17.18804 15.84163 27.683 27.922)" gradientUnits="userSpaceOnUse"><stop offset=".281" stop-color="#4BF9E8" /><stop offset=".319" stop-color="#41D8D3" /><stop offset=".384" stop-color="#32A4B2" /><stop offset=".451" stop-color="#247696" /><stop offset=".518" stop-color="#19517E" /><stop offset=".584" stop-color="#11356C" /><stop offset=".65" stop-color="#0B205F" /><stop offset=".716" stop-color="#071458" /><stop offset=".779" stop-color="#061055" /></radialGradient><radialGradient id="logo_sferum_color_56_c" cx="0" cy="0" r="1" gradientTransform="rotate(-128.972 23.696 8.511) scale(13.7017 20.209)" gradientUnits="userSpaceOnUse"><stop stop-color="#0B25CE" /><stop offset=".486" stop-color="#2C93DB" /><stop offset=".838" stop-color="#42DCE4" /><stop offset="1" stop-color="#4BF9E8" /></radialGradient><linearGradient id="logo_sferum_color_56_b" x1="16.716" x2="39.042" y1="37.874" y2="18.339" gradientUnits="userSpaceOnUse"><stop stop-color="#0000C9" /><stop offset=".128" stop-color="#2006C9" /><stop offset=".322" stop-color="#4A0EC8" /><stop offset=".511" stop-color="#6B14C8" /><stop offset=".691" stop-color="#8318C7" /><stop offset=".858" stop-color="#911BC7" /><stop offset="1" stop-color="#961CC7" /></linearGradient></defs></symbol>',56,56),bi=Ni("Icon96LogoVkCallsColor","logo_vk_calls_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 96 96" id="logo_vk_calls_color_96"><path fill="#07F" d="M62.72 0C89.6 0 96 6.4 96 33.28v29.44C96 89.6 89.6 96 62.72 96H33.28C6.4 96 0 89.6 0 62.72V33.28C0 6.4 6.4 0 33.28 0h29.44Z" /><path fill="#77BEFF" d="M95.999 63.146c-.01 3.725-.146 7.051-.446 10.018a55.994 55.994 0 0 1-20.404 3.823c-10.73 0-20.756-3.01-29.281-8.232a2.563 2.563 0 0 0-2.38-.15c-5.3 2.357-11.26 3.594-17.93 4.13-1.841.148-3.08-1.8-2.29-3.471 2.633-5.574 4.358-10.617 5.41-15.635a2.41 2.41 0 0 0-.365-1.821c-5.877-8.875-9.3-19.516-9.3-30.957 0-7.198 1.355-14.08 3.823-20.404C25.916.135 29.382 0 33.28 0h29.44c26.77 0 33.227 6.348 33.279 32.952V63.146Z" /><path fill="#fff" d="M22.834.447a55.996 55.996 0 0 0-3.821 20.398c0 11.44 3.423 22.082 9.3 30.957a2.41 2.41 0 0 1 .365 1.821c-.758 3.618-1.866 7.25-3.413 11.083l-.004.01a77.91 77.91 0 0 1-.289.706 87.244 87.244 0 0 1-1.705 3.836c-.79 1.67.45 3.619 2.292 3.47a79.068 79.068 0 0 0 5.177-.584l.038-.006c4.605-.69 8.836-1.815 12.715-3.539.77-.342 1.66-.29 2.379.15 8.525 5.222 18.551 8.232 29.28 8.232 7.2 0 14.081-1.355 20.405-3.824-.356 3.523-.945 6.539-1.83 9.111A64.15 64.15 0 0 1 75.149 85c-11.245 0-21.833-2.9-31.036-7.995-5.64 2.12-11.655 3.215-17.913 3.718-8.562.687-13.358-8.176-10.183-14.892 2-4.232 3.376-8.019 4.303-11.659-5.918-9.717-9.326-21.135-9.326-33.327 0-6.448.953-12.683 2.729-18.565 2.572-.886 5.588-1.476 9.11-1.833Z" /><path fill="#fff" fill-rule="evenodd" d="M43.164 15.03c2.618-.308 4.793 1.844 6.05 4.356l1.408 2.817a6.894 6.894 0 0 1-2.664 9.022c-.501.296-.659.952-.333 1.44a56.82 56.82 0 0 0 7.084 8.626 56.826 56.826 0 0 0 8.626 7.084 1.017 1.017 0 0 0 1.44-.333 6.894 6.894 0 0 1 9.022-2.664l2.817 1.409c2.512 1.256 4.664 3.431 4.357 6.05-.165 1.403-.744 2.65-1.81 3.717-2.702 2.701-7.448 3.134-12.984 1.453-5.518-1.675-11.729-5.428-17.242-10.942-5.514-5.513-9.267-11.724-10.942-17.242-1.68-5.536-1.248-10.282 1.453-12.984 1.066-1.066 2.313-1.645 3.718-1.81Z" clip-rule="evenodd" /></symbol>',96,96);var Oi=t(61108),wi=function(e,n,t){void 0===t&&(t=!1);var a=document.createElement("a");t&&(a.target="_blank"),a.download=n,a.href=e,document.body.appendChild(a),a.click(),a.remove()};function Li(e){if(e)return function(){switch(Oi.Platform.OS){case Oi.OS.MAC:case Oi.OS.WINDOWS:return{url:d.SFERUM_APP_URL[Oi.Platform.OS],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[Oi.Platform.OS]};case Oi.OS.LINUX:return{url:d.SFERUM_APP_URL[Oi.Platform.OS].deb[Oi.ARCH.X64],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[Oi.Platform.OS].deb[Oi.ARCH.X64]};default:return null}}();var n=null;return Oi.Platform.OS===Oi.OS.MAC?n={url:d.DESKTOP_CALLS_DOWNLOAD[Oi.OS.MAC],filename:d.DESKTOP_CALLS_FILENAME[Oi.OS.MAC]}:Oi.Platform.OS===Oi.OS.WINDOWS?n={url:d.DESKTOP_CALLS_DOWNLOAD[Oi.OS.WINDOWS],filename:d.DESKTOP_CALLS_FILENAME[Oi.OS.WINDOWS]}:Oi.Platform.OS===Oi.OS.LINUX&&(n={url:d.DESKTOP_CALLS_DOWNLOAD[Oi.OS.LINUX].deb[Oi.ARCH.X64],filename:d.DESKTOP_CALLS_FILENAME[Oi.OS.LINUX].deb[Oi.ARCH.X64]}),n}function ki(){s.localStorage.setItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED,"true")}var Pi=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"13",viewBox:"0 0 12 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.21967 2.96967C4.51256 2.67678 4.98744 2.67678 5.28033 2.96967L8.28033 5.96967C8.57322 6.26256 8.57322 6.73744 8.28033 7.03033L5.28033 10.0303C4.98744 10.3232 4.51256 10.3232 4.21967 10.0303C3.92678 9.73744 3.92678 9.26256 4.21967 8.96967L6.68934 6.5L4.21967 4.03033C3.92678 3.73744 3.92678 3.26256 4.21967 2.96967Z",fill:"white",fillOpacity:"0.64"},void 0)}),void 0)},Mi=function(e){var n=e.onClose,t=e.isSferum,a=(0,ue.useLang)().getLang,r=Li(t),s=Oi.Platform.OS===Oi.OS.MAC?"macOS":Oi.Platform.OS===Oi.OS.WINDOWS?"Windows":null,l=s?a("calls_notification_native_app_button_for").replace("{name}",s):a("calls_notification_native_app_button");return(0,o.jsxs)("div",(0,i.__assign)({className:"NotificationDesktopApp"},{children:[(0,o.jsx)(si,{className:"NotificationDesktopApp--close",onClick:n,width:16,height:16},void 0),!!t&&(0,o.jsx)(yi,{className:"NotificationDesktopApp--icon"},void 0),!t&&(0,o.jsx)(bi,{className:"NotificationDesktopApp--icon",width:56,height:56},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"NotificationDesktopApp--text"},{children:a("calls_notification_native_app_text")}),void 0),null!==s&&(0,o.jsxs)(Bn.default,(0,i.__assign)({onClick:function(){r&&wi(r.url,r.filename),n()},appearance:"overlay_primary",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Pi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),null===s&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Pi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0)]}),void 0)};const Di=(0,X.makeIcon)("Icon20ClockOutline","clock_outline_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="clock_outline_20"><g fill="currentColor"><path d="M10.25 6.5a.75.75 0 0 0-1.5 0v4a.75.75 0 0 0 .516.713l3.5 1.15a.75.75 0 1 0 .468-1.425l-2.984-.981z" /><path clip-rule="evenodd" d="M18.5 10a8.5 8.5 0 1 0-17 0 8.5 8.5 0 0 0 17 0zM3 10a7 7 0 1 1 14 0 7 7 0 0 1-14 0z" fill-rule="evenodd" /></g></symbol>',20,20,!1,void 0),ji=(0,X.makeIcon)("Icon20ChevronRight","chevron_right_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="chevron_right_20"><path fill-rule="evenodd" d="M7.293 4.293a1 1 0 0 1 1.414 0l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414-1.414L11.586 10 7.293 5.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var Ri=function(e){var n=e.open,t=e.onClose,a=e.onExit,r=(0,ue.useLang)().getLang,s=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t){var e=function(){d.current&&clearTimeout(d.current)};return e(),d.current=setTimeout((function(){t(!0)}),1e4),e}}),[n,t]),(0,l.useEffect)((function(){var e;if(!n)return null===(e=s.current)||void 0===e||e.addEventListener("transitionend",t),c.current=setTimeout(t,600),i;function t(){i(),null==a||a()}function i(){var e;null===(e=s.current)||void 0===e||e.removeEventListener("transitionend",t),c.current&&clearTimeout(c.current)}}),[n,a]),(0,o.jsxs)("div",(0,i.__assign)({ref:s,onClick:function(){return null==t?void 0:t()},className:(0,ba.classNames)({CallsNotificationRecordEnded:!0,"CallsNotificationRecordEnded--closing":!n})},{children:[(0,o.jsx)(Di,{className:"CallsNotificationRecordEnded--clock",fill:"#529EF4"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc__title"},{children:r("calls_record_is_processed")}),void 0),(0,o.jsx)("div",{children:r("calls_open_record_list")},void 0)]}),void 0),(0,o.jsx)(ji,{className:"CallsNotificationRecordEnded--chevron",fill:"var(--steel_gray_200)"},void 0)]}),void 0)};const Zi=(0,X.makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Bi=function(e){var n=e.onClose,t=e.onClickJoin,a=(0,l.useContext)(E.LangContext).getLang,r=Li(),c=Oi.Platform.OS===Oi.OS.LINUX?"Linux":Oi.Platform.OS===Oi.OS.MAC?"macOS":Oi.Platform.OS===Oi.OS.WINDOWS?"Windows":null,u=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),_=u[0],v=u[1],h=c?a("calls_warning_native_app_button_for").replace("{name}",c):a("calls_warning_native_app_button"),p=null===c||Oi.Platform.BROWSER===Oi.BROWSER.FIREFOX;return(0,o.jsxs)("div",(0,i.__assign)({className:"WarningDesktopApp"},{children:[(0,o.jsx)(Zi,{fill:"#FF5C5C"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--title"},{children:a("calls_warning_native_app_title")}),void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--text"},{children:a("calls_warning_native_app_text")}),void 0),!_&&!p&&(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){r&&(wi(r.url,r.filename),ki(),v(!0))},appearance:"overlay_primary"},{children:h}),void 0),!_&&p&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"WarningDesktopApp--link",onClick:function(){ki(),v(!0)}},{children:[h," ",(0,o.jsx)(Pi,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),_&&(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:t,appearance:"overlay_primary"},{children:a("calls_warning_native_app_join_button")}),void 0),(0,o.jsx)(si,{className:"WarningDesktopApp--close",onClick:n,width:16,height:16},void 0)]}),void 0)};function Ui(e){return new Promise((function(n,t){if(Oi.Platform.isMobile)t("is_mobile");else if(document.body.focus(),"hidden"===document.visibilityState||document.hidden)t("hidden_page");else{var a,i=function(){a&&clearTimeout(a),window.removeEventListener("blur",i),n(!0)};if(window.addEventListener("blur",i),a=setTimeout((function(){window.removeEventListener("blur",i),t("timed_out")}),3e3),Oi.Platform.BROWSER===Oi.BROWSER.SAFARI||Oi.Platform.BROWSER===Oi.BROWSER.FIREFOX){var o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o);var r=o.contentWindow;r?(r.location.href=e,setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o)}),100)):window.location.href=e}else window.location.href=e}}))}var Hi=function(e){var n=e.joinLink,t=e.vkJoinLink,a=e.userId,i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?joinLink="+n+"&userId="+a;return 0!==a&&a||(i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?callId="+t+"&joinLink="+n),console.log("deeplink: ",i),i},Vi=navigator.userAgent.toLowerCase(),Gi={version:(Vi.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(Vi)&&/webkit|safari|khtml/i.test(Vi),edge:/(edge)\/(\d+)\.(\d+)/.test(Vi),chrome:/(chrome)\/(\d+)\.(\d+)/.test(Vi),firefox:/(firefox)\/(\d+)\.(\d+)/.test(Vi)};function Fi(e){var n,t=null==e?void 0:e.find((function(e){return Gi[e.browser]&&void 0===e.version})),a=null==e?void 0:e.find((function(e){return Gi[e.browser]&&String(Gi.version).startsWith(String(e.version))}));return null!==(n=null!=a?a:t)&&void 0!==n?n:null}function Wi(){var e,n=((null===(e=/\.?(?<host>[^.]+\.[^.]+)$/.exec(window.location.host))||void 0===e?void 0:e.groups)||{}).host;return n&&/vk\.(com|ru)/.test(n)?n:"https://vk.com"}var zi=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=u(),_=(0,ue.useLang)(),v=_.getLang,h=_.langNumeric,p=r.config.desktopAppNotification,f=(0,i.__read)((0,l.useState)(!1),2),m=f[0],A=f[1];(0,l.useEffect)((function(){r.shouldShowRecordEndedDesktopAppNotification&&A(!0)}),[r.shouldShowRecordEndedDesktopAppNotification]);var g=(0,l.useMemo)((function(){return Fi(r.config.browserWarnings)}),[r.config.browserWarnings]),C=(0,l.useCallback)((function(e){var n,t=null===(n=r.waitingHall)||void 0===n?void 0:n.members.get(e);t&&s({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(e=r.waitingHall)||void 0===e?void 0:e.members,r.participants]),E=(0,l.useCallback)((function(){var e=[zn(r,s)];return Promise.all(e).then((function(){s({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:ai.WAITING_HALL})}))}),[r.waitingHall]),S=(0,l.useCallback)((function(e){r.waitingHall&&Gn(e,r.waitingHall,s)}),[null===(n=r.waitingHall)||void 0===n?void 0:n.members]),T=(0,l.useCallback)((function(){!function(e,n){e&&(e.hasNew=!1,n({type:d.E_ACTION.SET_WAITING_HALL,data:e}))}(r.waitingHall,s)}),[null===(t=r.waitingHall)||void 0===t?void 0:t.hasNew]);if(r.waitingHall&&0!==r.waitingHall.members.size&&r.waitingHall.hasNew){var I=Array.from(r.waitingHall.members.values()),x=v("calls_notification_users_in_waiting_hall_notification",r.waitingHall.totalCount).replace("{names}",(0,Ve.getParticipantsListLabel)(I,I.slice(0,3),(function(e){return e.shortName||e.name}),v,h,r.waitingHall.totalCount)),N=null;if(1===I.length){var y=I[0];N=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return S(y.peerId)},appearance:"overlay_primary"},{children:v("calls_waiting_hall_join")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return C(y.peerId)},appearance:"overlay_secondary"},{children:v("calls_waiting_hall_forbid")}),void 0)]},void 0)}else N=(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return E()},appearance:"overlay_primary"},{children:v("calls_waiting_show_participants")}),void 0);return(0,o.jsx)(li,{children:(0,o.jsxs)("div",{children:[(0,o.jsx)(si,{className:"NotificationWithButton--close",onClick:T},void 0),(0,o.jsx)("span",{children:x},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"NotificationWithButton--buttons"},{children:N}),void 0)]},void 0)},void 0)}if(r.shouldShowRecordEndedDesktopAppNotification&&dn(r))return(0,o.jsx)(Ri,{open:m,onClose:function(e){var n,t;!e&&r.translation.ownerId&&window.open&&window.open((n=r.translation.ownerId,t=Wi(),(0,P.isParticipantGroup)(n)?t+"/video/playlist/"+n+"_-8":t+function(e){return"/video/@"+e+"/recorded_calls"}(n)),"_blank"),A(!1)},onExit:function(){s({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION})}},void 0);if(g&&r.shouldShowWarningDesktopAppNotification&&(0,O.isGroupCallByPeer)(r.peer)&&(null===(a=r.join)||void 0===a?void 0:a.joinLink)){return(0,o.jsx)(Bi,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION,data:!1}),s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},onClickJoin:function(){var e,n,t,a;if(null===(e=r.join)||void 0===e?void 0:e.joinLink)return Ui(Hi({joinLink:null===(n=r.join)||void 0===n?void 0:n.joinLink,vkJoinLink:null===(t=r.join)||void 0===t?void 0:t.vkJoinLink,userId:null===(a=window.vk)||void 0===a?void 0:a.id}))}},void 0)}if(p&&r.shouldShowDesktopAppNotification){return(0,o.jsx)(Mi,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},isSferum:!!r.config.sferum},void 0)}return null},Ki=!1,Qi=!0;function Yi(e){Qi=e}function Ji(e,n,t){if(void 0===t&&(t=!0),Qi)if(e){var a=!(!n||!n.isAudioEnabled);t&&(Ki=a),a&&(0,J.toggleLocalAudio)(!1)}else Ki&&(0,J.toggleLocalAudio)(!0);else Yi(!0)}var Xi,qi=!1;function $i(e,n,t,a){var i=e.keyCode,o=e.type,r=e.repeat,s="keydown"===o;if(32===i){if(e&&e.target){if(["FCComposer__input","FCSearch__input","fc_editable","fc_clist_filter_text"].some((function(n){return e.target.classList.contains(n)})))return}if(e.preventDefault(),r)return;if(qi)return clearTimeout(Xi),void(qi=!1);qi=!0,Xi=setTimeout((function(){(function(e,n,t,a){var i=function(){var n,i,o=(null===(n=a.notification)||void 0===n?void 0:n.type)===d.NotificationType.PUSH_TO_TALK,r=!1;if(e&&!o?r=!0:e&&o?r=(null===(i=a.notification)||void 0===i?void 0:i.data)!==(0,O.isIAmSpeaking)(a):!e&&o&&(r=!0),r){var s=null;e&&(s={type:d.NotificationType.PUSH_TO_TALK,timer:0,data:(0,O.isIAmSpeaking)(a)}),t({type:d.E_ACTION.CALL_NOTIFICATION,notification:s})}};return e&&n||!e&&!n?Promise.resolve().then(i):(0,J.toggleLocalAudio)(e).then(i)})(s,n,t,a).then((function(){qi=!1}))}),s?200:100)}}const eo=(0,X.makeIcon)("Icon16MicrophoneSlash","microphone_slash_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="microphone_slash_16"><path d="M5.498 7.06v.44a2.501 2.501 0 0 0 2.909 2.467l1.2 1.198a4.005 4.005 0 0 1-5.521-2.822.75.75 0 0 0-1.47.314A5.508 5.508 0 0 0 7.25 12.95v1.301a.75.75 0 0 0 1.502 0v-1.3a5.473 5.473 0 0 0 1.972-.669l1.25 1.25a.751.751 0 0 0 1.062-1.061L3.88 3.32a.75.75 0 1 0-1.06 1.06l2.678 2.68Zm6.356 1.529c-.089.314-.03.66.2.89.37.37.993.284 1.16-.211a5.44 5.44 0 0 0 .17-.61.75.75 0 1 0-1.469-.315 3.945 3.945 0 0 1-.061.246ZM6.303 2.662c-.332.307-.254.818.066 1.138l3.428 3.424a.4.4 0 0 0 .683-.279l.022-2.445a2.501 2.501 0 0 0-4.199-1.838Z" /></symbol>',16,16,!1,void 0),no=(0,X.makeIcon)("Icon16PinDot","pin_dot_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="pin_dot_16"><path d="M6.25 4a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5Z" /><path d="m13.892 5.77-3.657-3.664c-.231-.232-.634-.057-.634.263v.526a.896.896 0 0 1-.263.634L7.623 5.244a.895.895 0 0 1-.633.262H3.995c-.565 0-.847.71-.455 1.102l2.29 2.29-3.569 3.574a.894.894 0 0 0 1.263 1.264l3.57-3.572 2.301 2.301c.402.402 1.101.098 1.101-.456V9.013a.9.9 0 0 1 .262-.633l1.715-1.715a.895.895 0 0 1 .633-.263h.523c.327 0 .488-.407.263-.633Z" /></symbol>',16,16,!1,void 0),to=(0,X.makeIcon)("Icon16Pin","pin_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="pin_16"><path d="m10.235 2.106 3.657 3.663c.225.226.064.633-.263.633h-.523a.895.895 0 0 0-.633.263L10.758 8.38a.896.896 0 0 0-.262.633v2.996c0 .554-.7.858-1.1.456l-2.301-2.3-3.57 3.57a.893.893 0 1 1-1.264-1.263L5.83 8.898l-2.29-2.29c-.391-.392-.109-1.102.456-1.102H6.99a.895.895 0 0 0 .633-.262L9.338 3.53a.896.896 0 0 0 .263-.634V2.37c0-.32.403-.495.634-.263z" fill="currentColor" /></symbol>',16,16,!1,void 0);var ao=(0,l.memo)((function(e){var n,t,a,r,s,c=e.orator,d=e.me,u=e.isPinned,_=e.isPinnedByAdmin,v=e.isPinnedByShareScreen,h=e.isUnpinAllowed,p=e.onTooltipChange,f=e.onUnpin,m=e.tooltips,A=e.oratorDevice,g=(0,l.useContext)(E.LangContext).getLang,C=_||v||u,S=(0,l.useCallback)((function(){p("oratorPin",!1),f()}),[f]),T=(0,l.useCallback)((function(){return p("oratorPin",!0)}),[]),I=(0,l.useCallback)((function(){return p("oratorPin",!1)}),[]),x=(A.wasConnected||c.peerId===d)&&!(null===(n=A.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),N=null===(t=A.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled,y=c.shortName||c.name,b=c.shortNameGen||c.shortName||c.name,O=((null===(a=A.mediaSettings)||void 0===a?void 0:a.isAudioEnabled)||(null===(r=A.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||(null===(s=A.mediaSettings)||void 0===s?void 0:s.isVideoEnabled))&&(A.networkStatus||1)<.6,w=(0,o.jsxs)(o.Fragment,{children:[O&&(0,o.jsx)(q,{fill:(A.networkStatus||1)<=.3?"#ff5c5c":"#FECE00"},void 0),N&&(0,o.jsx)("span",(0,i.__assign)({className:"OratorTitle__additionInfo"},{children:g("calls_orator_screen_sharing")}),void 0),N?b:y,x&&(0,o.jsx)(eo,{},void 0),_&&(0,o.jsx)(no,{},void 0),!_&&(v||u)&&(0,o.jsx)(to,{},void 0)]},void 0);return C?(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({position:"b",align:"center",content:g(_&&h?"calls_hint_admin_pin_for_admin":_?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:m.oratorPin,delay:300,onOpen:T,onClose:I},{children:(0,o.jsx)("button",(0,i.__assign)({className:"OratorTitle OratorTitle--button",onClick:S,disabled:!h},{children:w}),void 0)}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:"OratorTitle"},{children:w}),void 0)})),io=(0,l.memo)((function(e){var n=e.externalId,t=e.isInfoShown,a=e.isPinned,r=e.isPinnedByAdmin,c=e.isHandRaised,d=void 0!==c&&c,u=e.photo,_=e.hasAudio,v=e.isMe,h=void 0!==v&&v,p=e.name,A=e.letter,g=e.wasConnected,C=void 0===g||g,E=e.onClickParticipant,S=e.onDblClickParticipant,T=(0,l.useContext)(y.ConfigContext).anonymPhoto,I=(0,l.useRef)(null),x=(0,P.isParticipantAnonym)(n),N=(0,s.classNames)("Participant","Participant--withAnimation",{"Participant--isPinned":a}),b=(0,P.externalIdToString)(n),O=(0,l.useCallback)((function(e){E&&E(e,n)}),[E,n]),w=(0,l.useCallback)((function(e){S&&S(e,n)}),[S,n]);return(0,o.jsxs)("article",(0,i.__assign)({ref:I,className:N,onClick:O,onDoubleClick:w,"participant-id":b},{children:[(0,o.jsx)(f,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(m.CallPhoto,{id:+n.id,photo:!T&&x?"":u,alt:p||"",letter:A,className:t?"Participant__offsetCard":""},void 0)}),void 0),d&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(B,{className:"Participant__handIcon"},void 0)}),void 0),t&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:p}),void 0),(C||h)&&!_&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0),!r&&a&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),r&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(K,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)})),oo=t(37441);function ro(e){var n,t,a,r,_,v,h,p,f,A,g,C=e.SDK,S=e.navigateToConvo,T=e.navigateToProfile,I=e.onHandCountChanged,x=e.isVirtualBackgroundSupported,N=(0,c.useSelector)((function(e){return e})),L=u(),k=(0,l.useContext)(E.LangContext).getLang,D=(0,l.useContext)(y.ConfigContext),j=D.isModalView,R=D.debugLog,Z=D.enableScreenTrack,B=D.enableProducerScreenTrack,U=D.allowPushToTalk,H=N.peer,V=(0,l.useMemo)((function(){var e,n,t;return(0,O.isGroupCallByPeer)(H)||!!(null===(e=N.localDevice.mediaSettings)||void 0===e?void 0:e.isScreenSharingEnabled)||!!(null===(t=null===(n=(0,P.getPeerIdDeviceInfo)(H,N.devices))||void 0===n?void 0:n.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled)}),[H,N.localDevice,N.devices]),G=V?N.callData.conversation:N.participants[H],F=N.localDevice,W=F.mediaSettings,z=F.permissions,K=M(),Q=K>1,Y=(0,P.isCallHaveOtherParticipants)(),X=Q||(0,P.isParticipantWithVideo)(F),q=(0,l.useMemo)((function(){var e;if(!V||!(0,P.participantIsAdmin)(F))return!1;if(N.externalId&&!!(null===(e=N.maps.vkIdToDevices.get(+N.externalId.id))||void 0===e?void 0:e.size))return!1;var n=(0,P.getNonAnonymousConnectParticipantsCount)(),t=n.admins;return!!n.users&&!t}),[V,F.roles,N.externalId,N.participants,N.devices,N.me]),$=V||K>2,ee=$&&X&&!N.isOratorMode,ne=$&&X&&N.isOratorMode,te=null!==N.adminPinnedParticipant,ae=!te&&null!==N.pinnedParticipant,ie=!ae&&null!==N.screenSharingPinnedParticipant,oe=N.uiMode===d.UIMode.FULLSCREEN,re=(0,l.useMemo)((function(){return C.browser.isScreenCapturingSupported()}),[]),se=(null===(n=N.callData)||void 0===n?void 0:n.canFinishCall)||V&&0===H&&(0,P.isCreator)(F),le=!!N.translation.deferredId&&!N.translation.isOn,ce=(0,i.__read)((0,l.useState)(!1),2),ue=ce[0],ve=ce[1],he=(0,i.__read)((0,l.useState)(!1),2),pe=he[0],fe=he[1],me=(0,i.__read)((0,l.useState)(0),2),Ae=me[0],ge=me[1],Ce=Mt(N),Ee=(0,l.useMemo)((function(){return Ce?function(e){var n,t,a,o=null!==(t=null===(n=e.participantsChunk)||void 0===n?void 0:n.ids.reduce((function(n,t){var a=(0,P.externalIdToString)(t),i=ea(e,a);return i&&n.push(i),n}),[]))&&void 0!==t?t:Zt;return 0===(null===(a=e.participantsChunk)||void 0===a?void 0:a.countBefore)&&e.externalId&&o.unshift((0,i.__assign)((0,i.__assign)({},e.localDevice),{externalId:e.externalId})),{activeDevices:Zt=(0,Ve.shallowEqual)(Zt,o)?Zt:o}}(N):(0,P.getActiveDevices)(N)}),[N.devices,N.participantsChunk,N.adminPinnedParticipant,N.gridScrollFirstVisible,N.oratorScrollFirstVisible,N.isOratorMode,N.localDevice,N.oratorScrollNumberOfVisible,N.externalId,Ce]),Se=(0,i.__read)(function(e){if(e.participantsChunk){var n=Vt(e.participantsChunk);return[n,n+e.participantsChunk.ids.length]}var t=e.isOratorMode,a=t?e.oratorScrollNumberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE,i=t?P.PARTICIPANTS_LIST_BUFFER_SIZE.ORATOR:P.PARTICIPANTS_LIST_BUFFER_SIZE.GRID,o=t?e.oratorScrollFirstVisible:e.gridScrollFirstVisible;return[o<i?0:o-i,o+a+i]}(N),2),Te=Se[0],Ie=Se[1],xe=(0,l.useMemo)((function(){var e=Ee.activeDevices;return Ce?e:e.slice(Te,Ie)}),[Ee.activeDevices,Ce,Te,Ie]),Ne=(null===(t=N.callData.conversation)||void 0===t?void 0:t.canAddMembers)&&!(0,P.isParticipantAnonym)(N.me),ye=(0,l.useCallback)((function(e,n){var t=(0,P.isSameExternalId)(N.pinnedParticipant,n)?null:n;(0,P.isSameExternalId)(N.screenSharingPinnedParticipant,n)&&(t=null),N.screenSharingPinnedParticipant&&L({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[N.pinnedParticipant,N.screenSharingPinnedParticipant]),be=(0,l.useCallback)((function(e,n){N.isOratorMode||L({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),(0,P.isSameExternalId)(N.pinnedParticipant,n)||L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:n})}),[N.isOratorMode,N.pinnedParticipant]),Oe=(0,l.useMemo)((function(){return xe.map((function(e){var n,t,a,i,r,s,l,c,d,u,_=e.mediaSettings,v=_.isAudioEnabled,h=_.isScreenSharingEnabled,p=(0,P.isSameExternalId)(e.externalId,N.externalId),f=N.participants[e.externalId.id],m=p?k("calls_own_label"):(null==f?void 0:f.shortName)?null==f?void 0:f.shortName:null==f?void 0:f.name,A=(0,P.externalIdToString)(e.externalId);if(!e.visible)return(0,o.jsx)(io,{externalId:e.externalId,isInfoShown:!0,isMe:p,isHandRaised:e.wasConnected&&(null===(t=null===(n=e.statusData)||void 0===n?void 0:n.hand)||void 0===t?void 0:t.state),hasAudio:!!v,photo:null==f?void 0:f.photo,name:m,letter:null!==(i=null===(a=null==f?void 0:f.name)||void 0===a?void 0:a[0])&&void 0!==i?i:"",wasConnected:e.wasConnected,onClickParticipant:ye,isPinned:N.isOratorMode&&(0,P.isSameExternalId)(N.pinnedParticipant,e.externalId)||(0,P.isSameExternalId)(N.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:N.isOratorMode&&(0,P.isSameExternalId)(N.adminPinnedParticipant,e.externalId)},A);var g=N.isOratorMode&&(Z||B),E=(0,P.getStream)(e,g&&(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)),I=!(g&&(null===(s=e.mediaSettings)||void 0===s?void 0:s.isVideoEnabled)||!h),x=(0,P.isParticipantWithVideo)(e),y=N.localDevice.status===J.ParticipantStatus.CONNECTED?e.status:J.ParticipantStatus.CONNECTED,b=f&&(0,P.getParticipantActions)({state:N,SDK:C,dispatch:L,participant:f,addProfileLink:!0,getLang:k,navigateToConvo:S,navigateToProfile:T,separatedList:!1,device:e});return(0,o.jsx)(de,{externalId:e.externalId,isVisible:e.visible,isInfoShown:!0,isMe:p,isHandRaised:null===(c=null===(l=e.statusData)||void 0===l?void 0:l.hand)||void 0===c?void 0:c.state,hasVideo:!!x,hasAudio:!!v,isSharingScreen:!!I,stream:E,photo:null==f?void 0:f.photo,name:m,letter:null!==(u=null===(d=null==f?void 0:f.name)||void 0===d?void 0:d[0])&&void 0!==u?u:"",status:y,allowContain:!1,wasConnected:e.wasConnected,networkStatus:e.networkStatus,onClickParticipant:N.isOratorMode?ye:void 0,onDblClickParticipant:N.isOratorMode?void 0:be,actions:b,isPinned:N.isOratorMode&&(0,P.isSameExternalId)(N.pinnedParticipant,e.externalId)||(0,P.isSameExternalId)(N.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:N.isOratorMode&&(0,P.isSameExternalId)(N.adminPinnedParticipant,e.externalId)},A)}))}),[xe,N.externalId,N.participants,N.isOratorMode,N.pinnedParticipant,N.screenSharingPinnedParticipant,N.adminPinnedParticipant,N.groupId,N.me,N.peer,N.config,N.localDevice,N.callData]),we=function(e){L({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},Le=function(){Ze(C,[J.MediaOption.AUDIO,J.MediaOption.VIDEO]).then((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_SETTINGS})}))},ke=function(e){L(e?{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_RECORD}:{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION})},Me=(0,l.useCallback)((function(){lo({isModalView:j,uiMode:N.uiMode,changeUIMode:we})}),[N.uiMode]);(0,oo.useNavGoListener)(Me,!N.config.enableNavChangeCallCollapse),(0,oo.useBoxLayerObserver)(Me,!N.config.enableNavChangeCallCollapse);var Be=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!N.isOratorMode})}),[N.isOratorMode]),Ue=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!N.isShownParticipantsAside})}),[N.isShownParticipantsAside]),He=(0,l.useCallback)((function(){L({type:d.E_ACTION.MANAGEMENT,isOpen:!0})}),[]),Ge=(0,l.useCallback)((function(){L({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:ai.CALL_LINK})}),[]),Fe=(0,l.useCallback)((function(){if(!pe){var e=!W.isVideoEnabled||!!W.isScreenSharingEnabled&&!Z;(e?Ze(C,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){fe(!0),Z||W.isScreenSharingEnabled&&C.captureScreen(!1),C.toggleLocalVideo(e).catch((function(){})).finally((function(){fe(!1)}))})),w.callStats.logEvent({call_event_type:e?d.CallActionEventType.VIDEO_ENABLED:d.CallActionEventType.VIDEO_DISABLED,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer),reason:e?void 0:"manual"})}}),[W,pe]),We=(0,l.useCallback)((function(){C.captureScreen(!W.isScreenSharingEnabled).catch((function(){"MacOS"===C.browser.os()&&"Chrome"===C.browser.browserName()?L({type:d.E_ACTION.ERROR,text:k("calls_error_disabled_screen_sharing_macos_chrome")}):L({type:d.E_ACTION.ERROR,text:k("calls_error_disabled_screen_sharing")})})),w.callStats.logEvent({call_event_type:W.isScreenSharingEnabled?d.CallActionEventType.SCREEN_SHARING_STOPPED:d.CallActionEventType.SCREEN_SHARING_STARTED,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer)})}),[W.isScreenSharingEnabled,N.screenSharers,N.callData.callId,N.peer]),Ke=(0,l.useCallback)((function(){S(N.peer)===oo.ENavigateToConvoDirection.Messenger&&Me()}),[N.peer,N.uiMode]),Ye=(0,l.useCallback)((function(){if(!ue){var e=!W.isAudioEnabled;(e?Ze(C,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;ve(!0),(null===(n=N.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&L({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),C.toggleLocalAudio(e).catch((function(){})).finally((function(){ve(!1)}))}))}}),[W,ue]),Je=(0,l.useCallback)((function(){var e,n,t,a,o=!(null===(n=null===(e=F.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state);C.changeParticipantState({hand:o?d.SdkHandType.RAISED:d.SdkHandType.LOWERED}),L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},F.statusData),{hand:{state:!(null===(a=null===(t=F.statusData)||void 0===t?void 0:t.hand)||void 0===a?void 0:a.state),ts:Date.now()}})}}),w.callStats.logEvent({call_event_type:o?d.CallActionEventType.HAND_RAISED:d.CallActionEventType.HAND_LOWERED,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer)})}),[null===(r=null===(a=F.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state]),Xe=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_EXIT})}),[]),qe=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),$e=(0,l.useCallback)((function(){C.hangup(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer),reason:"none",group_call_users_count:K})}),[N.callData.callId,N.peer,K]),en=(0,l.useCallback)((function(){L({type:d.E_ACTION.CHANGE_UI_MODE,mode:oe?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[N.uiMode]),nn=(0,l.useCallback)((function(e,n){var t;L({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),tn=(0,l.useCallback)((function(){L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){le&&nn("streaming",!0)}),[le]);(0,l.useEffect)((function(){N.isOratorMode||function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===t?void 0:t.offsetWidth)||1/0,i=6*Math.floor(e/a),o=Ee.activeDevices,r=0;r<o.length;r++){var s=n+r,l=s>=i&&s<i+30;o[r].visible!==l&&((0,P.isSameExternalId)(N.externalId,o[r].externalId)?L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:l}}):ot(L,o[r].externalId,{visible:l}))}}(N.gridScrollPosition,Vt(N.participantsChunk))}),[N.isOratorMode,N.uiMode,N.gridScrollPosition,Ee.activeDevices,null===(_=N.participantsChunk)||void 0===_?void 0:_.countBefore]),(0,l.useEffect)((function(){N.isOratorMode&&function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===t?void 0:t.offsetHeight)||0,i=Math.max(0,Math.floor(e/148)-1),o=Math.min(N.config.videoSlotsCount,Math.floor(a/148+3)),r=Ee.activeDevices,s=0;s<r.length;s++){var l=n+s,c=l>=i&&l<i+o;r[s].visible!==c&&((0,P.isSameExternalId)(N.externalId,r[s].externalId)?L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:c}}):ot(L,r[s].externalId,{visible:c}))}}(N.oratorScrollPosition,Vt(N.participantsChunk))}),[N.externalId,N.config.videoSlotsCount,N.isOratorMode,N.uiMode,N.oratorScrollPosition,Ee.activeDevices,null===(v=N.participantsChunk)||void 0===v?void 0:v.countBefore]);var an=(0,l.useCallback)((0,s.debounce)((function(e){var n,t=(null===(n=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===n?void 0:n.offsetWidth)||1/0,a=6*Math.floor(e/t);St(N,L,{type:d.E_ACTION.SET_GRID_SCROLL_POSITION,position:e,firstVisible:a,numberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE},C)}),200),[]),on=(0,l.useCallback)((0,s.throttle)((function(e){var n,t=document.querySelectorAll('[data-calls-id="participant"]')[0],a=t?t.offsetWidth+8:1/0,i=(null===(n=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===n?void 0:n.offsetHeight)||0,o=Math.floor(e/a)-1,r=Math.min(N.config.videoSlotsCount,i/a+3);St(N,L,{type:d.E_ACTION.SET_ORATOR_SCROLL_POSITION,position:e,firstVisible:o,numberOfVisible:r},C)}),100),[N.config]),rn=(0,l.useMemo)((function(){var e,n,t=[{text:k("calls_call_menu_settings"),key:"settings",onClick:Le,disabled:!1}];if(N.config.streaming&&!(0,P.isParticipantAnonym)(N.me)&&(t.push({text:k("calls_call_menu_translation"),key:"translation",onClick:function(){return ke(!1)},disabled:!!(null===(e=N.translation)||void 0===e?void 0:e.isOn)&&(!!N.translation.isRecord||ln(N))}),N.config.enableTranslationSplit)){var a=!(!(null===(n=N.translation)||void 0===n?void 0:n.isOn)||!N.translation.isRecord),i=function(){var e;return a?!cn(N):!!(null===(e=N.translation)||void 0===e?void 0:e.isOn)}(),o=function(){var e;return(null===(e=N.translation)||void 0===e?void 0:e.isOn)?function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}:function(){return ke(!0)}}();t.push({text:a&&cn(N)?k("calls_record_stop_confirmation"):k("calls_call_menu_recording"),key:"recording",onClick:o,disabled:i})}(0,P.canMuteParticipants)(F)&&V&&(t.push({text:k("calls_call_menu_mute_audio_all"),key:"muteAllAudio",onClick:function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_AUDIO}})}}),t.push({text:k("calls_call_menu_mute_video_all"),key:"muteAllVideo",onClick:function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_VIDEO}})}})),(0,P.canMuteParticipants)(F)&&V&&Y&&t.push({text:k("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:function(){C.muteParticipant(null,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_ALL_TO_UNMUTE,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer)})}});return R&&t.push({text:k("calls_call_menu_debug"),key:"debugLog",onClick:function(){window.__VKCallsSDKLogs__()},disabled:!1}),x&&(t.push({separator:!0}),t.push({text:k("calls_virtual_background"),key:d.POPUP_VIRUTAL_BACKGROUND,onClick:function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}}),t.push({separator:!0})),t}),[N.peer,N.config.streaming,N.me,N.groupId,null===(h=N.translation)||void 0===h?void 0:h.isOn,null===(p=N.translation)||void 0===p?void 0:p.isRecord,N.conversationOptions,N.permissions,N.callData.callId,N.localDevice.roles,F,V,Y]);(0,l.useEffect)((function(){return function(){L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var sn=(0,l.useCallback)((function(){te&&(0,P.canPinParticipants)(F)?(C.pinParticipant(N.adminPinnedParticipant,!0).then((function(){L({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:N.callData.callId,peer_id:N.peer,is_group_call:(0,O.isGroupCallByPeer)(N.peer)})):(L({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:null}))}),[N.adminPinnedParticipant,N.peer,N.callData.callId]),dn=(0,l.useCallback)((function(e){z.audio>0&&$i(e,!!W.isAudioEnabled,L,N)}),[z.audio,W.isAudioEnabled,N.notification]);(0,l.useEffect)((function(){U&&z.audio>0&&Ji(N.pushToTalkEnabled,W,!0)}),[]),(0,l.useEffect)((function(){return U&&!function(e){return e.uiMode===d.UIMode.COLLAPSED}(N)&&N.pushToTalkEnabled?(e=dn,window.addEventListener("keydown",e),window.addEventListener("keyup",e),function(){!function(e){window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}(dn)}):function(){};var e}),[N.uiMode,N.pushToTalkEnabled,dn]);var un=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:L,notification:N.notification,participant:N.participants[null===(e=N.notification)||void 0===e?void 0:e.data]},void 0)}),[N.notification,N.participants[null===(f=N.notification)||void 0===f?void 0:f.data]]),_n=(0,l.useMemo)((function(){return(0,o.jsx)(zi,{},void 0)}),[N.waitingHall,N.shouldShowDesktopAppNotification,N.shouldShowWarningDesktopAppNotification,N.join]);(0,l.useEffect)((function(){if(!N.callData.localTimeStamp&&!(0,O.isGroupCallByPeer)(N.peer)&&!ze(N,k)){var e=(0,P.getPeerIdDeviceInfo)(N.peer,N.devices);e&&e.status===J.ParticipantStatus.CONNECTED&&L({type:d.E_ACTION.LOCAL_TIME_START,data:Date.now()})}}),[N]),(0,l.useEffect)((function(){V&&ge(K)}),[K]);var vn=(0,l.useRef)({}),hn=(0,l.useRef)({});return(0,l.useEffect)((function(){var e,n,t,a,o,r=[],s=function(e){var n,t=N.devices[e],a=t&&N.participants[t.externalId.id],i=a?a.peerId:e.split(":")[0];return(!a||(0,Ve.isEmpty)(null==t?void 0:t.mediaSettings)||!a.name)&&(null!==(n=vn.current[i])&&void 0!==n?n:0)<5&&(void 0===hn.current[i]||Date.now()-hn.current[i]>1e4)},l=Date.now();try{for(var c=(0,i.__values)(xe),d=c.next();!d.done;d=c.next()){var u=d.value,_=(0,P.externalIdToString)(u.externalId),v=+u.externalId.id;s(_)&&(r.push(v),vn.current[v]=(null!==(o=vn.current[v])&&void 0!==o?o:0)+1,hn.current[v]=l)}}catch(n){e={error:n}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var h=(0,i.__values)(N.speakersInHeader),p=h.next();!p.done;p=h.next()){s(_=p.value)&&N.devices[_]&&r.push(+N.devices[_].externalId.id)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(t)throw t.error}}if(window.Calls&&r.length>0){var f=N.callData.callId||"",m={withConversation:!N.callData.conversation,awaitImages:!1};mt(N,L,window.Calls,f,r,m)}}),[N.peer,N.speakersInHeader,xe]),(0,o.jsx)(b,(0,i.__assign)({onClose:q?qe:$e,isCautionBoxShown:!q,onBackdropClick:Me},{children:(0,o.jsx)(Pe,(0,i.__assign)({info:(0,o.jsx)(gn,{onHandCountChanged:I},void 0),callMenuActions:rn,isVideoAllowed:W.isVideoEnabled||z.video>0,isAudioAllowed:W.isAudioEnabled||z.audio>0,isVideoEnabled:Z?!!W.isVideoEnabled:!!W.isVideoEnabled&&!W.isScreenSharingEnabled,isAudioEnabled:W.isAudioEnabled,isScreenSharingEnabled:W.isScreenSharingEnabled,isOratorMode:N.isOratorMode,isFullScreen:oe,onToggleVideo:Fe,onToggleAudio:Ye,onToggleScreenShare:We,onLeaveCall:q?qe:se?Xe:$e,onCollapseCall:j?Me:null,onToggleOratorMode:Be,onFullScreenToggle:en,onTooltipChange:nn,onHidePanel:tn,onChat:Ke,onHandClick:Je,isParticipantControlActive:N.isManagementOpen,isLayoutSwitchShown:V&&Q,isHandRaised:null===(g=null===(A=F.statusData)||void 0===A?void 0:A.hand)||void 0===g?void 0:g.state,isHandControlShown:V,isChatControlShown:!!H&&!N.groupId,isScreenShareControlShown:z.screenSharing>0&&re,isStreamingControlShown:le,isChainControlShown:Ne,onDeferredStreamStart:function(){if(N.translation.deferredId){var e={isOn:!1,startStreamParams:{upcomingStreamParams:{ovId:N.translation.deferredId}}};L({type:d.E_ACTION.SET_TRANSLATION,data:e}),L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})}},onParticipantsClick:He,chatUnreadCount:N.chatUnreadCount,notification:un,tooltips:N.tooltips,onChainClick:Ge,notificationWithButton:_n,participantCount:Ae,isPopupOrModalOpen:!(!N.popup&&!N.isManagementOpen)},{children:(0,o.jsxs)(o.Fragment,{children:[!$&&(0,o.jsx)(_e,{},void 0),ee&&(0,o.jsx)(De,(0,i.__assign)({onScroll:an,scrollPosition:N.gridScrollPosition,participantsCount:K,participantsShiftCount:Te},{children:Oe}),void 0),ne&&(0,o.jsx)(je,(0,i.__assign)({orator:so(N,k,We),oratorTitle:(0,o.jsx)(ao,{orator:(0,P.getOrator)(N).participant,oratorDevice:(0,P.getOrator)(N).device,me:N.me,isPinned:ae,isPinnedByAdmin:te,isPinnedByShareScreen:ie,isUnpinAllowed:(0,P.canPinParticipants)(F)||!te,onUnpin:sn,tooltips:N.tooltips,onTooltipChange:nn},void 0),onToggleParticipantsAside:Ue,isShownParticipantsAside:N.isShownParticipantsAside,onScroll:on,scrollPosition:N.oratorScrollPosition,participantsAsideCount:K,participantsAsideShift:0===Te?0:148*Te-8},{children:Oe}),void 0),$&&!X&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(m.CallPhoto,{id:H,photo:G&&G.photo||"",waves:!0,alt:G&&G.tab||"",className:"CallPhoto--orator"},void 0)},void 0)]},void 0)}),void 0)}),void 0)}function so(e,n,t){var a,i,r,s,l,c=(0,P.getOrator)(e),d=c.device,u=c.participant;"externalId"in d?(r=(0,P.isSameExternalId)(d.externalId,e.externalId),s=(0,P.externalIdToString)(d.externalId),l=d.externalId):(r=(null==u?void 0:u.peerId)===e.me,s=null==u?void 0:u.peerId,l=e.externalId||(0,P.getDefaultExternalId)()),r&&e.groupId&&e.meGroup&&(u=u&&(0,Vn.mergeGroupToParticipant)(e.meGroup,u));var _=(0,P.isParticipantWithVideo)(d),v=(0,P.getStream)(d);return(0,o.jsx)(ce,{externalId:l,isOrator:!0,isInfoShown:!0,isMe:r,hasVideo:!!_,hasAudio:!!(null===(a=d.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isSharingScreen:!!(null===(i=d.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:v,photo:null==u?void 0:u.photo,name:r?n("calls_own_label"):null==u?void 0:u.name,status:d.status,wasConnected:d.wasConnected,networkStatus:d.networkStatus,allowContain:!0,onStopScreenShare:t},s)}function lo(e){var n=e.isModalView,t=e.uiMode,a=e.changeUIMode;n&&(t===d.UIMode.FULLSCREEN?((0,Cn.pause)(.3,null).then((function(){a(d.UIMode.COLLAPSED)})),a(d.UIMode.DEFAULT)):a(d.UIMode.COLLAPSED))}var co=function(e,n,t,a){var i=Math.max(e,Math.min(n,t));return Math.abs(i-e)<a?e:Math.abs(i-n)<a?n:i},uo={bottom:0,left:0,right:0,top:0},_o=[15,-15],vo=function(e){var n=e.children,t=e.style,a=e.startCoords,r=void 0===a?_o:a,s=e.padding,c=void 0===s?uo:s,d=e.className,u=e.onUpdateStartCoords,_=e.ignoredSelectors,v=(0,l.useRef)(null),h=(0,l.useRef)(!1),p=(0,i.__read)(function(){var e=(0,i.__read)((0,l.useState)((function(){return[window.innerHeight,window.innerWidth]})),2),n=e[0],t=e[1],a=(0,l.useRef)();return(0,l.useEffect)((function(){var e=function(){a.current&&clearTimeout(a.current),a.current=setTimeout((function(){t([window.innerHeight,window.innerWidth])}),300)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),n}(),2),f=p[0],m=p[1],A=(0,i.__read)(function(e){var n=(0,i.__read)((0,l.useState)([0,0]),2),t=n[0],a=n[1];return(0,l.useEffect)((function(){if(e.current){var n=e.current.getBoundingClientRect();a([n.width,n.height])}}),[]),t}(v),2),g=A[0],C=A[1],E=(0,i.__read)((0,l.useState)([0,0]),2),S=(0,i.__read)(E[0],2),T=S[0],I=S[1],x=E[1],N=(0,i.__read)((0,l.useState)(r),2),y=(0,i.__read)(N[0],2),b=y[0],O=y[1],w=N[1],L=(0,l.useCallback)((function(e,n){var t=0+c.left,a=0-c.top;return[co(t,m-g-c.right,e,10),co(-f+C+c.bottom,a,n,10)]}),[m,f,g,C,c]);(0,l.useEffect)((function(){w(L(b,O))}),[L]),(0,l.useEffect)((function(){null==u||u([b,O])}),[b,O,u]);var k=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),h.current||x([e.shiftX,e.shiftY])}),[b,O]),P=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),h.current?h.current=!1:(w((function(n){var t=(0,i.__read)(n,2),a=t[0],o=t[1];return L(a+e.shiftX,o+e.shiftY)})),x([0,0]))}),[L]),M=(0,l.useCallback)((function(e){(function(e,n){return!!n&&n.some((function(n){var t,a;return null===(a=(t=e.originalEvent.target).closest)||void 0===a?void 0:a.call(t,n)}))})(e,_)&&(h.current=!0)}),[]),D=(0,i.__read)(L(b+T,O+I),2),j=D[0],R=D[1];return(0,o.jsx)(ba.Touch,(0,i.__assign)({className:d,Component:"div",getRootRef:v,style:(0,i.__assign)((0,i.__assign)({},t),{transform:"translate("+j+"px, "+R+"px)"}),onStart:M,onMove:k,onEnd:P},{children:n}),void 0)};function ho(e){var n={h:!1,v:!1};if(!e)return n;var t=document.querySelector(e);return t?(t.scrollHeight>window.innerHeight&&(n.v=!0),t.scrollWidth>window.innerWidth&&(n.h=!0),n):((0,J.debugMessage)(J.DebugMessageType.ERROR,{hook:"useDragStaticElement",desc:"padding.checkScrollSelector (="+e+") is invalid"}),n)}var po={key:"calls_collapsed_call_position",getPosition:function(){var e=sessionStorage.getItem(po.key);return(0,s.isString)(e)?JSON.parse(e):void 0},setPosition:function(e){sessionStorage.setItem(po.key,JSON.stringify(e))}},fo=function(e){var n=e.children,t=(0,l.useContext)(y.ConfigContext).withAnimation,a=(0,s.classNames)("CollapsedCall",{"CollapsedCall--withAnimation":t});return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},mo=function(e){var n=e.children,t=function(e){var n=(0,i.__read)((0,l.useState)({h:!1,v:!1}),2),t=n[0],a=n[1],o=(0,l.useRef)();return(0,l.useLayoutEffect)((function(){a(ho(e))}),[e]),(0,l.useEffect)((function(){var n=function(){o.current&&clearTimeout(o.current),o.current=setTimeout((function(){a(ho(e))}),300)};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),t}("body"),a=(0,l.useMemo)((function(){return{bottom:t.h?30:15,left:15,right:t.v?30:15,top:15}}),[t]),r=(0,l.useMemo)((function(){return po.getPosition()||[15,-15]}),[]),c=(0,l.useMemo)((function(){return[".CallVideoWidget__buttons"]}),[]),d=(0,l.useCallback)((function(e){po.setPosition(e)}),[]),u=(0,l.useContext)(y.ConfigContext).withAnimation,_=(0,s.classNames)("CollapsedCall","CollapsedCall--draggable",{"CollapsedCall--withAnimation":u});return(0,o.jsx)(vo,(0,i.__assign)({className:_,padding:a,startCoords:r,onUpdateStartCoords:d,ignoredSelectors:c},{children:n}),void 0)},Ao=function(e){var n=e.id,t=e.photo,a=e.title,r=e.status,s=e.isIncoming,l=e.onClick,c=e.children;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallWidget",onClick:l},{children:[(0,o.jsx)(f,{id:n,className:"CallWidget__background"},void 0),(0,o.jsx)(m.CallPhoto,{id:n,photo:t,waves:s,alt:a||"",className:"CallWidget__photo"},void 0),(0,o.jsx)("h1",(0,i.__assign)({className:"CallWidget__name"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallWidget__status"},{children:r}),void 0),c]}),void 0)},go=function(e){var n=e.localVideoStream,t=e.isLocalAudioEnabled,a=e.isLocalAudioAllowed,r=e.isLocalScreenSharing,s=e.participantId,c=e.isMe,u=void 0!==c&&c,_=e.isWithVideo,v=e.isWithAudio,h=e.isScreenSharing,p=e.stream,f=e.photo,m=e.name,A=e.status,S=void 0===A?J.ParticipantStatus.CONNECTED:A,T=e.networkStatus,I=e.onRestoreCall,x=e.onToggleAudio,N=e.children,y=e.isRecord,b=(0,l.useContext)(E.LangContext).getLang,O=(0,i.__read)((0,l.useState)(!1),2),w=O[0],L=O[1],k=le().storedVideoOptions;(0,l.useEffect)((function(){n||L(!1)}),[n,w]);var M=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),I()}),[I]),D=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),x&&x()}),[x]),j=(0,l.useCallback)((function(e){var n,t;(null===(t=(n=e.target).closest)||void 0===t?void 0:t.call(n,".CallVideoWidget__buttons"))||I()}),[I]);return(0,o.jsxs)("div",(0,i.__assign)({className:"CallVideoWidget",onDoubleClick:j},{children:[n&&(0,o.jsx)(Z,{className:"CallVideoWidget__local",participantId:(0,P.externalIdToString)(s),stream:n,isMirrored:!r&&k[d.EVideoOptionType.IS_VIDEO_MIRRORED],isLocalSchreenShare:r,isContained:!1,isStartWithVisible:!0},void 0),y&&(0,o.jsx)(en,{className:"CallVideoWidget__is-record-icon",fill:"#FF3347",width:16,height:16},void 0),(0,o.jsx)(ce,{externalId:s,hasVideo:_,hasAudio:v,isSharingScreen:h,isMe:u,stream:p,photo:f,name:m,status:S,allowContain:!1,networkStatus:T},void 0),N,(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"left",marginTop:6,text:b(t?"calls_mute":"calls_unmute")},{children:(0,o.jsx)(g,{type:t?"mute":"unmute",onClick:D,disabled:!a},void 0)}),void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"right",text:b("calls_restore"),marginTop:6},{children:(0,o.jsx)(g,{type:"restore",onClick:M},void 0)}),void 0)}),void 0)]}),void 0)},Co=function(e){var n,t,a,r,s=e.SDK,c=k((function(e){return e})),_=u(),v=(0,l.useContext)(E.LangContext).getLang,h=c.peer,p=(0,Ve.isAnyoneWithVideo)(c),f=(0,O.isGroupCallByPeer)(h)?c.callData.conversation:c.participants[c.peer],m=c.localDevice,A=(0,P.getCallVisibleParticipant)(c,p),g=(0,P.isParticipantWithVideo)(m)&&A&&!(0,P.isSameExternalId)(A.externalId,c.externalId),C=k((function(e){return e.translation.isOn&&!!e.translation.isRecord})),S=(0,l.useCallback)((function(){_({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),Yi(!1)}),[]),T=(null===(n=null==m?void 0:m.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||(null===(t=m.permissions)||void 0===t?void 0:t.audio)>0,I=(0,l.useCallback)((function(){var e;s.toggleLocalAudio(!(null===(e=m.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[c]);return(0,o.jsxs)(o.Fragment,{children:[c.mode===d.Mode.INCOMING&&(0,o.jsx)(fo,{children:(0,o.jsx)(Ao,{id:h,title:(null==f?void 0:f.tab)||"",photo:(null==f?void 0:f.photo)||"",status:v("calls_incoming_collapsed"),isIncoming:!0,onClick:S},void 0)},void 0),c.mode!==d.Mode.INCOMING&&(0,o.jsx)(mo,{children:(0,o.jsx)(go,(0,i.__assign)({localVideoStream:g?(0,P.getStream)(m):void 0,isLocalAudioEnabled:!!(null===(a=m.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isLocalAudioAllowed:T,isLocalScreenSharing:!!(null===(r=m.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)},Eo(c,A,f),{onRestoreCall:S,onToggleAudio:I,isRecord:C}),void 0)},void 0)]},void 0)};function Eo(e,n,t){var a,i,o=n&&e.participants[n.externalId.id];return n&&o?{participantId:n.externalId,isMe:+n.externalId.id===e.me,isWithVideo:(0,P.isParticipantWithVideo)(n),isWithAudio:!!(null===(a=n.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isScreenSharing:!!(null===(i=n.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:(0,P.getStream)(n),photo:o.photo,name:o.name,status:n.status,networkStatus:n.networkStatus||1}:{participantId:(0,P.getDefaultExternalId)(),isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:(null==t?void 0:t.photo)||"",name:(null==t?void 0:t.tab)||"",status:(null==t?void 0:t.status)||J.ParticipantStatus.CONNECTED,networkStatus:1}}var So="incoming",To="outgoing",Io="connecting",xo="connected",No="end";function yo(e){var n,t=e.onBeforeCallStart,a=e.onAfterCallFinish,r=e.callSounds,s=(0,c.useSelector)((function(e){return e})),u=(0,l.useRef)(),_=((n={}).incoming=(0,l.useRef)(null),n.outgoing=(0,l.useRef)(null),n.connecting=(0,l.useRef)(null),n.connected=(0,l.useRef)(null),n.end=(0,l.useRef)(null),n),v={controls:!1,preload:"auto"},h=(0,l.useCallback)((function(e){var n=_[e].current;n&&n.paused&&n.play().catch((function(){}))}),[]),p=(0,l.useCallback)((function(e){var n=_[e].current;n&&!n.paused&&(n.pause(),n.currentTime=0)}),[]),f=(0,l.useCallback)((function(){Object.keys(_).forEach(p)}),[]),m=(0,l.useCallback)((function(e){var n=_[e].current;if(n){var t=n.volume;n.volume=0,n.play().catch((function(){})),n.pause(),n.currentTime=0,n.volume=t}}),[]),A=(0,l.useCallback)((function(){t&&t()}),[t]),g=(0,l.useCallback)((function(){a&&a()}),[a]);return(0,l.useEffect)((function(){return Gi.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(_).forEach(m),document.body.removeEventListener("mousedown",e)})),function(){f(),g()}}),[]),(0,l.useEffect)((function(){var e=u.current||s,n=s;e.mode!==n.mode&&(e.mode!==d.Mode.READY||n.mode!==d.Mode.INCOMING&&n.mode!==d.Mode.CALL||A(),e.mode===d.Mode.INCOMING&&p(So),n.mode===d.Mode.INCOMING&&h(So),n.mode!==d.Mode.READY||e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL||(f(),h(No),g()));var t=n.me,a=e.participants,o=n.participants,r=e.localDevice.status,l=n.localDevice.status,c=e.devices,_=n.devices;r!==l&&(r===J.ParticipantStatus.CONNECTING&&p(Io),l===J.ParticipantStatus.CONNECTING&&h(Io));var v=(0,Ve.objectSome)(o,(function(e){var n=e.peerId;return!!a[n]&&(0,P.someDeviceByParticipant)(a[n],(function(e){return e.status===J.ParticipantStatus.CONNECTED}))})),m=(0,Ve.objectSome)(o,(function(e){var n=e.peerId,t=c[n],a=_[n];return t&&a&&t.status!==a.status&&a.status===J.ParticipantStatus.CONNECTED}));!v&&m&&h(xo),n.mode===d.Mode.CALL&&(!function(e,n,t,a){var o,r,s=!1;try{for(var l=(0,i.__values)(Object.values(e)),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.peerId!==n){if((0,P.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.CONNECTED})))return!1;(0,P.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.WAITING}))&&(!a||t.has(d.peerId))&&(s=!0)}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return s}(o,t,n.participantsAddedByMe,(0,O.isGroupCallByPeer)(s.peer))?p(To):h(To)),u.current=s}),[s]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("audio",(0,i.__assign)({src:r.incoming,ref:_.incoming,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.outgoing,ref:_.outgoing,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connected,ref:_.connected,loop:!1},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connecting,ref:_.connecting,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.end,ref:_.end,loop:!1},v),void 0)]},void 0)}var bo=t(56589),Oo=t(79806),wo=t(74041);function Lo(e){var n=e.cameras,t=e.mics,a=e.noiseCancellationOptions,r=e.videoResolutionOptions,c=e.currentCamId,u=e.currentMicId,_=e.currentNoiseCancellation,v=e.currentVideoResolution,h=e.isCamAvailable,p=void 0!==h&&h,f=e.isMicAvailable,m=void 0!==f&&f,A=e.onCameraChange,g=e.onMicChange,S=e.onNoiseCancellationChange,T=e.onVideoResolutionChange,I=e.pushToTalkEnabled,x=e.onPushToTalkChange,N=(0,l.useContext)(E.LangContext).getLang,b=(0,l.useContext)(y.ConfigContext).allowPushToTalk,O=(0,l.useRef)(null);!function(e){var n=e.kind,t=e.resolution,a=e.mediaElRef,i=e.streamRef,o=e.deviceId,r=e.isActive,s={deviceId:o};"video"===n&&t&&(s.width={min:428,max:d.VideoWidth[t]||d.VideoWidth.SD,ideal:d.VideoWidth[t]||d.VideoWidth.SD},s.height={min:240,max:d.VideoHeight[t]||d.VideoHeight.SD,ideal:d.VideoHeight[t]||d.VideoHeight.SD});(0,l.useEffect)((function(){r&&Po(n,s).then((function(e){var n;null===(n=i.current)||void 0===n||n.getTracks().forEach((function(e){return e.stop()}));var t=a.current;t&&(i.current=e,t.srcObject=e,t.volume=0,t.play())})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,{err:e,deviceId:o,kind:n,kindParams:s})}))}),[o,r,t]),(0,l.useEffect)((function(){return function(){var e=i.current;e&&e.getTracks().forEach((function(e){return e.stop()}));var n=a.current;n&&(n.srcObject=null)}}),[])}({kind:"video",resolution:v,mediaElRef:O,streamRef:(0,l.useRef)(null),deviceId:c,isActive:p});var w=le().storedVideoOptions;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__camera"},{children:p?(0,o.jsx)("video",(0,i.__assign)({ref:O},{controls:!1,crossOrigin:"anonymous",playsInline:!0},{className:(0,s.classNames)({CallSettings__cameraStream:w[d.EVideoOptionType.IS_VIDEO_MIRRORED]},"CallSettings__cameraContent")}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallSettings__cameraStub","CallSettings__cameraContent")},{children:N("calls_no_camera")}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:N("calls_settings_camera")}),void 0),p?(0,o.jsx)(bo.default,{options:n.map(ko),value:c,onChange:function(e){var n=e.selected;return A(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:N("calls_settings_no_camera")}),void 0)]}),void 0),p&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:N("calls_settings_video_resolution")}),void 0),(0,o.jsx)(bo.default,{options:r,value:v,onChange:function(e){var n=e.selected;return T(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:N("calls_settings_mic")}),void 0),m?(0,o.jsx)(bo.default,{options:t.map(ko),value:u,onChange:function(e){var n=e.selected;return g(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:N("calls_settings_no_mic")}),void 0)]}),void 0),b&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",{className:"CallSettings__label"},void 0),(0,o.jsx)(wo.default,(0,i.__assign)({className:"CallSettings__field",onChange:x,checked:I},{children:N("calls_settings_push_to_talk_mode_description")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:N("calls_settings_push_to_talk_mode_hint"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(Oo.default,{className:"CallSettings__hint","aria-label":N("calls_settings_push_to_talk_mode_hint")},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:N("calls_settings_noise")}},void 0)}),void 0),m?(0,o.jsx)(bo.default,{options:a,value:_,onChange:function(e){var n=e.selected;return S(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:N("calls_settings_no_mic")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:N("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(Oo.default,{className:"CallSettings__hint","aria-label":N("calls_settings_noise_description")},void 0)}),void 0)]}),void 0)]}),void 0)}function ko(e){return{value:e.deviceId,label:e.label}}function Po(e,n){return(0,i.__awaiter)(this,void 0,Promise,(function(){var t,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia((a={video:!1,audio:!1},a[e]=n,a))];case 1:return[2,i.sent()];case 2:if(t=i.sent(),(0,J.debugMessage)(J.DebugMessageType.ERROR,{src:"[CallSettings][useDeviceOutput][getUserMedia]",err:t,kind:e,kindParams:n}),"OverconstrainedError"===(null==t?void 0:t.name)&&"video"===e&&Object.keys(n).length>1&&"deviceId"in n)return[2,Po(e,{deviceId:n.deviceId})];throw t;case 3:return[2]}}))}))}function Mo(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:r("calls_settings"),appearance:"blue",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:t},{children:r("calls_save")}),void 0)]},void 0),className:"CallSettingsModal"},{children:a}),void 0)}function Do(e){var n,t,a=e.SDK,r=(0,ue.useLang)().getLang,c=k((function(e){return e})),_=u(),v=c.config.fullHD,h=c.mode,p=!!(null===(n=c.localDevice.mediaSettings)||void 0===n?void 0:n.isVideoEnabled),f=!!(null===(t=c.localDevice.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),m=(0,l.useMemo)((function(){return[{label:r("calls_noise_neural"),value:d.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:r("calls_noise_simple"),value:d.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:r("calls_noise_none"),value:d.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}]}),[r]),A=(0,l.useMemo)((function(){var e=[{label:r("calls_video_resolution_sd"),value:d.VideoResolutionTypes.SD},{label:r("calls_video_resolution_hd"),value:d.VideoResolutionTypes.HD}];return v&&e.push({label:r("calls_video_resolution_fhd"),value:d.VideoResolutionTypes.FHD}),e}),[r,v]),g=a.browser.getCameras(),C=a.browser.getMicrophones(),E=a.browser.hasCamera()&&a.browser.hasCameraPermission(),S=a.browser.hasMicrophone()&&a.browser.hasMicrophonePermission(),T=a.browser.getSavedCamera(),I=a.browser.getSavedMicrophone(),x=E&&(T&&T.deviceId||g[0].deviceId),N=S&&(I&&I.deviceId||C[0].deviceId),y=(0,i.__read)((0,l.useState)(!1===x?void 0:x),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)(!1===N?void 0:N),2),L=w[0],P=w[1],M=(0,i.__read)((0,l.useState)(c.noiseCancellation),2),D=M[0],j=M[1],R=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY),Z=(0,i.__read)((0,l.useState)(R===d.VideoResolutionTypes.FHD?d.VideoResolutionTypes.FHD:R===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD),2),B=Z[0],U=Z[1],H=(0,i.__read)((0,l.useState)(c.pushToTalkEnabled),2),V=H[0],G=H[1];return(0,o.jsx)(Mo,(0,i.__assign)({onClose:function(){_({type:d.E_ACTION.TOGGLE_POPUP})},onSubmit:function(){var e,n=[Promise.resolve()];!T&&x===b&&h!==d.Mode.READY&&!p||!b||T&&T.deviceId===b||(p?n.push(a.changeDevice("videoinput",b)):n.push(a.browser.saveDeviceId("videoinput",b))),!L||I&&I.deviceId===L||(f?n.push(a.changeDevice("audioinput",L)):n.push(a.browser.saveDeviceId("audioinput",L))),c.noiseCancellation!==D&&n.push(a.setMediaModifiers((null===(e=m.find((function(e){return e.value===D})))||void 0===e?void 0:e.data)||{denoise:!0,denoiseAnn:!0}).then((function(){_({type:d.E_ACTION.SET_NOISE_CANCELLATION,data:D})})));var t=function(){return Promise.resolve()};c.localVideoResolution!==B&&(console.debug("set resolution from -> to: ",c.localVideoResolution,B,d.VideoWidth[B],d.VideoHeight[B]),t=function(){return a.setLocalResolution(d.VideoWidth[B],d.VideoHeight[B],{effect:{width:d.VideoWidth[B],height:d.VideoHeight[B]}}).catch((function(e){console.error(e)})).finally((function(){s.localStorage.setItem(d.VIDEO_RESOLUTION_STORAGE_KEY,B),_({type:d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION,data:B})}))}),c.pushToTalkEnabled!==V&&(c.localDevice.permissions.audio>0&&Ji(V,c.localDevice.mediaSettings),_({type:d.E_ACTION.SET_PUSH_TO_TALK_ENABLE,data:V})),Promise.all(n).then(t).then((function(){_({type:d.E_ACTION.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),_({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:(0,o.jsx)(Lo,{mics:C,cameras:g,noiseCancellationOptions:m,videoResolutionOptions:A,currentCamId:b,currentMicId:L,currentNoiseCancellation:D,currentVideoResolution:B,isCamAvailable:E,isMicAvailable:S,onCameraChange:O,onMicChange:P,onNoiseCancellationChange:function(e){return j(e)},onVideoResolutionChange:function(e){return U(e)},pushToTalkEnabled:V,onPushToTalkChange:function(){G(!V)}},void 0)}),void 0)}var jo=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e){switch(this.props.mode){case d.Mode.CALL:this.props.SDK.hangup();break;case d.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)},n.prototype.render=function(){return this.state.hasError?null:this.props.children},n}(l.Component),Ro=function(e){var n=e.children;return(0,o.jsx)("h2",(0,i.__assign)({className:"JoinHeader"},{children:n}),void 0)},Zo=t(11541),Bo=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"},void 0)}),void 0)};const Uo=(0,X.makeIcon)("Icon28LaptopOutline","laptop_outline_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="laptop_outline_28"><path clip-rule="evenodd" d="M8 5h-.151c-.781 0-1.4-.001-1.93.171A3.5 3.5 0 0 0 3.67 7.418C3.5 7.95 3.5 8.568 3.5 9.348V19H2.162a1.162 1.162 0 0 0-.367 2.265l1.466.489c.276.092.415.138.556.17.125.029.253.05.38.062.145.014.29.014.582.014H23.22c.291 0 .437 0 .581-.014.128-.012.256-.033.381-.062.141-.032.28-.078.556-.17l1.466-.49A1.162 1.162 0 0 0 25.838 19H24.5V9.349c0-.781.001-1.4-.171-1.93a3.5 3.5 0 0 0-2.247-2.248C21.55 5 20.932 5 20.152 5H20zM6.536 7.073C6.724 7.013 6.992 7 8 7h12c1.008 0 1.276.012 1.464.073a1.5 1.5 0 0 1 .963.963c.06.188.073.456.073 1.464V19h-17V9.5c0-1.008.012-1.276.073-1.464a1.5 1.5 0 0 1 .963-.963z" fill="currentColor" fill-rule="evenodd" /></symbol>',28,28,!1,void 0),Ho=(0,X.makeIcon)("Icon28UserOutline","user_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="user_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M17.5 8.5C17.5 6.566 15.934 5 14 5a3.499 3.499 0 0 0-3.5 3.5c0 1.934 1.566 3.5 3.5 3.5s3.5-1.566 3.5-3.5Zm2 0c0 3.039-2.461 5.5-5.5 5.5a5.499 5.499 0 0 1-5.5-5.5C8.5 5.461 10.961 3 14 3s5.5 2.461 5.5 5.5ZM7 20.643c0 .943-.08.857.456.857h13.588c.536 0 .456.086.456-.857 0-2.288-3.304-3.643-7.25-3.643S7 18.355 7 20.643Zm-2 0C5 16.763 9.299 15 14.25 15s9.25 1.763 9.25 5.643c0 2.016-.781 2.857-2.456 2.857H7.456C5.78 23.5 5 22.66 5 20.643Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var Vo=function(e){var n=e.isAnonym,t=e.title,a=e.label,r=e.items,l=e.onChangeName,c=e.name,d=e.namePlaceholder,u=e.joinWithVideoText,_=e.joinWithAudioText,v=e.onJoinWithVideo,h=e.onJoinWithAudio,p=e.disabled,f=e.inputDisabled,m=e.callByNameShow,A=e.onCallByNameClick,g=e.onCallViaNativeAppClick,C=e.callViaNativeAppShow,E=e.callByNameTitle,S=e.callViaNativeAppTitle;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("JoinScreen",{"JoinScreen--anonym":n})},{children:[(0,o.jsx)(Ro,{children:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"JoinScreen__members"},{children:[(0,o.jsx)(Zo.AvatarsStack,{items:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"JoinScreen__membersLabel"},{children:a}),void 0)]}),void 0),(0,o.jsxs)("footer",(0,i.__assign)({className:"JoinScreen__footer"},{children:[n&&(0,o.jsx)(On.default,{onChange:l,className:"JoinScreen__input",value:c,placeholder:d,disabled:f,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&v()}},void 0),(0,o.jsxs)(Bn.default,(0,i.__assign)({appearance:"primary",onClick:v,disabled:p,type:"submit"},{children:[(0,o.jsx)(Bo,{className:"JoinScreen__icon"},void 0),(0,o.jsx)("span",{children:u},void 0)]}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"primary",title:_,"aria-label":_,onClick:h,disabled:p},{children:(0,o.jsx)(Ha,{className:"JoinScreen__icon"},void 0)}),void 0)]}),void 0),(m||C)&&(0,o.jsxs)(Tn.default,(0,i.__assign)({border:!1,className:"JoinScreen__options"},{children:[C&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:g,icon:(0,o.jsx)(Uo,{className:"JoinScreen__optionIcon"},void 0)},{children:S}),void 0),m&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:A,icon:(0,o.jsx)(Ho,{className:"JoinScreen__optionIcon"},void 0)},{children:E}),void 0)]}),void 0)]}),void 0)},Go=t(73479),Fo=t(71154);function Wo(e){var n=e.onVolumeLevelReached,t=e.needCheckMicEnabled,a=e.vectorLength,o=e.volumeLevelDetection,r=e.callbackFactorStep,s=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,d=function(e){var n=[],t=0;return function(a){if(n.push(a),t+=a,n.length>e){var i=n.shift();t-=i||0}return t/n.length}}(a),u=0,_=!1;return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];c&&c(e);var v=(0,i.__read)(e,2),h=v[0],p=v[1],f=h>o;_!==f&&l&&l(f),_=f,0!==u&&p&&(u=0);var m=d(h);t&&p||h/m>(1+u)/s&&h>o&&(u+=r,n())}}function zo(e,n){var t=Object.keys(e),a=Object.keys(n);return t.length===a.length&&t.every((function(e){return n[e]}))}function Ko(e,n){return e.length===n.length&&e.every((function(e,t){return e===n[t]}))}var Qo="calls_token";function Yo(e){s.localStorage.setItem(Qo,e)}function Jo(e){var n=s.localStorage.getItem(Qo);return n?Promise.resolve(n):(0,sn.getCallAuthToken)(e).then((function(e){return e.token}))}var Xo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function qo(e){switch(e){case J.ParticipantStatus.WAITING:return 1;case J.ParticipantStatus.CONNECTING:return 2;case J.ParticipantStatus.CONNECTED:return 3;default:return 0}}var $o,er=function(){return Xo},nr=function(e){var n,t;Xo=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},Xo),e),{connectionStep:(n=e.connectionStep,t=Xo.connectionStep,n&&qo(n)&&qo(n)>qo(t)?n:t)})},tr=function(){Xo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function ar(e){$o=e}function ir(e,n,t,a){var i,o,r,s=er(),l=s.startType,c=s.entryPoint,u=s.timeStart,_=s.isGroupCall,v=s.hadVideoEnabled,h=s.isOutgoingCall,p=!e||e===d.HANGUP_TYPE_HUNGUP&&!t,f=l&&function(e,n,t){var a;a=e===d.CallType.VIDEO?n?d.CallStatReachedType.GROUP_VIDEO:d.CallStatReachedType.VIDEO:t?n?d.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:d.CallStatReachedType.AUDIO_TO_VIDEO:n?d.CallStatReachedType.GROUP_AUDIO:d.CallStatReachedType.AUDIO;return a}(l,_,v),m={type:f,result:p?d.CallStatResult.SUCCESS:d.CallStatResult.FAIL,failReason:p?null:or(e,t),callSource:c,totalDuration:u?Date.now()-u:0};h&&(a&&console.log(m),i=n,r=[(o=m).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],$o&&$o({name:"call_stats",value:i,keys:r}))}function or(e,n){var t=er().isOutgoingCall,a=er().connectionStep;switch(!0){case n:return d.CallStatFailReason.CONNECTION_LOST;case e===d.HANGUP_TYPE_CANCELED:return d.CallStatFailReason.LOCAL_DECLINE;case e===d.HANGUP_TYPE_REJECTED:return d.CallStatFailReason.REMOTE_DECLINE;case e===d.HANGUP_TYPE_BUSY:return d.CallStatFailReason.REMOTE_BUSY;case e===d.HANGUP_TYPE_MISSED:return t?d.CallStatFailReason.REMOTE_TIMEOUT:null;case a===J.ParticipantStatus.CONNECTING:return d.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return d.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function rr(e,n,t){void 0===n&&(n=!0);var a="";return e&&n?a=t("calls_error_no_cam_and_mic"):e?a=t("calls_error_no_cam"):n&&(a=t("calls_error_no_mic")),a}function sr(e,n){var t;return((t={})[d.MediaError.CAMERA_PERMISSION]=n("calls_error_no_cam"),t[d.MediaError.MIC_PERMISSION]=n("calls_error_no_mic"),t[d.MediaError.CAMERA_ACCESS]=n("calls_error_cameralock"),t[d.MediaError.MIC_ACCESS]=n("calls_error_miclock"),t[d.MediaError.MIC_NOT_FOUND]=n("calls_error_nomic"),t[d.MediaError.SCREEN_PERMISSION]=n("calls_error_screenpermission"),t[d.MediaError.SCREEN_ACCESS]=n("calls_error_screenlock"),t)[e]}function lr(e,n){return function(t){e&&e({msg:t}),(null==n?void 0:n.onError)&&n.onError(new Error(t)),console.error(t)}}var cr=t(62090);function dr(e,n,t,a,o,r){var l,c,u,_,v,h,p,f,m,A=a.dispatch,g=a.getState(),C=g.me,E=(0,Ve.compose)(pr,Ve.startCallRetryWrapper.bind(null,_r.bind(null,n,e,a))),S=(0,Ve.compose)(n.joinCallByLink,Ve.startCallRetryWrapper.bind(null,_r.bind(null,n,e,a))),T=g.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoHeight.SD:d.VideoHeight.HD,I=g.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoWidth.SD:d.VideoWidth.HD,x=function(){switch(!0){case g.config.enableDomainBender:return"bender";case r:return"vk_corp";default:return}}(),N=function(){if(g.config.enableCustomScreenSharePacketSize&&(0,s.isNumber)(g.config.customScreenSharePacketSize))return g.config.customScreenSharePacketSize}(),y={apiKey:t.key,apiEnv:t.is_dev?"VIDEOTEST":"PROD",anonymToken:t.is_anonym?t.token:"",filteredMessages:!0,batchParticipantsOnStart:!0,serverAudioRed:g.config.enableServerAudioRed,p2pAudioRed:g.config.enableP2PAudioRed,useParticipantListChunk:Mt(g),participantListChunkInitCount:(m=window.innerHeight,Pt(Math.max(Math.ceil(m/140),8))),voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},domain:x,videoTracksCount:g.config.enableVideoSlots?g.config.videoSlotsCount:void 0,videoMaxHeight:T,videoMaxWidth:I,videoEffectMaxHeight:T,videoEffectMaxWidth:I,debugLog:g.config.debugLog,consumerScreenTrack:g.config.enableScreenTrack,producerScreenTrack:g.config.enableProducerScreenTrack,callStatReportEnabled:!0,joinFromMultipleDevices:g.config.enableMultipleDevices,consumerScreenDataChannelPacketSize:N,onLocalStream:function(n,t){e.debug&&console.warn("onLocalStream",n,t),A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{stream:n,mediaSettings:t}}),nr({hadVideoEnabled:t.isVideoEnabled})},onLocalStreamUpdate:function(n,t){e.debug&&console.warn("onLocalStreamUpdate",n,t);var o=a.getState(),r=o.localDevice,s=r.mediaSettings,l=r.permissions,c={mediaSettings:n};l.audio!==d.MediaPermissionType.ONCE&&l.video!==d.MediaPermissionType.ONCE&&l.screenSharing!==d.MediaPermissionType.ONCE||(c.permissions={audio:l.audio,video:l.video,screenSharing:l.screenSharing},l.audio===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isAudioEnabled)&&!n.isAudioEnabled&&(c.permissions.audio=d.MediaPermissionType.DENY),l.video===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isVideoEnabled)&&!n.isVideoEnabled&&(c.permissions.video=d.MediaPermissionType.DENY),l.screenSharing===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isScreenSharingEnabled)&&!n.isScreenSharingEnabled&&(c.permissions.screenSharing=d.MediaPermissionType.DENY)),A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:(0,i.__assign)({},c)}),n.isScreenSharingEnabled!==(null==s?void 0:s.isScreenSharingEnabled)&&o.externalId&&((0,P.toggleScreenSharing)(o,A,n.isScreenSharingEnabled,o.externalId),n.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),nr({hadVideoEnabled:n.isVideoEnabled})},onRemoteStream:function(n,t){e.debug&&console.warn("onRemoteStream",n.id,t),Mt(g)?function(e,n,t){ca(e,n,t.externalId,{stream:t.stream})}(a.getState(),A,{externalId:n,stream:t}):ot(A,n,{stream:t})},onScreenStream:function(n,t){e.debug&&console.warn("onScreenStream",n,t),A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{screenSharingStream:n,mediaSettings:t}})},onRemoteScreenStream:function(n,t){e.debug&&console.warn("onRemoteScreenStream",n.id,t),Mt(g)?function(e,n,t){ca(e,n,t.externalId,{screenSharingStream:t.stream})}(a.getState(),A,{externalId:n,stream:t}):ot(A,n,{screenSharingStream:t})},onConversation:function(t,i,o,r){if(e.debug&&((0,J.debugMessage)(J.DebugMessageType.LOG,{type:"start call info",os:Oi.Platform.OS,arch:Oi.Platform.ARCH,isMobile:Oi.Platform.isMobile,browser:(0,Oi.getBrowserInfo)(),config:a.getState().config,cameras:n.browser.getCameras(),microphones:n.browser.getMicrophones(),hasMicrophonePermission:n.browser.hasMicrophonePermission(),hasCameraPermission:n.browser.hasCameraPermission(),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth,windowHeight:window.screen.height,windowWidth:window.screen.width}),console.warn("onConversation",t,i,r)),!a.getState().callData.ts){var s=Date.now();A({type:d.E_ACTION.TIME_START,data:s})}var l=a.getState().peer;0!==l&&ht(0,A,l),rt(g,A,r)},onConversationParticipantListChunk:function(n){!function(e,n,t,a){var i=[];a.participants.forEach((function(e){i.push(e.uid);var t=e.participantState;if(t){var a=(0,P.convertParticipantStateFromSDK)(t);Jt(n,e.uid,a)}})),na(e,n,t,i),zt(e,n,a)}(g,A,e,n)},onParticipantJoined:function(t,i){!function(e,n,t,a,i){var o=i.externalId,r=i.markers;if(Mt(e)){var s=Kt(r),l=e.participantsChunk;if(l&&s){var c=ua(e),d=l.ids||[],u=Sa(s,e),_=0===c&&0===l.countBefore;if(!(u<0)){if(0===u&&!_)return la(n,{countBefore:l.countBefore+1}),void Ea(e,n,t);var v=Aa(l,e);u>=d.length&&v?la(n,{countAfter:l.countAfter+1}):ma(e,n,a,{externalId:o,markers:r})}}}}(a.getState(),A,n,e,{externalId:t,markers:i})},onRemoteMediaSettings:function(t,i,o){var r,s=(0,P.externalIdToString)(t),l=a.getState(),c=l.devices[s],d=null==c?void 0:c.mediaSettings;if((null==d?void 0:d.isVideoEnabled)!==i.isVideoEnabled||(null==d?void 0:d.isAudioEnabled)!==i.isAudioEnabled||(null==d?void 0:d.isScreenSharingEnabled)!==i.isScreenSharingEnabled){e.debug&&console.warn("onRemoteMediaSettings",t,i);var u=!!(null===(r=null==c?void 0:c.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled),_=i.isScreenSharingEnabled;_!==u&&(0,P.toggleScreenSharing)(l,A,_,t,!0),Mt(l)?Rt(l,A,n,e,{externalId:t,markers:o,mediaSettings:i}):ot(A,t,{mediaSettings:i}),nr({hadVideoEnabled:i.isVideoEnabled})}},onRemoteStatus:function(n,t,o){var r,s,l=a.getState();e.debug&&console.warn("onRemoteStatus",n,t,o);var c=[];try{for(var u=(0,i.__values)(n),_=u.next();!_.done;_=u.next()){var v=_.value,h=+v.id,p=l.participants[h];p&&p.shortName||c.push(h);var f={status:t};o&&(f.statusData=o),ot(A,v,f)}}catch(e){r={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}if(e&&c.length>0){var m=l.callData.callId||"",g={withConversation:!l.callData.conversation,awaitImages:!1};mt(l,A,e,m,c,g)}nr({connectionStep:t});var C=+(null==n?void 0:n[0].id);if(C===l.peer){var E=(0,P.getPeerIdDeviceInfo)(C,Yn.GlobalStore.getCallsState().devices),S=function(e,n){var t={call_event_type:e,session_id:l.callData.callId,peer_id:l.peer,is_group_call:!1};n&&(t.reason=n),w.callStats.logEvent(t)};if(t===J.ParticipantStatus.CONNECTED){if(S(d.CallActionEventType.CALL_CONNECTED),cr.mailRuCounter.push(cr.EMailRuGoals.JoinCall),!(null==E?void 0:E.wasConnected)&&(0,P.isCreator)(l.localDevice)){var T=er().startType;S(d.CallActionEventType.OUTGOING_CALL_ACCEPTED_REMOTELY,null==T?void 0:T.toString())}}else t===J.ParticipantStatus.WAITING&&S(d.CallActionEventType.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:function(t){if(e.debug&&console.warn("onPermissionsError",t),a.getState().mode===d.Mode.CALL){switch(t){case d.MediaError.CAMERA_PERMISSION:case d.MediaError.CAMERA_ACCESS:n.toggleLocalVideo(!1);break;case d.MediaError.MIC_ACCESS:case d.MediaError.MIC_NOT_FOUND:n.toggleLocalAudio(!1);break;case d.MediaError.SCREEN_PERMISSION:case d.MediaError.SCREEN_ACCESS:n.captureScreen(!1)}A({type:d.E_ACTION.ERROR,text:sr(t,o)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t,i){e.debug&&console.warn("onRemoteRemoved",t);var o=a.getState();Mt(o)&&Dt(o,A,n,{externalId:t,markers:i}),A({type:d.E_ACTION.REMOVE_USER,participantId:t})},onCallState:function(n,t,i){var o,r,s;e.debug&&console.warn("onCallState",n,t,i);var l=i.id,c=i.direction,u=i.joinLink,_=i.externalId,v=i.options;if(!l||!a.getState().callData.callId){A({type:d.E_ACTION.CALL_STATE,callData:{callId:l},joinLink:u,externalId:_}),A({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:v});var h=a.getState(),p=h.peer,f=h.participants,m=h.entryPoint;if(!p){var C=[];(0,Ve.objectForEach)(f,(function(e){C.push(e.peerId)})),C.length&&mt(g,A,e,l,C,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!1})}var E=a.getState().peer||0;(0,O.isGroupCallByPeer)(E)&&[J.CallDirection.JOINING,J.CallDirection.OUTGOING].includes(c)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:l,peer_id:E,is_group_call:!0,source:m}),cr.mailRuCounter.push(cr.EMailRuGoals.JoinCall)),(null===(o=a.getState())||void 0===o?void 0:o.startOptions)&&(null===(s=null===(r=a.getState())||void 0===r?void 0:r.startOptions)||void 0===s?void 0:s.createLink)&&Et(A,l,a.getState().groupId)}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(n){e.debug&&console.warn("onSpeakerChanged",n),A({type:d.E_ACTION.SET_ORATOR,orator:n})},onJoinStatus:function(n,t){e.debug&&console.warn("onJoinStatus",n,t)},onHangup:function(t,i){var o,r=t.hangup;e.debug&&console.warn("onHangup",r,i);var s=r&&![d.HANGUP_TYPE_CANCELED,d.HANGUP_TYPE_MISSED,d.HANGUP_TYPE_HUNGUP].includes(r),l=a.getState(),c=r&&r===d.HANGUP_TYPE_HUNGUP,u=(0,O.isGroupCallByPeer)(l.peer);if(l.mode===d.Mode.CALL&&s||l.localDevice.status===J.ParticipantStatus.WAITING_HALL&&r===d.HANGUP_TYPE_REMOVED){var _=d.CALL_HANGUP_MODAP_MAP[r],v=!!(null===(o=l.lastCallData)||void 0===o?void 0:o.isMeEndedCallForAll)&&(r===J.HangupType.KILLED||r===J.HangupType.KILLED_WITHOUT_DELETE);A({type:d.E_ACTION.HANGUP,data:r}),(0,Ve.conditionalPausedPromise)(v||d.HANGUP_DELAY).finally((function(){A({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),_&&A({type:d.E_ACTION.TOGGLE_POPUP,data:_})}))}else if(g.config.showFeedbackScreen&&c){var h=l.callData.ts,p=(h?Math.floor((Date.now()-h)/1e3):0)>10&&0===Math.floor(3*Math.random()),f=0===Math.floor(5*Math.random());u&&p||f?(A({type:d.E_ACTION.MANAGEMENT,isOpen:!1}),A({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.FEEDBACK})):l.mode!==d.Mode.ERROR&&A({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}else l.mode!==d.Mode.ERROR&&A({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY});e.isInActiveCall=!1;var m=(0,Ve.isInReconnect)(l);if(ir(r,i=i||"",m,e.debug),!m&&!u){var C="none";r===J.HangupType.MISSED?C="timeout":r===J.HangupType.BUSY&&(C="busy");var E=l.callData.conversation,S={call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:i,peer_id:(null==E?void 0:E.peerId)||0,is_group_call:!1,reason:C};w.callStats.logEvent(S)}e.authorizedGroupId&&function(e,n,t,a){hr(e,n,t,0,a)}(n,e,a,A),tr(),qa(l)},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),(0,O.isGroupCallByPeer)(a.getState().peer)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:(0,O.isGroupCallByPeer)(a.getState().peer)}),cr.mailRuCounter.push(cr.EMailRuGoals.JoinCall))},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(_r(n,e,a),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(n){e.debug&&console.warn("onFingerprintChange",n)},onVolumesDetected:(l={onUpdate:function(e){A({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:e.speakers,speakersInHeader:e.speakersInHeader}})},volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},c=l.onUpdate,u=l.volumeLevelDetection,_=l.debugCallback,v={},h=[],p={},f=[],function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];_&&_(e);var t=(0,i.__read)(e,1),a=t[0];p=Object.keys(p).reduce((function(e,n){return p[n]-1>0&&(e[n]=p[n]-1),e}),{});var o=a.reduce((function(e,n){var t=n.uid,a=n.volume,i=(0,P.externalIdToString)(t);return a>u&&(e[i]=!0,p[i]=3),e}),{});f=Object.keys(p);var r=!1,s={speakers:v,speakersInHeader:h};zo(v,o)||(s.speakers=o,v=o,r=!0),Ko(h,f)||(s.speakersInHeader=f,h=f,r=!0),r&&c(s)}),onLocalVolume:Wo({onVolumeLevelReached:function(){var e=a.getState();A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.SPEAKING_ON_MUTE}}),w.callStats.logEvent({call_event_type:d.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,O.isGroupCallByPeer)(e.peer)})},onVolumeLevelUpdated:function(e){var n,t=null===(n=a.getState().localDevice.mediaSettings)||void 0===n?void 0:n.isAudioEnabled,o=a.getState().speakers,r=(0,i.__assign)({},o),s=a.getState().externalId,l=s?(0,P.externalIdToString)(s):C;e&&t&&s?r[l]=!0:!e&&s&&delete r[l],r[l]!==o[l]&&A({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:r}})},needCheckMicEnabled:!0,volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(n,t,a){e.debug&&console.warn("onChatMessage",n,t,a)},onCustomData:function(n,t){e.debug&&console.warn("onCustomData",n,t)},onNetworkStatusChanged:function(n){var t,a;if(e.debug&&console.warn("onNetworkStatusChanged",n),(0,O.isGroupCallByPeer)(g.peer)&&g.config.badNetwork||!(0,O.isGroupCallByPeer)(g.peer)&&g.config.badNetworkP2P)try{for(var o=(0,i.__values)(n),r=o.next();!r.done;r=o.next()){var s=r.value;ot(A,s.uid,{networkStatus:s.rating})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}},onLocalNetworkStatusChanged:function(n){e.debug&&console.warn("onLocalNetworkStatusChanged",n),((0,O.isGroupCallByPeer)(g.peer)&&g.config.badNetwork||!(0,O.isGroupCallByPeer)(g.peer)&&g.config.badNetworkP2P)&&A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{networkStatus:n}})},onDebugMessage:function(n){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e.debug&&console.warn.apply(console,(0,i.__spreadArray)(["onDebugMessage",n],(0,i.__read)(t),!1))},onRemoteParticipantState:function(t,i,o){var r,s,l,c,u,_,v,h;i=(0,P.convertParticipantStateFromSDK)(i);var p=(0,P.externalIdToString)(t),f=+t.id,m=a.getState(),g=!!(null!==(c=null===(l=null===(s=null===(r=m.devices[p])||void 0===r?void 0:r.statusData)||void 0===s?void 0:s.hand)||void 0===l?void 0:l.state)&&void 0!==c?c:null===(u=m.handState)||void 0===u?void 0:u[p]);if(g!==!!(null===(_=null==i?void 0:i.hand)||void 0===_?void 0:_.state)){e.debug&&console.warn("onRemoteParticipantState",t,i);var C=!!(null===(v=a.getState().participants[+t.id])||void 0===v?void 0:v.name);Mt(m)?function(e,n,t,a,i){var o=i.externalId,r=i.markers,s=i.participantState;Jt(n,o,s);var l=ia(e,r);oa(e.participantsChunk,l)?Ht(e,n,a,o,{markers:r,statusData:s}):qt(e,n,(0,P.externalIdToString)(o)),Yt(e,n,t,a,{externalId:o,markers:r})}(m,A,n,e,{externalId:t,markers:o,participantState:i}):ot(A,t,{statusData:i}),(null===(h=null==i?void 0:i.hand)||void 0===h?void 0:h.state)&&!g&&C&&f!==m.me&&A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.RAISED_HAND,data:f}})}},onRolesChanged:function(n,t){e.debug&&console.warn("onRolesChanged",n,t);var i=a.getState().participants[n.id];t.includes(J.UserRole.ADMIN)&&i&&i.peerId!==g.me&&A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:n.id}}),A({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:+n.id,data:t})},onLocalRolesChanged:function(n){e.debug&&console.warn("onLocalRolesChanged",n),(n.includes(J.UserRole.ADMIN)||n.includes(J.UserRole.CREATOR))&&A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:d.MediaPermissionType.ALLOW,video:d.MediaPermissionType.ALLOW,screenSharing:d.MediaPermissionType.ALLOW}}}),n.includes(J.UserRole.ADMIN)&&A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.ADMIN_ROLE_GRANTED}}),n.includes(J.UserRole.ADMIN)||n.includes(J.UserRole.CREATOR)?g.config.allowWaitingHall&&(0,O.isWaitingHallEnabled)(a.getState())&&function(e,n){(0,J.getWaitingHall)(null,void 0).then((function(t){return Wn(t.totalCount,t.participants,e,n)}))}(a.getState(),A):a.getState().waitingHall&&function(e){e({type:d.E_ACTION.SET_WAITING_HALL,data:void 0})}(A),A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{roles:n}})},onDeviceSwitched:function(n,t){e.debug&&console.warn("onDeviceSwitched",n,t)},onMuteStates:function(t,o,r,s,l,c){var u,_;e.debug&&console.warn("onMuteStates",t,o,r,s,l,c);var v=a.getState(),h=v.localDevice,p=h.permissions,f=p.audio,m=p.video,g=p.screenSharing,C=!!(null===(_=null===(u=h.statusData)||void 0===u?void 0:u.hand)||void 0===_?void 0:_.state),E=(0,P.isSameExternalId)(c,v.externalId);if(l&&(E||null===c)){if(C&&n.changeParticipantState({hand:d.SdkHandType.LOWERED}).catch(console.log),A({type:d.E_ACTION.TOGGLE_POPUP,data:r.includes(J.MediaOption.VIDEO)?d.POPUP_UNMUTE_REQUEST:d.POPUP_UNMUTE_AUDIO_REQUEST}),(0,P.isAdmin)(h)||(0,P.isCreator)(h))return;var S=!s;A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:(0,i.__assign)({permissions:{audio:r.includes(J.MediaOption.AUDIO)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:f,video:r.includes(J.MediaOption.VIDEO)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:m,screenSharing:r.includes(J.MediaOption.SCREEN_SHARING)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:g}},C&&{statusData:(0,i.__assign)((0,i.__assign)({},h.statusData),{hand:{ts:Date.now(),state:!1}})})})}else{null===c&&A({type:d.E_ACTION.SET_CALL_PERMISSIONS,data:t}),v.popup!==d.POPUP_UNMUTE_REQUEST&&v.popup!==d.POPUP_UNMUTE_AUDIO_REQUEST||A({type:d.E_ACTION.TOGGLE_POPUP});var T=(0,P.isAdmin)(h)||(0,P.isCreator)(h),I=d.NotificationType.ADMIN_MUTE,x=t[J.MediaOption.AUDIO]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.AUDIO]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:f,N=t[J.MediaOption.VIDEO]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.VIDEO]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:m,y=t[J.MediaOption.SCREEN_SHARING]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.SCREEN_SHARING]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:g;if(f!==x&&x===d.MediaPermissionType.DENY&&m!==N&&N===d.MediaPermissionType.DENY?I=T?d.NotificationType.ADMIN_MUTE:d.NotificationType.ADMIN_MUTE_PERMANENT:f!==x&&x===d.MediaPermissionType.DENY&&m===N?I=T?d.NotificationType.ADMIN_MUTE_AUDIO:d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:f===x&&m!==N&&N===d.MediaPermissionType.DENY?I=T?d.NotificationType.ADMIN_MUTE_VIDEO:d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:f!==x&&x===d.MediaPermissionType.ALLOW&&m!==N&&N===d.MediaPermissionType.ALLOW?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT:f!==x&&x===d.MediaPermissionType.ALLOW&&m===N?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:f===x&&m!==N&&N===d.MediaPermissionType.ALLOW?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:r.includes(J.MediaOption.AUDIO)&&f===x&&x===d.MediaPermissionType.ALLOW&&r.includes(J.MediaOption.VIDEO)&&m===N&&N===d.MediaPermissionType.ALLOW?I=d.NotificationType.ADMIN_MUTE:r.includes(J.MediaOption.AUDIO)&&f===x&&x===d.MediaPermissionType.ALLOW&&m===N?I=d.NotificationType.ADMIN_MUTE_AUDIO:f===x&&r.includes(J.MediaOption.VIDEO)&&m===N&&N===d.MediaPermissionType.ALLOW&&(I=d.NotificationType.ADMIN_MUTE_VIDEO),null===I||!(0,P.isSameExternalId)(c,v.externalId)&&null!==c||A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:I}}),(0,P.isAdmin)(h)||(0,P.isCreator)(h))return;A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:x,video:N,screenSharing:y}}})}},onRecordStarted:function(n,t,a,i,o,r){e.debug&&console.warn("onRecordStarted",n,t,a,i);var s={isOn:!0,videoId:o?+o:void 0,ownerId:r?+r:void 0,host:n,startTime:a,link:r&&o?"https://"+Wi()+D(r,o):void 0,startStreamParams:void 0,isRecord:"RECORD"===i};A({type:d.E_ACTION.SET_TRANSLATION,data:s})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),A({type:d.E_ACTION.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}}),A({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION,data:!0})},onLocalPin:function(n){var t;e.debug&&console.warn("onLocalPin",{unpin:n});var i=a.getState(),o=i.localDevice;n||A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.PINNED_BY_ADMIN}}),!n&&(0,P.isMutedPermanently)(o)&&A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:d.MediaPermissionType.ONCE,video:d.MediaPermissionType.ONCE,screenSharing:d.MediaPermissionType.ONCE}}}),n||(null===(t=o.mediaSettings)||void 0===t?void 0:t.isAudioEnabled)||A({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),n||i.isOratorMode||A({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),i.externalId&&A({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:n?null:i.externalId})},onPinnedParticipant:function(t,o,r){e.debug&&console.warn("onPinnedParticipant",t,o);var s=a.getState(),l=s.participants[t.id];!o&&l&&((null==l?void 0:l.shortName)||(null==l?void 0:l.name))&&A({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_PINNED_BY_ADMIN,data:t.id}}),s.isOratorMode||A({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),function(e,n,t,a,o){var r=o.externalId,s=o.pin,l=o.markers;(0,i.__awaiter)(this,void 0,void 0,(function(){var o,c,d,u,_,v,h;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return o=Kt(l),Mt(e)&&o?(c=(0,P.externalIdToString)(r),d=$t(e,c),u=aa(e,r),_=u>-1,v=ia(e,l),h=oa(e.participantsChunk,v),Yt(e,n,t,a,{externalId:r,markers:l}),h&&ta(n,r,{markers:l}),s&&d?[2]:s&&!d||h&&!_?[4,ra(e,n,t,a,{externalId:r,marker:o})]:[3,2]):[2];case 1:return i.sent(),[2];case 2:return!d||h||s||qt(e,n,c),[2]}}))}))}(s,A,n,e,{externalId:t,pin:!o,markers:r}),A({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:o?null:t})},onOptionsChanged:function(n){e.debug&&console.warn("onOptionsChanged",n),A({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:n})},onLocalStatus:function(n){e.debug&&console.warn("onLocalStatus",n);var t=a.getState(),o=t.callData,r=t.me,s=t.localDevice.status===J.ParticipantStatus.WAITING_HALL&&n===J.ParticipantStatus.WAITING,l=n===J.ParticipantStatus.CONNECTED&&!t.peer;o.callId&&!(0,P.isParticipantAnonym)(r)&&(l||s)&&(0,sn.getConversationsByCall)([o.callId]).then((function(e){var n=e.items,t=(0,i.__read)(n,1)[0].peer.id;return fr(a,t,void 0)})).catch((function(e){var n;if(951===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;throw e})).catch(Fo.handlePromiseError),A({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{status:n,wasConnected:!0}})},onChatRoomUpdated:function(n,t,i){e.debug&&console.warn("onChatRoomUpdated",n,t,i),n===J.ChatRoomEventType.ATTENDEE&&Wn(t,i,a.getState(),A)},onJoinLinkChanged:function(n){e.debug&&console.warn("onJoinLinkChanged",n);var t=a.getState(),i=t.callData.callId||"",o=(0,O.isAuthedByGroupId)(t)?t.groupId:0;At(a.dispatch,i,!1,o)}};e.authorized=!1,e.authorizedGroupId=0,e.debugMessage=J.debugMessage,e.call=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v){void 0===u&&(u=0),void 0===v&&(v={});var h=(0,O.getMediaOptions)({video:s,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return vr(e)})).then((function(){return hr(n,e,a,u,o)})).then((function(){return Ze(n,h)})).then((function(){return fr(a,r,l)})).then((function(t){return Promise.all([lt(t),i(e,n,a,h,r)])})).then((function(){return Er(n,v)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),nr({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:c,startType:s?d.CallType.VIDEO:d.CallType.AUDIO}),w.callStats.logEvent({call_event_type:s?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!1,source:c,group_call_users_count:2}),cr.mailRuCounter.push(cr.EMailRuGoals.StartP2PCall),mr(a,r,l)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),gr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startGroupCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v,h){void 0===_&&(_=!0),void 0===v&&(v=null),void 0===h&&(h={});var p=(0,O.getMediaOptions)({video:c,audio:!0}),f=l?l.filter(La.isUserPeer):[];return e.debug&&l&&l.length!==f.length&&console.warn("Some ids cannot get into the call.",l.filter((function(e){return!(0,La.isUserPeer)(e)}))),e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return vr(e)})).then((function(){return hr(n,e,a,0,o)})).then((function(){return Ze(n,p)})).then((function(){return fr(a,r,s)})).then((function(e){return dt(a.getState(),o,r,e[0])})).then((function(){return i(e,n,a,p,r)})).then((function(){return Er(n,h)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),_&&(f&&f.length?o({type:d.E_ACTION.GROUP_CALL_SETUP,open:!0,peerId:r,preselectedIds:f}):o({type:d.E_ACTION.MANAGEMENT,isOpen:!0})),v&&o({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),mr(a,r,s),nr({timeStart:Date.now(),isOutgoingCall:!0,startType:c?d.CallType.VIDEO:d.CallType.AUDIO,entryPoint:u,isGroupCall:!0}),w.callStats.logEvent({call_event_type:c?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!0,source:u,group_call_users_count:1}),cr.mailRuCounter.push(cr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),gr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u){void 0===l&&(l=!0),void 0===c&&(c=0),void 0===u&&(u={});var _=(0,O.getMediaOptions)({video:r,audio:!0});if(e.isInActiveCall)return Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur);e.isInActiveCall=!0;var v=(0,O.getDefaultConversation)(t);return Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return vr(e)})).then((function(){return hr(n,e,a,c,o)})).then((function(){return Ze(n,_)})).then((function(){return Promise.all([i(e,n,a,_),lt([v])])})).then((function(){return Er(n,u)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.LOAD_PEERS,conversation:v,members:[],peerId:0}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL}),l&&o({type:d.E_ACTION.MANAGEMENT,isOpen:!0});var e=a.getState().callData.callId;(null==u?void 0:u.createLink)&&(e?Et(o,e,c):o({type:d.E_ACTION.SET_START_OPTIONS,data:u})),nr({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:r?d.CallType.VIDEO:d.CallType.AUDIO,isGroupCall:!0}),w.callStats.logEvent({call_event_type:r?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:e,peer_id:0,is_group_call:!0,source:s,group_call_users_count:1}),cr.mailRuCounter.push(cr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),gr(a,n,e,!0,t,o)}))}}(e,n,o,a,E),e.joinCallByLink=function(e,n,t,a,o){var r=a.dispatch;return function(s,l,c,u,_,v,h){void 0===c&&(c=!1),void 0===_&&(_=0),void 0===v&&(v=void 0);var p=(0,O.getMediaOptions)({video:c,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur):(e.isInActiveCall=!0,r({type:d.E_ACTION.SET_ENTRYPOINT,entryPoint:u}),(0,P.isParticipantAnonym)(a.getState().me)?Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return vr(e)})).then((function(){return Ze(n,p)})).then((function(){return o(s,p).then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,joinLink:s,vkJoinLink:h})}))})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),gr(a,n,e,!0,t,r)})):Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return vr(e)})).then((function(){return hr(n,e,a,_,r)})).then((function(){return Ze(n,p)})).then((function(){return o(s,p)})).then((function(e){var n=e.id;return(0,sn.getConversationsByCall)([n])})).then((function(e){var n=e.items;if(!n||0===n.length)return 0;var t=(0,i.__read)(n,1)[0].peer.id;return fr(a,t,l).then((function(e){return lt(e)})),t})).catch((function(e){var n,t;if(8===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;if(951===(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.error_code))return 0;throw e})).then((function(e){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:e,joinLink:s}),v&&r({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),e&&mr(a,e,l),w.callStats.logEvent({call_event_type:d.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:null!=e?e:0,is_group_call:!0,source:u,group_call_users_count:(0,P.getActiveParticipantsCount)(a.getState())})})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),gr(a,n,e,!0,t,r)})))}}(e,n,o,a,S),e.showJoinPopup=function(e,n,t){var a=t.dispatch;return function(o,r){var s=t.getState().mode;return s===d.Mode.CALL||s===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){a({type:d.E_ACTION.ERROR,text:n("calls_already_in_call_error")})})):(a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),(0,sn.getJoinLinkDetails)(o).then(Ve.normalizePreviewData.bind(null,n)).then((function(e){a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.JOIN,data:(0,i.__assign)((0,i.__assign)({},e),{entryPoint:r})})})).catch((function(t){var i;e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.warn("getJoinLinkDetails",t);var o=(0,Ve.getTextForApiErrorByCode)(null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.error_code,!0,n);console.error(o),a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.ERROR,text:o,handleType:d.ErrorHandleType.FATAL})})))}}(e,o,a),e.acceptCall=function(e,n,t,a){var i=a.dispatch;return function(o,r){var s=a.getState(),l=s.peer,c=s.callData,u=(0,O.getMediaOptions)({video:o,audio:r});return Ze(n,u).then((function(){return n.acceptCall(u)})).then((function(n){var t=n.acceptTime;i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,ts:t}),e.isInActiveCall=!0,w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:c.callId,peer_id:l,is_group_call:(0,O.isGroupCallByPeer)(l),reason:o?d.CallType.VIDEO:d.CallType.AUDIO}),cr.mailRuCounter.push(cr.EMailRuGoals.AcceptCall)})).catch((function(n){i({type:d.E_ACTION.ERROR,text:rr(o,!0,t),handleType:d.ErrorHandleType.DECLINE}),e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),(0,J.debugMessage)(J.DebugMessageType.ERROR,n),console.error(n)}))}}(e,n,o,a),e.showCallByNamePopup=function(e,n,t,a){var i=a.dispatch;return function(e,n,o){var r=a.getState().mode;return r===d.Mode.CALL||r===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){i({type:d.E_ACTION.ERROR,text:t("calls_already_in_call_error")})})):Promise.resolve().then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),i({type:d.E_ACTION.CALL_BY_NAME,data:{peerId:e,joinLink:o,entryPoint:n}})})).catch((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}}(0,0,o,a),e.showCreateCallByLinkPopup=function(e,n,t,a){var i=a.dispatch;return function(e){var n=a.getState().mode;return n===d.Mode.CALL||n===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur):Promise.resolve().then((function(){i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CREATE_CALL,entryPoint:e})}))}}(0,0,0,a),e.showPlanCalendarEventPopup=function(e){var n=e.dispatch;return function(){return e.getState().mode===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(ur):Promise.resolve().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_PLAN_CALENDAR_EVENT})}))}}(a),e.store=a;var b=Fi(g.config.browserWarnings);if(null==b?void 0:b.block){var L=function(){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START})};e.call=L,e.startGroupCall=L,e.startCall=L,e.acceptCall=L,e.joinCallByLink=function(e){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,joinLink:e})},e.showJoinPopup=L,e.showCallByNamePopup=L,e.showCreateCallByLinkPopup=L,e.showPlanCalendarEventPopup=L}var k=t.token?Promise.resolve(t.token):Jo(t.is_dev),M=function(t){return Promise.resolve().then((function(){return(0,P.isParticipantAnonym)(a.getState().me)?Promise.resolve():n.authorize(t).then((function(){return Yo(t)})).then((function(){return e.authorized=!0})).catch((function(e){throw s.localStorage.removeItem(Qo),e}))}))};return k.then((function(t){return n.init(y).then((function(){g.config.debugLog&&e.setDebug(!0)})).then((function(){return M(t)}))}))}function ur(e){if(e===d.CallErrorType.ALREADY_IN_CALL)console.log("Already in call");else console.log(e)}function _r(e,n,t){return function(e,n,t){return(0,sn.getCallAuthToken)(t.getState().isDev).then((function(t){var a=t.token;return e.authorize(a).then((function(){return Yo(a)})).then((function(){return n.authorized=!0}))}))}(e,n,t).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function vr(e){return new Promise((function(n){e.initializing.finally((function(){n()}))}))}function hr(e,n,t,a,i,o){return void 0===o&&(o=!1),new Promise((function(r,s){a||n.authorizedGroupId||r(),a&&n.authorizedGroupId===a&&r(),o||(w.callStats.setEventCommonData(),i({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:0,groupMembers:[],unableToCallGroupMembersIds:[]})),(0,sn.getCallAuthToken)(t.getState().isDev,a).then((function(t){var l=t.token;e.authorize(l).then((function(){n.authorizedGroupId=a,o?r():a?(0,sn.getGroupById)(-a).then((function(e){if(e.groups){var n=e.groups[0];i({type:d.E_ACTION.SET_GROUP,groupId:a,meGroup:(0,Vn.normalizeGroup)(n)}),w.callStats.setEventCommonData({group_id:a}),r()}})).catch((function(e){s(e)})):r()}))}))}))}function pr(e,n,t,a,i,o){void 0===i&&(i=0),void 0===o&&(o=[]);var r=e.authorizedGroupId?e.id:0,s=(0,Ve.createPayload)(i,a,r);if(!i)return n.callTo(void 0,a,s,!0);if(!(0,O.isGroupCallByPeer)(i))return Cr(e,t,i).then((function(e){return n.forceRelayPolicy(e),n.callTo(i.toString(),a,s)}));var l=o.filter((function(e){return e=Number(e),(0,La.isUserPeer)(e)&&e!==t.getState().me}));return n.callTo(l,a,s,!0)}function fr(e,n,t){var a=e.dispatch;return!!t||n?(t?Promise.resolve((0,Ve.convertClientData)(t)):(0,sn.retryLoadCallPeers)(n).then(Ve.convertServerData)).then((function(e){var t=(0,i.__read)(e,3),o=t[0],r=t[1],s=t[2];return gt(a,s||o),a({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r,peerId:n}),e})):Promise.reject("Cannot load data")}function mr(e,n,t){var a=e.dispatch;return!!t&&n?(0,sn.retryLoadCallPeers)(n).then((function(e){var n=(0,i.__read)((0,Ve.convertServerData)(e),2),t=n[0],o=n[1];return gt(a,e.items[0]),lt([t,o])})).then((function(e){var n=(0,i.__read)(e,2),t=n[0],o=n[1];a({type:d.E_ACTION.LOAD_PEERS,conversation:t,members:o})})):Promise.resolve()}function Ar(e,n,t){switch(!0){case function(e){var n=e||{},t=n.hangup,a=n.message;return!(!t||!a)}(e):case function(e){var n=e||{},t=n.hangup;return n.message&&void 0===t}(e):return(0,Ve.getTextForServerError)(e.message,n,t);case function(e){var n;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null===(n=null==e?void 0:e.__proto__)||void 0===n?void 0:n.name)}(e):return t("calls_error");case function(e){return!!e.error_msg}(e):return(0,Ve.getTextForServerError)(e.error_msg,n,t);case function(e){return"number"==typeof e}(e):return(0,Ve.getTextForClientError)(e,n,t);case function(e){return!!e}(e):default:return t("calls_sorry_error")}}function gr(e,n,t,a,i,o){var r,s;try{var l=Ar(e,a,i);n.hangup(),t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e),o({type:d.E_ACTION.ERROR,text:l,handleType:d.ErrorHandleType.FATAL}),(null===(r=t.eventHandlers)||void 0===r?void 0:r.onErrorStartCall)&&(null===(s=t.eventHandlers)||void 0===s||s.onErrorStartCall())}catch(t){throw(0,J.debugMessage)(J.DebugMessageType.ERROR,t),console.error(t),n.hangup(),e}}function Cr(e,n,t){var a=n.getState();return a.ipSettingEnabled&&"all"!==a.privacySettings.callsIp?(0,La.isChatPeer)(t)?Promise.resolve(!0):e.isFriend?Promise.resolve(!e.isFriend(t)):Object.keys(a.friendsCache).length>0?Promise.resolve(!a.friendsCache[t]):(0,Ve.exponentialRetry)(ct)(e,a,n.dispatch).then((function(){return Cr(e,n,t)})):Promise.resolve(!1)}function Er(e,n){void 0===n&&(n={}),n&&(n.conversationOptions&&Object.keys(n.conversationOptions).length>0&&e.changeConversationOptions(n.conversationOptions),n.mediaOptions&&Object.keys(n.mediaOptions).length>0&&e.muteParticipant(null,n.mediaOptions))}var Sr=function(e){var n=e.isAnonym,t=e.joinLink,a=e.vkJoinLink,r=e.title,s=e.members,c=e.membersCount,u=e.conversationData,_=e.withPopup,v=e.onBeforeCallStart,h=e.onAfterCallFinish,p=e.onClose,f=e.bridge,m=e.entryPoint,A=e.tabIsMaster,g=e.tabIsIdle,C=e.onError,S=e.isDev,I=e.okPublicKey,x=(0,l.useContext)(E.LangContext),N=x.getLang,b=x.langNumeric,O=(0,i.__read)((0,l.useState)(""),2),w=O[0],L=O[1],k=(0,i.__read)((0,l.useState)(null),2),M=k[0],D=k[1],j=(0,i.__read)((0,l.useState)(!1),2),R=j[0],Z=j[1],B=!1,U=(0,l.useContext)(y.ConfigContext).allowCallByName,H=s?s.slice(0,3).map((function(e){var n=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:n,key:e.peerId}:{id:e.peerId,text:n.slice(0,1)}})):[],V=(0,l.useCallback)((function(e){L(e.target.value)}),[]),G=(0,l.useCallback)((function(e){if(n)return B?Promise.resolve():(B=!0,function(e,n,t,a,i,o){if(e)return Promise.resolve(e);return(0,sn.getJoinLinkDetails)(t,!0).then((function(e){var r=e.secret,s=void 0===r?"":r,l=e.user_id,c=void 0===l?0:l,u=e.preview;return(0,sn.getAnonymCallToken)(t,c,a,s).then((function(e){var t,r=e.token,s=e.secret,l=void 0===s?"":s,_={is_dev:Tr(o),key:i,token:r,ok_user:c,secret:l,is_anonym:!0,me:{canAddMembers:!1,firstName:a,peerId:c,id:c,sex:"0",shortName:a,name:a,lastName:"",link:"",photo:"",photo_100:"",shortNameGen:""}},v={callPreview:{tab:null==u?void 0:u.title,photo:null===(t=null==u?void 0:u.photo)||void 0===t?void 0:t.photo_200},callsCredentials:_,callsOkStaging:Tr(o),callsLogging:!1,CallsIncomingCall:!1,callsAllowBanParticipant:!1,callsFeedbackScreenEnabled:!1,callsVideoSlotsEnabled:!0,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:[{browser:"safari"},{browser:"firefox"}],callsAllowCallByName:!1,callsEnableScreenTrack:!0,callsEnableProducerScreenTrack:!0,callsAllowWaitingHall:!1,callsAllowPushToTalk:!1,callsBadNetwork:!1,callsBadNetworkP2P:!1,callsDesktopAppNotification:!1,callsLazyLoading:!1,callsEnableDomainBender:!1,callsEnableMultipleDevices:!1,callsEnableTranslationSplit:!1,callsEnableNavChangeCallCollapse:!0};return n(v),v}))}))}(M,D,a,w,I,S).then((function(e){return function(e){var n=e.bridge,t=e.inited,a=e.setInited,o=e.data,r=e.onBeforeCallStart,s=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,d=e.langUtils;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,u,_,v,h,p,f,m,A,g,C,E,S,T,I,x,N,y,b,O,w,L,k,P,M;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t?[2,Promise.resolve()]:(e=o.callPreview,u=o.callsCredentials,_=o.callsOkStaging,v=o.callsLogging,h=o.CallsIncomingCall,p=o.callsAllowBanParticipant,f=o.callsFeedbackScreenEnabled,m=o.callsVideoSlotsEnabled,A=o.videoSlotsCount,g=o.browserWarnings,C=o.callsAllowCallByName,E=o.callsEnableScreenTrack,S=o.callsEnableProducerScreenTrack,T=o.callsAllowWaitingHall,I=o.callsAllowPushToTalk,x=o.callsBadNetwork,N=o.callsBadNetworkP2P,y=o.callsDesktopAppNotification,b=o.callsLazyLoading,O=o.callsEnableDomainBender,w=o.callsEnableMultipleDevices,L=o.callsEnableTranslationSplit,k=o.callsEnableNavChangeCallCollapse,P=o.callsCustomScreenSharePacketSize,M=o.callsEnableCustomScreenSharePacketSize,[4,n.init({callPreview:e,callsCredentials:u,imHash:"",callsOkStaging:_,onBeforeCallStart:r,onAfterCallFinish:s,tabIsMaster:l,tabIsIdle:c,langUtils:d,toggles:{debugLog:v,incomingCall:h,allowBanParticipant:p,showFeedbackScreen:f,enableVideoSlots:m,videoSlotsCount:A,browserWarnings:g,allowCallByName:C,enableScreenTrack:E,enableProducerScreenTrack:S,allowWaitingHall:T,allowPushToTalk:I,badNetwork:x,badNetworkP2P:N,desktopAppNotification:y,lazyLoading:b,enableDomainBender:O,enableMultipleDevices:w,enableTranslationSplit:L,enableNavChangeCallCollapse:k,enableCustomScreenSharePacketSize:M,customScreenSharePacketSize:P}})]);case 1:return i.sent(),a(!0),[2]}}))}))}({bridge:f,inited:R,setInited:Z,data:e,onBeforeCallStart:v,onAfterCallFinish:h,tabIsMaster:A,tabIsIdle:g,langUtils:x})})).then((function(){return f.joinCallByLink(t,null,e,m,void 0,void 0,a)})).catch((function(e){f.eventHandlers.onError&&e&&f.eventHandlers.onError(e);var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,N):Ar(e,!0,N)||N("calls_unknown_error"),C&&C(n)})).finally((function(){B=!1})));if(p&&p(),!u)throw Error("no peer_id to join");return f.joinCallByLink(t,[u,s],e,m,void 0,void 0,a).catch((function(e){var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,N):N("calls_unknown_error"),C&&C(n)})),Promise.resolve()}),[t,p,w,M,R,I]),F=(0,l.useCallback)((function(){p&&p()}),[p]),W=(0,l.useMemo)((function(){return(0,wa.escape)((0,wa.decodeHTMLEntities)(r||""))}),[r]),z=(0,l.useCallback)((function(){f.showCallByNamePopup(null,m,t)}),[]),K=(0,l.useCallback)((function(){f.showStartCallModal(null,t)}),[]),Q=(0,o.jsx)(Vo,{isAnonym:!!n,name:w,onChangeName:V,namePlaceholder:N("calls_name_placeholder"),title:W,label:(0,Ve.getParticipantsListLabel)(s||[],H,(function(e){return(0,P.isParticipantGroup)(e.peerId)?e.name:e.firstName}),N,b,c),items:H,joinWithVideoText:N("calls_join_with_video"),joinWithAudioText:N("calls_join_with_audio"),onJoinWithVideo:function(){return G(!0)},onJoinWithAudio:function(){return G(!1)},disabled:!!n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(w),inputDisabled:!!M,callByNameShow:U&&!n,callByNameTitle:N("calls_call_by_name_join_by"),callByNameDescription:"",onCallByNameClick:z,callViaNativeAppShow:!n,callViaNativeAppTitle:N("calls_call_via_native_app_join"),onCallViaNativeAppClick:K},void 0);return _?(0,o.jsxs)(T.default,(0,i.__assign)({onClose:F},{children:[(0,o.jsx)(Go.ModalHeader,{title:N("calls_invite"),onClose:F},void 0),Q]}),void 0):Q},Tr=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var Ir=function(e){var n=e.children;return(0,o.jsx)("div",(0,i.__assign)({className:"ErrorPopupText"},{children:n}),void 0)},xr=function(e){var n=e.title,t=e.onClose,a=e.actionButtons,r=e.text;return(0,o.jsx)(En.default,(0,i.__assign)({appearance:"blue",title:n,onClose:t,actionButtons:a,className:"CallError"},{children:(0,o.jsx)(Ir,{children:r},void 0)}),void 0)},Nr=function(e){var n=e.title,t=e.text,a=e.onCloseFatal,r=e.handleType,s=e.callId,c=e.bridge,_=u(),v=(0,l.useContext)(E.LangContext).getLang,h=function(){switch(_({type:d.E_ACTION.ERROR,isClosed:!0}),r){case d.ErrorHandleType.FATAL:a();break;case d.ErrorHandleType.DECLINE:(0,J.declineCall)().catch((function(){}));break;case d.ErrorHandleType.PROCESS:(0,J.processPush)(s||"").then((function(){(0,J.declineCall)().catch((function(){}))})).catch((function(e){c.debug&&console.error("Delayed by error push process error",e)}))}},p=t||v("calls_error"),f=p.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:p}},void 0):p;return(0,o.jsx)(xr,{title:n||v("calls_oops"),onClose:h,actionButtons:(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:h},{children:v("calls_close")}),void 0),text:f},void 0)},yr=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.title;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:r,appearance:"blue",actionButtons:t,className:"CallExitModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallExitModal__text"},{children:a}),void 0)}),void 0)},br=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=t.conversationOptions.find((function(e){return"RECURRING"===e})),_=function(){w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:t.callData.callId,peer_id:t.peer,is_group_call:(0,O.isGroupCallByPeer)(t.peer),reason:"none",group_call_users_count:(0,P.getActiveParticipantsCount)(t)})},v=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP})}),[]),h=r(s?"calls_exit_call_disconnect_all":"calls_force_call_finish_v2"),p=r(s?"calls_exit_call_desc":"calls_sure_leave_call_v2");return(0,o.jsx)(yr,{onClose:v,actionButtons:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){a({type:d.E_ACTION.TOGGLE_POPUP}),_(),$a(0,t,a,r)},appearance:"secondary"},{children:h}),"forceCallFinish"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return a({type:d.E_ACTION.TOGGLE_POPUP}),_(),n.hangup()}},{children:r("calls_exit")}),"leave")],description:p,title:r("calls_exit_call")},void 0)},Or=function(e,n){var t=(0,i.__read)((0,l.useState)([0,0]),2),a=(0,i.__read)(t[0],2),o=a[0],r=a[1],s=t[1],c=(0,l.useRef)(new Map);(0,l.useEffect)((function(){var e=function(){return s([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]);var u=Mt(n);(0,l.useEffect)((function(){if(n.mode===d.Mode.CALL){var t=u?function(e,n,t,a){var i=Tt(e,n,t);return i.forEach((function(e,n){var t=a.get(n);!e.stopStream||t&&!t.stopStream||i.delete(n)})),a.forEach((function(e,n){if(!i.has(n)&&!e.stopStream){var t=xt({externalId:e.uid},e.mediaType);i.set(n,t)}})),i}(n,o,r,c.current):Tt(n,o,r),a=function(e,n){var t=[];return n.forEach((function(n,a){var i=e.get(a);(It(i)||It(n))&&(i&&function(e,n){var t=e,a=n;if(!0===t.stopStream&&!0===a.stopStream)return!0;if(!0===t.stopStream||!0===a.stopStream)return!1;var i=e,o=n;return i.fit===o.fit&&i.width===o.width&&i.height===o.height&&i.priority===o.priority}(i,n)||t.push(n))})),t}(c.current,t);a.length>0&&(c.current=t,e.updateDisplayLayout(a))}else c.current=new Map}),[o,r,n.peer,n.participants,n.devices,n.mode,n.uiMode,n.isOratorMode,n.orator,n.pinnedParticipant,n.adminPinnedParticipant,n.screenSharingPinnedParticipant,n.translation,u])};var wr=function(e){var n=e.isIncoming,t=void 0!==n&&n,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=s(t?"calls_reject_title":"calls_hangup_description"),v=s(t?"calls_reject_description":"calls_hangup_description"),h=(0,l.useCallback)((function(){r({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!1})}),[]),p=function(){h(),t?(0,J.declineCall)().catch((function(){})):((0,J.hangup)().catch((function(){})),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:(0,P.getActiveParticipantsCount)(a)}))},f=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"secondary",onClick:h},{children:s("calls_cancel_reject")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:p},{children:s("calls_reject")}),void 0)]},void 0),m=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:p},{children:s("calls_yes")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:h},{children:s("calls_no")}),void 0)]},void 0);return(0,o.jsx)(xr,{title:_,onClose:h,actionButtons:t?f:m,text:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:v}},void 0)},void 0)},Lr=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(En.default,(0,i.__assign)({className:"MuteParticipantModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:t&&(0,o.jsx)("div",(0,i.__assign)({className:"MuteParticipantModal__content"},{children:t}),void 0)}),void 0)};var kr=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=null===(e=r.participantsManagement)||void 0===e?void 0:e.device,_=s&&r.participants[s.externalId.id],v=null!==(t=null===(n=r.participantsManagement)||void 0===n?void 0:n.mode)&&void 0!==t?t:d.ParticipantsManagementMode.SINGLE,h=[d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.ALL_AUDIO].includes(v),p=[d.ParticipantsManagementMode.SINGLE,d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.SINGLE_VIDEO].includes(v),f=(0,P.isSameExternalId)(null==s?void 0:s.externalId,r.externalId)?r.localDevice:_,m=p&&((0,P.isAdmin)(f)||(0,P.isCreator)(f)),A=(0,i.__read)((0,l.useState)(!0),2),g=A[0],C=A[1],S=(0,i.__read)((0,l.useState)(null!==(a=null==_?void 0:_.name)&&void 0!==a?a:""),2),T=S[0],I=S[1],x=u(),N=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){p&&!(0,P.isParticipantAnonym)((null==_?void 0:_.peerId)||0)?(x({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){_&&_.peerId<0?(0,sn.getGroupById)(-_.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch(n):(0,sn.loadUsers)({user_ids:_&&String(_.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)||"")})).catch(n)})).then((function(e){I(e),C(!1),x({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)):C(!1)}),[r.participantsManagement]);var y=function(e){var n=e.callEventType,t=e.sessionId,a=e.peerId,i=e.isGroupCall;return function(e){return w.callStats.logEvent({call_event_type:n,session_id:t,peer_id:a,is_group_call:i,mute_permanent:e})}}({callEventType:p?d.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED:d.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,sessionId:r.callData.callId,peerId:r.peer,isGroupCall:(0,O.isGroupCallByPeer)(r.peer)}),b=(0,l.useCallback)((function(){x({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),L=(0,l.useCallback)((function(e,n){!function(e){var n,t,a=e.isAudio,i=e.isSingle,o=e.isPermanent,r=e.participantExternalId,s=e.logEvent,l=e.closeDialog,c=o?J.MuteState.MUTE_PERMANENT:J.MuteState.MUTE,d=a?((n={})[J.MediaOption.AUDIO]=c,n):((t={})[J.MediaOption.VIDEO]=c,t[J.MediaOption.SCREEN_SHARING]=c,t);(0,J.muteParticipant)(i?r:null,d).catch(console.log).finally(l),s(o?Ja.CallStatMuteType.ONCE:Ja.CallStatMuteType.PERMANENT)}({isAudio:h,isSingle:p,isPermanent:e,participantExternalId:n,logEvent:y,closeDialog:b})}),[h,p,y,b]),k=(0,l.useCallback)((function(){L(!0,p&&s?s.externalId:null)}),[L]),M=(0,l.useCallback)((function(){L(!1,p&&s?s.externalId:null)}),[L]),D=(0,l.useMemo)((function(){switch(v){case d.ParticipantsManagementMode.SINGLE_AUDIO:return N("calls_mute_participant_dialog_title_audio").replace("{name}",T);case d.ParticipantsManagementMode.SINGLE_VIDEO:return N("calls_mute_participant_dialog_title_video").replace("{name}",T);case d.ParticipantsManagementMode.ALL_AUDIO:return N("calls_mute_all_participants_dialog_title_audio");case d.ParticipantsManagementMode.ALL_VIDEO:return N("calls_mute_all_participants_dialog_title_video");default:return""}}),[v,T]);return p&&g?null:(0,o.jsx)(Lr,{title:D,onClose:b,actionButtons:(0,o.jsxs)(o.Fragment,{children:[!m&&(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:k,appearance:"secondary"},{children:N("calls_mute_participant_permanent_dialog_action")}),"mute_permanent"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:M},{children:N("calls_mute_participant_dialog_action")}),"mute")]},void 0)},void 0)};var Pr,Mr=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(En.default,(0,i.__assign)({className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},Dr=function(e){var n=e.SDK,t=e.withVideo,a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=(0,c.useSelector)((function(e){return e})),_=s.localDevice,v=_.mediaSettings,h=function(){a({type:d.E_ACTION.TOGGLE_POPUP})},p=function(){var e=_.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(v.isAudioEnabled?Promise.resolve():Ze(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=s.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&a({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)}))},f=function(){p(),h()},m=function(){var e;p(),(null==(e=_.mediaSettings)?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!v.isVideoEnabled||v.isScreenSharingEnabled?Ze(n,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){n.toggleLocalVideo(!0).catch(console.log)})),h()},A=(0,l.useMemo)((function(){return t?[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:f,appearance:"secondary"},{children:r("calls_dialog_unmute_request_mic_only_action")}),"mic"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:m},{children:r("calls_dialog_unmute_request_action")}),"all")]:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:f},{children:r("calls_dialog_unmute_request_mic_action")}),"mic")]}),[t]);return(0,o.jsx)(Mr,{onClose:h,title:r(t?"calls_dialog_unmute_request_audio_and_video_title":"calls_dialog_unmute_request_audio_title"),description:r(t?"calls_dialog_unmute_request_audio_and_video_description":"calls_dialog_unmute_request_audio_description"),actionButtons:A},void 0)},jr=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(En.default,(0,i.__assign)({className:"AssignAdminModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AssignAdminModal__content"},{children:t}),void 0)}),void 0)},Rr=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,i.__read)((0,l.useState)(!0),2),_=s[0],v=s[1],h=(0,i.__read)((0,l.useState)(""),2),p=h[0],f=h[1],m=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){t&&t.peerId<0?(0,sn.getGroupById)(-t.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch((function(e){return n(e)})):(0,sn.loadUsers)({user_ids:t&&String(t.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)+" "+(null==t?void 0:t.last_name))})).catch((function(e){return n(e)}))})).then((function(e){f(e),v(!1),r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[t]);var A=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT})}),[]),g=(0,l.useCallback)((function(){var e=(0,P.getParticipantExternalId)(t);e?(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){t&&r({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:t.peerId,data:t.roles?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.roles),!1),[J.UserRole.ADMIN],!1):[J.UserRole.ADMIN]})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer)}),A()):A()}),[]);return _?null:(0,o.jsx)(jr,{onClose:A,title:m("calls_dialog_assign_admin_role_title"),description:m("calls_dialog_assign_admin_role_description").replace("{name}",p),actionButtons:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:A,appearance:"secondary"},{children:m("calls_dialog_assign_admin_role_action_later")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:g},{children:m("calls_dialog_assign_admin_role_action_primary")}),"primary")]},void 0)},Zr=t(92110),Br="wakeLock"in navigator&&!0,Ur=null,Hr=!1,Vr=function(){null!==Ur&&"visible"===document.visibilityState&&Fr()},Gr=function(){var e,n,t,a;Pr||((Pr=document.createElement("video")).setAttribute("title","Wake lock"),Pr.setAttribute("playsinline",""),e=Pr,n="mp4",t="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(a=document.createElement("source")).src=t,a.type="video/"+n,e.appendChild(a),Pr.addEventListener("loadedmetadata",(function(){Pr&&Pr.addEventListener("timeupdate",(function(){Pr&&Pr.currentTime>.5&&(Pr.currentTime=Math.random())}))}))),Pr.play().catch((function(){}))};function Fr(){if(!Br)return Gr();Hr||(Hr=!0,document.addEventListener("visibilitychange",Vr));try{navigator.wakeLock.request("screen").then((function(e){(Ur=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function Wr(){Br?Ur&&Ur.release().then((function(){Ur=null})):Pr&&Pr.pause()}var zr=t(73947);function Kr(e){var n=e.onClose,t=e.onSubmit,a=e.title,r=e.children,s=e.isWithBackButton,c=e.onBackClick,d=e.contentClassName,u=void 0===d?"TranslationCreateModal__content":d,_=e.isRecord,v=(0,l.useContext)(E.LangContext).getLang,h=n&&t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:v("calls_cancel")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:t},{children:v(_?"calls_record_start":"calls_translation_start")}),void 0)]},void 0);return(0,o.jsx)(En.default,(0,i.__assign)({className:"TranslationCreateModal",title:a,onClose:n,backText:s?v("calls_back"):void 0,onBack:c,actionButtons:h},{children:(0,o.jsx)("div",(0,i.__assign)({className:u},{children:l.Children.toArray(r).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)}var Qr,Yr,Jr=t(28581),Xr=t(21086),qr=t(31897);function $r(e){var n=e.onSubmit,t=e.onClose,a=e.isRecord,r=(0,l.useContext)(E.LangContext),s=r.getLang,d=r.langShortDateTime,u=(0,c.useSelector)((function(e){return e})),_=function(){var e=(new Date).toISOString().split("T")[0];return s("calls_translation_title_default_value").replace("%s",e)},v=function(e,n,t){return void 0===n&&(n=""),void 0===t&&(t=""),{id:e,name:n,photo:t,isGroup:e<0}},h=function(e){var n=[{value:Qr.ONLY_ME,label:s("calls_translation_privacy_only_me_and_chat")},{value:Qr.FRIENDS,label:s("calls_translation_privacy_friends_and_chat")}];return e&&n.push({value:Qr.ALL,label:s("calls_translation_privacy_all_users")}),n},p=u.participants[u.me],f=u.config,m=(0,i.__read)((0,l.useState)(_()),2),A=m[0],g=m[1],C=(0,i.__read)((0,l.useState)(""),2),S=C[0],T=C[1],I=(0,i.__read)((0,l.useState)(u.groupId?Qr.ALL:Qr.ONLY_ME),2),x=I[0],N=I[1],y=(0,i.__read)((0,l.useState)((function(){return h(!p.isClosed||!!u.groupId)})),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)((function(){var e,n;return u.groupId?v(u.groupId,null===(e=u.meGroup)||void 0===e?void 0:e.name,null===(n=u.meGroup)||void 0===n?void 0:n.photo):v(p.peerId,p.name,p.photo)})),2),L=w[0],k=w[1],P=(0,i.__read)((0,l.useState)(Yr.MAIN),2),M=P[0],D=P[1],j=(0,i.__read)((0,l.useState)({}),2),R=j[0],Z=j[1],B=(0,i.__read)((0,l.useState)((function(){return u.groupId&&u.meGroup?[{value:u.meGroup.peerId,label:u.meGroup.name}]:[{value:p.peerId,label:p.name}]})),2),U=B[0],H=B[1],V=(0,i.__read)((0,l.useState)([]),2),G=V[0],F=V[1],W=(0,i.__read)((0,l.useState)(!1),2),z=W[0],K=W[1],Q=(0,i.__read)((0,l.useState)([]),2),Y=Q[0],J=Q[1],X=(0,i.__read)((0,l.useState)([]),2),q=X[0],$=X[1],ee=(0,l.useCallback)((function(){var e=A.trim(),t=S.trim(),a={};if(Object.keys(R).length>0){e||(e=R.title),t||(t=R.description);var i=t!=R.title||e!=R.description;i||(i=L.id>0&&R.privacy_view.category!=x),i&&(0,sn.sendVideoEdit)(L.id,R.id,e,t,x).catch((function(e){return console.error(e)}));var o={ovId:R.ov_id};R.live_start_time&&(o.startTime=R.live_start_time),a.upcomingStreamParams=o}else a.streamParams={name:e||_(),description:t,privacy_view:x,group_id:L.id<0?-L.id:0,call:1};n(a)}),[A,S,x,L,R]);(0,l.useEffect)((function(){if(!u.groupId)try{(0,sn.getGroupsForStreaming)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(U),!1);e.length>0&&(e.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),H(n),F(e))})).catch(console.error)}catch(e){console.log(e)}}),[]),(0,l.useEffect)((function(){Z({}),K(!1),J([]),(0,sn.getUpcomingLives)([L.id]).then((function(e){var n=[];e.count>0&&(n=e.items.filter((function(e){return""!==e.ov_id})));var t=n.length>0;if(K(t),J(n),t){var a=[];n.forEach((function(e){e.owner_id&&e.owner_id>0&&a.push(e.owner_id.toString())})),a&&(0,sn.loadUsers)({user_ids:a.join(",")}).then((function(e){var n=[];e.forEach((function(e){n.push({id:e.id,name:e.first_name+" "+e.last_name})})),$(n)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[L]);var ne=function(e){var n=e.date;e.live_start_time&&(n=e.live_start_time);var t=n-Date.now()/1e3;return t>0&&t<rn.WEEK?s("calls_translation_date_label_soon"):""},te=function(e){if(!(e>0))return L.name;var n=q.filter((function(n){return n.id==e}));if(n.length>0){var t=n[0];if(t)return t.name}return""};return(0,o.jsxs)(o.Fragment,{children:[M===Yr.MAIN&&(0,o.jsxs)(Kr,(0,i.__assign)({onClose:t,onSubmit:ee,title:s(a?"calls_record_box_title":"calls_translation_box_title"),isRecord:a},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__link"},{children:[(0,o.jsxs)(Tn.default,{children:[!!U.length&&(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(xn.ListIcon,{icon:(0,o.jsx)("img",{className:"TranslationCreateForm__ownerIcon",src:L.photo,alt:L.name},void 0),color:xn.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(bo.default,{className:"TranslationCreateFormOptions__longselect",options:U,value:L.id,onChange:function(e){var n=e.selected.value;n<0?G.forEach((function(e){e.id==-n&&(N(Qr.ALL),O(h(!0)),k(v(-e.id,e.name,e.photo_100)))})):(O(h(!p.isClosed)),N(Qr.ONLY_ME),k(v(p.peerId,p.name,p.photo)))},disabled:U.length<=1},void 0)},{children:s(a?"calls_record_owner_title":"calls_translation_owner_title")}),void 0),z&&!a&&(0,o.jsxs)(In.default,(0,i.__assign)({onClick:function(){z&&D(Yr.SELECT_POSTPONE)},chevron:!0,border:!0,icon:(0,o.jsx)(xn.ListIcon,{icon:(0,o.jsx)(Xr.TimeIcon,{},void 0),color:xn.ListIconColors.GREEN},void 0)},{children:[s("calls_translation_postponed_title"),Object.keys(R).length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__copyControl"},{children:(0,o.jsx)(qr.default,(0,i.__assign)({className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),Z({}),g(_()),T("")}},{children:s("calls_translation_postponed_reset")}),void 0)}),void 0)]}),void 0),!f.sferum&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(xn.ListIcon,{icon:(0,o.jsx)(Jr.PrivacyIcon,{},void 0),color:xn.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(bo.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:L.isGroup,options:b,value:x,onChange:function(e){N(e.selected.value)}},void 0)},{children:s("calls_translation_who_can_see_video_privacy")}),void 0)]},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__privacyHint"},{children:s(a?"calls_record_who_can_see_video_privacy_hint":"calls_translation_who_can_see_video_privacy_hint")}),void 0)]}),void 0),(0,o.jsxs)("form",(0,i.__assign)({className:"TranslationCreateForm__main",onSubmit:ee},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__section"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_title"),(0,o.jsx)(On.default,{className:"TranslationCreateForm__field",value:A,onChange:function(e){var n=e.target;g(n.value)},placeholder:s("calls_translation_name_placeholder")},void 0)]}),void 0)}),void 0),!a&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_description"),(0,o.jsx)(zr.default,{className:"TranslationCreateForm__field",placeholder:s("calls_translation_description_placeholder"),value:S,onChange:function(e){var n=e.target;T(n.value)}},void 0)]}),void 0)}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__tabSection"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__warning"},{children:s(a?"calls_record_notification_warning":"calls_translation_notification_warning")}),void 0)}),void 0)]}),void 0)]}),void 0),M===Yr.SELECT_POSTPONE&&(0,o.jsx)(Kr,(0,i.__assign)({title:s("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return D(Yr.MAIN)},onClose:t,contentClassName:"TranslationCreateForm__modalVideo"},{children:(0,o.jsx)("div",{children:Y.length>0&&(0,o.jsx)(Tn.default,(0,i.__assign)({className:"TranslationCreateForm__VideoList"},{children:Y.map((function(e,n){return(0,o.jsxs)(In.default,(0,i.__assign)({className:"TranslationCreateForm__videoItem",active:e.id===R,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return(n=e).owner_id>0&&(0,sn.getVideos)(n.owner_id,[n.owner_id+"_"+n.id],!0).then((function(e){if(e.count>0){var t=e.items.filter((function(e){return e.id==n.id}));t.length>0&&(n.privacy_view=t[0].privacy_view,Z(n),n.privacy_view&&N(n.privacy_view.category))}})),Z(n),D(Yr.MAIN),g(n.title),void T(n.description);var n},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoLink"},{children:s("calls_translation_select_video_link")}),void 0)},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoImagePreview"},{children:[(0,o.jsx)("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title},void 0),ne(e)&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoImageLabel"},{children:ne(e)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDescription"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoTitle"},{children:e.title}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoOwner"},{children:te(e.owner_id)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDate"},{children:(t=e,a=t.date,t.live_start_time&&(a=t.live_start_time),d(1e3*a))}),void 0)]}),void 0)]}),n);var t,a}))}),void 0)},void 0)}),void 0)]},void 0)}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(Qr||(Qr={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(Yr||(Yr={}));var es=function(e){var n,t=e.isRecord,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP})}),[]),v=ln(a),h=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]),p=(0,l.useCallback)((function(e){var n,a;if(null==e?void 0:e.upcomingStreamParams){var i=e.upcomingStreamParams,o=i.startTime,s=i.ovId;if(o&&o>Date.now()/1e3+4)return Ct(s,t).finally(_)}var l={isOn:!1,startStreamParams:e,isRecord:t,name:null===(n=e.streamParams)||void 0===n?void 0:n.name};return t&&(null===(a=l.startStreamParams)||void 0===a?void 0:a.streamParams)&&(l.startStreamParams.streamParams.is_call_record=1),r({type:d.E_ACTION.SET_TRANSLATION,data:l}),r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN}),Promise.resolve()}),[t]),f=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}),[]);return(null===(n=a.translation)||void 0===n?void 0:n.isOn)?(0,o.jsx)(Sn,(0,i.__assign)({title:s("calls_translation_menu_title"),actionButtons:v?[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:h,appearance:"negative"},{children:s("calls_translation_menu_stop")}),"stop")]:[],onCloseModal:_},{children:(0,o.jsx)(bn,{isLinkBlockShown:!0,linkBlockTitle:s("calls_translation_menu_link"),onLinkBlockClick:f,callUrlLink:a.translation.link},void 0)}),void 0):(0,o.jsx)($r,{onSubmit:p,onClose:_,isRecord:t},void 0)},ns=function(e){var n=e.onClose,t=e.actionButtons,a=e.isRecord,r=(0,ue.useLang)().getLang,s=r(a?"calls_record_stop_confirmation":"calls_translation_stop_confirmation"),l=r(a?"calls_record_stop_sure":"calls_translation_stop_sure");return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:s,appearance:"blue",actionButtons:t,className:"TranslationStopModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStopModal__text"},{children:l}),void 0)}),void 0)},ts=function(){var e=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=k((function(e){return e.translation.isRecord})),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return{dispatch:e,getLang:n,isRecord:t,onClose:a}}(),n=e.dispatch,t=e.getLang,a=e.isRecord,r=e.onClose;return(0,o.jsx)(ns,{onClose:r,actionButtons:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:r,appearance:"secondary"},{children:t("calls_cancel")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){(0,sn.stopVideoStream)().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:t("calls_translation_stop")}),"stop")],isRecord:a},void 0)};var as=function(e){var n=e.link,t=(0,l.useContext)(E.LangContext).getLang,a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=(0,l.useCallback)((function(){return s(!0)}),[]),d=(0,l.useCallback)((function(){return s(!1)}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"TranslationLink__info"},{children:t("calls_translation_link_info")}),void 0),(0,o.jsx)(On.default,{readOnly:"readonly",className:"TranslationLink__input",value:n},void 0),n&&(0,o.jsx)(oi.CopyText,(0,i.__assign)({text:n,onCopyDone:c},{children:(0,o.jsx)(Bn.default,{children:t("calls_translation_link_copy")},void 0)}),void 0),(0,o.jsx)(wn.default,(0,i.__assign)({className:"TranslationLink__copied",shown:r,callback:d},{children:t("calls_translation_link_copied")}),void 0)]}),void 0)},is=function(e){var n,t=e.onBack,a=e.link,r=e.linkExtractor,s=u(),_=(0,l.useContext)(E.LangContext).getLang,v=(0,c.useSelector)((function(e){return e.translation})),h=(0,l.useCallback)((function(){s({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return(0,o.jsx)(Sn,(0,i.__assign)({title:_("calls_translation_link"),onCloseModal:h,isWithBackButton:!!t,onBackClick:t},{children:(0,o.jsx)(as,{link:null!==(n=null==r?void 0:r(v))&&void 0!==n?n:a},void 0)}),void 0)},os=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(En.default,(0,i.__assign)({className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AdminPinUnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},rs=function(e){var n=e.SDK,t=u(),a=(0,l.useContext)(E.LangContext).getLang,r=(0,c.useSelector)((function(e){return e})),s=r.localDevice.mediaSettings,_=function(){t({type:d.E_ACTION.TOGGLE_POPUP})};return(0,o.jsx)(os,{onClose:_,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:_,appearance:"secondary"},{children:a("calls_admin_pin_dialog_cancel")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){(s.isAudioEnabled?Promise.resolve():Ze(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&t({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)})).then((function(){return _()}))}},{children:a("calls_admin_pin_dialog_action")}),"mic")]},void 0)},ss=function(e){var n=e.participants,t=e.selected,a=e.onSelect,r=e.onClose,s=e.onCallForceFinish,c=e.onRightsTransfer,d=e.onSearch,u=e.isCreator,_=(0,ue.useLang)().getLang,v=k((function(e){return e.me})),h=(0,l.useMemo)((function(){return n.filter((function(e){return e.peerId!==v}))}),[n,v]);return(0,o.jsx)(Sn,(0,i.__assign)({title:_("calls_dialog_creator_exit_title"),onCloseModal:r,actionButtons:(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"secondary",onClick:s},{children:_("calls_force_call_finish")}),"force"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:c},{children:_(null===t?"calls_leave_call":"calls_dialog_creator_exit_action")}),"action")]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TransferAdminRightsModal__content"},{children:[(0,o.jsx)(On.default,{onChange:function(e){return d(e.target.value)},placeholder:_("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"},void 0),(0,o.jsxs)(Tn.default,(0,i.__assign)({border:!1},{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:h.length},{children:_("calls_call_participants")}),void 0),!h.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0),h.map((function(e){return(0,o.jsx)(In.default,(0,i.__assign)({className:"TransferAdminRightsModal__item",onClick:function(){return a(t!==e.peerId?e:null)},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TransferAdminRightsModal__label","aria-selected":t===e.peerId},{children:t===e.peerId?_("calls_dialog_creator_exit_selected"):_("calls_dialog_creator_exit_select")}),void 0)},{children:(0,o.jsx)(Zn.default,{size:"34",title:e.name,photo:e.photo},void 0)}),e.peerId)}))]}),void 0)]}),void 0)}),void 0)},ls=function(e){var n=e.SDK,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,s=(0,i.__read)((0,l.useState)((function(){var e=(0,Ve.objectFilter)(a.participants,(function(e){return e.peerId===a.me||!(0,P.isParticipantAnonym)(e.peerId)&&(0,P.someDeviceByParticipant)(e,(function(e){return e.status===J.ParticipantStatus.CONNECTED}))}));return e})),2),_=s[0],v=s[1],h=(0,i.__read)((0,l.useState)(null),2),p=h[0],f=h[1],m=(0,l.useCallback)((function(e){return e.name}),[]),A=(0,l.useCallback)((function(e){return e.peerId}),[]),g=N(_,m,A),C=(0,l.useMemo)((function(){return(0,P.getActiveParticipantsCount)(a)}),[a.participants]),S=function(){return w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:C})},T=(0,l.useMemo)((function(){return(0,P.isCreator)(a.localDevice)}),[a.localDevice]),I=(0,l.useCallback)((function(e){v(e?g.search(e):g.list),f(null)}),[a]),x=function(){t({type:d.E_ACTION.TOGGLE_POPUP})},y=function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup().catch(console.log)},b=(0,l.useCallback)((function(e){f(null===e?null:e.peerId)}),[]);return(0,l.useEffect)((function(){p&&!_.find((function(e){return e.peerId===p}))&&f(null)}),[p]),(0,o.jsx)(ss,{participants:_,onClose:x,onSelect:b,selected:p,onCallForceFinish:function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup(),$a(0,a,t,r)},onRightsTransfer:function(){if(null!==p){var e=(0,P.getParticipantExternalId)(a.participants[p]);e&&(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){return y()})).catch(console.log),x())}else y()},onSearch:I,isCreator:T},void 0)},cs=function(e){var n=e.onCloseModal,t=e.counter,a=e.onStopTranslation,r=e.isRecord,s=(0,l.useContext)(E.LangContext).getLang,c=s(r?"calls_record_cancel_button":"calls_translation_cancel_button");return(0,o.jsx)(T.default,(0,i.__assign)({disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__counter"},{children:t}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({className:"TranslationStartCountdownModal__stop",onClick:a,appearance:"overlay_secondary"},{children:c}),void 0)]}),void 0)}),void 0)};function ds(){var e=u(),n=k((function(e){return e})),t=(0,i.__read)((0,l.useState)(3),2),a=t[0],r=t[1],s=k((function(e){return e.translation.isRecord})),c=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]),_=(0,l.useCallback)((function(){var e,t=null===(e=n.translation)||void 0===e?void 0:e.startTime;t&&t>=Date.now()&&(0,sn.stopVideoStream)(),c()}),[]);return(0,l.useEffect)((function(){var e=setInterval((function(){return r(a-1)}),rn.SECOND_JS);return function(){return clearInterval(e)}}),[a]),(0,l.useEffect)((function(){var e,t;if(a<=0){var i=null===(e=n.translation)||void 0===e?void 0:e.startStreamParams;(null==i?void 0:i.streamParams)?(t=i.streamParams,(0,sn.videoStartStreaming)(t).then((function(e){return(0,J.startStream)(!!t.is_call_record,null,String(e.stream.ov_id))})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))):(null==i?void 0:i.upcomingStreamParams)&&Ct(i.upcomingStreamParams.ovId),c()}}),[a]),(0,o.jsx)(cs,{onCloseModal:c,counter:a,onStopTranslation:_,isRecord:s},void 0)}var us,_s=function(e){var n=e.onClose,t=e.actionButtons,a=e.onAllowReconnectChange,r=e.description,s=e.allowBan,c=e.banText,d=(0,l.useContext)(E.LangContext).getLang,u=(0,l.useContext)(y.ConfigContext).allowBanParticipant,_=(0,i.__read)((0,l.useState)(!0),2),v=_[0],h=_[1],p=(0,l.useCallback)((function(e,n){a&&a(n),h(n)}),[]);return(0,o.jsx)(En.default,(0,i.__assign)({className:"KickParticipantModal",appearance:"blue",title:d("calls_kick_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"KickParticipantModal__content"},{children:[r,u&&s&&(0,o.jsx)("div",{children:(0,o.jsx)(wo.default,(0,i.__assign)({className:"KickParticipantModal__checkbox",onChange:p,checked:v},{children:c}),void 0)},void 0)]}),void 0)}),void 0)},vs=function(){var e,n=u(),t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langSex,s=k((function(e){return e.waitingHall})),c=k((function(e){var n;return null===(n=e.participantKick)||void 0===n?void 0:n.participant})),_=k((function(e){var n;return(null===(n=e.participantKick)||void 0===n?void 0:n.type)===d.KickParticipantType.CALL})),v=k((function(e){return e.callData.conversation})),h=(0,i.__read)((0,l.useState)(!0),2),p=h[0],f=h[1],m=!!c&&(!(0,P.participantIsAdmin)(c)&&!(0,P.participantIsChatAdmin)(c,v)),A=(0,l.useCallback)((function(){n({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK})}),[]),g=(0,l.useCallback)((function(){(0,P.kickParticipant)(c,!p).then((function(){!_&&s&&(null==c?void 0:c.peerId)&&Fn(null==c?void 0:c.peerId,s,n)})),A()}),[c,p,s]),C=(0,l.useCallback)((function(e){f(e)}),[]),S=_?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",T=r(null==c?void 0:c.sex,S,a(S,!0)).replace("{user}",null!==(e=null==c?void 0:c.name)&&void 0!==e?e:""),I=a(_?"calls_kick_participant_kick_button_text":"calls_kick_participant_from_waiting_hall_button_text"),x=a(_?"calls_kick_participant_with_ban_setting":"calls_kick_participant_from_waiting_hall_with_ban_setting");return(0,o.jsx)(_s,{onClose:A,onAllowReconnectChange:C,description:T,allowBan:m,banText:x,actionButtons:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:A,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:g},{children:I}),"stop")]},void 0)},hs=function(e){var n=e.title,t=e.children,a=e.sendButtonClick,r=e.skipButtonClick,s=e.sendButtonDisabled,c=void 0===s||s,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen"},{children:[(0,o.jsx)("div",{className:"FeedbackScreen__close",onClick:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__title"},{children:n}),void 0),t,(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__actions"},{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"overlay_secondary",onClick:r},{children:d("calls_feedback_skip")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"overlay_primary",onClick:a,disabled:c},{children:d("calls_feedback_send")}),void 0)]}),void 0)]}),void 0)},ps=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"},void 0)}),void 0)},fs=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"},void 0)}),void 0)};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(us||(us={}));var ms=function(e){var n=e.onSuccessFeedback,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,_=(0,i.__read)((0,l.useState)(us.DEFAULT),2),v=_[0],h=_[1],p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],m=p[1],A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],C=A[1],S=new Map([["DID_NOT_HEAR_INTERLOCUTOR",r("calls_feedback_reason_did_not_hear_interlocutor")],["DID_NOT_SEE_INTERLOCUTOR",r("calls_feedback_reason_did_not_see_interlocutor")],["BAD_VIDEO_QUALITY",r("calls_feedback_reason_bad_video_quality")],["VIDEO_FREEZES",r("calls_feedback_reason_video_freezes")],["VERY_QUIET_SOUND",r("calls_feedback_reason_very_quiet_sound")],["BAD_SOUND_QUALITY",r("calls_feedback_reason_bad_sound_quality")],["SOUND_DID_NOT_MATCH_THE_VIDEO",r("calls_feedback_reason_sound_did_not_match_the_video")],["FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE",r("calls_feedback_reason_failed_to_turn_on_camera_or_microphone")]]),T=(0,i.__read)((0,l.useState)({user_response:0,feedback:[],custom_feedback:void 0}),2),I=T[0],x=T[1],N=(0,i.__read)((0,l.useState)(Array.from(S,(function(e){return{name:(0,i.__read)(e,1)[0],checked:!1}}))),1),y=N[0],L=function(){t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},k=function(e){var n=e.target.getAttribute("data-response");if(n){var t=parseInt(n,10);t<=3&&h(us.ADVANCE),x((0,i.__assign)((0,i.__assign)({},I),{user_response:t})),m(!1)}},P=function(e,n){y.forEach((function(t){t.name===e&&(t.checked=n)})),x((function(e){return(0,i.__assign)((0,i.__assign)({},e),{feedback:y.filter((function(e){return e.checked})).map((function(e){return e.name}))})}))},M=function(e,n){C(n)},D=function(e){x((0,i.__assign)((0,i.__assign)({},I),{custom_feedback:e.currentTarget.value}))};return(0,o.jsx)(b,(0,i.__assign)({onClose:L,onBackdropClick:L},{children:(0,o.jsx)("section",(0,i.__assign)({className:"Call"},{children:(0,o.jsx)(hs,(0,i.__assign)({title:v===us.DEFAULT?r("calls_feedback_default_title"):r("calls_feedback_advance_title"),sendButtonClick:function(){var e=(a.lastCallData?a.lastCallData.peerId:0)||0;w.callStats.logEvent({call_event_type:d.CallActionEventType.USER_FEEDBACK_RECEIVED,session_id:a.lastCallData?a.lastCallData.callId:"",peer_id:e,is_group_call:(0,O.isGroupCallByPeer)(e),user_response:I.user_response,feedback:I.feedback,custom_feedback:g&&I.custom_feedback?I.custom_feedback:void 0}),t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),n&&n()},skipButtonClick:L,sendButtonDisabled:f},{children:v===us.DEFAULT?(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__stars",onClick:k},{children:[1,2,3,4,5].map((function(e,n){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=I.user_response}),"data-response":e},{children:[(0,o.jsx)(ps,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"},void 0),(0,o.jsx)(fs,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"},void 0)]}),n)}))}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__voting"},{children:[Array.from(S,(function(e){var n=(0,i.__read)(e,2),t=n[0],a=n[1];return(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem"},{children:(0,o.jsx)(wo.default,(0,i.__assign)({name:t,className:"FeedbackScreen__votingItemCheckbox",onChange:P},{children:a}),void 0)}),t)})),(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom"},{children:[(0,o.jsx)(wo.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:M},void 0),(0,o.jsx)(zr.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:r("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!g,onChange:D},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)}),void 0)},As=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.subDescription,s=e.avatarsItems,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"UnbanMembersModal",appearance:"blue",title:c("calls_unban_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"UnbanMembersModal__content"},{children:[(0,o.jsx)(Zo.AvatarsStack,{items:s},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__description"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__subDescription"},{children:r}),void 0)]}),void 0)}),void 0)},gs=function(e){var n,t=e.SDK,a=u(),r=(0,l.useContext)(E.LangContext),s=r.getLang,_=r.langNumeric,v=r.langSex,h=(0,c.useSelector)((function(e){return e})),p=(0,P.participantIsAdmin)(h.localDevice),f=null===(n=h.membersUnban)||void 0===n?void 0:n.members,m=(0,l.useCallback)((function(){a({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:null})}),[]),A=(0,l.useCallback)((function(){null==f||f.forEach((function(e){t.addParticipant(String(e.id),{unban:!0})})),m()}),[h.membersUnban]);if(!f||0===f.length)return(0,o.jsx)(o.Fragment,{},void 0);var g=null==f?void 0:f.length,C=_(g,"calls_unban_participant_text",s("calls_unban_participant_text",!0)),S="",T=[];if(1===g){var I=f[0];S=v(I.sex,"calls_unban_participant_description_text_one_person",s("calls_unban_participant_description_text_one_person",!0)).replace("{user}",I.name),T.push((0,Vn.getMemberForUserStack)(I))}else{var x=[f[0].name,f[1].name];T=f.slice(0,2).map((function(e){return(0,Vn.getMemberForUserStack)(e)}));if(g<=3)3===g&&(x.push(f[2].name),T.push((0,Vn.getMemberForUserStack)(f[2]))),S=s("calls_unban_participant_description_text_two_persons").replace("{users}",x.join(", "));else{var N=g-2;S=_(N,"calls_unban_participant_description_text_more_persons",s("calls_unban_participant_description_text_more_persons",!0)).replace("{users}",x.join(", ")).replace("{users_count}",N),T.push({id:N,text:"+"+N})}}var y=p?[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:m,appearance:"secondary"},{children:s("calls_unban_participant_cancel_button_text")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:A},{children:s("calls_unban_participant_ok_button_text")}),"stop")]:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:m},{children:s("calls_unban_participant_disallowed_button_text")}),"cancel")];return(0,o.jsx)(As,{onClose:m,description:C,subDescription:S,actionButtons:y,avatarsItems:T},void 0)};const Cs=(0,X.makeIcon)("Icon28DownloadOutline","download_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="download_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M21 22a1 1 0 1 1 0 2H7a1 1 0 0 1 0-2h14ZM14 2a1 1 0 0 1 1 1v13.585l5.293-5.292a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-1.414 0l-7-7a1 1 0 0 1 1.414-1.414L13 16.585V3a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),Es=(0,X.makeIcon)("Icon28VideocamOutline","videocam_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="videocam_outline_28"><path fill-rule="evenodd" d="M9.357 5h4.286c1.084 0 1.958 0 2.666.058.729.06 1.369.185 1.961.487a5 5 0 0 1 2.185 2.185c.231.454.36.936.433 1.464l.437-.284.903-.585c.239-.155.52-.338.773-.471.255-.134.794-.395 1.482-.348a2.7 2.7 0 0 1 1.975 1.07c.415.552.49 1.148.516 1.434.026.285.026.62.026.904v6.172c0 .284 0 .619-.026.904-.026.286-.1.882-.516 1.434a2.7 2.7 0 0 1-1.975 1.07c-.688.047-1.227-.214-1.482-.348a10.407 10.407 0 0 1-.773-.47l-.905-.588-.435-.282c-.074.528-.202 1.01-.433 1.464a5 5 0 0 1-2.185 2.185c-.592.302-1.232.428-1.961.487C15.6 23 14.727 23 13.643 23H9.357c-1.084 0-1.958 0-2.666-.058-.728-.06-1.369-.185-1.96-.487a5 5 0 0 1-2.186-2.185c-.302-.592-.428-1.232-.487-1.961C2 17.6 2 16.727 2 15.643v-3.286c0-1.084 0-1.958.058-2.666.06-.728.185-1.369.487-1.961A5 5 0 0 1 4.73 5.545c.592-.302 1.233-.428 1.961-.487C7.4 5 8.273 5 9.357 5ZM21 15.643v-4.138l2.27-1.472c.563-.365.844-.548 1.077-.532a.7.7 0 0 1 .513.277c.14.187.14.522.14 1.192v6.06c0 .67 0 1.005-.14 1.192a.7.7 0 0 1-.513.277c-.233.016-.514-.167-1.077-.532L21 16.495v-.852ZM6.854 7.05c-.605.05-.953.142-1.216.276a3 3 0 0 0-1.311 1.311c-.134.263-.226.611-.276 1.216-.05.617-.051 1.41-.051 2.546v3.2c0 1.137 0 1.929.051 2.546.05.605.142.953.276 1.216a3 3 0 0 0 1.311 1.311c.263.134.611.226 1.216.276.617.05 1.41.051 2.546.051h4.2c1.137 0 1.929 0 2.546-.051.605-.05.953-.142 1.216-.276a3 3 0 0 0 1.311-1.311c.134-.263.226-.611.276-1.216.05-.617.051-1.41.051-2.546v-3.2c0-1.137 0-1.929-.051-2.546-.05-.605-.142-.953-.276-1.216a3 3 0 0 0-1.311-1.311c-.263-.134-.611-.226-1.216-.276-.617-.049-1.41-.05-2.546-.05H9.4c-1.137 0-1.929 0-2.546.051Z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);function Ss(){var e,n,t,a=(0,c.useSelector)((function(e){return e})),r=u(),_=(0,l.useContext)(E.LangContext).getLang,v=!(null===(e=a.join)||void 0===e?void 0:e.joinLink),h=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),p=h[0],f=h[1],m=(0,i.__read)((0,l.useState)(!p),2),A=m[0],g=m[1],C=(0,l.useRef)(Li()),S=null!==C.current,T=(0,i.__read)((0,l.useState)(!p),2),I=T[0],x=T[1],N=function(){var e,n,t,i;return(null===(e=a.join)||void 0===e?void 0:e.joinLink)?Ui(Hi({joinLink:null===(n=a.join)||void 0===n?void 0:n.joinLink,userId:null===(t=window.vk)||void 0===t?void 0:t.id})):Ui(function(e){var n=e.peerId,t=e.userId,a=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?peerId="+n+"&userId="+t;return console.log("deeplink: ",a),a}({peerId:a.peer,userId:null===(i=window.vk)||void 0===i?void 0:i.id}))};(0,l.useEffect)((function(){N().then((function(){g(!1)})).catch((function(){g(!1)}))}),[p]);var y=function(){r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},O=null!==(t=null===(n=Fi(a.config.browserWarnings))||void 0===n?void 0:n.block)&&void 0!==t&&t;return(0,o.jsx)(b,(0,i.__assign)({onClose:y,onBackdropClick:y},{children:(0,o.jsxs)(ba.ModalCard,(0,i.__assign)({nav:"StartCallModal",header:(0,o.jsx)(V.default,{children:_(A&&S?"calls_download_started":p?"calls_app_title":v?"calls_start_call_after_install_app":"calls_join_call_after_install_app")},void 0),subheader:I?_("calls_download_and_install_app_for_pc"):p?_(v?"calls_try_manual_start_lesson":"calls_try_manual_join_lesson"):A?_("calls_wait_until_app_downloaded"):"",className:"StartCallModal"},{children:[A&&S&&C.current?(0,o.jsxs)(l.Fragment,{children:[(0,o.jsx)(ba.Spinner,{size:"large",className:"StartCallModal__action"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"StartCallModal__text"},{children:_("calls_downloading_file").replace("{file}",C.current.filename)}),void 0)]},void 0):I?C.current&&S?(0,o.jsx)(ba.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(Cs,{},void 0),onClick:function(){return e=C.current.url,n=C.current.filename,ki(),wi(e,n),g(!0),void setTimeout((function(){f(!0),g(!1),x(!1)}),3e3);var e,n},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(ba.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(Cs,{},void 0),href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank",onClick:function(){ki(),x(!1)},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(ba.Button,(0,i.__assign)({mode:"secondary",size:"l",before:(0,o.jsx)(Es,{},void 0),onClick:N,className:"StartCallModal__action"},{children:_(v?"calls_start_in_app":"calls_join_call_in_app")}),void 0),!I&&(0,o.jsxs)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[(0,o.jsx)("div",{children:_("calls_apps_for_all_platform")},void 0),(0,o.jsx)(ba.Link,(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank"},{children:_("calls_open_app_list")}),void 0)]}),void 0),!O&&(0,o.jsxs)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[_("calls_calls_troubles_with_app"),(0,o.jsx)("br",{},void 0),(0,o.jsx)(ba.Link,(0,i.__assign)({onClick:function(){var e,n,t,i,o=a.peer;if(window.Calls)if(null===(e=a.join)||void 0===e?void 0:e.joinLink){var r=null!==(n=a.entryPoint)&&void 0!==n?n:d.CallStatSource.CONVO_JOIN_SNIPPET;window.Calls.joinCallByLink(null===(t=a.join)||void 0===t?void 0:t.joinLink,void 0,!1,r)}else{var s=null!==(i=a.entryPoint)&&void 0!==i?i:d.CallStatSource.CONVO_LIST;if(o)o>2e9?window.Calls.startGroupCall(o,void 0,null,!1,s):window.Calls.call(o,!1,void 0,s);else window.Calls.startCall(!1,s)}}},{children:_(v?"calls_calls_start_lesson_in_browser":"calls_join_call_in_browser")}),void 0)]}),void 0),O&&(0,o.jsx)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:_("calls_warning_native_app_description")}),void 0)]}),void 0)}),void 0)}var Ts=t(98037),Is=function(e){var n=e.items,t=e.actionButtons,a=e.onListItemClick,r=e.selectedId,s=e.onClose,c=e.onSearchChange,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)(T.default,(0,i.__assign)({className:"CallByNameModal",onClose:s},{children:[(0,o.jsx)(Go.ModalHeader,{title:d("calls_call_by_name_title"),onClose:s},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallByNameModal__content"},{children:[(0,o.jsx)(Mn.BlockSearchInput,{className:"CallByNameModalList__input",placeholder:d("calls_call_by_name_search_placeholder"),onChange:c,onInput:c,onPaste:c},void 0),(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:n.length||""},{children:d("calls_call_by_name_list_header")}),void 0),0!==n.length&&(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallByNameModalList__list"},{children:n.map((function(e){return function(e,n){var t=null;return t=n===e.id?(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__selected"},{children:d("calls_call_by_name_selected")}),void 0):(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__select"},{children:d("calls_call_by_name_select")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({onClick:function(){return a(e.id)},className:"CallByNameModalList__listItem",aside:t},{children:(0,o.jsx)(Zn.default,{photo:(0,o.jsx)(m.CallPhoto,{id:e.id,photo:e.photo,alt:e.name||"",className:"CallByNameModalList__photo"},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.id)}(e,r)}))}),void 0),0===n.length&&(0,o.jsx)(Re.default,{children:d("calls_call_by_name_not_found")},void 0)]}),void 0),(0,o.jsx)(Ts.ModalFooter,{actionButtons:t},void 0)]}),void 0)},xs=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,i.__read)((0,l.useState)([]),2),s=r[0],_=r[1],v=(0,i.__read)((0,l.useState)(t.me),2),h=v[0],p=v[1],f=(0,l.useContext)(E.LangContext).getLang,m=(0,i.__read)((0,l.useState)(""),2),A=m[0],g=m[1],C=(0,l.useCallback)((function(e){return e.name}),[]),S=(0,l.useCallback)((function(e){return e.id}),[]),T=N([],C,S),I=t.participants[t.me],x=A?T.search(A):s,y=(0,l.useCallback)((function(e){g(e.target.value)}),[]),b=function(e,n){void 0===n&&(n=!1);var t="id"in e?e.id:e.peerId,a="screen_name"in e?"/"+e.screen_name:e.link,i="photo_100"in e?e.photo_100:e.photo;return{id:n?t:-t,name:(0,wa.escape)(e.name),link:a,photo:i}};(0,l.useEffect)((function(){var e=[b(I,!0)];(0,sn.getGroupsForCall)().then((function(n){n.count>0&&n.items.forEach((function(n){e.push(b(n))}))})).finally((function(){_(e),e.forEach((function(e){return T.add(e)}))}))}),[]);var O=(0,l.useCallback)((function(e){if(t.callByName){var a=t.callByName,i=a.peerId,o=a.entryPoint,r=a.joinLink;r?n.joinCallByLink(r,void 0,e,o,h>0?0:h):i?n.call(i,e,void 0,o,h>0?0:h):n.startCall(e,o,!0,h>0?0:h)}}),[h]);if(!s.length)return(0,o.jsx)(Zr.default,{},void 0);var w=[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return O(!1)},appearance:"secondary"},{children:f("calls_call_by_name_audio_button")}),"callByNameByAudio"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){return O(!0)}},{children:f("calls_call_by_name_video_button")}),"callByNameByVideo")];return(0,o.jsx)(Is,{items:x,actionButtons:w,selectedId:h,onListItemClick:function(e){p(e)},onClose:function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},participantMe:I,onSearchChange:y},void 0)},Ns=function(e){var n,t,a,i=e.SDK,r=(0,c.useSelector)((function(e){return e})),s=u(),_=r.localDevice,v=r.externalId,h=r.participants[r.me],p=(0,l.useCallback)((function(){s({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})}),[]),f=(0,l.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=r.localDevice.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[r.localDevice.mediaSettings]);return(0,o.jsx)(fo,{children:v&&(0,o.jsx)(go,{onRestoreCall:p,isMe:!0,isLocalAudioEnabled:!!(null===(n=_.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalAudioAllowed:!0,isLocalScreenSharing:!1,onToggleAudio:f,photo:h.photo,name:h.name,participantId:v,isWithVideo:(0,P.isParticipantWithVideo)(_),isWithAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isScreenSharing:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,P.getStream)(_),status:_.status,networkStatus:_.networkStatus},void 0)},void 0)},ys=function(e){var n=e.name,t=e.letter,a=e.hasAudio,r=e.hasVideo,s=e.stream,l=e.wasConnected,c=e.externalId;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHall"},{children:(0,o.jsx)("main",(0,i.__assign)({className:"WaitingHall__main"},{children:(0,o.jsx)(ce,{externalId:c,hasVideo:r,hasAudio:a,isSharingScreen:!1,stream:s,isMe:!0,name:n,letter:t,allowContain:!0,wasConnected:l,networkStatus:1},void 0)}),void 0)}),void 0)},bs=function(e){var n=e.text;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo__text"},{children:n}),void 0)}),void 0)};function Os(e){var n,t,a,r=e.SDK,s=e.navigateToConvo,_=(0,c.useSelector)((function(e){return e})),v=u(),h=(0,l.useContext)(E.LangContext).getLang,p=(0,l.useContext)(y.ConfigContext),f=p.isModalView,m=p.enableScreenTrack,A=_.peer,g=_.localDevice.mediaSettings,C=_.uiMode===d.UIMode.FULLSCREEN,S=(0,i.__read)((0,l.useState)(!1),2),T=S[0],I=S[1],x=(0,i.__read)((0,l.useState)(!1),2),N=x[0],O=x[1],w=function(e){return v({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},L=(0,l.useCallback)((function(){f&&(_.uiMode===d.UIMode.FULLSCREEN?((0,Cn.pause)(.3,null).then((function(){w(d.UIMode.COLLAPSED)})),w(d.UIMode.DEFAULT)):w(d.UIMode.COLLAPSED))}),[_.uiMode]),k=(0,l.useCallback)((function(){if(!T){var e=!g.isAudioEnabled;(e?Ze(r,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;I(!0),(null===(n=_.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&v({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),r.toggleLocalAudio(e).finally((function(){I(!1)}))}))}}),[g,T]),M=(0,l.useCallback)((function(){if(!N){var e=!g.isVideoEnabled||!!g.isScreenSharingEnabled&&!m;(e?Ze(r,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){O(!0),m||g.isScreenSharingEnabled&&r.captureScreen(!1),r.toggleLocalVideo(e).finally((function(){O(!1)}))}))}}),[g,N]),D=(0,l.useCallback)((function(){L(),s(_.peer)}),[_.peer,_.uiMode]),j=(0,l.useCallback)((function(){r.hangup()}),[]),R=(0,l.useCallback)((function(){v({type:d.E_ACTION.CHANGE_UI_MODE,mode:C?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[_.uiMode]),Z=(0,l.useCallback)((function(e,n){var t;v({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),B=(0,l.useCallback)((function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){return function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var U=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:v,notification:_.notification,participant:_.participants[null===(e=_.notification)||void 0===e?void 0:e.data]},void 0)}),[_.notification,_.participants[null===(n=_.notification)||void 0===n?void 0:n.data]]),H=_.hangupType===d.HANGUP_TYPE_REMOVED?h("calls_waiting_hall_removed"):h("calls_waiting_hall_info");return(0,o.jsx)(b,(0,i.__assign)({onClose:j,onBackdropClick:L},{children:(0,o.jsx)(Pe,(0,i.__assign)({info:null,isVideoAllowed:!0,isAudioAllowed:!0,isVideoEnabled:!!g.isVideoEnabled,isAudioEnabled:!!g.isAudioEnabled,isFullScreen:C,onToggleAudio:k,onToggleVideo:M,onLeaveCall:j,onCollapseCall:f?L:null,onFullScreenToggle:R,onTooltipChange:Z,onHidePanel:B,onChat:D,isChatControlShown:!!A&&!_.groupId,chatUnreadCount:_.chatUnreadCount,notification:U,tooltips:_.tooltips,notificationWithButton:null,withoutPadding:!0},{children:(0,o.jsxs)(o.Fragment,{children:[!!g.isVideoEnabled&&_.externalId&&(0,o.jsx)(ys,{name:"",letter:null===(t=_.participants[_.me].name)||void 0===t?void 0:t.slice(0,1),hasAudio:!!(null===(a=_.localDevice.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),externalId:_.externalId,stream:(0,P.getStream)(_.localDevice),hasVideo:(0,P.isParticipantWithVideo)(_.localDevice),wasConnected:!!_.localDevice.wasConnected},void 0),(0,o.jsx)(bs,{text:H},void 0)]},void 0)}),void 0)}),void 0)}var ws=function(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=e.onChangeVideoOption,s=e.videoOptions,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:c("calls_virtual_background"),appearance:"blue",disableEscapeClose:!0,actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__options"},{children:(0,o.jsx)(wo.default,(0,i.__assign)({checked:!!s[d.EVideoOptionType.IS_VIDEO_MIRRORED],name:d.EVideoOptionType.IS_VIDEO_MIRRORED,onChange:r},{children:c("calls_mirror_display_view")}),void 0)}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:c("calls_cancel")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:t},{children:c("calls_save")}),void 0)]},void 0),className:"VirtualBackgroundSettingsModal"},{children:a}),void 0)},Ls=function(e,n){return Ls=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},Ls(e,n)};function ks(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}Ls(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}function Ps(e,n,t,a){return new(t||(t=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,s)}l((a=a.apply(e,n||[])).next())}))}function Ms(e,n){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=n.call(e,r)}catch(e){o=[6,e],a=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Ds,js=function(e,n){void 0===n&&(n=[]);var t=n.join(","),a=new Blob(["("+e+")("+t+");"],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(a)};!function(e){e.IE="IE",e.Safari="Safari",e.Chrome="Chrome",e.Edge="Edge",e.Firefox="Firefox",e.Yandex="Yandex",e.Opera="Opera",e.Sferum="Sferum"}(Ds||(Ds={}));var Rs,Zs,Bs,Us,Hs,Vs,Gs,Fs=(Rs=navigator.appVersion,Zs=navigator.appName,Bs=navigator.userAgent,Us=[],function(){return Us.length?Us:Us=function(){var e,n=!1,t=0,a=Bs.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1]))return e=/\brv[ :]+(\d+)/g.exec(Bs),[Ds.IE,e&&e[1]||"Unknown",n,t];if("Safari"===a[1]){if(e=Bs.match(/\bEdge\/(\d+)/))return[Ds.Edge,e[1]||"Unknown",n,t];if(e=Bs.match(/\bCriOS\/(\d+)/))return[Ds.Chrome,e[1],!0,+e[1]];if(e=Bs.match(/\bFxiOS\/(\d+)/))return[Ds.Firefox,e[1],!1,t];if(e=Bs.match(/\bYaBrowser\/(\d+)/))return[Ds.Yandex,e[1],!1,t];if(e=Bs.match(/\bOPT\/(\d+)/))return[Ds.Opera,e[1],!1,t]}if(a[1]===Ds.Chrome){if(n=!0,t=Number(a[2]),e=Bs.match(/\bOPR\/(\d+)/))return[Ds.Opera,e[1]||"Unknown",n,t];if(e=Bs.match(/\bYaBrowser\/(\d+)/))return[Ds.Yandex,e[1]||"Unknown",n,t];if(e=Bs.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return[Ds.Sferum,e[1]||"Unknown",n,t];if(e=Bs.match(/\bEdge?\/(\d+)/))return[Ds.Edge,e[1]||"Unknown",n,t];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return[Ds.Opera,"Hidden",n,t]}return e=Bs.match(/version\/(\d+)/i),[a[2]?a[1]:Zs,e&&e[1]||a[2]||Rs,n,t]}()}),Ws=function(e){return Ps(void 0,void 0,void 0,(function(){return Ms(this,(function(n){return[2,new Promise((function(n,t){var a=document.createElement("img");a.crossOrigin="anonymous",a.onerror=function(e){t("Failed image loading: "+e)},a.onload=function(){return n(a)},a.src=e}))]}))}))},zs=function(){function e(){this._backgroundCanvas=document.createElement("canvas")}return e.prototype.resize=function(e,n,t,a){var i,o,r=(void 0===a?{}:a).ctxOptions,s=(o={width:0,height:0},"number"==typeof(i=e).width&&"number"==typeof i.height&&(o.height=i.height,o.width=i.width),o),l=s.height,c=s.width,d=this._backgroundCanvas,u=d.getContext("2d",r);if(!u)throw new Error("ctx did not initialized");d.width=n,d.height=t;var _=Math.max(d.width/c,d.height/l),v=d.width/2-c/2*_,h=d.height/2-l/2*_;return u.drawImage(e,v,h,c*_,l*_),d},e}(),Ks=(Hs=function(e,n){e.exports=function(e){var n,t,a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,a){n=e,t=a}));var o,r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var s="./this.program",l=function(e,n){throw n},c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),void 0!==a&&a&&(c=a),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var d,u=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);r=null,i.arguments,i.thisProgram&&(s=i.thisProgram),i.quit&&(l=i.quit),i.wasmBinary&&(d=i.wasmBinary);var v,h=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&k("no native wasm support detected");var p,f,m,A,g,C=!1,E="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function S(e,n,t){for(var a=n+t,i=n;e[i]&&!(i>=a);)++i;if(i-n>16&&e.subarray&&E)return E.decode(e.subarray(n,i));for(var o="";n<i;){var r=e[n++];if(128&r){var s=63&e[n++];if(192!=(224&r)){var l=63&e[n++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[n++])<65536)o+=String.fromCharCode(r);else{var c=r-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&r)<<6|s)}else o+=String.fromCharCode(r)}return o}function T(e){p=e,i.HEAP8=f=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=A=new Int32Array(e),i.HEAPU8=m=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var I,x,N,y=[],b=[],O=[],w=0,L=null;function k(e){i.onAbort&&i.onAbort(e),_(e+=""),C=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(e);throw t(n),n}function P(e){return e.startsWith("data:application/octet-stream;base64,")}function M(e){try{if(e==I&&d)return new Uint8Array(d);throw"both async and sync fetching of the wasm failed"}catch(e){k(e)}}function D(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var t=n.func;"number"==typeof t?void 0===n.arg?g.get(t)():g.get(t)(n.arg):t(void 0===n.arg?null:n.arg)}else n(i)}}function j(e){try{return v.grow(e-p.byteLength+65535>>>16),T(v.buffer),1}catch(e){}}i.preloadedImages={},i.preloadedAudios={},P(I="https://st.mycdn.me/static/callseffects/0-0-3/tflite-simd.wasm")||(x=I,I=i.locateFile?i.locateFile(x,c):c+x),N=function(){return performance.now()};var R={};function Z(){if(!Z.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var n in R)void 0===R[n]?delete e[n]:e[n]=R[n];var t=[];for(var n in e)t.push(n+"="+e[n]);Z.strings=t}return Z.strings}var B={mappings:{},buffers:[null,[],[]],printChar:function(e,n){var t=B.buffers[e];0===n||10===n?((1===e?u:_)(S(t,0)),t.length=0):t.push(n)},varargs:void 0,get:function(){return B.varargs+=4,A[B.varargs-4>>2]},getStr:function(e){var n=function(e,n){return e?S(m,e,void 0):""}(e);return n},get64:function(e,n){return e}},U={a:function(){k()},m:function(e,n){var t;if(0===e)t=Date.now();else{if(1!==e&&4!==e)return 28,A[V()>>2]=28,-1;t=N()}return A[n>>2]=t/1e3|0,A[n+4>>2]=t%1e3*1e3*1e3|0,0},i:function(e,n){k("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},c:function(e,n){k("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},g:function(){return 2147483648},k:function(e,n,t){m.copyWithin(e,n,n+t)},l:function(e){var n,t=m.length,a=2147483648;if((e>>>=0)>a)return!1;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),j(Math.min(a,((n=Math.max(e,o))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},d:function(e){for(var n=N();N()-n<e;);},e:function(e,n){var t=0;return Z().forEach((function(a,i){var o=n+t;A[e+4*i>>2]=o,function(e,n,t){for(var a=0;a<e.length;++a)f[n++>>0]=e.charCodeAt(a);f[n>>0]=0}(a,o),t+=a.length+1})),0},f:function(e,n){var t=Z();A[e>>2]=t.length;var a=0;return t.forEach((function(e){a+=e.length+1})),A[n>>2]=a,0},o:function(e){!function(e,n){var t;t=e,h||(i.onExit&&i.onExit(t),C=!0),l(t,new G(t))}(e)},h:function(e){return 0},j:function(e,n,t,a,i){},b:function(e,n,t,a){for(var i=0,o=0;o<t;o++){for(var r=A[n+8*o>>2],s=A[n+(8*o+4)>>2],l=0;l<s;l++)B.printChar(e,m[r+l]);i+=s}return A[a>>2]=i,0},n:function e(n,t){e.randomDevice||(e.randomDevice=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){k("randomDevice")}}());for(var a=0;a<t;a++)f[n+a>>0]=e.randomDevice();return 0}};!function(){var e={a:U};function n(e,n){var t,a=e.exports;i.asm=a,T((v=i.asm.p).buffer),g=i.asm.A,t=i.asm.q,b.unshift(t),function(e){if(w--,i.monitorRunDependencies&&i.monitorRunDependencies(w),0==w&&L){var n=L;L=null,n()}}()}function a(e){n(e.instance)}function o(n){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return M(I)})):fetch(I,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+I+"'";return e.arrayBuffer()})).catch((function(){return M(I)}))).then((function(n){return WebAssembly.instantiate(n,e)})).then((function(e){return e})).then(n,(function(e){_("failed to asynchronously prepare wasm: "+e),k(e)}))}if(w++,i.monitorRunDependencies&&i.monitorRunDependencies(w),i.instantiateWasm)try{return i.instantiateWasm(e,n)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||P(I)||"function"!=typeof fetch?o(a):fetch(I,{credentials:"same-origin"}).then((function(n){return WebAssembly.instantiateStreaming(n,e).then(a,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(a)}))}))).catch(t)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.q).apply(null,arguments)},i._setNumThreads=function(){return(i._setNumThreads=i.asm.r).apply(null,arguments)},i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.u).apply(null,arguments)},i._getInputDim=function(){return(i._getInputDim=i.asm.v).apply(null,arguments)},i._getOutputDim=function(){return(i._getOutputDim=i.asm.w).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.x).apply(null,arguments)},i._updateRecurrentState=function(){return(i._updateRecurrentState=i.asm.y).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.z).apply(null,arguments)};var H,V=i.___errno_location=function(){return(V=i.___errno_location=i.asm.B).apply(null,arguments)};function G(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function F(e){function t(){H||(H=!0,i.calledRun=!0,C||(D(b),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),O.unshift(e);var e;D(O)}()))}w>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),y.unshift(e);var e;D(y)}(),w>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(L=function e(){H||F(),H||(L=e)},i.run=F,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return F(),e.ready}},Hs(Vs={exports:{}}),Vs.exports),Qs="https://st.mycdn.me/static/callseffects",Ys=Qs+"/0-0-3",Js=Qs+"/0-0-5",Xs=Qs+"/0-0-6",qs=Qs+"/0-0-8",$s=Qs+"/0-0-9",el={segmentation:{models:{"192x256":Ys+"/segmentation-model.tflite"},wasm:{tfliteSimd:Ys+"/tflite-simd.wasm"}},backgrounds:[{id:3012,preview:Js+"/3012-preview.png",original:Js+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:Js+"/3013-preview.png",original:Js+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:Js+"/3014-preview.png",original:Js+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:Js+"/3015-preview.png",original:Js+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:Js+"/3016-preview.png",original:Js+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:Js+"/3017-preview.png",original:Js+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:Js+"/3018-preview.png",original:Js+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:Js+"/3019-preview.jpg",original:Js+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:Js+"/3020-preview.jpg",original:Js+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:Js+"/3021-preview.jpg",original:Js+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:Js+"/3022-preview.jpg",original:Js+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:Js+"/3023-preview.jpg",original:Js+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:Js+"/3024-preview.jpg",original:Js+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:Js+"/3025-preview.jpg",original:Js+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:Js+"/3026-preview.jpg",original:Js+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:Js+"/3027-preview.jpg",original:Js+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:Xs+"/3028-preview.jpeg",original:Xs+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:qs+"/3029-preview.jpg",original:qs+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:$s+"/3030-preview.jpg",original:$s+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]}],icons:{starBackground:{id:"icon-star-background",description:"Icon for indicating that virtual background is from stars",url:Js+"/icon-star-background.svg",type:"svg"}}},nl=function(){function e(){}return e.workerFn=function(e){console.log("here goes the worker...");var n=null,t=!1,a={"192x256":[192,256]},i={processSizeKey:"192x256",inputMemoryOffset:0,outputMemoryOffset:0,maskArray:null,numThreads:2},o=function(){c.call(null,"log",Array.from(arguments))},r=function(){c.call(null,"warn",Array.from(arguments))};function s(s,c,d){return void 0===c&&(c={}),void 0===d&&(d=!1),t=d,o("[createModel]",s,c,{debugFlag:d}),e().then((function(e){return function(e,n){return o("[loadModel][modelPath]",e,n),fetch(n).then((function(e){return e.arrayBuffer()})).then((function(n){o("Model buffer size:",n.byteLength);var t=i.numThreads,a=e._getModelBufferMemoryOffset();return o("Model buffer memory offset:",a),o("Loading model buffer..."),e.HEAPU8.set(new Uint8Array(n),a),o("_loadModel result:",e._loadModel(n.byteLength,t)),{inputMemoryOffset:e._getInputMemoryOffset(0)/4,outputMemoryOffset:e._getOutputMemoryOffset(0)/4}}))}(e,s).then((function(t){return n=e,t}))})).then((function(e){var n=c.processSizeKey||i.processSizeKey,t=a[n],o=t[0],r=t[1],s=new Float32Array(o*r);l(Object.assign({maskArray:s},e,c))})).catch((function(e){n=null,r("simd error",e),self.postMessage({type:"error",error:e})}))}function l(e){Object.assign(i,e),o("settings updated",i)}function c(e,n){if(void 0===e&&(e="log"),"function"==typeof console[e]&&t){var a=["[segmentation-worker]"].concat(n);console[e].apply(null,a)}}self.onmessage=function(e){try{switch(e.data.type){case"create":s(e.data.modelPath,e.data.settings,e.data.debug).then((function(){self.postMessage({type:"ready"})}));break;case"frame":var t=function(e){var t=i.maskArray,o=i.inputMemoryOffset,s=i.outputMemoryOffset,l=a[i.processSizeKey],c=l[0],d=l[1];if(n){if(t){for(var u=0,_=0;u<c*d;u++,_+=4)n.HEAPF32[o+_]=e.data[_]/255,n.HEAPF32[o+_+1]=e.data[_+1]/255,n.HEAPF32[o+_+2]=e.data[_+2]/255,n.HEAPF32[o+_+3]=t[u];n._runInference(),n._updateRecurrentState(1,1);var v=new ImageData(d,c);for(u=0,_=0;u<c*d;u++,_+=4)t[u]=n.HEAPF32[s+u],v.data[_+3]=255*t[u];return v}r("no maskArray created")}else r("no tfliteSIMD instance!")}(e.data.imageData);t&&self.postMessage({type:"frame",segmentationMask:t,resizedImage:e.data.imageData},[t.data.buffer,e.data.imageData.data.buffer]);break;case"params":l(e.data.params);break;default:r("unhandled event",e.data)}}catch(e){r("onmessage error",e),self.postMessage({type:"error",error:e})}}},e}(),tl=function(){function e(e){var n=this,t=e.onFrame,a=e.onReady,i=e.onError;this._settings={modelKey:"192x256",processSizeKey:"192x256"},this._processSize={"192x256":[192,256]},this._worker=null,this._worker=new Worker(js(nl.workerFn,[Ks,JSON.stringify({})])),this._worker.onmessage=function(e){switch(e.data.type){case"ready":a(n);break;case"frame":t({image:n._canvasImageBackup,resizedImage:e.data.resizedImage,segmentationMask:e.data.segmentationMask});break;case"error":null==i||i(e.data);break;default:console.warn("unhandled event type",e.data)}},this._canvas=document.createElement("canvas"),this._canvasImageBackup=document.createElement("canvas");var o=this._canvas.getContext("2d"),r=this._canvasImageBackup.getContext("2d");if(!o||!r)throw new Error("can't get ctx for canvas");this._ctx=o,this._ctxImageBackup=r}return e.prototype.createModel=function(e){var n,t=this._settings,a=el.segmentation.models[t.modelKey];null===(n=this._worker)||void 0===n||n.postMessage({type:"create",modelPath:a,settings:t,debug:e})},e.prototype.setParams=function(e){var n=this._worker,t=this._settings;Object.assign(t,e),null==n||n.postMessage({type:"params",params:t})},e.prototype.requestSegmentation=function(e){var n=this,t=n._settings,a=n._canvas,i=n._ctx,o=n._worker,r=n._processSize[t.processSizeKey],s=r[0],l=r[1];this._saveImage(e),a.width=l,a.height=s,i.drawImage(e,0,0,l,s);var c=i.getImageData(0,0,l,s);null==o||o.postMessage({type:"frame",imageData:c},[c.data.buffer])},e.prototype._saveImage=function(e){var n=this._ctxImageBackup,t=this._canvasImageBackup,a=function(e){var n={height:0,width:0};return"number"==typeof e.height?n.height=e.height:n.height=e.height.baseVal.value,"number"==typeof e.width?n.width=e.width:n.width=e.width.baseVal.value,n}(e),i=a.height,o=a.width;t.height=i,t.width=o,n.clearRect(0,0,o,i),n.drawImage(e,0,0,o,i)},e.prototype.destroy=function(){this._worker&&(this._worker.terminate(),this._worker=null)},e}(),al=function(){function e(){}return e.updateSegmentationParams=function(n){Object.assign(e._params.segmentation,n)},e.getSegmentationParams=function(){return e._params.segmentation},e.setDebug=function(n){e._params.debug=n},e.getDebug=function(){return!!e._params.debug},e._params={segmentation:{processSizeKey:"192x256",modelKey:"192x256"}},e}(),il=function(){function e(){this._timeouts=new Map,this._throttles=new Map,this._worker=new Worker(js(e.workerFn))}return e.prototype.initWorker=function(e){var n=void 0===e?{}:e,t=n.onError,a=n.onTimeout,i=n.onThrottle,o=n.onReady;return Ps(this,void 0,void 0,(function(){var e=this;return Ms(this,(function(n){return[2,new Promise((function(n,r){e._worker.addEventListener("message",(function(s){switch(s.data.type){case"timeout":e._callTimeout(s.data.id),null==a||a(s.data);break;case"throttle":e._callThrottle(s.data.id),null==i||i(s.data);break;case"error":null==t||t(s.data),r(s.data);break;case"ready":null==o||o(s.data),n()}})),e._worker.addEventListener("error",(function(e){null==t||t(e),r(e)})),e._worker.postMessage({type:"ready"})}))]}))}))},e.workerFn=function(){var e=new Map,n=new Map;self.onmessage=function(t){switch(t.data.type){case"timeout":!function(n,t){void 0===t&&(t=5);var a=setTimeout((function(){self.postMessage({type:"timeout",id:n}),e.delete(n)}),t);e.set(n,a)}(t.data.id,t.data.ms);break;case"throttle":!function(e,t){void 0===t&&(t=5);var a=n.get(e);a&&clearTimeout(a);var i=setTimeout((function(){self.postMessage({type:"throttle",id:e}),n.delete(e)}),t);n.set(e,i)}(t.data.id,t.data.ms);break;case"ready":self.postMessage({type:"ready"});break;default:self.postMessage({type:"error",data:t.data})}},self.postMessage({type:"ready"})},e.prototype.postTimeout=function(e,n,t){void 0===t&&(t=5),this._timeouts.set(e,n),this._worker.postMessage({type:"timeout",id:e,ms:t})},e.prototype.postThrottle=function(e,n,t){void 0===t&&(t=5),this._throttles.set(e,n),this._worker.postMessage({type:"throttle",id:e,ms:t})},e.prototype._callTimeout=function(e){var n=this._timeouts.get(e);n&&(this._timeouts.delete(e),n())},e.prototype._callThrottle=function(e){var n=this._throttles.get(e);n&&(this._throttles.delete(e),n())},e.prototype.destroy=function(){this._worker.terminate(),this._throttles.clear(),this._timeouts.clear()},e}();!function(e){e.NONE="none",e.BLUR="blur",e.BACKGROUND="background"}(Gs||(Gs={}));var ol=function(){function e(e){var n=void 0===e?{}:e,t=n.segmentation,a=n.debug;this._effect=null,this._net=null,this._video=null,this._canvas=null,this._stream=null,this._track=null,this._sendNextFrame=null,this._timerWorker=null,t&&al.updateSegmentationParams(t),a&&al.setDebug(a)}return e.prototype._createDom=function(e){var n=function(e){var n,t,a=e.defaults,i=e.track,o=i.getSettings(),r=i.getConstraints(),s=a;return t=["width","height"],"object"==typeof(n=o)&&(Array.isArray(t)?t.every((function(e){return e in n})):t in n)||!function(e){return"object"==typeof e?Array.isArray(e)?!e.length:!Object.keys(e).length:"string"==typeof e?!e.length:!e}(r)?(o.height?s.height=o.height:"number"==typeof r.height?s.height=r.height:"object"==typeof r.height&&(s.height=r.height.exact||r.height.ideal||r.height.max||r.height.min||s.height),o.width?s.width=o.width:"number"==typeof r.width?s.width=r.width:"object"==typeof r.width&&(s.width=r.width.exact||r.width.ideal||r.width.max||r.width.min||s.width),s):s}({track:e,defaults:{height:360,width:640}}),t=n.width,a=n.height;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.height=a,this._canvas.width=t,this._canvas.style.bottom="0",this._canvas.style.left="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas)),this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.height=a,this._video.width=t,this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},e.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvas=null,this._video=null},e.prototype._createStream=function(e){return Ps(this,void 0,void 0,(function(){var n=this;return Ms(this,(function(t){if(!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._stream=this._canvas.captureStream(0),[2,new Promise((function(t,a){var i=n._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(){var e;i.width=i.videoWidth,i.height=i.videoHeight,n._track=null===(e=n._stream)||void 0===e?void 0:e.getVideoTracks()[0],t()},i.onerror=function(){return a(new Error("Video element error"))};var o=i.play(),r=function(){return a(new Error("Autoplay is disabled"))};o?o.catch(r):r()}))]}))}))},e.prototype._createNet=function(){return Ps(this,void 0,void 0,(function(){var e=this;return Ms(this,(function(n){return[2,new Promise((function(n,t){var a=al.getDebug()?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn.apply(console,e),t()}:void 0;new tl({onFrame:function(n){e._drawFrame(n)},onReady:n,onError:a}).createModel(al.getDebug())}))]}))}))},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),this._video.srcObject=null)},e.prototype._drawFrame=function(e){var n,t=this;this._net&&this._video&&this._effect&&this._canvas&&this._video&&this._effect&&(this._effect.draw(e),this._track&&(this._track.requestFrame(),null===(n=this._timerWorker)||void 0===n||n.postTimeout(Date.now(),(function(){t._video&&t._sendNextFrame&&t._sendNextFrame(t._video)}))))},e.prototype._cleanup=function(e){var n=void 0===e?{}:e,t=n.removeWorkerNet,a=n.removeWorkerTimer;this._effect&&(this._effect.destroy(),this._effect=null),this._removeStream(),this._removeDom(),t&&this._net&&(this._net.destroy(),this._net=null),a&&this._timerWorker&&(this._timerWorker.destroy(),this._timerWorker=null)},e.prototype._setEffect=function(e,n){return Ps(this,void 0,void 0,(function(){var t,a=this;return Ms(this,(function(i){switch(i.label){case 0:return this._timerWorker?[3,2]:(this._timerWorker=new il,[4,this._timerWorker.initWorker()]);case 1:i.sent(),i.label=2;case 2:return this._net?[3,4]:(t=this,[4,this._createNet()]);case 3:t._net=i.sent(),i.label=4;case 4:return this._effect&&(this._effect=null),this._sendNextFrame=function(e){var n;null===(n=a._timerWorker)||void 0===n||n.postThrottle("img-segm",(function(){var n;null===(n=a._net)||void 0===n||n.requestSegmentation(e)}),1e3/60)},this._removeStream(),this._createDom(n),[4,this._createStream(n)];case 5:if(i.sent(),!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._effect=e,this._effect.video=this._video,this._effect.canvas=this._canvas,this._sendNextFrame(this._video),[2]}}))}))},e.prototype.setEffect=function(e,n){var t;return Ps(this,void 0,void 0,(function(){var a;return Ms(this,(function(i){switch(i.label){case 0:if(!e)return this._cleanup(),[2,n];e.effect!==(null===(t=this._effect)||void 0===t?void 0:t.effect)&&e.destroy(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._setEffect(e,n)];case 2:return i.sent(),[2,this._track||n];case 3:throw a=i.sent(),this._cleanup(),a;case 4:return[2]}}))}))},e.prototype.stopEffect=function(){this._cleanup()},Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect?this._effect.effect:Gs.NONE},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._cleanup({removeWorkerNet:!0,removeWorkerTimer:!0})},e}(),rl=function(e){var n=e.gl,t=e.fs,a=e.vs,i=n.createShader(n.VERTEX_SHADER);if(!i)throw new Error("vertex shader didn't initialized");n.shaderSource(i,a),n.compileShader(i);var o=n.createShader(n.FRAGMENT_SHADER);if(!o)throw new Error("fragment shader didn't initialized");n.shaderSource(o,t),n.compileShader(o);var r=n.createProgram();if(!r)throw new Error("shader program didn't initialized");if(n.attachShader(r,i),n.attachShader(r,o),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r);return n.deleteShader(i),n.deleteShader(o),{program:r}},sl=function(e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),n},ll=function(e,n,t){var a=sl(e);if(!a)throw new Error("texture was not created");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null);var i=e.createFramebuffer();if(!i)throw new Error("framebuffer was not created");return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),{framebuffer:i,texture:a}},cl=function(e,n,t,a){e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},dl=function(e,n){e.bindFramebuffer(e.FRAMEBUFFER,n),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null)},ul=function(e,n){return{aTextureCoord:e.getAttribLocation(n,"aTextureCoord"),aVertexCoord:e.getAttribLocation(n,"aVertexCoord")}},_l="attribute vec3 aVertexCoord;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexCoord, 1.0);\n  vTextureCoord = aTextureCoord;\n}",vl=function(){function e(e){var n=this;this.gl=e,this.program=rl({fs:"precision highp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uAlphaTexture;\nuniform float uLowerBound;\nuniform float uUpperBound;\n\nvoid main(void) {\n  vec4 color = texture2D(uAlphaTexture, vTextureCoord);\n  if (color.a < uLowerBound) {\n    color.a = 0.0;\n  } else {\n    if (color.a < uUpperBound) {\n      color.a = (color.a - uLowerBound) / (uUpperBound - uLowerBound);\n    } else {\n      color.a = 1.0;\n    }\n  }\n  gl_FragColor = color;\n}",gl:e,vs:_l}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uLowerBound:function(e){var t=n.gl.getUniformLocation(n.program,"uLowerBound");n.gl.uniform1f(t,e)},uUpperBound:function(e){var t=n.gl.getUniformLocation(n.program,"uUpperBound");n.gl.uniform1f(t,e)}},this.attributes=ul(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),hl=function(){function e(e){var n=this;this.gl=e,this.program=rl({fs:"precision highp float;\n\nuniform sampler2D uCameraFrameTexture;\nuniform sampler2D uBackgroundTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 cameraFrameColor = texture2D(uCameraFrameTexture, vTextureCoord);\n  vec4 backgroundColor = texture2D(uBackgroundTexture, vTextureCoord);\n  vec4 alphaMask = texture2D(uAlphaTexture, vTextureCoord);\n  gl_FragColor = mix(backgroundColor, cameraFrameColor, alphaMask.a);\n}",gl:e,vs:_l}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uCameraFrameTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uCameraFrameTexture");n.gl.uniform1i(t,e)},uBackgroundTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uBackgroundTexture");n.gl.uniform1i(t,e)}},this.attributes=ul(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),pl=function(){function e(e){var n=this;this.gl=e,this.program=rl({fs:"// https://github.com/Jam3/glsl-fast-gaussian-blur\n\nprecision highp float;\n\nuniform sampler2D texture;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color;\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor = blur13(texture, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={texture:function(e){var t=n.gl.getUniformLocation(n.program,"texture");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),fl=function(){function e(e){var n=this;this.gl=e,this.program=rl({fs:"precision highp float;\n\nuniform sampler2D uTextureOriginal;\nuniform sampler2D uTextureMask;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur13(sampler2D image, sampler2D maskTexture, vec2 uv, vec2 resolution,\n            vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  float sumCof = 0.0;\n\n  vec4 c = texture2D(image, uv);\n  vec4 m = texture2D(maskTexture, uv);\n  color += c * 0.1964825501511404 * (1.0 - m.a);\n  sumCof += 0.1964825501511404 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off1 / resolution));\n  m = texture2D(maskTexture, uv + (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off1 / resolution));\n  m = texture2D(maskTexture, uv - (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off2 / resolution));\n  m = texture2D(maskTexture, uv + (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off2 / resolution));\n  m = texture2D(maskTexture, uv - (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off3 / resolution));\n  m = texture2D(maskTexture, uv + (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off3 / resolution));\n  m = texture2D(maskTexture, uv - (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  return sumCof > 0.0 ? color / sumCof : vec4(0.0, 0.0, 0.0, 0.0);\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor =\n      blur13(uTextureOriginal, uTextureMask, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={uTextureOriginal:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureOriginal");n.gl.uniform1i(t,e)},uTextureMask:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureMask");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),ml=function(){function e(e){this.textures={background:null,image:null,resizedImage:null,segmentationMask:null},this.parameters={blurStrength:.8,fixSegmentation:!0,fixSegmentationBlurStrength:.25,fixSegmentationIterations:8,alphaCutterLowerBound:.4,alphaCutterUpperBound:.6},this.$canvas=e;var n=this.$canvas.getContext("webgl");if(!n)throw new Error("getting ctx failed");this.gl=n;var t=this.gl;this.onresize=this.onresize.bind(this),this.onresize(),this.pBlurFastWithMask=new fl(this.gl),this.pBackgroundComposer=new hl(this.gl),this.pBlurFast=new pl(this.gl),this.pAlphaCutter=new vl(this.gl),this.vertices=[1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0,-1,1,0,0,1],this.indices=[0,1,3,1,2,3];var a=t.createBuffer(),i=t.createBuffer();if(!a||!i)throw new Error("create buffer error");this.positionBuffer=a,this.indexBuffer=i,t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.fbs={blur:this.createTextureLayers(),segmentationFix:this.createTextureLayers()},this.textures={background:sl(t),image:sl(t),resizedImage:sl(t),segmentationMask:sl(t)},window.addEventListener("resize",this.onresize)}return e.prototype.onresize=function(){var e=this,n=e.$canvas,t=e.gl,a=e.fbs,i=n.width||n.clientWidth,o=n.height||n.clientHeight;n.width=i,n.height=o,t.viewport(0,0,i,o),a&&function(e,n){for(var t=n.height,a=n.width,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];i.forEach((function(n){n.forEach((function(n){dl(e,n.framebuffer),cl(e,n.texture,a,t)}))}))}(t,{width:i,height:o},a.blur,a.segmentationFix)},e.prototype.loadTextures=function(e){var n=e.image,t=e.resizedImage,a=e.segmentationMask,i=e.background,o=this.gl,r=this.textures;return o.bindTexture(o.TEXTURE_2D,r.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),i||(o.bindTexture(o.TEXTURE_2D,r.resizedImage),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),o.bindTexture(o.TEXTURE_2D,r.segmentationMask),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),i&&(o.bindTexture(o.TEXTURE_2D,r.background),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i)),o.bindTexture(o.TEXTURE_2D,null),r},e.prototype.close=function(){var e=this,n=e.gl,t=e.positionBuffer,a=e.indexBuffer,i=e.pBackgroundComposer,o=e.pBlurFast,r=e.pBlurFastWithMask,s=e.pAlphaCutter,l=e.fbs,c=e.textures;window.removeEventListener("resize",this.onresize),n.bindBuffer(n.ARRAY_BUFFER,null),n.deleteBuffer(t),n.deleteBuffer(a),n.useProgram(null),i.destroy(),o.destroy(),r.destroy(),s.destroy(),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){n.forEach((function(n){e.deleteFramebuffer(n.framebuffer),e.deleteTexture(n.texture)}))}))}(n,l.blur,l.segmentationFix),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){return e.deleteTexture(n)}))}(n,c.background,c.image,c.resizedImage,c.segmentationMask)},e.prototype.drawGeometry=function(){var e=this,n=e.gl,t=e.indexBuffer,a=e.indices;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.drawElements(n.TRIANGLES,a.length,n.UNSIGNED_SHORT,0)},e.prototype.createTextureLayers=function(){var e=this.gl,n=this.$canvas,t=n.width,a=n.height;return[ll(e,t,a),ll(e,t,a)]},e.prototype.setGeometry=function(e,n){var t=this.gl,a=this.positionBuffer;t.bindBuffer(t.ARRAY_BUFFER,a),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,3,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),void 0!==n&&(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT))},e.prototype.setParameters=function(e){Object.assign(this.parameters,e)},e.prototype.draw=function(e){var n,t,a=this,i=a.gl,o=a.$canvas,r=a.parameters,s=a.pBlurFastWithMask,l=a.pBackgroundComposer,c=a.pBlurFast,d=a.pAlphaCutter,u=a.fbs,_=r.fixSegmentation,v=r.fixSegmentationBlurStrength,h=r.blurStrength,p=r.fixSegmentationIterations,f=r.alphaCutterLowerBound,m=r.alphaCutterUpperBound,A=o.width,g=o.height;i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,A,g),i.disable(i.BLEND),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var C=this.loadTextures(e),E=null,S=e.background?C.background:null;if(_){c.bind(),this.setGeometry(c.attributes.position),c.uniforms.iResolution(A,g,0),c.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,C.segmentationMask),c.uniforms.texture(0);for(var T=0,I=0;I<p;++I){var x=(p-I-1)*v,N=I%2==0?[x,0]:[0,x];(n=c.uniforms).direction.apply(n,N),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),i.bindTexture(i.TEXTURE_2D,u.segmentationFix[T%2].texture),++T}d.bind(),this.setGeometry(d.attributes.aVertexCoord,d.attributes.aTextureCoord),d.uniforms.uLowerBound(f),d.uniforms.uUpperBound(m),d.uniforms.uAlphaTexture(0),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),E=u.segmentationFix[T%2].texture}if(!S){s.bind(),this.setGeometry(s.attributes.position),s.uniforms.iResolution(A,g,0),s.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),s.uniforms.uTextureMask(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,C.resizedImage),s.uniforms.uTextureOriginal(1);var y=0;for(I=0;I<8;++I)x=(8-I-1)*h,N=I%2==0?[x,0]:[0,x],(t=s.uniforms).direction.apply(t,N),i.bindFramebuffer(i.FRAMEBUFFER,u.blur[y%2].framebuffer),this.drawGeometry(),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u.blur[y%2].texture),++y;S=u.blur[(y-1)%2].texture}l.bind(),this.setGeometry(l.attributes.aVertexCoord,l.attributes.aTextureCoord),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),l.uniforms.uAlphaTexture(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,S),l.uniforms.uBackgroundTexture(1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,C.image),l.uniforms.uCameraFrameTexture(2),i.bindFramebuffer(i.FRAMEBUFFER,null),this.drawGeometry()},e}(),Al=function(){function e(e){this._effect=e}return Object.defineProperty(e.prototype,"video",{set:function(e){this._video=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),gl=function(e){function n(){var n=e.call(this,Gs.BACKGROUND)||this;return n._imageEdit=new zs,n._WebGlBlend=null,n}return ks(n,e),n.prototype.setBackgroundImage=function(e){return Ps(this,void 0,void 0,(function(){var n,t;return Ms(this,(function(a){switch(a.label){case 0:return n=this,e?[4,Ws(e)]:[3,2];case 1:return t=a.sent(),[3,3];case 2:t=void 0,a.label=3;case 3:return n._nextBackgroundImage=t,[2]}}))}))},n.prototype._updateBackground=function(){try{if(this._nextBackgroundImage){var e=this._canvas,n=this._imageEdit,t=e.width,a=e.height;this._backgroundImage=n.resize(this._nextBackgroundImage,t,a),delete this._nextBackgroundImage}}catch(e){console.warn(e)}},n.prototype.draw=function(e){try{if(this._WebGlBlend||(this._WebGlBlend=new ml(this._canvas)),this._nextBackgroundImage&&this._updateBackground(),this._WebGlBlend){var n=Object.assign({background:this._backgroundImage},e);this._WebGlBlend.draw(n)}}catch(e){console.warn(e)}},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGlBlend&&(this._WebGlBlend.close(),this._WebGlBlend=null)},n}(Al),Cl=function(e){function n(){var n=e.call(this,Gs.BLUR)||this;return n._WebGLEffects=null,n._savedOptions=null,n}return ks(n,e),n.prototype.draw=function(e){try{this._WebGLEffects||(this._WebGLEffects=new ml(this._canvas),this._savedOptions&&this._WebGLEffects.setParameters(this._savedOptions)),this._WebGLEffects.draw(e)}catch(e){console.warn(e)}},n.prototype.setEffects=function(e){this._savedOptions=e,this._WebGLEffects&&this._WebGLEffects.setParameters(e)},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGLEffects&&(this._WebGLEffects.close(),this._WebGLEffects=null)},n}(Al),El=function(){function e(e){this.params=e}return e.prototype.getMappedParams=function(){return{id:this.params.id,originalUrl:this.params.original,previewUrl:this.params.preview,isPredefined:!0,tags:this.params.tags}},e}(),Sl=[{audio:!1,video:{frameRate:25,height:250,width:436}},{audio:!1,video:{frameRate:25}},{audio:!1,video:!0}],Tl=function(){var e,n,t=new Map;[3030,3029,3028,3019,3026,3027,3023,3024,3025,3020,3021,3022,3015,3013,3016,3012,3014,3017,3018].forEach((function(e){return t.set(e,null)}));try{for(var a=(0,i.__values)(el.backgrounds),o=a.next();!o.done;o=a.next()){var r=o.value;t.has(r.id)&&t.set(r.id,new El(r))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return(0,i.__spreadArray)([],(0,i.__read)(t.values()),!1).filter(Boolean)}(),Il=function(e){var n;return null===(n=e.sizes)||void 0===n?void 0:n.reduce((function(e,n){return e[n.type]=n.url,e}),{})},xl=function(e){var n=Il(e);return(null==n?void 0:n.x)||(null==n?void 0:n.m)||(null==n?void 0:n.s)||""},Nl=function(e,n){if(n){var t=n.find((function(n){return n.id===e}));if(t)return Promise.resolve({id:t.id,url:t.originalUrl})}return(0,sn.photosGetAllImages)({photo_ids:""+e}).then((function(e){try{var n=e.items[0];return n?{id:n.id,url:xl(n)}:null}catch(e){return null}}))},yl=t(71982),bl=function(e){var n=e.children,t=e.className,a=e.style,r=e.passedRef,c=(0,i.__rest)(e,["children","className","style","passedRef"]),d=(0,l.useCallback)((function(){}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)(t),style:a,ref:r},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__item--radio"},{children:(0,o.jsx)(yl.default,(0,i.__assign)({},c,{onChange:d}),void 0)}),void 0)]},void 0)},Ol=(0,l.memo)((function(e){var n=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(bl,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--with-border")},{children:n("calls_virtual_background_settings_no_background")}),void 0)})),wl=(0,l.memo)((function(e){return(0,o.jsx)(bl,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--blur")}),void 0)})),Ll=t(45898),kl=(0,l.memo)((function(){return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--add-image")},{children:(0,o.jsx)(Ll.default,{},void 0)}),void 0)})),Pl=(0,l.forwardRef)((function(e,n){var t=(0,i.__rest)(e,[]);return(0,o.jsx)("div",(0,i.__assign)({},t,{ref:n,style:{width:18,height:18}},{children:(0,o.jsxs)("svg",(0,i.__assign)({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("rect",{width:"18",height:"18",rx:"2",fill:"black",fillOpacity:"0.4"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.10202 5L5 6.10202L7.89798 9L5 11.898L6.10202 13L9 10.102L11.898 13L13 11.898L10.102 9L13 6.10202L11.898 5L9.10108 7.7969L9 7.89798L6.10202 5Z",fill:"white",fillOpacity:"0.72"},void 0)]}),void 0)}),void 0)})),Ml=t(54190),Dl=(0,l.memo)((function(e){var n=e.backgroundUrl,t=e.checked,a=e.onDelete,r=e.photoId,c=e.isPredefinedBackground,d=e.isStarBackground,u=(0,i.__rest)(e,["backgroundUrl","checked","onDelete","photoId","isPredefinedBackground","isStarBackground"]),_=(0,l.useContext)(E.LangContext).getLang,v=(0,l.useRef)(null),h=(0,i.__read)((0,l.useState)(!0),2),p=h[0],f=h[1],m=(0,l.useMemo)((function(){return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:_(t?"calls_cant_remove_background":"calls_delete_background")}},void 0)}),[t]),A=(0,l.useCallback)((function(e){e.stopPropagation(),t||a(r)}),[t,r]);return(0,l.useEffect)((function(){var e,t;return v.current&&(e=new IntersectionObserver((function(a){var o,r;try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){l.value.isIntersecting&&(e.disconnect(),(t=new Image).src=n,t.onload=function(){f(!1),t.remove()})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}}),{threshold:0,root:null}),e.observe(v.current)),function(){t&&(t.onload=null,t.remove()),null==e||e.disconnect()}}),[]),(0,o.jsxs)(bl,(0,i.__assign)({},u,{checked:t,className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--background",{"VirtualBackgroundSettings__item--background-star":!p&&!!d}),passedRef:v,style:{backgroundImage:p?void 0:"url("+n+")"}},{children:[p&&(0,o.jsx)(Ml.DivBlockSkeleton,{classNames:"VirtualBackgroundSettings__item--background__skeleton",height:80},void 0),!c&&!p&&(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item--background__deletebtn",{"VirtualBackgroundSettings__item--background__deletebtn--disabled":t}),onClick:A},{children:(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:m,className:"VirtualBackgroundSettings__item__popper",position:"t",align:"center"},{children:(0,o.jsx)(Pl,{},void 0)}),void 0)}),void 0)]}),void 0)})),jl=function(){var e=(0,c.useSelector)((function(e){return e.me}));return{isAnonymous:(0,P.isParticipantAnonym)(e)}},Rl=function(){function e(e){this.$c=e,this.gl=this.$c.getContext("webgl")}return e.prototype.draw=function(){var e=this.gl;null==e||e.clearColor(0,0,0,0),null==e||e.clear(e.COLOR_BUFFER_BIT)},e}(),Zl=function(e){var n=e.backgroundList,t=e.$srcElement,a=e.userStream,o=(0,l.useRef)(null),r=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null);null===c.current&&(c.current=new zs);var u=(0,l.useRef)(null),_=(0,l.useRef)(d.EVideoEffectType.NONE),v=(0,l.useRef)(d.EVideoEffectType.NONE),h=(0,l.useRef)(void 0),p=(0,l.useRef)(null),f=(0,l.useRef)(null),m=(0,l.useRef)(!1),A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],C=A[1],E=(0,l.useCallback)((function(e){m.current="play"===e,C("play"===e)}),[]),S=(0,l.useCallback)((function(e,n){void 0===n&&(n=!1),v.current=e,n||(_.current=e)}),[]),T=(0,l.useCallback)((function(){if(p.current&&clearTimeout(p.current),m.current)if(t.current&&r.current)try{r.current.requestSegmentation(t.current)}catch(e){console.error("[useVideoEffects][onRequestSegmentation][error]",e)}else p.current=setTimeout((function(){T()}),300)}),[]),I=(0,l.useCallback)((function(e){var t,a,r;if(null===(t=o.current)||void 0===t?void 0:t.isReady)switch(e){case d.EVideoEffectType.ADD:break;case d.EVideoEffectType.BLUR:S(e),h.current&&(h.current=void 0),m.current||(E("play"),T());break;case d.EVideoEffectType.NONE:S(e),h.current&&(h.current=void 0),null===(a=u.current)||void 0===a||a.draw(),E("stop");break;default:var s=n.find((function(n){return n.id===e}));s&&(S(e,!0),(r=s.originalUrl,(0,i.__awaiter)(void 0,void 0,Promise,(function(){return(0,i.__generator)(this,(function(e){return[2,new Promise((function(e,n){var t=document.createElement("img");t.crossOrigin="anonymous",t.onerror=function(e){n("Failed image loading: "+e)},t.onload=function(){return e(t)},t.src=r}))]}))}))).then((function(n){if(!o.current)throw new Error("output canvas is not initialized");if(!c.current)throw new Error("ImageEdit class is not initialized");if(v.current!==e)throw new Error("Settings changed during load");var t=o.current,a=t.width,i=t.height;return c.current.resize(n,a,i)})).then((function(n){if(v.current!==e)throw new Error("Settings changed during load");S(e),h.current=n,m.current||(E("play"),T())})).catch(console.warn))}else f.current=function(){I(e)}}),[n]),x=(0,l.useCallback)((function(e){switch(_.current){case d.EVideoEffectType.ADD:case d.EVideoEffectType.NONE:break;case d.EVideoEffectType.BLUR:requestAnimationFrame((function(){var n;null===(n=s.current)||void 0===n||n.draw(e),m.current&&T()}));break;default:requestAnimationFrame((function(){var n,t=Object.assign({background:h.current},e);null===(n=s.current)||void 0===n||n.draw(t),m.current&&T()}))}}),[]);return(0,l.useEffect)((function(){var e;if(a){if(o.current){var n=a.getVideoTracks()[0].getSettings(),t=n.width,l=n.height;o.current.width=t||436,o.current.height=l||250,o.current.isReady=!0,null===(e=f.current)||void 0===e||e.call(f);s.current=new ml(o.current),u.current=new Rl(o.current);var c=new Promise((function(e,n){var t=new tl({onReady:e,onError:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,(0,i.__spreadArray)([],(0,i.__read)(e),!1)),n()},onFrame:x});t.createModel(!0)})).then((function(e){return r.current=e,e})).catch((function(){r.current=null}));return function(){var e,n;null===(e=s.current)||void 0===e||e.close(),null===(n=r.current)||void 0===n||n.destroy(),c.then((function(e){e&&e.destroy()})),s.current=null,r.current=null,f.current=null}}console.error("[useVideoEffects][on-userStream-update] canvas is not initialized")}}),[a]),{$canvas:o,onRequestSegmentation:T,onUpdateVideoEffectsSettings:I,isPlaying:g}},Bl=t(23326),Ul=function(e){e.getTracks().forEach((function(e){return e.stop()}))},Hl=function(e){var n=e.className;return(0,o.jsx)("svg",(0,i.__assign)({className:n,width:"4",height:"4",viewBox:"0 0 4 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 4V0H0C2.20898 0 4 1.79077 4 4Z",fill:"white"},void 0)}),void 0)},Vl=(0,l.memo)((function(e){var n=e.onClick,t=e.id,a=e.content;return(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettingsCarousel__Item",onClick:function(){return null==n?void 0:n(t)}},{children:a}),void 0)})),Gl=function(e){var n=e.backgroundList,t=e.onDeleteBackground,a=e.onChooseBackground,r=e.chosen,c=e.videoOptions,u=e.isSferum,_=(0,ue.useLang)().getLang,v=function(e){var n=(0,i.__read)((0,l.useState)(null),2),t=n[0],a=n[1],o=(0,i.__read)((0,l.useState)(!1),2),r=o[0],s=o[1],c=(0,l.useRef)(!1),d=(0,Bl.useIsMounted)(),u=(0,l.useRef)(0),_=(0,l.useCallback)((function(){if(!c.current){s(!1),c.current=!0;var n=function(t){return navigator.mediaDevices.getUserMedia(t).then((function(e){d()?a(e):Ul(e),c.current=!1})).catch((function(t){++u.current<e.length?n(e[u.current]):(a(null),s(t),c.current=!1)}))};n(e[u.current])}}),[e]);return(0,l.useEffect)((function(){_();var e=function(){u.current=0,_()};return navigator.mediaDevices.addEventListener("devicechange",e),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[_]),(0,l.useEffect)((function(){return function(){t&&Ul(t)}}),[t]),{userStream:t,error:r,updateUserMediaStream:_}}(Sl),h=v.userStream,p=v.error,f=v.updateUserMediaStream,m=function(e){var n=e.userStream,t=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t.current){var e=function(e){var n=e.getVideoTracks()[0].getSettings(),t=n.width,a=void 0===t?436:t,i=n.height;return{width:a,height:void 0===i?250:i}}(n),a=e.height,i=e.width;t.current.height=a,t.current.width=i,t.current.srcObject=n}}),[n]),{$video:t}}({userStream:h}).$video,A=Zl({backgroundList:n,$srcElement:m,userStream:h}),g=A.$canvas,C=A.onUpdateVideoEffectsSettings,E=A.isPlaying,S=function(e){var n=e.onDeleteBackground,t=e.backgroundList,a=e.chosen,r=e.onUpdateVideoEffectsSettings,s=e.onChooseBackground,c=e.isSferum,u=jl().isAnonymous;(0,l.useEffect)((function(){a!==d.EVideoEffectType.NONE&&r(a)}),[]);var _=(0,l.useCallback)((function(e){s(e),r(e)}),[s,r]),v=(0,l.useMemo)((function(){return t.map((function(e){var t;return{id:e.id,onClick:_,content:(0,o.jsx)(Dl,{checked:a===e.id,backgroundUrl:e.previewUrl,onDelete:n,photoId:e.id,isPredefinedBackground:e.isPredefined,isStarBackground:null===(t=e.tags)||void 0===t?void 0:t.includes("star")},void 0)}}))}),[a,t,_]);return{carouselItems:(0,l.useMemo)((function(){var e=[{id:d.EVideoEffectType.NONE,onClick:_,content:(0,o.jsx)(Ol,{checked:a===d.EVideoEffectType.NONE},void 0)},{id:d.EVideoEffectType.BLUR,onClick:_,content:(0,o.jsx)(wl,{checked:a===d.EVideoEffectType.BLUR},void 0)}];return c||(u||e.push({id:d.EVideoEffectType.ADD,onClick:_,content:(0,o.jsx)(kl,{},void 0)}),e.push.apply(e,(0,i.__spreadArray)([],(0,i.__read)(v),!1))),e}),[a,v,_])}}({backgroundList:n,onDeleteBackground:t,onUpdateVideoEffectsSettings:C,onChooseBackground:a,chosen:r,isSferum:u}).carouselItems;return(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__userStream"},{children:[h&&(0,o.jsx)("video",(0,i.__assign)({className:(0,s.classNames)("Video",{"Video--visible":!E},"Video--contain",{"Video--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]}),ref:m,controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,autoPlay:!0},{children:"Video tag is not supported"}),void 0),(0,o.jsx)("canvas",{ref:g,className:(0,s.classNames)("VirtualBackgroundSettings__userCanvas",{"VirtualBackgroundSettings__userCanvas--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]},{"VirtualBackgroundSettings__userCanvas--playing":E})},void 0),p&&(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__error"},{children:[(0,o.jsx)("div",{children:_("profile_no_camera_access")},void 0),(0,o.jsx)("div",{children:(0,o.jsx)(Bn.default,(0,i.__assign)({className:"VirtualBackgroundSettings__error__btn",size:"m",onClick:f},{children:_("calls_button_allow_access")}),void 0)},void 0)]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({VirtualBackgroundSettings__carousel__modalFix:!0,"VirtualBackgroundSettings__carousel__modalFix--sferum":u})},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__carousel"},{children:S.map((function(e){return(0,o.jsx)(Vl,{id:e.id,onClick:e.onClick,content:e.content},e.id)}))}),void 0),(0,o.jsx)(Hl,{className:"VirtualBackgroundSettings__carousel__cornerIcon"},void 0)]}),void 0)]}),void 0)},Fl=t(99939),Wl=function(){var e=(0,Fl.useSendStatsData)().sendStatsData,n=(0,l.useCallback)((function(n,t,a){var i=Xa(n,t,a),o=i.disabledActionType,r=i.prevSendValue,s=i.effectDuration;null!==o&&e(o,{background_id:r,background_duration:s})}),[e]),t=(0,l.useCallback)((function(t,a){var i,o=Date.now(),r=oe();r&&n(a,o,r),i=t>4e3?Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_SELECTED:Fl.ECallActionEventType.VIRTUAL_BACKGROUND_SELECTED,e(i,{background_id:t}),re(o)}),[e,n]),a=(0,l.useCallback)((function(e){var t=oe();if(t){var a=Date.now();n(e,a,t),se()}}),[n]),i=(0,l.useCallback)((function(n){e(Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_ADDED,{background_id:n})}),[e]);return{sendVirtualBackgroundSelected:t,sendVirtualBackgroundDisabled:a,sendVirtualBackgroundDeleted:(0,l.useCallback)((function(n){e(Fl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DELETED,{background_id:n})}),[e]),sendVirtualBackgroundAdded:i}},zl=function(){var e=u();return{onClose:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:null})}),[]),onClosePopupCalendar:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING})}),[])}},Kl=function(e){var n=e.photos,t=e.onSuccessPhotoUpload,a=e.isSferum,o=u(),r=Wl(),s=r.sendVirtualBackgroundAdded,c=r.sendVirtualBackgroundDeleted,_=jl().isAnonymous,v=(0,l.useRef)([]),h=(0,i.__read)((0,l.useState)(!1),2),p=h[0],f=h[1];(0,l.useEffect)((function(){n.length||_||a||(0,sn.photosGetAllImages)().then((function(e){o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Ql(e.items||[])})}))}),[]);var m=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));t&&(v.current.push(t),o({type:d.E_ACTION.VB_REMOVE_USER_PHOTO,photoId:e}))}),[n]),A=(0,l.useCallback)((function(){var e=v.current;return v.current=[],function(e,n){var t=e.map((function(e){return(0,sn.photosDelete)({photo_id:e.id})}));return Promise.allSettled(t).then((function(t){t.forEach((function(t,a){"fulfilled"===t.status&&n(e[a].id)}))}))}(e,c)}),[c]),g=(0,l.useCallback)((function(){var e=v.current;v.current=[];var t=n.concat(e);o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Ql(t)})}),[n]),C=(0,l.useCallback)((function(e){return f(!0),(0,sn.photosSaveBackgroundPhoto)(e).then((function(e){var n=e[0];if(!n)throw new Error("Something wrong with uploaded photo");return o({type:d.E_ACTION.VB_ADD_USER_PHOTO,photo:n}),t(n),s(n.id),n})).finally((function(){f(!1)}))}),[t,s]);return{photos:n,onAddBackground:C,onDeleteBackground:m,onSaveSettings:A,onCancelSettings:g,loadingUpload:p}};function Ql(e){return e.sort((function(e,n){return e.date<n.date?1:-1}))}var Yl,Jl=function(e){var n=e.children,t=e.onClose,a=e.onSubmit,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:t,title:r("calls_warning"),appearance:"blue",className:"UploadBackgroundErrorModal",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:t,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:a},{children:r("calls_retry_action")}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundErrorModal__content"},{children:n}),void 0)}),void 0)},Xl=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO})}),[]);return(0,o.jsx)(Jl,(0,i.__assign)({onClose:t,onSubmit:a},{children:n("calls_error_upload_background_image")}),void 0)},ql=function(e){var n=e.children,t=e.onClose,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:t,title:a("calls_upload_image_for_background"),appearance:"blue",className:"UploadBackgroundPhotoModal",footerHint:a("calls_if_you_have_problems_with_upload")},{children:n}),void 0)},$l=function(e){var n=e.onSubmit,t=e.loading,a=(0,l.useContext)(E.LangContext).getLang,r=(0,l.useRef)(null),s=function(e){var n=e.$inputEl,t=e.onSubmit,a=(0,i.__read)((0,l.useState)({}),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,l.useCallback)((function(){n.current&&(n.current.onchange=function(e){var n;d(!1);var a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(a){var i=new FileReader;i.onload=function(){var e=new Image;e.onload=function(){!function(e){return(e.width>=510||e.width>7e3)&&(e.height>=200||e.height>7e3)}(e)?d(!0):(r({file:a,image:e}),t&&t(a))},e.onerror=function(){return d(!0)},e.src=i.result},i.onerror=function(){return d(!0)},i.readAsDataURL(a)}},n.current.click())}),[]);return{error:c,fileData:o,onClick:u}}({$inputEl:r,onSubmit:n}),c=s.onClick,d=s.error,u=(0,l.useMemo)((function(){return(""+a("profile_oph_err_size")).replace("{sorry}","<b>"+a("global_sorry_error")+"</b>").replace("{min}","200").replace("{max}","7000")}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto"},{children:[(0,o.jsx)("input",{ref:r,type:"file",className:"UploadBackgroundPhoto__upload"},void 0),d&&(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__error"},{children:[(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__left"},void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__right",dangerouslySetInnerHTML:{__html:u}},void 0)]}),void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__description",dangerouslySetInnerHTML:{__html:a("calls_you_can_upload_description")}},void 0),!t&&(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__button"},{children:(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:c},{children:a("calls_choose_file")}),void 0)}),void 0),t&&(0,o.jsx)("div",{className:"UploadBackgroundPhoto__progress"},void 0)]}),void 0)},ec=function(e){var n=e.onAddBackground,t=e.loading,a=u(),r=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),s=(0,l.useCallback)((function(e){n(e).then(r).catch((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_ERROR})}))}),[r]);return(0,o.jsx)(ql,(0,i.__assign)({onClose:r},{children:(0,o.jsx)($l,{loading:t,onSubmit:s},void 0)}),void 0)},nc=(0,l.memo)((function(e){var n=e.SDK,t=(0,i.__read)((0,l.useState)(!1),2),a=t[0],r=t[1],s=k((function(e){return e.popup})),_=k((function(e){return e.virtualBackgroundSettings.photos})),v=k((function(e){return!!e.config.sferum})),h=function(e){var n=e.photos;return{backgroundList:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(Tl),!1).map((function(e){return e instanceof El?e.getMappedParams():{id:e.id,originalUrl:xl(e),previewUrl:(n=e,t=Il(n),(null==t?void 0:t.o)||(null==t?void 0:t.p)||(null==t?void 0:t.q)||(null==t?void 0:t.x)||(null==t?void 0:t.s)||""),isPredefined:!1};var n,t}))}),[n])}}({photos:_}).backgroundList,p=zl().onClose,f=function(){var e=(0,c.useSelector)((function(e){return e.localDevice.stream})),n=(0,c.useSelector)((function(e){return e.localDevice.mediaSettings}));return{userStream:e,isVideoEnabled:!!(null==n?void 0:n.isVideoEnabled)}}(),m=f.userStream,A=f.isVideoEnabled,g=function(e){var n=e.backgroundList,t=u(),a=(0,i.__read)((0,l.useState)(ae),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){switch(e){case d.EVideoEffectType.BLUR:r(e);break;case d.EVideoEffectType.ADD:t({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO});break;case d.EVideoEffectType.NONE:r(e);break;default:n.some((function(n){return n.id===e}))&&r(e)}}),[n]),c=(0,l.useRef)(null),_=(0,l.useCallback)((function(e){return c.current=e}),[]);return(0,l.useEffect)((function(){c.current&&(s(c.current.id),c.current=null)}),[s]),{chosen:o,setChosen:r,onClick:s,onSuccessPhotoUpload:_}}({backgroundList:h}),C=g.chosen,E=g.setChosen,S=g.onClick,T=g.onSuccessPhotoUpload,I=Kl({photos:_,onSuccessPhotoUpload:T,isSferum:v}),x=I.onCancelSettings,N=I.loadingUpload,y=I.onAddBackground,b=I.onDeleteBackground,O=I.onSaveSettings,w=function(e){var n=e.SDK,t=(0,l.useMemo)((function(){return{background:new gl,blur:new Cl,effect:new ol({debug:!0})}}),[]);(0,l.useEffect)((function(){return n.setVideoEffects(t.effect),function(){t.effect.destroy()}}),[]);var a=(0,l.useCallback)((function(e){switch(e.type){case d.EVideoEffectType.BACKGROUND:t.background.setBackgroundImage(e.value).then((function(){n.changeVideoEffect(t.background)}));break;case d.EVideoEffectType.BLUR:n.changeVideoEffect(t.blur);break;case d.EVideoEffectType.NONE:n.changeVideoEffect(null);case d.EVideoEffectType.ADD:}}),[]);return{onSettingsChange:a}}({SDK:n}).onSettingsChange;!function(e){var n=e.userStream,t=e.onSettingsChange,a=e.backgroundList,i=e.isVideoEnabled,o=Wl(),r=o.sendVirtualBackgroundSelected,s=o.sendVirtualBackgroundDisabled;(0,l.useEffect)((function(){if(n){var e=ae();i?"number"==typeof e?Nl(e,a).then((function(n){n&&(t({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r(n.id,e))})):e===d.EVideoEffectType.BLUR&&(t({type:d.EVideoEffectType.BLUR}),r(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):(t({type:d.EVideoEffectType.NONE}),s(e))}}),[n,i])}({onSettingsChange:w,userStream:m,backgroundList:h,isVideoEnabled:A});var L=function(e){var n=e.chosen,t=e.settingsOpened,a=e.onSettingsChange,i=e.setChosen,o=e.backgroundList,r=e.isVideoEnabled,s=Wl(),c=s.sendVirtualBackgroundSelected,u=s.sendVirtualBackgroundDisabled,_=(0,l.useRef)(null);return(0,l.useEffect)((function(){t&&(_.current=n)}),[t]),{onApplySettings:(0,l.useCallback)((function(){if(_.current!==n){var e=ae();ie(n),"number"==typeof n?Nl(n,o).then((function(n){n&&(a({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r&&c(n.id,e))})):n===d.EVideoEffectType.BLUR?(a({type:d.EVideoEffectType.BLUR}),r&&c(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):n===d.EVideoEffectType.NONE&&(a({type:d.EVideoEffectType.NONE}),r&&u(e))}}),[a,o,n,c,u,r]),onRestoreSettings:(0,l.useCallback)((function(){_.current&&i(_.current)}),[i])}}({chosen:C,onSettingsChange:w,settingsOpened:a,setChosen:E,backgroundList:h,isVideoEnabled:A}),P=L.onRestoreSettings,M=L.onApplySettings,D=le(),j=D.videoOptions,R=D.onRestoreSettings,Z=D.onSaveSettings,B=D.onChangeVideoOption;(0,l.useEffect)((function(){se()}),[]),(0,l.useEffect)((function(){s!==d.POPUP_VIRUTAL_BACKGROUND||a||r(!0)}),[s]);var U=(0,l.useCallback)((function(){O(),p(),r(!1),M(),Z()}),[O,p,M,Z]),H=(0,l.useCallback)((function(){x(),p(),r(!1),P(),R()}),[x,p,P,R]);return(0,o.jsxs)(o.Fragment,{children:[s===d.POPUP_VIRUTAL_BACKGROUND&&(0,o.jsx)(ws,(0,i.__assign)({onClose:H,onSubmit:U,onChangeVideoOption:B,videoOptions:j},{children:(0,o.jsx)(Gl,{chosen:C,backgroundList:h,onDeleteBackground:b,onChooseBackground:S,videoOptions:j,isSferum:v},void 0)}),void 0),s===d.POPUP_UPLOAD_BACKGROUND_PHOTO&&(0,o.jsx)(ec,{onAddBackground:y,loading:N},void 0),s===d.POPUP_UPLOAD_BACKGROUND_ERROR&&(0,o.jsx)(Xl,{},void 0)]},void 0)})),tc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallUserIconGradient)"},void 0),(0,o.jsx)("path",{d:"M17.25 10.25a3.25 3.25 0 1 0-6.5 0 3.25 3.25 0 1 0 6.5 0ZM7.5 18.462v.7c0 .463.375.838.838.838h11.325a.838.838 0 0 0 .837-.837v-.701C20.5 15.769 16.17 15 14 15s-6.5.77-6.5 3.462Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallUserIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#70B2FF"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#5C9CE6"},void 0)]}),void 0)},void 0)]}),void 0)},ac=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallWaitingHallIconGradient)"},void 0),(0,o.jsx)("path",{d:"M13.85 6.85h1.072c1.529 0 2.095.127 2.657.428.493.263.88.65 1.143 1.143.3.562.428 1.129.428 2.657v5.842c0 1.528-.127 2.098-.428 2.66a2.74 2.74 0 0 1-1.143 1.14c-.562.3-1.128.43-2.657.43H13.85",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round"},void 0),(0,o.jsx)("path",{d:"M10.85 10.85 14 14l-3.15 3.15M6.85 14h6.6",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round",strokeLinejoin:"round"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallWaitingHallIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#50C750"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#32B332"},void 0)]}),void 0)},void 0)]}),void 0)},ic=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallAnonymousIconGradient)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"m9.52 10.906.503-2.328A2 2 0 0 1 11.978 7h4.044a2 2 0 0 1 1.955 1.578l.503 2.328a.916.916 0 0 1 .015.094H20a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h1.505a.902.902 0 0 1 .015-.094Zm3.447 7a2.5 2.5 0 1 1-.217-1.497 4.984 4.984 0 0 1 2.5 0 2.5 2.5 0 1 1-.217 1.498 3.488 3.488 0 0 0-2.066 0Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallAnonymousIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},oc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallCameraIcon)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.772 10.865C7.5 11.4 7.5 12.1 7.5 13.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092c.535.273 1.235.273 2.635.273h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092c.273-.535.273-1.235.273-2.635v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C15.6 9.5 14.9 9.5 13.5 9.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417v-2.464a.5.5 0 0 1 .223-.416Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallCameraIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},rc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallMicrophoneIcon)"},void 0),(0,o.jsx)("path",{d:"M11.498 10.5c0-1.38 1.12-2.5 2.502-2.5a2.501 2.501 0 0 1 2.503 2.5v3c0 1.38-1.12 2.5-2.503 2.5a2.501 2.501 0 0 1-2.502-2.5v-3Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M9.194 13.767a.75.75 0 0 1 .891.576 4.005 4.005 0 0 0 7.83 0 .75.75 0 0 1 1.468.314 5.508 5.508 0 0 1-4.632 4.292v1.301a.75.75 0 0 1-1.502 0v-1.3a5.508 5.508 0 0 1-4.632-4.293.75.75 0 0 1 .577-.89Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallMicrophoneIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},sc=function(){return(0,l.useContext)(E.LangContext)},lc=function(e){var n=e.actionButtons,t=e.onClose,a=e.ownerOptions,r=e.selectedOwnerId,s=e.waitingHall,l=e.allowAnon,c=e.onGroupSelectChange,d=e.onChangeWaitingHall,u=e.onChangeAllowAnon,_=e.microphoneOptions,v=e.cameraOptions,h=e.onMicrophoneSelectChange,p=e.onCameraSelectChange,f=e.selectedMicrophoneOption,m=e.selectedCameraOption,A=sc().getLang;return(0,o.jsxs)(T.default,(0,i.__assign)({className:"CreateCallByLinkModal",onClose:t,disableBodyScroll:!0},{children:[(0,o.jsx)(Go.ModalHeader,{title:A("calls_create_call_by_link_title"),onClose:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CreateCallByLinkModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CreateCallByLinkModal__description"},{children:A("calls_create_call_by_link_description")}),void 0),(0,o.jsxs)(Tn.default,{children:[(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(tc,{},void 0),aside:(0,o.jsx)(bo.default,{className:"CreateCallByLinkModalOptions__longselect",options:a,value:r,onChange:c,disabled:a.length<=1},void 0)},{children:A("calls_create_call_by_link_by_name")}),void 0),(0,o.jsx)(ni,(0,i.__assign)({canBeHovered:!1,onClick:d,icon:(0,o.jsx)(ac,{},void 0),hint:A("calls_menu_waiting_hall_description"),aside:(0,o.jsx)(G.default,{onChange:d,checked:s},void 0)},{children:A("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(ni,(0,i.__assign)({canBeHovered:!1,onClick:u,icon:(0,o.jsx)(ic,{},void 0),hint:A("calls_create_call_by_link_anon_hint_shedule"),aside:(0,o.jsx)(G.default,{onChange:u,checked:l},void 0)},{children:A("calls_create_call_by_link_anon")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(rc,{},void 0),aside:(0,o.jsx)(bo.default,{className:"CreateCallByLinkModalOptions__longselect",options:_,value:f,onChange:h},void 0)},{children:A("calls_create_call_by_link_microphones")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(oc,{},void 0),aside:(0,o.jsx)(bo.default,{className:"CreateCallByLinkModalOptions__longselect",options:v,value:m,onChange:p},void 0)},{children:A("calls_create_call_by_link_cameras")}),void 0)]},void 0)]}),void 0),(0,o.jsx)(Ts.ModalFooter,{actionButtons:n},void 0)]}),void 0)},cc=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=sc().getLang,s=t.participants[t.me],_=(0,i.__read)((0,l.useState)(s.peerId),2),v=_[0],h=_[1],p=(0,i.__read)((0,l.useState)([{value:s.peerId,label:s.name}]),2),f=p[0],m=p[1],A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],C=A[1],E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],T=E[1],I=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),x=I[0],N=I[1],y=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),b=y[0],O=y[1];(0,l.useEffect)((function(){(0,sn.getGroupsForCall)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(f),!1);e.count>0&&(e.items.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),m(n))}))}),[]);var w=(0,l.useCallback)((function(e){h(Number(e.selected.value))}),[]),L=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),C(!g))}),[g]),k=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),T(!S))}),[S]),P=(0,l.useCallback)((function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),M=(0,l.useCallback)((function(){var e,a={};S||(a[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=!0),g&&(a[J.ConversationOption.WAITING_HALL]=!0);var i={};x!==J.MuteState.UNMUTE&&(i[J.MediaOption.AUDIO]=x),b!==J.MuteState.UNMUTE&&(i[J.MediaOption.VIDEO]=b,i[J.MediaOption.SCREEN_SHARING]=b),n.startCall(!1,null!==(e=t.entryPoint)&&void 0!==e?e:d.CallStatSource.HISTORY_CREATE,!1,v>0?0:v,{conversationOptions:a,createLink:!0,mediaOptions:i})}),[v,g,S,x,b]),D=[(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:P,appearance:"tertiary"},{children:r("calls_cancel")}),"cancel"),(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:M},{children:r("calls_create_call_by_link")}),"call")],j=[{value:J.MuteState.UNMUTE,label:r("calls_create_call_by_link_phone_option_allow_always")},{value:J.MuteState.MUTE,label:r("calls_create_call_by_link_phone_option_disallow_entrance")},{value:J.MuteState.MUTE_PERMANENT,label:r("calls_create_call_by_link_phone_option_disallow_always")}],R=function(e){var n=J.MuteState.UNMUTE;return e==J.MuteState.MUTE?n=J.MuteState.MUTE:e==J.MuteState.MUTE_PERMANENT&&(n=J.MuteState.MUTE_PERMANENT),n},Z=(0,l.useCallback)((function(e){N(R(String(e.selected.value)))}),[]),B=(0,l.useCallback)((function(e){O(R(String(e.selected.value)))}),[]);return(0,o.jsx)(lc,{actionButtons:D,onClose:P,ownerOptions:f,selectedOwnerId:v,waitingHall:g,allowAnon:S,onGroupSelectChange:w,onChangeWaitingHall:L,onChangeAllowAnon:k,microphoneOptions:j,cameraOptions:j,onMicrophoneSelectChange:Z,onCameraSelectChange:B,selectedMicrophoneOption:x,selectedCameraOption:b},void 0)},dc=function(e){var n=e.onClose,t=e.title,a=e.description,r=e.btnText;return(0,o.jsx)(En.default,(0,i.__assign)({className:"OnHangupModal",onClose:n,title:t,appearance:"blue",actionButtons:(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:n},{children:r}),void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"OnHangupModal__description"},{children:a}),void 0)}),void 0)},uc=function(){var e=(0,ue.useLang)().getLang,n=zl().onClose,t=(0,c.useSelector)((function(e){return e.popup})),a=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.opponentName})),i=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.isMeEndedCallForAll})),r=u(),s="",_="",v=e("calls_close"),h=!1;switch(t){case d.POPUP_ON_CALL_HANGUP_BUSY:s=e("calls_user_busy"),_=e("calls_user_busy_description").replace("{username}",a||e("calls_opponent"));break;case d.POPUP_ON_CALL_HANGUP_KILLED:if(i){h=!0;break}s=e("calls_join_error_not_found_conversation"),_=e("calls_admin_ended_call_for_everyone");break;case d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE:if(i){h=!0;break}s=e("calls_meeting_ended_title"),_=e("calls_meeting_ended_desc"),v=e("calls_warning_ok");break;case d.POPUP_ON_CALL_HANGUP_BANNED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_banned");break;case d.POPUP_ON_CALL_HANGUP_REMOVED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_kicked")}return(0,l.useEffect)((function(){return function(){r({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})}}),[]),(0,l.useEffect)((function(){h&&n()}),[h,n]),h?null:(0,o.jsx)(dc,{onClose:n,title:s,description:_,btnText:v},void 0)};!function(e){e[e.Wall=0]="Wall",e[e.Community=1]="Community",e[e.History=2]="History",e[e.IM=3]="IM"}(Yl||(Yl={}));var _c=function(){return(0,o.jsx)("svg",(0,i.__assign)({width:"11",height:"6",viewBox:"0 0 11 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M0.75 0.75L5.5 5.25L10.25 0.75",stroke:"#AEB7C2",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},void 0)}),void 0)},vc=t(11798),hc=function(e){var n=e.id,t=e.onClick,a=e.text,r=e.type,l=void 0===r?"regular":r;return(0,o.jsxs)("span",(0,i.__assign)({className:(0,s.classNames)("TokenInput__token",{"TokenInput__token--add":"add"===l}),onClick:"add"===l?function(){return t()}:void 0},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"TokenInput__label"},{children:a}),void 0),(0,o.jsx)("button",(0,i.__assign)({"data-id":n,className:"TokenInput__remove",onClick:function(){return t(n)}},{children:(0,o.jsx)(vc.default,{},void 0)}),void 0)]}),n)},pc="https://vk.com/images/icons/im_multichat_50.png",fc=function(){},mc=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;return t&&t.photo_50||pc},Ac=function(e,n){var t,a;switch(e.conversation.peer.type){case"chat":return(null===(a=null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.photo)||void 0===a?void 0:a.photo_50)||pc;case"user":return mc(n,e.conversation.peer.id);default:return pc}},gc=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;if(!t||!t.first_name)return"";var a=t.first_name;return t.last_name&&(a+=" "+t.last_name),a},Cc=function(e,n){var t;switch(e.conversation.peer.type){case"chat":return(null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.title)||"";case"user":return gc(n,e.conversation.peer.id);default:return""}},Ec=(0,l.forwardRef)((function(e,n){var t=e.handleAddToken,a=e.handleChange,r=e.handleRemoveToken,c=e.handleSelect,d=e.opened,u=e.tokens,_=e.value,v=e.filteredOptions,h=e.onClickAway,p=e.loading,f=(0,ue.useLang)().getLang,m=function(e){var n=e.ref,t=e.onClickAway,a=(0,l.useCallback)((function(e){var a;switch(e.code){case"Escape":n&&"function"!=typeof n&&(null===(a=n.current)||void 0===a||a.blur()),t();break;case"Tab":t()}}),[n,t]);return{handleClickAway:a}}({ref:n,onClickAway:h}).handleClickAway;return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ModalSendMessage__MultiSelect",{"ModalSendMessage__MultiSelect--hidden":!!p&&!v.length})},{children:(0,o.jsx)(ja.default,{opened:d,placeholder:f("calls_enter_recipient_or_dialog_name"),removeTokenPlaceholder:"Remove",disableEmptyList:!!p,tokens:u,hasMore:!1,onChange:a,value:_,onSelect:c,onRemoveToken:r,disableOnSelectInputFocus:!0,hideInputWithName:!0,renderInput:function(){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TokenInput","ModalSendMessage__TokenInput",{"ModalSendMessage__TokenInput--opened":d&&!p}),onClick:t},{children:[u.map((function(e){return(0,o.jsx)(hc,(0,i.__assign)({},e,{onClick:r}),e.id)})),!(!u.length||d)&&(0,o.jsx)(hc,{id:"token-add",text:f("calls_add"),type:"add",onClick:fc},"token-add"),(!u.length||d)&&(0,o.jsx)("input",{ref:n,className:"ModalSendMessage__input",type:"text",value:_,onChange:a,onKeyDown:m,placeholder:f("calls_enter_recipient_or_dialog_name")},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__angle-icon"},{children:(0,o.jsx)(_c,{},void 0)}),void 0)]}),void 0)},renderSuggest:function(e){return(0,o.jsx)(Zn.default,{"data-id":e.id,photo:e.photo,title:e.text,onClick:function(){return c(e.id)}},e.id)},data:v,notFoundText:f("calls_search_empty_list")},void 0)}),void 0)})),Sc=function(e){var n=e.options,t=e.onChangeInput,a=(0,i.__read)((0,l.useState)(""),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)([]),2),_=u[0],v=u[1],h=(0,i.__read)((0,l.useState)((function(){return(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),2),p=h[0],f=h[1],m=(0,l.useRef)(null),A=(0,l.useCallback)((function(){d(!1),r("")}),[]);(0,l.useEffect)((function(){null==t||t(o)}),[o]),(0,l.useEffect)((function(){f(function(e,n,t){var a=t.reduce((function(e,n){return e[n.id]=!0,e}),{}),i=e.toLowerCase();return n.filter((function(e){return!a[e.id]&&e.text.toLowerCase().includes(i)}))}(o,n,_))}),[o,n,_]),function(e){var n=e.selector,t=e.opened,a=e.onClose;(0,l.useEffect)((function(){if(t){var e=function(e){var t=e.target;t instanceof HTMLElement&&(t.closest(n)||a(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}}),[t])}({selector:".ModalSendMessage__MultiSelect",onClose:A,opened:c});var g=(0,l.useCallback)((function(e){var n=e.target.value;r(n),d(!0)}),[]),C=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));return t&&v((function(e){var n=new Set(e);return n.add({id:t.id,text:t.text,src:t.photo}),(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),d(!1),r(""),Promise.resolve()}),[n]),E=(0,l.useCallback)((function(e){v((function(n){return n.filter((function(n){return n.id!==e}))})),d(!1)}),[]),S=(0,l.useCallback)((function(e){var n,t=e.target,a=null===(n=t.closest)||void 0===n?void 0:n.call(t,".TokenInput__token");a&&!a.classList.contains("TokenInput__token--add")||(d(!0),r(""),requestAnimationFrame((function(){var e;null===(e=m.current)||void 0===e||e.focus()})))}),[_,n]);return{ref:m,filteredOptions:p,handleAddToken:S,handleChange:g,handleRemoveToken:E,handleSelect:C,onClickAway:A,opened:c,options:n,tokens:_,value:o}},Tc=function(e){var n=e.onClose,t=e.title,a=e.onSubmit,r=e.optionsIM,s=e.submitDisabled,c=e.initialText,d=e.onChangeInputIM,u=e.loading,_=(0,ue.useLang)().getLang,v=(0,i.__read)((0,l.useState)(c||""),2),h=v[0],p=v[1],f=(0,i.__read)((0,l.useState)(Yl.IM),1)[0],m=Sc({options:r,onChangeInput:d}),A=(0,l.useCallback)((function(e){var n=e.target.value;p(n)}),[]),g=(0,l.useCallback)((function(){switch(f){case Yl.IM:var e=m.tokens.map((function(e){return e.id}));if(!e.length||!h)break;a({text:h,ids:e,destination:f})}}),[h,m.tokens,a,f]),C=!h||!m.tokens.length;return(0,o.jsx)(En.default,(0,i.__assign)({className:"ModalSendMessage",onClose:n,title:t,actionButtons:(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"primary",onClick:g,disabled:C||s},{children:_("calls_send")}),void 0),disableEscapeClose:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Main"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__Destination"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__RadioDestination"},{children:(0,o.jsx)(Ec,(0,i.__assign)({loading:u},m),void 0)}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Message"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"ModalSendMessage__Message__title"},{children:_("calls_your_message")}),void 0),(0,o.jsx)(zr.default,{value:h,onChange:A},void 0)]}),void 0)]}),void 0)}),void 0)},Ic=t(73521),xc=t(84356),Nc=function(){var e=(0,ue.useLang)().getLang,n=(0,xc.usePromiseError)().handleError,t=u(),a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=function(){var e=(0,xc.usePromiseError)().handleError,n=(0,l.useRef)([]),t=(0,l.useRef)([]),a=(0,i.__read)((0,l.useState)([]),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)([]),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],h=(0,Bl.useIsMounted)(),p=(0,l.useRef)(null),f=k((function(e){var n;return+((null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me)})),m=yc(),A=yc(),g=(0,l.useCallback)((function(a){p.current&&clearTimeout(p.current);var o=A.getId();if(!a||a.length<=2)return d(n.current),void r(t.current);var s=m.getId();p.current=setTimeout((function(){v(!0),Promise.allSettled([(0,sn.messagesSearch)({q:a}),(0,sn.friendsSearch)(f,a,20)]).then((function(e){var a=(0,i.__read)(e,2),s=a[0],l=a[1];if(h()&&o===A.prevId.current){var c,u;if("fulfilled"===s.status)(c=s.value).count&&c.conversations?r(c.conversations.map((function(e){var n,t,a;return{id:e.peer.id.toString(),photo:(null===(t=null===(n=e.chat_settings)||void 0===n?void 0:n.photo)||void 0===t?void 0:t.photo_50)||pc,text:(null===(a=e.chat_settings)||void 0===a?void 0:a.title)||""}}))):r(t.current);if("fulfilled"===l.status)(c=l.value).count?d((void 0===(u=c.items)&&(u=[]),u.map((function(e){return{id:e.id.toString(),photo:mc(e,e.id),text:gc(e,e.id)}})))):d(n.current)}})).catch(e).finally((function(){h()&&s===m.prevId.current&&v(!1)}))}),300)}),[]);return(0,l.useEffect)((function(){v(!0),(0,sn.messagesGetConversations)().then((function(e){if(h()){var n=function(e,n){var t,a;void 0===n&&(n=[]);var o=[];try{for(var r=(0,i.__values)(e),s=r.next();!s.done;s=r.next()){var l=s.value;"chat"===l.conversation.peer.type&&o.push({id:l.conversation.peer.id.toString(),photo:Ac(l,n),text:Cc(l,n)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}(e.items,e.profiles);t.current=n,r(n)}})).catch(e).finally((function(){h()&&v(!1)}))}),[]),{conversations:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),(0,i.__read)(o),!1)}),[o,c]),loading:_,fetchSearchFriends:g}}(),v=_.conversations,h=_.fetchSearchFriends,p=_.loading,f=yc().getId,m=zl().onClosePopupCalendar,A=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),g=(0,Ic.useCalendarEventDetails)({meParticipant:A}),C=(0,Bl.useIsMounted)(),E=(0,l.useCallback)((function(e){if(e)return s(!0),e.destination===Yl.IM?Promise.allSettled(e.ids.map((function(n){return(0,sn.messagesSend)({peer_id:+n,message:e.text,random_id:f()})}))).then(m).catch(n).finally((function(){C()&&s(!1)})):void 0}),[]),S=(0,l.useCallback)((function(){t({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})}),[t]);return(0,o.jsx)(Tc,{onClose:S,onSubmit:E,optionsIM:v,title:e("calls_send_call_link_title"),submitDisabled:r,initialText:g.getDescription(c),onChangeInputIM:h,loading:p},void 0)};function yc(){var e=(0,l.useRef)(0);return e.current||(e.current=Date.now()),{getId:(0,l.useCallback)((function(){return e.current=Date.now(),e.current}),[]),prevId:e}}var bc=t(49336),Oc=function(){return(0,o.jsxs)("svg",(0,i.__assign)({width:"40",height:"46",viewBox:"0 0 40 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("path",{d:"M30.5607 17.4393C31.1464 18.0251 31.1464 18.9749 30.5607 19.5607L18.5607 31.5607C17.9749 32.1464 17.0251 32.1464 16.4393 31.5607L10.4393 25.5607C9.85355 24.9749 9.85355 24.0251 10.4393 23.4393C11.0251 22.8536 11.9749 22.8536 12.5607 23.4393L17.5 28.3787L28.4393 17.4393C29.0251 16.8536 29.9749 16.8536 30.5607 17.4393Z",fill:"var(--accent)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1.5C12 0.671573 11.3284 0 10.5 0C9.67157 0 9 0.671573 9 1.5V3.10786L8.92347 3.11398C7.49669 3.23055 6.28944 3.47376 5.18709 4.03544C3.39955 4.94624 1.94624 6.39955 1.03544 8.18709C0.473764 9.28944 0.230548 10.4967 0.113976 11.9235C-2.00495e-05 13.3187 -1.09936e-05 15.0497 2.21849e-07 17.234V31.766C-1.09936e-05 33.9503 -2.00495e-05 35.6813 0.113976 37.0765C0.230548 38.5033 0.473764 39.7106 1.03544 40.8129C1.94624 42.6004 3.39955 44.0538 5.18709 44.9646C6.28944 45.5262 7.49669 45.7695 8.92347 45.886C10.3187 46 12.0497 46 14.234 46H25.766C27.9503 46 29.6813 46 31.0765 45.886C32.5033 45.7695 33.7106 45.5262 34.8129 44.9646C36.6004 44.0538 38.0538 42.6004 38.9646 40.8129C39.5262 39.7106 39.7695 38.5033 39.886 37.0765C40 35.6813 40 33.9503 40 31.766V17.234C40 15.0497 40 13.3187 39.886 11.9235C39.7695 10.4967 39.5262 9.28944 38.9646 8.18709C38.0538 6.39955 36.6004 4.94624 34.8129 4.03544C33.7106 3.47376 32.5033 3.23055 31.0765 3.11398C31.0511 3.1119 31.0256 3.10986 31 3.10786V1.5C31 0.671573 30.3284 0 29.5 0C28.6716 0 28 0.671573 28 1.5V3.00568C27.3129 2.99999 26.5702 3 25.766 3H21.5V1.5C21.5 0.671573 20.8284 0 20 0C19.1716 0 18.5 0.671573 18.5 1.5V3H14.234C13.4299 3 12.6871 2.99999 12 3.00568V1.5ZM28 6.0059C27.3158 6.00017 26.5546 6 25.7 6H21.5V7.5C21.5 8.32843 20.8284 9 20 9C19.1716 9 18.5 8.32843 18.5 7.5V6H14.3C13.4454 6 12.6842 6.00017 12 6.0059V7.5C12 8.32843 11.3284 9 10.5 9C9.67157 9 9 8.32843 9 7.5V6.11854C7.85638 6.22335 7.13009 6.41241 6.54906 6.70846C5.32601 7.33163 4.33164 8.32601 3.70846 9.54906C3.39819 10.158 3.20543 10.9265 3.10401 12.1678C3.00117 13.4265 3 15.035 3 17.3V31.7C3 33.965 3.00117 35.5735 3.10401 36.8322C3.20543 38.0735 3.39819 38.842 3.70846 39.4509C4.33164 40.674 5.32601 41.6684 6.54906 42.2915C7.15801 42.6018 7.92651 42.7946 9.16776 42.896C10.4265 42.9988 12.035 43 14.3 43H25.7C27.965 43 29.5735 42.9988 30.8322 42.896C32.0735 42.7946 32.842 42.6018 33.4509 42.2915C34.674 41.6684 35.6684 40.674 36.2915 39.4509C36.6018 38.842 36.7946 38.0735 36.896 36.8322C36.9988 35.5735 37 33.965 37 31.7V17.3C37 15.035 36.9988 13.4265 36.896 12.1678C36.7946 10.9265 36.6018 10.158 36.2915 9.54906C35.6684 8.32601 34.674 7.33163 33.4509 6.70846C32.8699 6.41241 32.1436 6.22335 31 6.11854V7.5C31 8.32843 30.3284 9 29.5 9C28.6716 9 28 8.32843 28 7.5V6.0059Z",fill:"var(--accent)"},void 0)]}),void 0)},wc=function(e){var n=e.onClose,t=e.text,a=e.onCopyLink,r=e.onCopyText,s=e.onSendByMessage,l=(0,ue.useLang)().getLang;return(0,o.jsx)(bc.BaseModal,(0,i.__assign)({className:"CallsModalEventPlanned",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__wrap"},{children:[(0,o.jsx)(Oc,{},void 0),(0,o.jsx)("h3",(0,i.__assign)({className:"CallsModalEventPlanned__title"},{children:l("calls_event_planned")}),void 0),(0,o.jsx)("textarea",{className:"CallsModalEventPlanned__preview",value:t,readOnly:!0},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__buttons"},{children:[(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"primary",onClick:r},{children:l("calls_copy_invite_text")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"link",onClick:a},{children:l("calls_copy_invite_link")}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({appearance:"link",onClick:s},{children:l("calls_send_text_by_im")}),void 0)]}),void 0)]}),void 0)}),void 0)},Lc=t(209),kc=function(){var e=(0,xc.usePromiseError)().handleError,n=(0,ue.useLang)().getLang,t=(0,Lc.useNotifier)().showText,a=u(),i=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),r=zl().onClosePopupCalendar,l=(0,Ic.useCalendarEventDetails)({meParticipant:i}),c=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=l.getDescription(c);return c?(0,o.jsx)(wc,{onClose:r,text:_,onCopyLink:function(){c?(0,s.copyTextToClipboard)(c.join_link).then((function(){t(n("calls_create_call_by_link_copied"))})).catch(e):(0,Fo.handlePromiseError)("No event stored is store to copy :(")},onCopyText:function(){c?(0,s.copyTextToClipboard)(_).then((function(){t(n("calls_create_call_by_link_text_copied"))})).catch(e):(0,Fo.handlePromiseError)("No event stored is store to copy :(")},onSendByMessage:function(){a({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_ON_CALL_SEND_LINK})}},void 0):null},Pc=t(37184),Mc=t(62833),Dc=t(82659),jc=t(86969),Rc=function(){var e=zl().onClosePopupCalendar,n=(0,ue.useLang)().getLang,t=function(){var e=u(),n=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),t=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEventOwnerOptions})),a=(0,l.useMemo)((function(){var e={value:n.peerId,label:n.name,profile:(0,i.__assign)((0,i.__assign)({},n),{id:n.peerId})};return(0,i.__spreadArray)([e],(0,i.__read)(t||[]),!1)}),[t,n]);return(0,l.useEffect)((function(){(0,sn.getGroupsForCall)().then((function(n){if(n.count>0){var t=(n.items||[]).map((function(e){return{value:-e.id,label:e.name||"",profile:e}}));e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS,data:t})}}))}),[]),{ownerOptions:a,meParticipant:n}}(),a=t.ownerOptions,r=t.meParticipant,c=function(){var e=u(),n=(0,i.__read)((0,l.useState)(!1),2),t=n[0],a=n[1],o=(0,xc.usePromiseError)().handleError,r=(0,Lc.useNotifier)().showText,c=(0,ue.useLang)().getLang,_=(0,jc.useSendStatsDataCallScheduled)().sendCallScheduled,v=(0,cr.useMailRuCounter)().mailRuCounter,h=(0,Bl.useIsMounted)(),p=zl().onClosePopupCalendar,f=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),m=(0,Ic.useCalendarEventDetails)({meParticipant:f}).getDescription;return{handleOnSubmit:(0,l.useCallback)((function(n){return a(!0),(0,sn.messagesStartCall)((0,Mc.mapFormData)(n)).then((function(t){if(h()){var a=new Date(n.start),i={start:a,title:n.name,repeatRule:n.rrule,join_link:t.join_link,call_id:t.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},l=m(i);switch(i.description=l,(0,s.copyTextToClipboard)(l).then((function(){r(c("calls_create_call_by_link_text_copied"))})).catch(o),_({creatorId:n.groupId,sharingChannel:n.calendar}),v.push(cr.EMailRuGoals.ScheduledCall),n.calendar){case Dc.ECalendar.Other:return e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:i}),void e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL});case Dc.ECalendar.Google:var u=(0,Mc.google)((0,Mc.mapGoogleIcsUrl)(i,c));(0,Mc.openLinkInNewTab)(u,a);break;case Dc.ECalendar.iCloud:case Dc.ECalendar.Outlook:u=(0,Mc.ics)((0,Mc.mapGoogleIcsUrl)(i,c));(0,Mc.openLinkInNewTab)(u,a,!1)}p()}})).catch(o).finally((function(){h()&&a(!1)}))}),[]),loading:t}}(),_=c.handleOnSubmit,v=c.loading;return(0,o.jsx)(Pc.ModalScheduleCall,{headerTitle:n("calls_plan_event"),onClose:e,onSubmit:_,userSelectOptions:a,myUserId:r.peerId,loading:v},void 0)};var Zc=function(e){var n,t,a,r,s,_,v,h=e.SDK,p=e.bridge,f=e.onBeforeCallStart,m=e.onAfterCallFinish,A=e.tabIsMaster,g=e.navigateToConvo,C=e.callSounds,E=e.navigateToProfile,S=e.onHandCountChanged,T=e.onSuccessFeedback,I=e.okPublicKey,x=e.config,N=e.streamUrlExtractor,y=x.allowAddMembers,b=x.incomingCall,w=x.showFeedbackScreen,P=(0,c.useSelector)((function(e){return e})),M=u(),D=(0,l.useCallback)((function(){M({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),j=(0,i.__read)((0,l.useState)(null),2),R=j[0],Z=j[1],B=(0,l.useCallback)((function(e){M({type:d.E_ACTION.ERROR,text:e})}),[]),U=(0,l.useCallback)((function(){return M({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]);(0,l.useEffect)((function(){return P.mode===d.Mode.CALL?((0,O.increaseCallsCount)(),Fr(),function(){Wr()}):function(){}}),[P.mode]),function(e,n,t,a){void 0===a&&(a=[]);var i=window.document,o=i.documentElement,r=o.requestFullscreen||o.webkitRequestFullscreen;if(r){var s=!o.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,d=s?"webkitfullscreenchange":"fullscreenchange",u=s?"webkitFullscreenElement":"fullscreenElement";(0,l.useEffect)((function(){var e=function(){i.fullscreenElement?n&&n():t&&t()};return i.addEventListener(d,e),function(){return i.removeEventListener(d,e)}}),[]),(0,l.useEffect)((function(){e&&!i[u]?r.call(i.documentElement):!e&&i[u]&&c.call(i)}),a)}}(P.uiMode===d.UIMode.FULLSCREEN&&P.mode===d.Mode.CALL,(function(){var e;window.FastChat&&(Z(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!0,"call")}),(function(){var e;P.uiMode===d.UIMode.FULLSCREEN&&M({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(R),Z(null)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!1,"call")}),[P.uiMode,P.mode]),Or(h,P),(0,l.useEffect)((function(){if(P.mode===d.Mode.CALL&&((0,O.increaseCallsCount)(),P.callsCount%3==0)){var e=setTimeout((function(){return M({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!0})}),1e3);return function(){return clearTimeout(e)}}}),[P.mode]);var H,V=(0,l.useMemo)((function(){return function(){try{var e=window,n=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.CanvasCaptureMediaStreamTrack&&!0,t=Fs()[0]===Ds.Safari;return n&&!t}catch(e){return!1}}()}),[]);return H=k((function(e){return!!e.config.sferum})),(0,l.useMemo)((function(){var e=H?ee.Sferum:ee.VkCalls;ne.setAppType(e)}),[H]),(0,o.jsx)(jo,(0,i.__assign)({SDK:h,mode:P.mode,onReset:U},{children:(0,o.jsxs)(o.Fragment,{children:[(b||A())&&(0,o.jsx)(yo,{onBeforeCallStart:f,onAfterCallFinish:m,callSounds:C},void 0),P.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&P.mode===d.Mode.CALL&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(ro,{SDK:h,isVirtualBackgroundSupported:V,navigateToConvo:g,navigateToProfile:E,onHandCountChanged:S},void 0),P.localDevice.status===J.ParticipantStatus.WAITING_HALL&&P.mode===d.Mode.CALL&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(Os,{SDK:h,navigateToConvo:g,navigateToProfile:E},void 0),P.mode===d.Mode.INCOMING&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(L,{SDK:h,bridge:p},void 0),P.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&P.mode!==d.Mode.READY&&P.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(Co,{SDK:h},void 0),P.localDevice.status===J.ParticipantStatus.WAITING_HALL&&P.mode!==d.Mode.READY&&P.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(Ns,{SDK:h},void 0),P.mode===d.Mode.START&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(Ss,{},void 0),w&&P.mode===d.Mode.FEEDBACK&&(0,o.jsx)(ms,{onSuccessFeedback:T},void 0),P.mode===d.Mode.CALL_BY&&(0,o.jsx)(xs,{bridge:p},void 0),P.mode===d.Mode.JOIN&&(0,o.jsx)(Sr,(0,i.__assign)({},P.join,{bridge:p,withPopup:!0,onClose:D,onError:B,okPublicKey:I}),void 0),P.mode===d.Mode.CREATE_CALL&&(0,o.jsx)(cc,{bridge:p},void 0),P.errorShown&&(0,o.jsx)(Nr,{title:null===(n=P.error)||void 0===n?void 0:n.title,text:null===(t=P.error)||void 0===t?void 0:t.text,handleType:null===(a=P.error)||void 0===a?void 0:a.handleType,callId:null===(r=P.error)||void 0===r?void 0:r.callId,bridge:p,onCloseFatal:D},void 0),P.cautionShown&&(0,o.jsx)(wr,{isIncoming:P.isIncoming},void 0),P.groupCallSetup&&(0,o.jsx)(Qa,{SDK:h},void 0),P.isManagementOpen&&(0,o.jsx)(ri,{bridge:p,SDK:h,navigateToProfile:E,navigateToConvo:g,allowAddMembers:y},void 0),P.popup===d.POPUP_SETTINGS&&(0,o.jsx)(Do,{SDK:h},void 0),P.popup===d.POPUP_TRANSLATION&&(0,o.jsx)(es,{},d.POPUP_TRANSLATION),P.popup===d.POPUP_RECORD&&(0,o.jsx)(es,{isRecord:!0},d.POPUP_RECORD),P.popup===d.POPUP_TRANSLATION_START_COUNTDOWN&&(0,o.jsx)(ds,{},void 0),P.popup===d.POPUP_TRANSLATION_STOP&&(0,o.jsx)(ts,{},void 0),P.popup===d.POPUP_TRANSLATION_SHARE&&(0,o.jsx)(is,{link:P.translation.link,linkExtractor:N},void 0),P.popup===d.POPUP_EXIT&&(0,o.jsx)(br,{SDK:h},void 0),P.popup===d.POPUP_TRANSFER_ADMIN_RIGHTS&&(0,o.jsx)(ls,{SDK:h},void 0),P.popup===d.POPUP_UNMUTE_REQUEST&&(0,o.jsx)(Dr,{SDK:h,withVideo:!0},void 0),P.popup===d.POPUP_UNMUTE_AUDIO_REQUEST&&(0,o.jsx)(Dr,{SDK:h,withVideo:!1},void 0),P.popup===d.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&(0,o.jsx)(rs,{SDK:h},void 0),(0,Ve.hasIn)(P.popup,d.POPUP_ON_CALL_HANGUP_BUSY,d.POPUP_ON_CALL_HANGUP_KILLED,d.POPUP_ON_CALL_HANGUP_BANNED,d.POPUP_ON_CALL_HANGUP_REMOVED,d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE)&&(0,o.jsx)(uc,{},void 0),(null===(s=P.misc)||void 0===s?void 0:s.popupCalendarPlanning)===d.POPUP_ON_CALL_SEND_LINK&&(0,o.jsx)(Nc,{},void 0),(null===(_=P.misc)||void 0===_?void 0:_.popupCalendarPlanning)===d.POPUP_SHARE_PLANNED_CALL&&(0,o.jsx)(kc,{},void 0),(null===(v=P.misc)||void 0===v?void 0:v.popupCalendarPlanning)===d.POPUP_PLAN_CALENDAR_EVENT&&(0,o.jsx)(Rc,{},void 0),V&&(0,o.jsx)(nc,{SDK:h},void 0),P.participantKick&&(0,o.jsx)(vs,{SDK:h},void 0),P.membersUnban&&(0,o.jsx)(gs,{SDK:h},void 0),P.participantsManagement&&(0,o.jsx)(kr,{},void 0),P.adminAssignment&&(0,o.jsx)(Rr,{SDK:h},void 0),P.isLoaderVisible&&(0,o.jsx)(Zr.default,{},void 0)]},void 0)}),void 0)},Bc=t(40182);function Uc(e,n,t,a,o){var r=a.reduce((function(a,r){switch(r.type){case d.INCOMING_CALL:if(!Hc(e,r)){a.push(Promise.resolve());break}var s=(0,Ve.isGroupCallEvent)(r),l=s,c=(0,Ve.convertCallerFromLongpoll)(r.payload);if(!s&&c.peerId<0)JSON.parse((0,wa.decodeHTMLEntities)(r.payload.payload)).with_join_link&&(l=!0);if(l){var u=s?(0,Ve.convertChatFromLongpoll)(r.payload):(0,O.getDefaultConversation)(o);if(n({type:d.E_ACTION.LOAD_PEERS,conversation:u,members:[c],peerId:u.peerId,caller:s?u:c}),u.photo&&a.push(st(u.photo).catch((function(e){return(0,J.debugMessage)(J.DebugMessageType.WARN,e)}))),s){var _=function(e,n,t,a){return(0,sn.retryLoadCallPeers)(a).then((function(e){var a=(0,i.__read)((0,Ve.convertServerData)(e),3),o=a[0],r=a[1],s=a[2];gt(n,s),lt([o,r]).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})),n({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r})}))}(0,n,t,u.peerId);a.push(_)}}else n({type:d.E_ACTION.LOAD_PEERS,conversation:c,members:[c],peerId:c.peerId});c.photo&&a.push(st(c.photo).catch((function(e){n({type:d.E_ACTION.LOAD_PEERS,members:[(0,i.__assign)((0,i.__assign)({},c),{photo:""})]}),(0,J.debugMessage)(J.DebugMessageType.WARN,e)})))}return a}),[]);return Promise.all(r)}function Hc(e,n){return function(e){return!!e.payload.call_id}(n)&&e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL}function Vc(){return(0,c.useSelector)((function(e){return e})).isLoaderVisible?(0,o.jsx)(Zr.default,{},void 0):null}var Gc=t(14890),Fc=function(e,n,t,a){var o,r=a.isDev,s=void 0!==r&&r,l=a.token,c=a.config,u=void 0===c?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:c,_=a.localVideoResolution,v=void 0===_?d.VideoResolutionTypes.SD:_,h=a.friends,p=void 0===h?[]:h,f=a.friendsCache,m=a.privacySettings,A=a.ipSettingEnabled,g=a.pushToTalkEnabled,C=void 0!==g&&g,E=a.friendsCount,S=window.vk&&window.vk.id||e.peerId;return{anonymSecret:l,me:S,groupId:0,mode:d.Mode.READY,peer:0,participants:(o={},o[S]=(0,i.__assign)({},e),o),devices:{},localDevice:{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1,videoStreams:[]},statusData:{hand:{state:!1,ts:Date.now()}},networkStatus:1,roles:[],permissions:{audio:d.MediaPermissionType.ALLOW,video:d.MediaPermissionType.ALLOW,screenSharing:d.MediaPermissionType.ALLOW},status:J.ParticipantStatus.WAITING},callData:{type:null,ts:null,localTimeStamp:null,conversation:t},imHash:n,isDev:s,popup:null,uiMode:d.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!0,chatMembers:[],groupMembers:[],groupMembersCount:0,preselectedIds:null,friends:p,friendsCount:E,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{deferredId:null,isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:d.NoiseCancellationTypes.NEURAL,config:u,localVideoResolution:v,conversationOptions:[],privacySettings:{callsIp:(null==m?void 0:m.callsIp)||"friends"},friendsCache:f||{},groupMembersCache:{},unableToCallGroupMembersIds:[],ipSettingEnabled:A||!1,isIncoming:!1,pushToTalkEnabled:C,gridScrollPosition:0,gridScrollFirstVisible:0,oratorScrollPosition:0,oratorScrollFirstVisible:0,oratorScrollNumberOfVisible:5,callsCount:(0,O.getCallsCount)(),shouldShowDesktopAppNotification:!1,shouldShowWarningDesktopAppNotification:!0,virtualBackgroundSettings:{photos:[],videoOptions:{}},permissions:{},maps:{vkIdToDevices:new Map}}};function Wc(e,n){var t,a,o,r,s,l,c,u,_,v,h,p,f,m,A,g,C;switch(n.type){case d.E_ACTION.LOAD_PEERS:var E=n.conversation||e.callData.conversation,S={};try{for(var T=(0,i.__values)(n.members),I=T.next();!I.done;I=T.next()){var x=I.value;x&&x.peerId&&(S[x.peerId]=(0,i.__assign)((0,i.__assign)({},e.participants[x.peerId]||{}),x))}}catch(e){t={error:e}}finally{try{I&&!I.done&&(a=T.return)&&a.call(T)}finally{if(t)throw t.error}}return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),S),callData:(0,i.__assign)((0,i.__assign)({},e.callData),{conversation:E}),peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,caller:"caller"in n?n.caller:e.caller});case d.E_ACTION.CHANGE_MODE:var N=n.mode!==d.Mode.READY&&n.data&&n.data.type?n.data.type:null;if(n.mode===d.Mode.READY||n.mode===d.Mode.FEEDBACK){E=e.callData&&e.callData.conversation;var y=Fc(e.participants[e.me],e.imHash,E,{token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,friendsCache:e.friendsCache,friendsCount:e.friendsCount,privacySettings:e.privacySettings,ipSettingEnabled:e.ipSettingEnabled,isDev:e.isDev});return n.mode===d.Mode.FEEDBACK&&(y.mode=d.Mode.FEEDBACK,y.lastCallData={callId:null!==(l=null===(s=e.callData)||void 0===s?void 0:s.callId)&&void 0!==l?l:"",peerId:null!==(c=e.peer)&&void 0!==c?c:0}),y.virtualBackgroundSettings=e.virtualBackgroundSettings,y.misc=e.misc,e.hangupType===J.HangupType.BUSY?y.lastCallData=(0,i.__assign)((0,i.__assign)({},y.lastCallData||{}),{opponentName:null===(u=e.participants[e.peer])||void 0===u?void 0:u.name}):e.hangupType!==J.HangupType.KILLED&&e.hangupType!==J.HangupType.KILLED_WITHOUT_DELETE||(y.lastCallData=(0,i.__assign)((0,i.__assign)({},y.lastCallData||{}),{isMeEndedCallForAll:null===(_=e.lastCallData)||void 0===_?void 0:_.isMeEndedCallForAll})),y}e.maps.vkIdToDevices.clear();var b=(0,i.__assign)((0,i.__assign)({},e),{mode:n.mode,peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,callData:(0,i.__assign)((0,i.__assign)({},e.callData),{type:N,ts:n.ts||e.callData.ts||null}),hangupType:e.hangupType,entryPoint:n.entryPoint||e.entryPoint,join:(0,i.__assign)({},e.join||{})});return n.joinLink&&b.join&&(b.join.joinLink=n.joinLink),n.vkJoinLink&&b.join&&(b.join.vkJoinLink=n.vkJoinLink),b;case d.E_ACTION.HANGUP:return(0,i.__assign)((0,i.__assign)({},e),{hangupType:n.data});case d.E_ACTION.TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{ts:n.data})});case d.E_ACTION.LOCAL_TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{localTimeStamp:n.data})});case d.E_ACTION.REMOVE_USER:var O=(0,P.externalIdToString)(n.participantId),w=e.devices[O]?function(e,n,t){var a;return(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)((0,i.__assign)({},e.devices),(a={},a[n]=(0,i.__assign)((0,i.__assign)({},e.devices[n]),t),a))})}(e,O,{status:void 0,statusData:void 0,wasConnected:void 0,mediaSettings:{},stream:void 0,screenSharingStream:void 0}):(0,i.__assign)({},e);if(null===(v=e.maps.vkIdToDevices.get(+n.participantId.id))||void 0===v||v.delete(O),e.screenSharers[O]&&delete w.screenSharers[O],(0,P.isSameExternalId)(e.orator,n.participantId)&&(w.orator=null),(0,P.isSameExternalId)(e.pinnedParticipant,n.participantId)&&(w.pinnedParticipant=null),(0,P.isSameExternalId)(e.adminPinnedParticipant,n.participantId)&&(w.adminPinnedParticipant=null),(0,P.isSameExternalId)(e.screenSharingPinnedParticipant,n.participantId)&&(w.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(+n.participantId.id)){var L=new Set(e.participantsAddedByMe);L.delete(+n.participantId.id),w.participantsAddedByMe=L}return w;case d.E_ACTION.SET_CHAT_INFO:return(0,i.__assign)((0,i.__assign)({},e),{chatMembers:n.data,chatData:n.conversation});case d.E_ACTION.GROUP_CALL_SETUP:return(0,i.__assign)((0,i.__assign)({},e),{groupCallSetup:n.open,peer:n.peerId||e.peer||0,preselectedIds:n.preselectedIds});case d.E_ACTION.TOGGLE_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data||null});case d.E_ACTION.UPDATE_HASH:return(0,i.__assign)((0,i.__assign)({},e),{imHash:n.hash});case d.E_ACTION.CHANGE_UI_MODE:return(0,i.__assign)((0,i.__assign)({},e),{uiMode:n.mode||d.UIMode.DEFAULT});case d.E_ACTION.TOGGLE_ORATOR_MODE:return(0,i.__assign)((0,i.__assign)({},e),{isOratorMode:n.isOratorMode});case d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE:return(0,i.__assign)((0,i.__assign)({},e),{isShownParticipantsAside:n.isShownParticipantsAside});case d.E_ACTION.SET_ORATOR:return(0,i.__assign)((0,i.__assign)({},e),{orator:n.orator||null});case d.E_ACTION.SET_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{pinnedParticipant:n.pinnedParticipant});case d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{adminPinnedParticipant:n.data});case d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{screenSharingPinnedParticipant:n.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:!!n.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:n.screenSharingOldPinnedParticipant||null});case d.E_ACTION.MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{isManagementOpen:n.isOpen,managementView:n.managementView});case d.E_ACTION.CALL_STATE:b=(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),n.callData),join:(0,i.__assign)({},e.join||{}),externalId:n.externalId||e.externalId});return n.joinLink&&b.join&&(b.join.joinLink=n.joinLink),n.vkJoinLink&&b.join&&(b.join.vkJoinLink=n.vkJoinLink),b;case d.E_ACTION.CALL_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{notification:n.notification});case d.E_ACTION.JOIN:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.JOIN,join:n.data});case d.E_ACTION.CALL_BY_NAME:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.CALL_BY,callByName:n.data});case d.E_ACTION.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{mode:n.handleType===d.ErrorHandleType.FATAL?d.Mode.ERROR:e.mode,errorShown:!n.isClosed,error:{title:n.title,text:n.text,handleType:n.handleType,callId:n.callId}});case d.E_ACTION.CHANGE_PARTICIPANT_ROLES:O=n.participantId;return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),(o={},o[O]=(0,i.__assign)((0,i.__assign)({},e.participants[O]||{}),{roles:n.data}),o))});case d.E_ACTION.SET_SCREEN_SHARER:return(0,i.__assign)((0,i.__assign)({},e),{screenSharers:(0,i.__assign)((0,i.__assign)({},e.screenSharers),(r={},r[(0,P.externalIdToString)(n.participantId)]=n.isScreenSharingEnabled,r))});case d.E_ACTION.SET_FRIENDS:return(0,i.__assign)((0,i.__assign)({},e),{friends:n.data,friendsCache:(0,Vn.createFriendsCache)(n.data),friendsCount:n.friendsCount});case d.E_ACTION.SET_GROUP_MEMBERS:return(0,i.__assign)((0,i.__assign)({},e),{groupMembersCount:n.groupMembersCount,groupMembers:n.groupMembers,unableToCallGroupMembersIds:n.unableToCallGroupMembersIds,groupMembersCache:(0,Vn.createFriendsCache)(n.groupMembers)});case d.E_ACTION.SET_SPEAKERS:var k=n.data,M=k.speakers,D=k.speakersInHeader;return e=(0,i.__assign)((0,i.__assign)({},e),{speakers:M||e.speakers,speakersInHeader:D||e.speakersInHeader});case d.E_ACTION.UPDATE_PARTICIPANTS_BATCH:return function(e,n){var t=(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)({},e.devices)}),a=e.maps.vkIdToDevices;return(0,Ve.objectForEach)(n,(function(o){var r=(0,P.externalIdToString)(o.externalId),s=e.devices[r]||{};if(void 0===(null==s?void 0:s.status)&&o.status===J.ParticipantStatus.HANGUP)delete t.devices[r];else{var l=a.get(+o.externalId.id);l||(l=new Set,a.set(+o.externalId.id,l)),l.add(r);var c=o.statusData?(0,i.__assign)((0,i.__assign)({},s.statusData),o.statusData):s.statusData,d=s.wasConnected||o.status===J.ParticipantStatus.CONNECTED,u=Object.assign({},s.mediaSettings,o.mediaSettings);t.devices[r]=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e.devices[r]),n[r]),{statusData:c,wasConnected:d,mediaSettings:u})}})),t}(e,n.data);case d.E_ACTION.REMOVE_DEVICE_FROM_CACHE:var j=(0,i.__assign)({},e.devices);return delete j[O=n.id],(0,i.__assign)((0,i.__assign)({},e),{devices:j});case d.E_ACTION.SET_UNREAD_COUNT:return(0,i.__assign)((0,i.__assign)({},e),{chatUnreadCount:n.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in n?n.chatUpToMsgId:e.chatUpToMsgId});case d.E_ACTION.SHOW_CAUTION_BOX:return(0,i.__assign)((0,i.__assign)({},e),{cautionShown:n.isOpen,isIncoming:n.isIncoming||e.isIncoming});case d.E_ACTION.SHOW_LOADER:return(0,i.__assign)((0,i.__assign)({},e),{isLoaderVisible:n.isLoaderVisible});case d.E_ACTION.SET_ENTRYPOINT:return(0,i.__assign)((0,i.__assign)({},e),{entryPoint:n.entryPoint});case d.E_ACTION.SET_TOOLTIP:var R=n.tooltips?n.tooltips:Object.keys(e.tooltips).reduce((function(e,n){return e[n]=!1,e}),{});return(0,i.__assign)((0,i.__assign)({},e),{tooltips:(0,i.__assign)((0,i.__assign)({},e.tooltips),R)});case d.E_ACTION.MANUAL_ADD_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{participantsAddedByMe:(n.participants||[]).reduce((function(e,n){return e.add(n),e}),new Set(e.participantsAddedByMe))});case d.E_ACTION.SET_TRANSLATION:return(0,i.__assign)((0,i.__assign)({},e),{translation:(0,i.__assign)((0,i.__assign)({},e.translation),n.data)});case d.E_ACTION.UPDATE_ANON_SECRET:return(0,i.__assign)((0,i.__assign)({},e),{anonymSecret:n.secret});case d.E_ACTION.TOGGLE_PARTICIPANTS_KICK:return(0,i.__assign)((0,i.__assign)({},e),{participantKick:n.data?{participant:n.data.participant,type:n.data.type}:null});case d.E_ACTION.UNBAN_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{membersUnban:n.data?{members:n.data.members}:null});case d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{participantsManagement:n.data?{mode:n.data.mode,device:n.data.device}:null});case d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT:return(0,i.__assign)((0,i.__assign)({},e),{adminAssignment:n.data?{participant:n.data.participant}:null});case d.E_ACTION.SET_NOISE_CANCELLATION:return(0,i.__assign)((0,i.__assign)({},e),{noiseCancellation:n.data});case d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION:return(0,i.__assign)((0,i.__assign)({},e),{localVideoResolution:n.data});case d.E_ACTION.SET_CONVERSATION_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{conversationOptions:n.data});case d.E_ACTION.SET_PRIVACY_SETTINGS:return(0,i.__assign)((0,i.__assign)({},e),{privacySettings:n.data});case d.E_ACTION.SET_GROUP:return(0,i.__assign)((0,i.__assign)({},e),{groupId:n.groupId,meGroup:n.meGroup});case d.E_ACTION.SET_WAITING_HALL:return(0,i.__assign)((0,i.__assign)({},e),{waitingHall:n.data});case d.E_ACTION.SET_PUSH_TO_TALK_ENABLE:return(0,i.__assign)((0,i.__assign)({},e),{pushToTalkEnabled:n.data});case d.E_ACTION.SET_GRID_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{gridScrollPosition:n.position,gridScrollFirstVisible:n.firstVisible});case d.E_ACTION.SET_ORATOR_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{oratorScrollPosition:n.position,oratorScrollFirstVisible:n.firstVisible,oratorScrollNumberOfVisible:n.numberOfVisible});case d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowDesktopAppNotification:n.data});case d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowWarningDesktopAppNotification:n.data});case d.E_ACTION.SET_START_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{startOptions:n.data});case d.E_ACTION.VB_SET_USER_PHOTOS:return zc(e,{photos:(0,i.__spreadArray)([],(0,i.__read)(n.photos),!1)});case d.E_ACTION.VB_ADD_USER_PHOTO:return zc(e,{photos:(0,i.__spreadArray)([n.photo],(0,i.__read)(e.virtualBackgroundSettings.photos),!1)});case d.E_ACTION.VB_REMOVE_USER_PHOTO:return zc(e,{photos:e.virtualBackgroundSettings.photos.filter((function(e){return e.id!==n.photoId}))});case d.E_ACTION.VB_SET_VIDEO_OPTIONS:return zc(e,{videoOptions:n.videoOptions});case d.E_ACTION.SET_CALL_PERMISSIONS:var Z=n.data;return Z[J.MediaOption.AUDIO]===e.permissions[J.MediaOption.AUDIO]&&Z[J.MediaOption.VIDEO]===e.permissions[J.MediaOption.VIDEO]&&Z[J.MediaOption.SCREEN_SHARING]===e.permissions[J.MediaOption.SCREEN_SHARING]?e:(0,i.__assign)((0,i.__assign)({},e),{permissions:n.data});case d.E_ACTION.SET_PARTICIPANTS_CHUNK:return(0,i.__assign)((0,i.__assign)({},e),{participantsChunk:(0,i.__assign)({countBefore:null!==(p=null===(h=e.participantsChunk)||void 0===h?void 0:h.countBefore)&&void 0!==p?p:0,ids:null!==(m=null===(f=e.participantsChunk)||void 0===f?void 0:f.ids)&&void 0!==m?m:[],countAfter:null!==(g=null===(A=e.participantsChunk)||void 0===A?void 0:A.countAfter)&&void 0!==g?g:0},n.data)});case d.E_ACTION.SET_PARTICIPANT_HAND_STATE:var B=n.key,U=n.value,H=e.handState;if((null!==(C=null==H?void 0:H[B])&&void 0!==C&&C)===U)return e;var V=(0,i.__assign)({},H);return V[B]=U,U||delete V[B],(0,i.__assign)((0,i.__assign)({},e),{handState:V});case d.E_ACTION.CLEAN_LAST_CALL_DATA:return Kc(e,{opponentName:void 0,isMeEndedCallForAll:void 0});case d.E_ACTION.SET_LAST_CALL_DATA:return Kc(e,n.data);case d.E_ACTION.SET_LOCAL_DEVICE:return(0,i.__assign)((0,i.__assign)({},e),{localDevice:(0,i.__assign)((0,i.__assign)({},e.localDevice),n.data)});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT:return Qc(e,{plannedCalendarEvent:n.data});case d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING:return Qc(e,{popupCalendarPlanning:n.data});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS:return Qc(e,{plannedCalendarEventOwnerOptions:n.data});case d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowRecordEndedDesktopAppNotification:n.data});default:return e}}function zc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{virtualBackgroundSettings:(0,i.__assign)((0,i.__assign)({},e.virtualBackgroundSettings),n)})}function Kc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{lastCallData:(0,i.__assign)((0,i.__assign)({},e.lastCallData||{}),n)})}function Qc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{misc:(0,i.__assign)((0,i.__assign)({},e.misc||{}),n)})}var Yc=t(87080);function Jc(e,n){switch(n.type){case Yc.HistoryScreenActionTypes.DELETE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{deleteCallId:n.data});case Yc.HistoryScreenActionTypes.SET_CURRENT_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{currentCalls:n.data});case Yc.HistoryScreenActionTypes.SET_HISTORY_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{historyCalls:n.data});case Yc.HistoryScreenActionTypes.SET_PROFILES:return(0,i.__assign)((0,i.__assign)({},e),{profiles:(0,i.__assign)((0,i.__assign)({},e.profiles),n.data)});case Yc.HistoryScreenActionTypes.SET_URLS:return(0,i.__assign)((0,i.__assign)({},e),{joinLinks:(0,i.__assign)((0,i.__assign)({},e.joinLinks),n.data)});case Yc.HistoryScreenActionTypes.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{error:n.data});case Yc.HistoryScreenActionTypes.SET_LOADING:return(0,i.__assign)((0,i.__assign)({},e),{loading:n.data});case Yc.HistoryScreenActionTypes.SET_SHOW_CREATE_BUTTON:return(0,i.__assign)((0,i.__assign)({},e),{showCreateCall:n.data});case Yc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCalls:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCalls||{}),n.data):void 0});case Yc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCallsPreview:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCallsPreview||{}),n.data):void 0});case Yc.HistoryScreenActionTypes.SET_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data});case Yc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{scheduledEditableCall:n.data});case Yc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE:return(0,i.__assign)((0,i.__assign)({},e),{callsQueueResponse:n.data});default:return e}}var Xc=function(e){var n=e.onClose,t=e.actionButtons,a=e.text,r=sc().getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"DeleteCallModal",title:r("calls_history_delete_modal_title"),actionButtons:t,onClose:n,appearance:"blue"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"DeleteCallModal__content"},{children:a}),void 0)}),void 0)},qc=t(95098),$c=c.useSelector,ed=function(){return(0,c.useDispatch)()},nd=t(50611),td=function(){var e=ed(),n=sc(),t=n.getLang,a=n.langShortDateTime,r=$c((function(e){return e.deleteCallId})),s=$c((function(e){return e.profiles})),c=$c((function(e){return e.historyCalls})),d=$c((function(e){return e.currentCalls})),u=r in c?c[r]:null,_=(0,l.useCallback)((function(){e((0,nd.dispatchDeleteCall)(-1))}),[]),v=(0,l.useCallback)((function(){if((null==u?void 0:u.type)&&"merged"===(null==u?void 0:u.type)&&(null==u?void 0:u.items)){var n=u.items.reduce((function(e,n){return(null==n?void 0:n.id)&&e.push(n.id),e}),[]);n.length>0&&(0,J.removeHistoryRecords)(n)}else(null==u?void 0:u.id)&&(0,J.removeHistoryRecords)([u.id]);c.splice(r,1),e((0,nd.dispatchSetHistoryCalls)((0,i.__spreadArray)([],(0,i.__read)(c),!1))),_()}),[u]),h=(0,l.useCallback)((function(){if(null==u?void 0:u.call_id){(0,sn.forceCallFinish)(u.call_id);var n=d.filter((function(e){return e.call_id!==u.call_id}));e((0,nd.dispatchSetCurrentCalls)(n))}v()}),[u]),p=[];if((null==u?void 0:u.can_finish_call)&&(p=p.concat([(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){h()},appearance:"secondary"},{children:t("calls_history_delete_and_finish_call_button")}),"finishAndDeleteCall")])),p=p.concat([(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:function(){v()}},{children:t("calls_history_delete_call_button")}),"deleteCall")]),!u)return(0,o.jsx)(o.Fragment,{},void 0);var f=(0,qc.getHistoryItemOwner)(u,s),m=f.member,A=f.chat;if(!m&&!A)return(0,o.jsx)(o.Fragment,{},void 0);var g="";if(A)g=t("calls_history_delete_group_call").replace("%name",(0,Ve.shorten)(A.title,50));else{if(!m)return(0,o.jsx)(o.Fragment,{},void 0);var C=u.is_missed,E=u.is_inbound;g=(g=t(C&&E?"calls_history_delete_missed_call":!C&&E?"calls_history_delete_inbound_call":C&&!E?"calls_history_delete_declined_call":"calls_history_delete_outbound_call")).replace("%name",String(m.nameGen||m.name))}var S=(null==u?void 0:u.finished_at)?a(u.finished_at):"";return g=g.replace("%date",S),(0,o.jsx)(Xc,{onClose:_,actionButtons:p,text:g},void 0)},ad=t(69050),id=t(84330),od=t(3244),rd=t(6057);const sd=(0,X.makeIcon)("Icon16CalendarOutline","calendar_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="calendar_outline_16"><path fill="currentColor" d="M12 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" /><path fill="currentColor" fill-rule="evenodd" d="M5 .5a.75.75 0 0 1 .75.75v.25H10.251v-.25a.75.75 0 0 1 1.5 0v.318c.347.047.669.13.975.286a3.25 3.25 0 0 1 1.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672V9.78c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.272a3.25 3.25 0 0 1-1.42 1.42c-.391.2-.81.28-1.273.318-.447.037-.998.037-1.671.037H6.219c-.674 0-1.224 0-1.672-.037-.463-.037-.882-.118-1.272-.317a3.25 3.25 0 0 1-1.42-1.42c-.2-.391-.28-.81-.318-1.273-.037-.447-.037-.998-.037-1.672V6.22c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 0 1 1.42-1.42c.306-.156.628-.24.976-.287V1.25A.75.75 0 0 1 5 .5ZM10.25 3v.25a.75.75 0 0 0 1.5 0v-.16c.125.028.218.062.294.1a1.75 1.75 0 0 1 .765.766c.074.144.13.343.16.713.027.333.03.751.03 1.331H3c0-.58.004-.998.032-1.331.03-.37.085-.57.159-.713a1.75 1.75 0 0 1 .764-.765c.077-.04.17-.073.295-.101v.16a.75.75 0 1 0 1.5 0V3h4.5ZM3 7.5v2.25c0 .712 0 1.202.032 1.58.03.371.085.57.159.714a1.75 1.75 0 0 0 .765.765c.144.074.343.13.713.16.38.03.869.031 1.581.031h3.5c.712 0 1.202 0 1.58-.032.371-.03.57-.085.714-.159a1.75 1.75 0 0 0 .765-.765c.074-.144.13-.343.16-.713.03-.38.031-.869.031-1.581V7.5H3Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var ld=function(e){var n=e.onCreateCallClick,t=e.onPlanCalendarEvent,a=sc().getLang;return(0,o.jsx)(od.default,(0,i.__assign)({title:"",isSaved:!1,savedTitle:"",className:""},{children:(0,o.jsx)(Tn.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall",border:!1},{children:(0,o.jsx)(In.default,(0,i.__assign)({chevron:!1,selectable:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(Bn.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:n,size:"s"},{children:[(0,o.jsx)(rd.default,{width:16,height:16},void 0),a("calls_page_call_by_link_create")]}),void 0),(0,o.jsxs)(Bn.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:t,appearance:"secondary",size:"s"},{children:[(0,o.jsx)(sd,{},void 0),a("calls_landing_standalone_schedule_call")]}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenCreateCall--title"},{children:a("calls_page_call_by_link_header_v2")}),void 0)}),void 0)}),void 0)}),void 0)},cd=function(e){var n=e.showCreateCall,t=e.onCreateCallClick,a=e.activeMenuItem,r=e.menuItems,s=e.onMenuItemClick,l=e.loading,c=e.banner,d=e.children,u=e.onPlanCalendarEvent;return(0,o.jsx)(ad.PageColumns,(0,i.__assign)({narrow:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(id.RightMenu,{tabs:r,activeTab:a,onTabClick:s,loading:l},void 0),c]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen"},{children:[n&&(0,o.jsx)(ld,{onCreateCallClick:function(){return t(Ja.CallStatSource.HISTORY_CREATE)},onPlanCalendarEvent:u},void 0),d]}),void 0)}),void 0)},dd=(0,l.createContext)({bridge:{},SDK:{}}),ud=function(){return(0,l.useContext)(dd)},_d=function(){var e=ud().bridge,n=(0,l.useCallback)((function(n){e.showCreateCallByLinkPopup(n)}),[e]),t=(0,l.useCallback)((function(n,t,a){void 0===t&&(t=0),e.showStartCallModal(t,n,a)}),[e]),a=(0,l.useCallback)((function(){e.showPlanCalendarEventPopup()}),[e]),i=(0,l.useCallback)((function(n){var t;null===(t=e.setPlannedCalendarEvent)||void 0===t||t.call(e,n)}),[e]);return{onCreateCallClick:n,onJoin:t,onPlanCalendarEvent:a,setPlannedCalendarEvent:i}},vd=function(){var e=$c((function(e){return e.loading})),n=ed(),t=(0,l.useCallback)((function(e){n((0,nd.dispatchSetLoading)(e))}),[]);return{loading:e,setLoading:t}};const hd=(0,X.makeIcon)("Icon12ArrowDownLeft","arrow_down_left_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_down_left_12"><path d="M3 10a1 1 0 0 1-1-1V4a1 1 0 0 1 2 0v2.586l4.293-4.293a1 1 0 0 1 1.414 1.414L5.415 8.001 8 8a1 1 0 0 1 0 2z" fill="currentColor" /></symbol>',12,12,!1,void 0),pd=(0,X.makeIcon)("Icon12ArrowUpRight","arrow_up_right_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_up_right_12"><path d="M9 2a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V5.414L3.707 9.707a1 1 0 0 1-1.414-1.414l4.292-4.294L4 4a1 1 0 0 1 0-2z" fill="currentColor" /></symbol>',12,12,!1,void 0);var fd=t(67458),md=t(39446);const Ad=(0,X.makeIcon)("Icon24PhoneOutline","phone_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="phone_outline_24"><g fill="none"><path d="M0 0h24v24H0z" /><path d="M4.477 4.116c-2.924 3.217-1.362 8.196 2.932 12.51 4.204 4.222 9.407 5.8 12.486 2.936 1.685-1.567 1.436-4.343-.645-6.198l-.19-.161c-1.931-1.563-4.734-1.568-6.445-.027l-.088.082-.05-.042c-.187-.16-.43-.381-.724-.673l-.298-.303-.306-.326c-.092-.101-.174-.194-.246-.277l-.124-.147-.07.075c1.69-1.697 1.706-4.72.006-6.75-1.887-2.255-4.75-2.335-6.238-.699zM9.335 5.97c1.18 1.41 1.049 3.371.099 4.325l-.148.14c-.63.567-1.246.901 1.032 3.218 2.458 2.499 2.765 1.622 3.405.952 1.006-1.01 2.975-1.104 4.329.103 1.497 1.334 1.335 2.868.617 3.536-2.222 2.067-6.476.636-9.984-2.888-3.507-3.523-5.064-7.622-2.876-10.03.508-.558 2.101-1.057 3.526.644z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),gd=(0,X.makeIcon)("Icon24VideocamOutline","videocam_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="videocam_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M1 10.9c0-2.24 0-3.36.436-4.216a4 4 0 0 1 1.748-1.748C4.04 4.5 5.16 4.5 7.4 4.5h3.2c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.155.305.255.643.32 1.053l.577-.414c.948-.68 1.422-1.02 1.785-1.15a2.8 2.8 0 0 1 3.65 1.874C23 8.418 23 9 23 10.167v4.02c0 1.04 0 1.56-.093 1.9a2.6 2.6 0 0 1-3.309 1.781c-.335-.109-.769-.395-1.637-.967l-1.067-.704c-.064.44-.167.798-.33 1.119a4 4 0 0 1-1.748 1.748c-.856.436-1.976.436-4.216.436H7.4c-2.24 0-3.36 0-4.216-.436a4 4 0 0 1-1.748-1.748C1 16.46 1 15.34 1 13.1v-2.2Zm6.4-4.6h3.2c1.15 0 1.904.001 2.48.049.556.045.787.124.919.19a2.2 2.2 0 0 1 .961.962c.067.132.146.363.191.918.048.577.049 1.331.049 2.481v2.2c0 1.15-.001 1.904-.048 2.48-.046.556-.125.787-.192.919a2.2 2.2 0 0 1-.961.961c-.132.067-.363.146-.918.191-.577.048-1.331.049-2.481.049H7.4c-1.15 0-1.904-.001-2.48-.049-.556-.045-.787-.124-.919-.19a2.2 2.2 0 0 1-.961-.962c-.067-.132-.146-.363-.191-.918C2.8 15.004 2.8 14.25 2.8 13.1v-2.2c0-1.15.001-1.904.049-2.48.045-.556.124-.787.19-.919a2.2 2.2 0 0 1 .962-.961c.132-.067.363-.146.918-.192C5.496 6.301 6.25 6.3 7.4 6.3Zm10.153 3.172.957-.686c.486-.348.808-.579 1.054-.741l.295-.18a1 1 0 0 1 1.302.663s.017.084.027.35c.012.296.012.692.012 1.29v4.02c0 .534 0 .883-.01 1.142a2.89 2.89 0 0 1-.022.288.8.8 0 0 1-1.004.541 2.852 2.852 0 0 1-.253-.14 33.487 33.487 0 0 1-.959-.62l-1.356-.895a247.905 247.905 0 0 1-.35-.237.7.7 0 0 1-.24-.446S17 13.422 17 13.398v-2.85l.005-.403a.7.7 0 0 1 .223-.434s.307-.226.325-.24Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Cd,Ed=t(81536);!function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.MESSAGE=2]="MESSAGE",e[e.DELETE=3]="DELETE"}(Cd||(Cd={}));var Sd=function(e,n){void 0===n&&(n=0);var t="";if(n){var a=new Date(n);if((0,s.isDateToday)(a)){var i=(0,s.leadingZero)(a.getMinutes());t=a.getHours()+":"+i}else t=n?e(n,!1):""}return t},Td=function(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}},Id=(0,l.memo)((function(e){var n=e.index,t=e.call,a=e.onMenuItemClick,r=e.selectedOwnerId,c=void 0===r?0:r,d=$c((function(e){return e.profiles})),u=sc(),_=u.getLang,v=u.langShortDate,h=(0,qc.getHistoryItemOwner)(t,d),p=h.member,f=h.chat,m=(0,l.useMemo)((function(){var e=t.type,r=t.items,l=t.started_at,c=t.finished_at,d="";l&&c&&(d=(0,s.formatDuration)(Math.floor((c-l)/1e3)));var u=function(e){if(void 0===e&&(e=0),!e)return{date:"",time:""};var n=new Date(e),t=n.getDate(),a=n.getMonth()+1,i=n.getFullYear(),o=n.getHours(),r=n.getMinutes();return{date:[(0,s.leadingZero)(t),(0,s.leadingZero)(a),i].join("."),time:[(0,s.leadingZero)(o),(0,s.leadingZero)(r)].join(":")}}(c),h=u.date,m=u.time,A=f?function(e,n,t,a){var i=t.title,o=void 0===i?"":i,r=t.photo_100,s=void 0===r?"":r,l=t.id,c=void 0===l?0:l,d=a.finished_at,u=void 0===d?0:d,_=c?"/im?sel=c"+c:"",v=e("calls_history_call_type_group_hint"),h=Sd(n,u);return{title:o,href:_,hint:h?e("calls_history_call_type_group_time_hint").replace("{time}",h):"",photo:s,status:v}}(_,v,f,t):p?function(e,n,t,a){var r=t.name,l=void 0===r?"":r,c=t.photo,d=void 0===c?"":c,u=t.id,_=void 0===u?0:u,v=t.link,h=void 0===v?"":v,p=a.is_inbound,f=void 0!==p&&p,m=a.finished_at,A=void 0===m?0:m,g=a.reach_status,C=void 0===g?"":g,E=f?(0,o.jsx)(hd,{className:"CallHistoryListItem--hintIcon"},void 0):(0,o.jsx)(pd,{className:"CallHistoryListItem--hintIcon"},void 0),S=Sd(n,A),T="",I=!1;return f?"CANCELLED_BY_INITIATOR"===C?(T=e("calls_history_status_inb_cancelled_by_initiator"),I=!0):T=e("REACHED"===C?"calls_history_status_inb_reached":"REJECTED_BY_RECEIVER"===C?"calls_history_status_inb_reject_by_receiver":"calls_history_status_inb"):"CANCELLED_BY_INITIATOR"===C?T=e("calls_history_status_out_cancelled_by_initiator"):"REACHED"===C?T=e("calls_history_status_out_reached"):"REJECTED_BY_RECEIVER"===C?(T=e("calls_history_status_out_reject_by_receiver"),I=!0):T=e("calls_history_status_out"),{title:l,href:h||"/id"+_,hint:(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallHistoryListItem",{"CallHistoryListItem--important":I})},{children:[E,e("calls_history_call_list_item_description").replace("%type",T).replace("%time",S)]}),void 0),photo:d,status:T}}(_,v,p,t):{},g=A.title,C=void 0===g?"":g,E=A.photo,S=void 0===E?"":E,T=A.href,I=void 0===T?"":T,x=A.hint,N=void 0===x?"":x,y=A.status,b=void 0===y?"":y;C+="merged"===e?" ("+(null==r?void 0:r.length)+")":"";var O=(0,qc.getHistoryCallPeerId)(t),w=[],L=function(e){return function(){return a(t,e,n)}};return w.push({onClick:function(){},noHover:!0,text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatus"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusFinishTime"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDate"},{children:h}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusTime"},{children:m}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusType"},{children:b}),void 0),!!d&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDuration"},{children:d}),void 0)]}),void 0)}),O&&(w.push(Td((0,o.jsx)(fd.default,{},void 0),_("calls_history_dropdown_item_message"),L(Cd.MESSAGE))),w.push({separator:!0})),w.push(Td((0,o.jsx)(md.default,{},void 0),_("calls_history_dropdown_item_delete"),L(Cd.DELETE))),{title:C,photo:S,href:I,hint:N,actions:w,peerId:O}}),[t]),A=m.title,g=m.photo,E=m.href,S=m.hint,T=m.actions,I=m.peerId;return p||f?(0,o.jsx)(In.default,(0,i.__assign)({className:"CallHistoryListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--aside"},{children:[!!I&&!(null==f?void 0:f.left_or_kicked)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_audio")},{children:(0,o.jsx)(Ad,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return a(t,Cd.AUDIO,n,c)}},void 0)}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_video")},{children:(0,o.jsx)(gd,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return a(t,Cd.VIDEO,n,c)}},void 0)}),void 0)]},void 0),(0,o.jsx)(Xe.default,(0,i.__assign)({className:"CallHistoryListItem--asideMenu",trigger:"hover",align:"right",data:T},{children:(0,o.jsx)(Ed.default,{className:"CallHistoryScreen--friendsIcon CallHistoryListItem--asidePointers"},void 0)}),void 0)]}),void 0)},{children:(0,o.jsx)(Zn.default,{className:"CallHistoryListItem--entity",photo:g,title:A,href:E,description:S||_("calls_history_call_type_group_hint"),target:"_blank"},void 0)}),void 0):(0,o.jsx)(o.Fragment,{},void 0)})),xd=t(23985),Nd=function(e){var n=e.calls,t=e.onMenuItemClick,a=e.stubText,r=e.hasMore,s=e.onLoadMore,l=e.selectedOwnerId,c=void 0===l?0:l;return(0,o.jsx)(xd.default,(0,i.__assign)({useWindowScroll:!0,hasMore:r,loadMore:s},{children:(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[n.map((function(e,n){return(0,o.jsx)(Id,{selectedOwnerId:c,onMenuItemClick:t,call:e,index:n},n)})),0===n.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:a}),void 0)]}),void 0)}),void 0)},yd=(0,l.createContext)({navigateToConvo:function(e){},navigateToProfile:function(e,n){}}),bd=function(){return(0,l.useContext)(yd)},Od=function(){var e=$c((function(e){return e.profiles})),n=$c((function(e){return e.joinLinks})),t=ed(),a=bd().navigateToConvo,i=ud().bridge,o=(0,l.useCallback)((function(o,r,s,l){var c;void 0===l&&(l=0);var u=(0,qc.getHistoryCallPeerId)(o);if(r===Cd.AUDIO||r===Cd.VIDEO){if(i.isInActiveCall)return;var _=r===Cd.VIDEO;if((0,O.isGroupCallByPeer)(u))if(u in n)i.joinCallByLink(n[u],void 0,_,d.CallStatSource.HISTORY,l);else{var v=(0,qc.getHistoryItemOwner)(o,e).chat;(null==v?void 0:v.call_in_progress)&&(null===(c=null==v?void 0:v.call_in_progress)||void 0===c?void 0:c.join_link)?i.joinCallByLink(v.call_in_progress.join_link,void 0,_,d.CallStatSource.HISTORY,l):i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else r===Cd.MESSAGE?a(u):t((0,nd.dispatchDeleteCall)(s))}),[n,e,i]);return{onHistoryAction:o}},wd=function(e){void 0===e&&(e="all");var n=(0,Bl.useIsMounted)(),t=$c((function(e){return e.historyCalls})),a=(0,c.useDispatch)(),o=vd(),r=o.setLoading,s=o.loading,d=(0,i.__read)((0,l.useState)(!1),2),u=d[0],_=d[1],v=(0,i.__read)((0,l.useState)(0),2),h=v[0],p=v[1],f=(0,i.__read)((0,l.useState)(!1),2),m=f[0],A=f[1];(0,l.useEffect)((function(){r(!0),(0,nd.loadHistoryCalls)(a,25,h,0,e).then((function(e){var t,a;if(n())return _(null!==(t=e.has_more)&&void 0!==t&&t),p(null!==(a=e.next_from)&&void 0!==a?a:0),e})).then((function(e){e&&(0,nd.updateProfilesAndUrls)(a,[e]).then((function(e){A(!e)}))})).finally((function(){n()&&r(!1)}))}),[]);var g=function(t,i,o,r){return void 0===o&&(o=[]),void 0===r&&(r=!1),(0,nd.loadHistoryCalls)(a,25,t,i,e,o,r).then((function(e){var t,a;return!!n()&&(_(null!==(t=e.has_more)&&void 0!==t&&t),p(null!==(a=e.next_from)&&void 0!==a?a:0),e)})).then((function(e){return!!e&&(0,nd.updateProfilesAndUrls)(a,[e])}))};return{onShowMoreHistory:function(){return g(h,0,t)},loadHistory:g,loading:s,showMoreHistory:u,showLanding:m,setLoading:r}},Ld=function(){var e=$c((function(e){return e.historyCalls})),n=sc().getLang,t=wd("missed"),a=t.onShowMoreHistory,r=t.loading,s=t.showMoreHistory,l=Od().onHistoryAction;return r?(0,o.jsx)(od.default,{children:(0,o.jsx)(Ml.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsx)(od.default,(0,i.__assign)({title:n("calls_history_missed_list_header"),className:"CallHistoryScreen--content"},{children:(0,o.jsx)(Nd,{calls:e,onMenuItemClick:l,stubText:n("calls_history_missed_list_stub"),hasMore:s,onLoadMore:a},void 0)}),void 0)},kd=t(25432),Pd=t(60837),Md=t(33024),Dd=function(e){var n=e.onChange,t=e.placeholder,a=e.className,r=(0,i.__read)((0,l.useState)(""),2),c=r[0],d=r[1];return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ui_search_new","ui_search",a)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_block"},{children:[(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_button_search"},{children:(0,o.jsx)(Pd.default,{},void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_inner"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ui_search_controls"},{children:!!c&&(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_reset_button ui_search_button_control",onClick:function(){d(""),null==n||n("")}},{children:(0,o.jsx)(Md.default,{},void 0)}),void 0)}),void 0),(0,o.jsx)("form",(0,i.__assign)({onSubmit:function(e){e.preventDefault()}},{children:(0,o.jsx)("input",{type:"text",className:"ui_search_field",placeholder:t,value:c,onChange:function(e){e.preventDefault();var t=e.target.value;d(t),null==n||n(t)}},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},jd=100;var Rd=function(){var e=sc(),n=e.getLang,t=e.langShortDate,a=e.langNumeric,r=e.langSex,s=$c((function(e){return e.meId})),c=vd(),u=c.setLoading,_=c.loading,v=ud().bridge,h=(0,i.__read)((0,l.useState)([]),2),p=h[0],f=h[1],m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],g=m[1],C=(0,i.__read)((0,l.useState)(0),2),E=C[0],S=C[1],T=(0,i.__read)((0,l.useState)(0),2),I=T[0],x=T[1],y=(0,i.__read)((0,l.useState)(""),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)(!1),2),L=w[0],k=w[1],P=(0,l.useRef)(null),M=$c((function(e){return!!e.config.enableNewSearchInput}));(0,l.useEffect)((function(){u(!0);(0,sn.getFriends)(100,E).then((function(e){var n=e.count,t=e.items;x(n);g(100<n),S(100);var a=t.map(Vn.normalizeUser);f(a)})).finally((function(){u(!1)}))}),[]);var D=(0,l.useMemo)((function(){return I>jd}),[I]);(0,l.useEffect)((function(){var e=b;if(D){if(e.length>=1&&!L)return P.current&&clearTimeout(P.current),P.current=setTimeout((function(){k(!0),(0,sn.friendsSearch)(s,e,50).then((function(e){var n=e.count,t=e.items;g(50<n),S(50);var a=t.map(Vn.normalizeUser);f(a)})).finally((function(){k(!1)}))}),1e3),function(){clearTimeout(P.current)};0===e.length&&(0,sn.getFriends)(jd,0).then((function(e){var n=e.count,t=e.items;g(100<n),S(100);var a=t.map(Vn.normalizeUser);f(a)}))}}),[b]);var j=(0,l.useCallback)((function(e,n){v.call(e,n,void 0,d.CallStatSource.HISTORY_FRIENDS_LIST)}),[]),R=(0,l.useCallback)((function(e){return e.name}),[]),Z=(0,l.useCallback)((function(e){return e.peerId}),[]),B=N(p,R,Z),U=b&&!D?B.search(b):p,H=(0,l.useCallback)((function(e){O(e.target.value)}),[]),V=function(e,s){var l,c,d,u,_,v,h,p="";return(null===(l=e.onlineInfo)||void 0===l?void 0:l.is_online)?p="Online":(null===(c=e.onlineInfo)||void 0===c?void 0:c.last_seen)?p=function(e,n,t,a){var i=Math.floor((Date.now()-a)/1e3);return i<60?e("global_just_now"):i<3600?n(Math.floor(i/60),"global_mins_ago",e("global_mins_ago",!0)):i<21600?n(Math.floor(i/3600),"global_hours_ago",e("global_hours_ago",!0)):t(a,!1)}(n,a,t,1e3*(null===(d=e.onlineInfo)||void 0===d?void 0:d.last_seen)):(null===(u=e.onlineInfo)||void 0===u?void 0:u.status)&&(p="recently"===(null===(_=e.onlineInfo)||void 0===_?void 0:_.status)?r(e.sex,"global_online_was_recently",n("global_online_was_recently",!0)):"last_week"===(null===(v=e.onlineInfo)||void 0===v?void 0:v.status)?r(e.sex,"global_online_was_week",n("global_online_was_week",!0)):r(e.sex,"global_online_long_ago",n("global_online_long_ago",!0))),(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsIcons"},{children:[(0,o.jsx)(Ad,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return j(e.peerId,!1)}},void 0),(0,o.jsx)(gd,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return j(e.peerId,!0)}},void 0)]}),void 0)},{children:(0,o.jsx)(Zn.default,{size:"34",photo:(0,o.jsx)(kd.default,{id:s,photo:e.photo,title:e.name,isOnline:null===(h=e.onlineInfo)||void 0===h?void 0:h.is_online},void 0),title:e.name,href:e.link,description:p,target:"_blank"},void 0)}),s)};return _?(0,o.jsx)(od.default,{children:(0,o.jsx)(Ml.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsxs)(od.default,(0,i.__assign)({title:n("calls_page_menu_friends_calls"),className:"CallHistoryScreen--content"},{children:[!M&&(0,o.jsx)(Mn.BlockSearchInput,{className:"CallParticipantList__input",value:b,placeholder:n("global_search"),onChange:H,onInput:H,onPaste:H},void 0),M&&(0,o.jsx)(Dd,{className:"CallParticipantList__input--new",placeholder:n("global_search"),onChange:O},void 0),(0,o.jsx)(xd.default,(0,i.__assign)({useWindowScroll:!0,hasMore:A,loadMore:function(){return b&&D?(0,sn.friendsSearch)(s,b,50,E).then((function(e){var n=e.count,t=e.items,a=E+50;g(a<n),S(a);var o=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(p),!1),(0,i.__read)(t.map(Vn.normalizeUser)),!1);return f(o),!0})):(0,sn.getFriends)(jd,E).then((function(e){var n=e.items,t=E+jd;g(t<I),S(t);var a=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(p),!1),(0,i.__read)(n.map(Vn.normalizeUser)),!1);return f(a),!0}))}},{children:(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[U.map((function(e,n){return V(e,n)})),0===U.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:n("calls_page_friends_not_found")}),void 0)]}),void 0)}),void 0)]}),void 0)},Zd=t(80170);var Bd=function(e){var n=e.call,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a,s=$c((function(e){return e.profiles})),c=sc(),u=c.getLang,_=c.langNumeric,v=(0,qc.getCurrentCallOwner)(n,s),h=v.member,p=v.chat,f=(0,l.useMemo)((function(){var e,t,a=p?function(e){var n=e.title,t=void 0===n?"":n,a=e.photo_100,i=void 0===a?"":a,o=e.id,r=void 0===o?0:o;return{title:t,photo:i,href:r?"/im?sel=c"+r:"",id:r}}(p):h?function(e){var n=e.name,t=void 0===n?"":n,a=e.photo,i=void 0===a?"":a,o=e.link,r=void 0===o?"":o,s=e.id,l=void 0===s?0:s;return{title:t,photo:i,href:r||"/im?sel=c"+l,id:l}}(h):{},o=a.id,r=void 0===o?0:o,l=a.title,c=void 0===l?"":l,d=a.photo,v=void 0===d?"":d,f=a.href,m=void 0===f?"":f,A=n.users_count,g=n.user_ids,C=n.join_link,E=void 0===C?"":C,S=n.caller_id,T=n.name;S&&(0,P.isParticipantGroup)(S)&&(c=T||c);var I=_(A,"calls_history_members_count",u("calls_history_members_count",A)).replace("%n",String(A)),x=g.slice(0,3),N=[];try{for(var y=(0,i.__values)(x),b=y.next();!b.done;b=y.next()){var O=b.value;O in s&&N.push((0,Vn.getMemberForUserStack)(s[O]))}}catch(n){e={error:n}}finally{try{b&&!b.done&&(t=y.return)&&t.call(y)}finally{if(e)throw e.error}}return{id:r,title:c,photo:v,href:m,description:I,join_link:E,avatarItems:N}}),[p,n,h,s]),A=f.id,g=f.title,C=f.photo,E=f.href,S=f.description,T=f.avatarItems,I=f.join_link;return h||p?(0,o.jsx)(In.default,(0,i.__assign)({border:r,className:"CurrentCallsListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)(o.Fragment,{children:[T.length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"CurrentCallsListItem--avatarStack"},{children:(0,o.jsx)(Zd.AvatarsStackNoSvg,{size:Zd.AvatarsStackNoSvgSizes.SIZE_24,items:T},void 0)}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({size:"s",onClick:function(){return t(I,A,d.CallStatSource.HISTORY)}},{children:u("calls_history_join_call_button")}),void 0)]},void 0)},{children:(0,o.jsx)(Zn.default,{photo:(0,o.jsx)(m.CallPhoto,{id:A,photo:C,alt:g,size:"34"},void 0),title:g,href:E,description:S,target:"_blank"},void 0)}),A):(0,o.jsx)(o.Fragment,{},void 0)},Ud=function(e){var n=e.currentCalls,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a;return n.length?(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1},{children:n.map((function(e,n){return(0,o.jsx)(Bd,{listItemBorder:r,call:e,onJoin:t},n)}))}),void 0):(0,o.jsx)(o.Fragment,{},void 0)},Hd=function(){var e=ed(),n=$c((function(e){return e.profiles})),t=$c((function(e){return e.currentCalls})),a=$c((function(e){return e.callsQueueResponse})),o=(0,i.__read)((0,l.useState)(!0),2),r=o[0],s=o[1],c=function(){s(!0),(0,nd.loadCurrentCalls)(e).then((function(n){(0,nd.updateProfilesAndUrls)(e,[n])})).finally((function(){s(!1)}))};return(0,l.useEffect)((function(){c()}),[]),(0,l.useEffect)((function(){var e;!!(null===(e=null==a?void 0:a.events)||void 0===e?void 0:e.some((function(e){var n;return"current_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&c()}),[a]),{currentCallsBlockLoading:r,currentCalls:t,profiles:n}},Vd=function(){var e=sc().getLang,n=_d().onJoin,t=Hd(),a=t.currentCallsBlockLoading,r=t.currentCalls,s=t.profiles,c=vd().setLoading,d=(0,l.useMemo)((function(){return a?(0,o.jsx)(od.default,{children:(0,o.jsx)(Ml.DivBlockSkeleton,{height:300},void 0)},void 0):(0,o.jsxs)(od.default,(0,i.__assign)({title:e("calls_history_current_list_header"),className:"CallHistoryScreen--content CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Ud,{currentCalls:r,profiles:s,onJoin:n},void 0),0===r.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:e("calls_history_current_calls_list_stub")}),void 0)]}),void 0)}),[a,r]);return(0,l.useEffect)((function(){c(a)}),[a]),(0,o.jsx)(o.Fragment,{children:d},void 0)};const Gd=(0,X.makeIcon)("Icon28ChainOutline","chain_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chain_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M12.59 16.83c-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l5.24-5.24a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.436 1.436a.999.999 0 0 1-1.414-1.41l1.43-1.436a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-5.23 5.23a2.982 2.982 0 0 0 0 4.24c.41.39.41 1.03 0 1.42Zm2.82-5.66c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-5.24 5.24a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.431-1.431a1 1 0 0 1 1.414 0h.001c.39.392.39 1.025 0 1.415L5.94 17.82a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l5.23-5.23a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),Fd=(0,X.makeIcon)("Icon28ArrowUpRectangleOutline","arrow_up_rectangle_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" id="arrow_up_rectangle_outline_28"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.07 4.801C6.164 4.216 7.243 4 9.691 4h8.616c2.448 0 3.527.216 4.622.801A5.465 5.465 0 0 1 25.2 7.07c.585 1.096.801 2.175.801 4.623v4.616c0 2.448-.216 3.527-.801 4.622A5.465 5.465 0 0 1 22.93 23.2c-1.095.585-2.174.801-4.622.801H9.692c-2.448 0-3.527-.216-4.623-.801a5.465 5.465 0 0 1-2.268-2.269C2.216 19.835 2 18.756 2 16.308v-4.616c0-2.448.216-3.527.801-4.623A5.466 5.466 0 0 1 5.07 4.801ZM9.691 6c-2.335 0-3.019.212-3.68.565a3.466 3.466 0 0 0-1.447 1.448C4.212 8.673 4 9.357 4 11.692v4.616c0 2.335.212 3.019.565 3.68a3.466 3.466 0 0 0 1.448 1.447c.66.353 1.344.565 3.679.565h8.616c2.335 0 3.019-.212 3.68-.565a3.467 3.467 0 0 0 1.447-1.448c.353-.66.565-1.344.565-3.679v-4.616c0-2.335-.212-3.019-.565-3.68a3.466 3.466 0 0 0-1.448-1.447C21.327 6.212 20.643 6 18.308 6H9.692Z" fill="currentColor" /><path d="M13 18a1 1 0 1 0 2 0v-5.586l1.293 1.293a1 1 0 0 0 1.414-1.414l-3-3a1 1 0 0 0-1.414 0l-3 3a1 1 0 1 0 1.414 1.414L13 12.414V18Z" fill="currentColor" /></symbol>',28,28,!1,void 0);var Wd=function(e){var n=e.onCreateCallClick,t=sc().getLang;return(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--header"},{children:t("calls_screen_landing_header")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--subheader"},{children:t("calls_screen_landing_subheader")}),void 0),(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryScreenLanding--list",border:!1},{children:[(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Ho,{},void 0)},{children:t("calls_screen_landing_feature_participants")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Gd,{},void 0)},{children:t("calls_screen_landing_feature_anon")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Fd,{},void 0)},{children:t("calls_screen_landing_feature_share")}),void 0)]}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({size:"l",className:"CallHistoryScreenLanding--createButton",onClick:function(){return n(Ja.CallStatSource.HISTORY_CREATE)}},{children:t("calls_current_calls_create_call_by_link")}),void 0)]}),void 0)}),void 0)},zd=t(64891);const Kd=(0,X.makeIcon)("Icon28PhoneOutline","phone_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="phone_outline_28"><g fill-rule="nonzero" fill="none"><path d="M0 0h28v28H0z" /><path d="m16.112 17.259-.734.734a.712.712 0 0 1-.75.166c-.73-.269-1.643-.95-2.74-2.047-1.095-1.096-1.778-2.01-2.045-2.74a.712.712 0 0 1 .164-.75l.736-.734c1.354-1.354 1.478-3.487.284-4.903l-.862-1.024c-.984-1.17-2.756-1.288-3.96-.264a3.319 3.319 0 0 0-.974 1.443 3.25 3.25 0 0 0-.159.752c-.44 3.272 1.137 6.707 4.733 10.303 3.596 3.596 7.03 5.174 10.303 4.733a3.318 3.318 0 0 0 2.195-1.134c1.024-1.202.905-2.976-.263-3.96l-1.025-.862c-1.417-1.192-3.55-1.067-4.903.287Zm-2.81-2.561c.525.523.982.92 1.35 1.191 2.124-2.123 5.428-2.317 7.652-.447l1.023.862c2.03 1.708 2.233 4.751.49 6.798-.896 1.036-2.156 1.687-3.442 1.808-3.982.536-7.987-1.303-11.984-5.3-3.997-3.998-5.837-8.004-5.31-11.896.036-.414.122-.822.257-1.22A5.33 5.33 0 0 1 4.91 4.174c2.037-1.732 5.079-1.53 6.785.5l.86 1.023c1.873 2.22 1.681 5.527-.4 7.608.227.413.624.87 1.148 1.394Z" fill="currentColor" /></g></symbol>',28,28,!1,void 0);var Qd,Yd=t(33483),Jd=t(59247);!function(e){e[e.Preview=0]="Preview",e[e.Full=1]="Full"}(Qd||(Qd={}));var Xd=function(e){var n=e.type,t=void 0===n?Qd.Preview:n,a=e.forceUpdate,o=e.disabled,r=e.callerId,s=(0,ue.useLang)().getLang,c=(0,Jd.useLocale)().locale,d=(0,xc.usePromiseError)().handleError,u=(0,Bl.useIsMounted)(),_=(0,l.useRef)(),v=(0,i.__read)((0,l.useState)(),2),h=v[0],p=v[1],f=ed(),m=$c((function(e){return e.scheduledCalls})),A=$c((function(e){return e.scheduledCallsPreview})),g=$c((function(e){return e.profiles}));(0,l.useEffect)((function(){if(null==h?void 0:h.size){var e=[];h.forEach((function(n){g[n]||e.push(n)})),e.length&&(0,sn.loadCallPeersByPeerIds)(e).then((function(e){if(u()){var n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.profiles||[]),!1),(0,i.__read)(e.groups||[]),!1);n.length&&(0,nd.loadProfiles)(f,n)}})).catch(d)}}),[h,g]);var C=(0,l.useCallback)((function(){if(!o){var e,n=new Date,a={grouped:1};switch(a.start_time=Math.round(n.valueOf()/1e3),r&&(a.caller_id=r),t){case Qd.Full:a.finish_time=a.start_time+31536e3,e=$d;break;case Qd.Preview:a.finish_time=a.start_time+604800,e=qd}e(f,{loading:!0}),(0,sn.messagesGetScheduledCalls)(a).then((function(t){if(u()){var a=(0,Yd.mapCalls)({now:n,items:null==t?void 0:t.items,locale:c,getLang:s,groups:null==t?void 0:t.groups}),i=a.calls,o=a.callerIds,r=a.total;e(f,{items:i,total:r}),p(o)}})).catch(d).finally((function(){u()&&e(f,{loading:!1})})),_.current=function(){e(f)}}}),[t,o,r]);return(0,l.useEffect)((function(){return function(){var e;null===(e=_.current)||void 0===e||e.call(_)}}),[]),(0,l.useEffect)((function(){C()}),[t,a,r]),{scheduledCalls:m,scheduledCallsPreview:A,fetchData:C}};function qd(e,n){e({type:Yc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW,data:n})}function $d(e,n){e({type:Yc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS,data:n})}var eu=t(32997),nu=function(e){var n=e.children;return(0,o.jsx)(In.default,(0,i.__assign)({className:"CallsScheduledRowBlockTitle",selectable:!1,canBeHovered:!1},{children:n}),void 0)},tu=t(767),au=function(e){var n=e.text,t=e.href,a=e.className,r=e.onClick,l=e.rightIcon,c=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__text"},{children:n}),void 0),l&&(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__icon"},{children:l}),void 0)]},void 0);return t?(0,o.jsx)(zd.default,(0,i.__assign)({href:t,className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0)},iu=function(e){var n,t,a=e.calls,r=e.loading,c=e.onLinkClick,d=e.skeletonHeight,u=e.ownerSelect,_=e.section,v=(0,ue.useLang)().getLang,h=ed(),p=(0,Lc.useNotifier)().showText,f=ud().bridge,m=bd().navigateToConvo,A=(0,i.__read)((0,l.useState)((function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone})),1)[0],g=$c((function(e){return e.meId})),C=$c((function(e){return e.profiles[g]})),E=(0,Ic.useCalendarEventDetails)({meParticipant:C}),S=(0,Bl.useIsMounted)(),T="scheduled"===_,I=function(e){var n=e.allCalls,t=e.isScheduledSection,a=(0,i.__read)((0,l.useState)(!1),2),o=a[0],r=a[1],c=(0,l.useCallback)((function(){r((function(e){return!e}))}),[]),d=(0,l.useMemo)((function(){var e,a;if((0,s.isUndefined)(n)||t||o||!n.total||n.total<=3||!Array.isArray(null==n?void 0:n.items))return n;var r=[],l=0;try{for(var c=(0,i.__values)(null==n?void 0:n.items),d=c.next();!d.done;d=c.next()){var u=d.value,_=u.calls,v=(0,i.__rest)(u,["calls"]);if(l>=3)break;var h=3-l,p=_.length<h?_:_.slice(0,h);r.push((0,i.__assign)((0,i.__assign)({},v),{calls:p})),l+=p.length}}catch(n){e={error:n}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(e)throw e.error}}return r.length?(0,i.__assign)((0,i.__assign)({},n),{items:r}):null}),[n,o]);return{isShowAll:o,toggleShowAll:c,calls:d}}({allCalls:a,isScheduledSection:T}),x=I.calls,N=I.isShowAll,y=I.toggleShowAll;(0,l.useEffect)((function(){C||(0,sn.loadChatMembers)(g).then((function(e){(null==e?void 0:e.profiles)&&S()&&(0,nd.loadProfiles)(h,e.profiles)}))}),[C,g]);var b=(0,l.useCallback)((function(e){f.joinCallByLink(e.join_link,void 0,!1,Ja.CallStatSource.HISTORY)}),[]),O=(0,l.useCallback)((function(e){e.vk_join_link&&(0,s.copyTextToClipboard)(e.vk_join_link).then((function(){p(v("calls_create_call_by_link_copied"))}))}),[v,p]),w=(0,l.useCallback)((function(e){var n,t,a,i,o={call_id:e.call_id,title:e.name||"",start:new Date(1e3*((null===(n=e.schedule)||void 0===n?void 0:n.time)||0)),timezone:A,duration:(null===(t=e.schedule)||void 0===t?void 0:t.duration)||0,join_link:e.vk_join_link||"",repeatRule:(0,Mc.mapRecurrenceRule)(null===(a=e.schedule)||void 0===a?void 0:a.recurrence_rule)};(null===(i=e.group)||void 0===i?void 0:i.name)&&(o.displayName=e.group.name),(0,s.copyTextToClipboard)(E.getDescription(o)).then((function(){p(v("calls_create_call_by_link_text_copied"))}))}),[E,v,p]),L=(0,l.useCallback)((function(e){h({type:Yc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),h({type:Yc.HistoryScreenActionTypes.SET_POPUP,data:Yc.EHistoryScreenPopup.DeleteCalendarEvent})}),[]),k=(0,l.useCallback)((function(e){h({type:Yc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),h({type:Yc.HistoryScreenActionTypes.SET_POPUP,data:Yc.EHistoryScreenPopup.EditCalendarEvent})}),[]),P=(0,l.useCallback)((function(){c&&c(event,"scheduled","calls?section=scheduled")}),[c]),M=(0,l.useCallback)((function(e){var n;(null===(n=e.chat)||void 0===n?void 0:n.peer_id)&&m(e.chat.peer_id)}),[m]),D=function(){var e;return T&&(null===(e=null==u?void 0:u.options)||void 0===e?void 0:e.length)?(0,o.jsx)(eu.default,(0,i.__assign)({className:"CallHistoryScreen--listHeaderSelector",disabled:r},u),void 0):c&&!T?(0,o.jsx)(zd.default,(0,i.__assign)({className:"CallHistoryScreen--moreLink",href:"/calls?section=scheduled",onClick:P},{children:v("calls_show_all")}),void 0):void 0}(),j=!!(null===(n=null==x?void 0:x.items)||void 0===n?void 0:n.length),R=r&&!j,Z=!r&&j,B=!(r||j||c&&!(null==u?void 0:u.value)),U=j||B||R,H=r&&j,V=Z&&!T&&(null==a?void 0:a.total)&&a.total>3,G=N?v("calls_collapse"):v("calls_history_scheduled_calls_show_all").replace("{count}",((null==a?void 0:a.total)||0)-3);return U?(0,o.jsxs)(od.default,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--content",{"CallHistoryScreen--currentCalls":!R})},{children:[!R&&(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--listHeader","HistoryScreenScheduledCalls__header",{"HistoryScreenScheduledCalls__header--standalone":T&&!B}),right:D},{children:v("calls_scheduled")}),void 0),R&&(0,o.jsx)(Ml.DivBlockSkeleton,{height:d||300},void 0),H&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Me.default,{},void 0)},void 0),Z&&(null===(t=null==x?void 0:x.items)||void 0===t?void 0:t.map((function(e,n){return(0,o.jsxs)("div",{children:[(0,o.jsx)(nu,{children:e.title},void 0),e.calls.map((function(t){return(0,o.jsx)(tu.ScheduledCallRow,{call:t,isToday:e.isToday,isTomorrow:e.isTomorrow,onCallEnter:b,onCallCopyLink:O,onCallCopyText:w,onCallDelete:L,onCallEdit:k,onCallMessage:M},t.call_id+"-"+n)}))]},e.title)}))),V&&(0,o.jsx)(au,{text:G,onClick:y},void 0),B&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:v("calls_history_scheduled_calls_list_stub")}),void 0)]}),void 0):null},ou=function(e){var n=e.historyCalls,t=e.loading,a=e.historyBlockReloading,r=e.selectedOwnerId,s=e.ownerOptions,c=e.onGroupSelectChange,d=e.onHistoryAction,u=e.onShowMoreHistory,_=e.showMoreHistory,v=e.isShowList,h=(0,ue.useLang)().getLang,p=(0,l.useMemo)((function(){return s.length>1?(0,o.jsx)(bo.default,{className:"CallHistoryScreen--listHeaderSelector",options:s,value:r,onChange:c},void 0):(0,o.jsx)(o.Fragment,{},void 0)}),[s]),f=(0,l.useMemo)((function(){return h(0===r?"calls_history_list_stub":"calls_history_list_groups_stub")}),[r]),m=!(t||a||v||n.length),A=h("calls_history_list_header");return(0,o.jsxs)(od.default,(0,i.__assign)({title:m?A:void 0},{children:[m&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:f}),void 0),t&&(0,o.jsx)(Ml.DivBlockSkeleton,{height:500},void 0),v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:p},{children:A}),void 0),a&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Me.default,{},void 0)},void 0),!a&&(0,o.jsx)(Nd,{selectedOwnerId:r,calls:n,onMenuItemClick:d,stubText:f,hasMore:_,onLoadMore:u},void 0)]},void 0)]}),void 0)},ru=function(e){void 0===e&&(e={});var n=e.initialOptions,t=(0,i.__read)((0,l.useState)([]),2),a=t[0],o=t[1];return(0,l.useEffect)((function(){a.length||(0,sn.getGroupsForCall)().then((function(e){var t=e.count,a=e.items,i=n||[];t>0&&(a.forEach((function(e){var n=e.id,t=e.name,a=void 0===t?"":t;i.push({value:-n,label:a})})),o(i))}))}),[]),{ownerOptions:a}},su=function(){var e=(0,ue.useLang)().getLang,n=(0,c.useStore)(),t=ed(),a=$c((function(e){return e.historyCalls})),o=$c((function(e){return e.joinLinks})),r=$c((function(e){return e.profiles})),s=ud(),d=s.SDK,u=s.bridge,_=(0,i.__read)((0,l.useState)(!1),2),v=_[0],h=_[1],p=(0,i.__read)((0,l.useState)(0),2),f=p[0],m=p[1],A=Od().onHistoryAction,g=wd("all"),C=g.onShowMoreHistory,E=g.loading,S=g.showMoreHistory,T=g.loadHistory,I=(0,l.useMemo)((function(){return[{value:0,label:e("calls_history_list_personal_option")}]}),[]),x=ru({initialOptions:I}).ownerOptions,N=(0,l.useCallback)((function(e){var a=Number(e.selected.value);h(!0),m(a),T(0,a,[],!0).then((function(e){h(!1),e&&hr(d,u,n,a,t,!0)}))}),[r,o,a]),y=!E&&(a.length>0||f<0||0===f&&v);return{loading:E,historyCalls:a,historyBlockReloading:v,selectedOwnerId:f,ownerOptions:x,onGroupSelectChange:N,onHistoryAction:A,onShowMoreHistory:C,showMoreHistory:S,isShowList:y,isDisplayBlock:E||y||v}},lu=function(){var e=(0,l.useRef)(),n=$c((function(e){return e.callsQueueResponse}));return(0,l.useMemo)((function(){var t;return(null===(t=null==n?void 0:n.events)||void 0===t?void 0:t.some((function(e){var n;return"scheduled_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&(e.current=Date.now()),e.current}),[n])},cu=function(e){var n=e.onMenuItemClick,t=ed(),a=sc().getLang,r=$c((function(e){return e.profiles})),c=$c((function(e){return e.historyCalls})),u=Xd({type:Qd.Preview,forceUpdate:lu()}).scheduledCallsPreview,_=_d(),v=_.onCreateCallClick,h=_.onJoin,p=Hd(),f=p.currentCallsBlockLoading,m=p.currentCalls,A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],C=A[1],E=(0,i.__read)((0,l.useState)([]),2),S=E[0],T=E[1],I=(0,i.__read)((0,l.useState)(!1),2),x=I[0],N=I[1],y=su();(0,l.useEffect)((function(){C(!0),(0,sn.getFriends)(7).then((function(e){var n=e.items.map(Vn.normalizeUser);T(n)})).finally((function(){C(!1)}))}),[]);var b=(0,l.useCallback)((function(e,t,a){e.preventDefault(),n(t,a)}),[]),O=(0,l.useCallback)((function(e,n){return!(!e.ctrlKey&&!e.metaKey)||(e.preventDefault(),h("",n,d.CallStatSource.HISTORY_FRIENDS_LIST),!1)}),[]);return(0,l.useEffect)((function(){if(!y.loading){var e=!(f||m.length||y.loading||c.length||0!==y.selectedOwnerId);N(e),t((0,nd.dispatchSetShowCreateButton)(!e))}return function(){t((0,nd.dispatchSetShowCreateButton)(!0))}}),[f,m.length,y.loading,c.length,y.selectedOwnerId]),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--content"},{children:[x&&(0,o.jsx)(od.default,(0,i.__assign)({className:(0,s.classNames)({"CallHistoryScreenLanding--pageBlock":!g&&0===S.length})},{children:(0,o.jsx)(Wd,{onCreateCallClick:v},void 0)}),void 0),g&&(0,o.jsx)(od.default,{children:(0,o.jsx)(Ml.DivBlockSkeleton,{height:147},void 0)},void 0),!g&&S.length>0&&(0,o.jsxs)(od.default,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:(0,o.jsx)(zd.default,(0,i.__assign)({href:"/calls?section=friends",onClick:function(){return b(event,"friends","calls?section=friends")},className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_friends_header_link")}),void 0)},{children:a("calls_history_friends_block_header")}),void 0),(0,o.jsx)("ul",(0,i.__assign)({className:"CallHistoryScreen--friendsList"},{children:S.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallHistoryScreen--friendsListItem"},{children:(0,o.jsx)("a",(0,i.__assign)({href:e.link,onClick:function(){return O(event,e.peerId)}},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemContent"},{children:[(0,o.jsx)(kd.default,{className:"CallHistoryScreen--friendsListItemPhoto",photo:e.photo,title:e.name},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemPhotoHoverIcon"},{children:(0,o.jsx)(Kd,{fill:"white"},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemName"},{children:e.firstName}),void 0)]}),void 0)}),void 0)}),e.id)}))}),void 0)]},void 0),f&&(0,o.jsx)(od.default,{children:(0,o.jsx)(Ml.DivBlockSkeleton,{height:300},void 0)},void 0),!f&&m.length>0&&(0,o.jsxs)(od.default,(0,i.__assign)({className:"CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",extra:m.length,right:m.length?(0,o.jsx)(zd.default,(0,i.__assign)({onClick:function(){return b(event,"current","calls?section=current")},href:"/calls?section=current",className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_header_link")}),void 0):""},{children:a("calls_history_current_list_header")}),void 0),(0,o.jsx)(Ud,{currentCalls:m.slice(0,5),profiles:r,onJoin:h},void 0)]}),void 0),(0,o.jsx)(iu,{calls:u,loading:null==u?void 0:u.loading,onLinkClick:b,skeletonHeight:300},void 0),y.isDisplayBlock&&(0,o.jsx)(ou,(0,i.__assign)({},y),void 0)]}),void 0)},du=t(95418),uu=function(){var e,n,t,a,i=vd().setLoading,r=(e=(0,ue.useLang)().getLang,n=$c((function(e){return e.meId})),t=(0,l.useMemo)((function(){return[{label:e("calls_all"),value:0},{label:e("calls_history_list_personal_option"),value:n}]}),[n]),a=ru({initialOptions:t}).ownerOptions,(0,du.useFormSelectValue)({options:a,initialValue:function(){return 0}})),s=Xd({type:Qd.Full,forceUpdate:lu(),callerId:r.value}).scheduledCalls;return(0,l.useEffect)((function(){i(!!(null==s?void 0:s.loading))}),[null==s?void 0:s.loading]),(0,o.jsx)(iu,{calls:s,loading:null==s?void 0:s.loading,skeletonHeight:500,section:"scheduled",ownerSelect:r},void 0)},_u=function(){var e=su();return(0,o.jsx)(ou,(0,i.__assign)({},e),void 0)};const vu=(0,X.makeIcon)("Icon24Qr","qr_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="qr_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M19.5 19H21a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM14 19h1.5a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75H21a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5Zm-5.5 0h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5ZM4.5 13h4a2.5 2.5 0 0 1 2.5 2.5v4A2.5 2.5 0 0 1 8.5 22h-4A2.5 2.5 0 0 1 2 19.5v-4A2.5 2.5 0 0 1 4.5 13Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM15.5 2h4A2.5 2.5 0 0 1 22 4.5v4a2.5 2.5 0 0 1-2.5 2.5h-4A2.5 2.5 0 0 1 13 8.5v-4A2.5 2.5 0 0 1 15.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM4.5 2h4A2.5 2.5 0 0 1 11 4.5v4A2.5 2.5 0 0 1 8.5 11h-4A2.5 2.5 0 0 1 2 8.5v-4A2.5 2.5 0 0 1 4.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),hu=Ni("Icon40GooglePlayButtonRu","google_play_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 126 40" id="google_play_button_ru_40"><path fill="currentColor" fill-rule="evenodd" d="M46.025 13.917c.86 0 1.529-.287 2.102-.86s.86-1.242.86-2.102c0-.86-.287-1.529-.86-2.102-.574-.573-1.242-.86-2.102-.86-.86 0-1.529.287-2.102.86s-.86 1.242-.86 2.102c0 .86.286 1.529.86 2.102.573.573 1.242.86 2.102.86Zm-8.696 1.146h-.668v-1.91h.573c.478-.383.764-1.147.764-2.198V8.088h3.822v5.064h.669v1.911h-.669v-1.242h-4.395v1.242h-.096Zm1.338-4.108c0 .86-.191 1.624-.574 2.197h2.867v-4.3h-2.29v2.103h-.003Zm5.828 1.624c.383.382.956.669 1.53.669.572 0 1.146-.191 1.528-.669a2.305 2.305 0 0 0 .669-1.624c0-.67-.191-1.242-.67-1.625-.381-.382-.955-.668-1.528-.668-.573 0-1.146.19-1.529.668a2.305 2.305 0 0 0-.668 1.625c0 .669.19 1.242.668 1.624Zm6.116.478c.573.573 1.242.86 2.102.86.477 0 .86-.096 1.242-.287.382-.191.669-.478.955-.764l-.478-.478c-.477.573-1.05.86-1.72.86a2.305 2.305 0 0 1-1.624-.669c-.477-.382-.668-.955-.668-1.624 0-.669.19-1.242.668-1.624.478-.478.956-.67 1.625-.67.668 0 1.242.287 1.624.765l.478-.478c-.574-.668-1.242-.955-2.102-.955-.86 0-1.53.287-2.102.86-.574.573-.86 1.242-.86 2.102 0 .86.286 1.529.86 2.102Zm7.26.764h-.668V8.757h-1.625v-.669h3.918v.67h-1.624v5.063Zm6.646-5.637.043-.096v.096h-.043Zm0 0-2.154 4.777c-.287.669-.764 1.051-1.338 1.051-.19 0-.382 0-.573-.095l.191-.67c.096.096.287.096.382.096.191 0 .287 0 .382-.095.096-.096.192-.191.287-.382l.191-.478-1.91-4.204h.86l1.432 3.249 1.338-3.25h.912Zm.903 5.637V8.088h4.109v5.733h-.765V8.757H66.09v5.064h-.669Zm5.446-5.733v5.733h.764v-2.58h2.867v2.58h.764V8.088h-.764v2.485H71.63V8.088h-.764Zm10.414 4.969c-.573.573-1.242.86-2.102.86-.86 0-1.528-.287-2.102-.86-.573-.573-.86-1.242-.86-2.102 0-.86.287-1.529.86-2.102.574-.573 1.242-.86 2.102-.86.86 0 1.53.287 2.102.86.574.573.86 1.242.86 2.102-.095.86-.382 1.529-.86 2.102Zm-2.197.19c-.573 0-1.146-.286-1.529-.668a2.305 2.305 0 0 1-.668-1.624c0-.67.286-1.242.668-1.625.383-.477.956-.668 1.53-.668.572 0 1.146.286 1.528.668.478.383.669.956.669 1.625a2.305 2.305 0 0 1-.67 1.624c-.381.478-.955.669-1.528.669Zm6.02.574V8.088h2.102c.477 0 .86.191 1.146.478.287.287.478.669.478 1.147 0 .227-.06.393-.132.595l-.06.169a.978.978 0 0 1-.573.478c.287.095.478.286.67.477.19.192.286.478.286.86 0 .478-.191.86-.478 1.147-.382.287-.764.478-1.242.478h-2.197v-.096Zm2.1-3.248h-1.337v-1.72h1.338c.287 0 .478.095.669.286.19.191.286.383.286.574 0 .19-.095.382-.286.573-.191.191-.382.287-.67.287Zm-1.241 2.58h1.433c.287 0 .478-.096.669-.287.191-.191.286-.382.286-.67 0-.19-.095-.477-.286-.668-.191-.191-.382-.287-.669-.287h-1.433v1.911ZM23.494 16.55 10.7 9.27a1.23 1.23 0 0 0-.677-.242l10.49 10.507 2.981-2.985Zm-13.48 15.052a.98.98 0 0 0 .62-.198l12.86-7.332-2.982-2.986-10.498 10.516ZM29.286 20.31c0-.293-.251-.602-.686-.848l-4.234-2.4-3.22 3.248 3.233 3.262 4.22-2.405c.437-.25.688-.563.687-.857ZM9.236 30.967a1.36 1.36 0 0 1-.05-.482l-.002-20.378a1.297 1.297 0 0 1 .053-.443L19.876 20.31 9.236 30.967Zm33.445-7.496v1.72h4.108c-.096.956-.478 1.72-.955 2.198-.574.573-1.53 1.242-3.153 1.242-2.58 0-4.491-2.007-4.491-4.586s2.006-4.587 4.49-4.587c1.338 0 2.39.574 3.154 1.242l1.242-1.242c-1.051-.955-2.389-1.72-4.3-1.72-3.44 0-6.401 2.867-6.401 6.307s2.962 6.306 6.401 6.306c1.911 0 3.249-.574 4.395-1.816 1.147-1.146 1.529-2.77 1.529-4.013 0-.382 0-.764-.096-1.05h-5.923Zm10.605-1.242c-2.293 0-4.109 1.72-4.109 4.109 0 2.293 1.816 4.108 4.109 4.108s4.108-1.72 4.108-4.108c0-2.484-1.815-4.109-4.108-4.109Zm4.777 4.109c0-2.389 1.815-4.109 4.108-4.109 2.293 0 4.109 1.625 4.109 4.109 0 2.388-1.816 4.108-4.109 4.108s-4.108-1.815-4.108-4.108Zm1.816-.096c0 1.433 1.051 2.484 2.293 2.484s2.293-1.05 2.293-2.484c0-1.529-1.05-2.484-2.293-2.484s-2.293 1.05-2.293 2.484Zm-8.887 0c0 1.433 1.051 2.484 2.293 2.484s2.293-1.05 2.293-2.484c0-1.529-1.05-2.484-2.293-2.484s-2.293 1.05-2.293 2.484Zm31.626-4.013c2.102 0 3.057 1.624 3.44 2.58l.19.478-5.445 2.293c.477.86 1.05 1.242 2.006 1.242.956 0 1.529-.478 2.007-1.147l1.337.956c-.382.669-1.529 1.815-3.344 1.815-2.293 0-4.013-1.815-4.013-4.108 0-2.485 1.72-4.109 3.822-4.109Zm-2.103 3.917c0-1.528 1.242-2.388 2.102-2.388.67 0 1.338.382 1.53.86l-3.632 1.529Zm-2.675 3.918h-1.815V18.121h1.815v11.943Zm-4.68-6.975c-.479-.478-1.243-.955-2.198-.955-2.007 0-3.918 1.815-3.918 4.108 0 2.293 1.816 4.013 3.918 4.013.955 0 1.72-.478 2.102-.955h.095v.573c0 1.529-.86 2.389-2.197 2.389-1.051 0-1.816-.765-2.007-1.434l-1.529.67c.478 1.05 1.625 2.388 3.631 2.388 2.102 0 3.822-1.242 3.822-4.204V22.42h-1.72v.67Zm-4.396 3.153c0 1.433 1.05 2.484 2.293 2.484s2.197-1.05 2.197-2.484c0-1.433-.955-2.484-2.197-2.484s-2.293 1.05-2.293 2.484Zm25.605-8.121h-4.3v11.943h1.816v-4.49h2.484c2.007 0 3.918-1.434 3.918-3.727s-1.911-3.726-3.918-3.726Zm-2.483 5.732h2.58c1.242 0 2.007-1.05 2.102-2.102 0-.86-.764-2.006-2.102-2.006h-2.58v4.108Zm13.568-1.72c-1.338 0-2.675.574-3.153 1.816l1.624.669c.382-.669.956-.86 1.624-.86.956 0 1.816.573 1.911 1.529v.095c-.286-.19-1.051-.477-1.815-.477-1.72 0-3.44.955-3.44 2.675 0 1.624 1.433 2.675 2.962 2.675 1.242 0 1.816-.573 2.293-1.146h.096v.955h1.72v-4.586c-.191-2.102-1.816-3.344-3.822-3.344Zm-1.624 5.542c0 .765.86 1.051 1.433 1.051.956 0 1.911-.764 2.102-1.91-.048-.02-.095-.04-.142-.058-.417-.17-.795-.325-1.482-.325-.86 0-1.911.287-1.911 1.242Zm11.464-5.255-2.006 5.16h-.096l-2.102-5.16h-1.911l3.153 7.262-1.815 4.013h1.815l4.873-11.275h-1.911Zm-14.235 7.644h-1.816V18.121h1.816v11.943Z" clip-rule="evenodd" /><path fill="currentColor" d="m48.127 13.057.07.07-.07-.07Zm0-4.204.07-.07-.07.07Zm-4.204 0-.07-.07.07.07Zm0 4.204-.07.07.07-.07Zm-7.262 2.006h-.1v.1h.1v-.1Zm0-1.91v-.1h-.1v.1h.1Zm.573 0v.1h.035l.027-.023-.062-.078Zm.764-5.065v-.1h-.1v.1h.1Zm3.822 0h.1v-.1h-.1v.1Zm0 5.064h-.1v.1h.1v-.1Zm.669 0h.1v-.1h-.1v.1Zm0 1.911v.1h.1v-.1h-.1Zm-.669 0h-.1v.1h.1v-.1Zm0-1.242h.1v-.1h-.1v.1Zm-4.395 0v-.1h-.1v.1h.1Zm0 1.242v.1h.1v-.1h-.1Zm.668-1.91-.083-.056-.103.155h.186v-.1Zm.574-2.198v-.1h-.1v.1h.1Zm2.293 2.197v.1h.1v-.1h-.1Zm0-4.3h.1v-.1h-.1v.1Zm-2.29 0v-.1h-.1v.1h.1Zm0 2.103v.1h.1v-.1h-.1Zm5.825 1.624.072-.071-.01-.007-.062.078Zm3.058 0-.071-.071-.007.009.078.062Zm0-3.249-.071.072.008.007.063-.079Zm-3.058 0 .072.072.007-.01-.079-.062Zm6.116 3.727-.071.07.07-.07Zm4.3-.191.07.07.07-.07-.07-.071-.07.07Zm-.479-.478.071-.07-.077-.078-.07.084.076.064Zm-3.344.191.072-.071-.01-.007-.062.078Zm0-3.248.063.078.008-.008-.07-.07Zm3.249.095-.078.063.07.087.079-.08-.071-.07Zm.478-.478.07.071.066-.065-.06-.07-.076.064Zm-4.204-.095-.071-.07.07.07Zm6.592 4.968h-.1v.1h.1v-.1Zm.669 0v.1h.1v-.1h-.1Zm-.67-5.064h.1v-.1h-.1v.1Zm-1.624 0h-.1v.1h.1v-.1Zm0-.669v-.1h-.1v.1h.1Zm3.918 0h.1v-.1h-.1v.1Zm0 .67v.1h.1v-.1h-.1Zm-1.624 0v-.1h-.1v.1h.1Zm6.688-.67h.1l-.19-.04.09.04Zm0 .096v.1h.1v-.1h-.1Zm-2.197 4.777-.091-.04h-.001l.092.04Zm-1.911.956-.096-.028-.023.08.074.037.045-.09Zm.191-.67.07-.07-.12-.12-.046.163.096.028Zm.764 0-.07-.07.07.07Zm.287-.381.09.045.003-.008-.093-.037Zm.191-.478.093.037.016-.04-.018-.038-.09.04Zm-1.91-4.204v-.1h-.156l.064.141.091-.041Zm.86 0 .09-.04-.026-.06h-.065v.1Zm1.432 3.249-.091.04.095.214.089-.216-.093-.038Zm1.338-3.25v-.1h-.067l-.025.063.092.038Zm1.815-.095v-.1h-.1v.1h.1Zm0 5.733h-.1v.1h.1v-.1Zm4.109-5.733h.1v-.1h-.1v.1Zm0 5.733v.1h.1v-.1h-.1Zm-.765 0h-.1v.1h.1v-.1Zm0-5.064h.1v-.1h-.1v.1Zm-2.675 0v-.1h-.1v.1h.1Zm0 5.064v.1h.1v-.1h-.1Zm4.777 0h-.1v.1h.1v-.1Zm0-5.733v-.1h-.1v.1h.1Zm.764 5.733v.1h.1v-.1h-.1Zm0-2.58v-.1h-.1v.1h.1Zm2.867 0h.1v-.1h-.1v.1Zm0 2.58h-.1v.1h.1v-.1Zm.764 0v.1h.1v-.1h-.1Zm0-5.733h.1v-.1h-.1v.1Zm-.764 0v-.1h-.1v.1h.1Zm0 2.485v.1h.1v-.1h-.1Zm-2.867 0h-.1v.1h.1v-.1Zm0-2.485h.1v-.1h-.1v.1Zm9.65 4.969.071.07.006-.006-.077-.064Zm-4.204 0-.07.07.07-.07Zm0-4.204-.07-.07.07.07Zm4.204 0 .071-.07-.07.07Zm.86 2.102.1.01v-.01h-.1Zm-4.586 1.624.071-.07-.07.07Zm0-3.249.072.072.007-.01-.079-.062Zm3.058 0-.071.072.008.007.063-.079Zm0 3.249-.071-.071-.007.009.078.062Zm4.49-4.49v-.1h-.1v.1h.1Zm3.25.477.07-.07-.07.07Zm.345 1.742.093.038v-.004l-.093-.034Zm0 0-.093-.037.093.037Zm0 0-.093-.037-.001.004.094.034Zm-.06.169.09.045.003-.007.003-.006-.095-.032Zm-.572.478-.032-.095-.285.095.285.095.032-.095Zm.477 2.484.06.08.006-.004.005-.005-.07-.071Zm-3.44.478h-.1v.1h.1v-.1Zm.764-3.344h-.1v.1h.1v-.1Zm0-1.72v-.1h-.1v.1h.1Zm2.007.286-.07.071.07-.07Zm-1.911 4.013h-.1v.1h.1v-.1Zm2.102-.286-.07-.071.07.07Zm0-1.338-.07.07.07-.07Zm-2.102-.287v-.1h-.1v.1h.1ZM10.7 9.27l-.062.08.012.007.05-.087Zm12.794 7.28.07.07.093-.092-.114-.065-.049.087ZM10.023 9.028l.005-.1-.26-.014.184.184.07-.07Zm10.49 10.507-.071.071.07.07.071-.07-.07-.07Zm-9.878 11.87-.05-.088-.012.008.062.08Zm-.62.197-.071-.071-.169.169.239.002v-.1Zm13.479-7.53.05.087.113-.065-.093-.093-.07.07Zm-2.982-2.986.071-.07-.07-.072-.071.071.07.07Zm8.088-1.623-.05.087h.001l.05-.087Zm.686.848h.1-.1Zm-4.92-3.249.05-.087-.067-.037-.054.054.071.07Zm-3.22 3.249-.071-.07-.07.07.07.07.07-.07Zm3.233 3.262-.07.07.053.055.067-.038-.05-.087Zm4.22-2.405.049.087-.05-.086ZM9.184 30.486l.1.006v-.006h-.1Zm.052.482-.096.029.048.16.119-.118-.071-.07Zm-.053-20.86h.1v-.005l-.1.005Zm.053-.443.07-.071-.117-.118-.049.16.096.029ZM19.876 20.31l.07.07.071-.07-.07-.071-.071.07Zm22.805 4.88h-.1v.1h.1v-.1Zm0-1.72v-.1h-.1v.1h.1Zm4.108 1.72.1.01.01-.11h-.11v.1Zm-.955 2.198-.071-.071.07.07Zm0-6.689-.066.076.07.061.066-.066-.07-.07Zm1.242-1.242.07.071.075-.074-.078-.07-.067.073Zm.095 9.077-.07-.07-.003.002.073.068Zm1.433-5.064.095-.031-.022-.069h-.073v.1Zm37.454 1.338.092-.037-.092.037Zm.19.478.04.092.09-.038-.036-.092-.093.038Zm-5.445 2.293-.04-.092-.102.043.054.097.088-.048Zm4.013.095.058-.081-.082-.058-.058.081.082.058Zm1.337.956.087.05.045-.08-.074-.052-.058.082Zm-5.638-2.485h-.1v.151l.14-.058-.04-.093Zm3.631-1.528.039.092.09-.038-.036-.091-.093.037Zm-8.121 5.446h-.1v.1h.1v-.1Zm1.815 0v.1h.1v-.1h-.1Zm-1.815-11.943v-.1h-.1v.1h.1Zm1.815 0h.1v-.1h-.1v.1Zm-4.68 4.968-.071.07.17.171v-.24h-.1Zm-.096 6.21v-.1h-.048l-.03.038.078.063Zm.095 0h.1v-.1h-.1v.1Zm-4.204 1.53.096-.028-.031-.11-.105.046.04.091Zm-1.529.668-.04-.092-.093.041.042.092.091-.04Zm7.453-9.077h.1v-.1h-.1v.1Zm-1.72 0v-.1h-.1v.1h.1Zm16.91-4.3v-.1h-.1v.1h.1Zm0 11.944h-.1v.1h.1v-.1Zm1.816 0v.1h.1v-.1h-.1Zm0-4.49v-.1h-.1v.1h.1Zm.001-1.72h-.1v.1h.1v-.1Zm4.682-2.103.1.01v-.01h-.1Zm-4.682-2.006v-.1h-.1v.1h.1Zm10.415 4.204-.093-.036-.036.091.091.037.038-.092Zm1.624.669-.038.092.081.034.044-.077-.087-.05Zm3.535.669h.101l-.001-.01-.1.01Zm0 .095-.055.083.155.104v-.187h-.1Zm0 3.726v-.1h-.047l-.03.036.077.064Zm.096 0h.1v-.1h-.1v.1Zm0 .956h-.1v.1h.1v-.1Zm1.72 0v.1h.1v-.1h-.1Zm0-4.586h.1l-.001-.01-.099.01Zm-1.911 1.337.099.017.013-.08-.075-.03-.037.093Zm-.142-.057-.045.09.007.002.038-.092Zm0 0 .045-.09-.007-.003-.038.093Zm6.065.822v.1h.068l.025-.064-.093-.036Zm2.006-5.16v-.1h-.068l-.025.064.093.036Zm-2.102 5.16-.092.037.025.063h.067v-.1Zm-2.102-5.16.093-.038-.025-.062h-.068v.1Zm-1.911 0v-.1h-.152l.061.14.091-.04Zm3.153 7.262.092.04.018-.04-.018-.04-.092.04Zm-1.815 4.013-.091-.042-.064.142h.155v-.1Zm1.815 0v.1h.066l.026-.06-.092-.04Zm4.873-11.275.092.04.06-.14h-.152v.1Zm-17.962 7.644h-.1v.1h.1v-.1Zm1.816 0v.1h.1v-.1h-.1Zm-1.816-11.943v-.1h-.1v.1h.1Zm1.816 0h.1v-.1h-.1v.1Zm-53.003-5.135c-.554.555-1.198.83-2.031.83v.2c.886 0 1.58-.296 2.173-.888l-.142-.142Zm.83-2.031c0 .833-.276 1.477-.83 2.031l.142.142c.592-.592.889-1.287.889-2.173h-.2Zm-.83-2.031c.555.554.83 1.197.83 2.03h.2c0-.885-.296-1.58-.888-2.172l-.142.142Zm-2.031-.831c.833 0 1.477.276 2.031.83l.142-.14c-.593-.593-1.287-.89-2.173-.89v.2Zm-2.031.83c.554-.554 1.197-.83 2.03-.83v-.2c-.886 0-1.58.297-2.172.89l.142.14Zm-.831 2.032c0-.834.276-1.477.83-2.031l-.14-.142c-.593.592-.89 1.287-.89 2.173h.2Zm.83 2.031c-.554-.554-.83-1.198-.83-2.031h-.2c0 .886.297 1.58.89 2.173l.14-.142Zm2.032.83c-.834 0-1.477-.275-2.031-.83l-.142.142c.592.592 1.286.889 2.173.889v-.2Zm-9.364 1.347h.668v-.2h-.669v.2Zm-.1-2.01v1.91h.2v-1.91h-.2Zm.673-.1h-.574v.2h.574v-.2Zm.664-2.098c0 1.038-.284 1.765-.727 2.12l.125.155c.513-.41.802-1.211.802-2.275h-.2Zm0-2.867v2.867h.2V8.088h-.2Zm3.922-.1h-3.822v.2h3.822v-.2Zm.1 5.164V8.088h-.2v5.064h.2Zm.569-.1h-.669v.2h.669v-.2Zm.1 2.011v-1.91h-.2v1.91h.2Zm-.769.1h.669v-.2h-.669v.2Zm-.1-1.342v1.242h.2v-1.242h-.2Zm-4.295.1h4.395v-.2h-4.395v.2Zm.1 1.142v-1.242h-.2v1.242h.2Zm-.196.1h.096v-.2h-.096v.2Zm.848-1.955c.396-.594.59-1.38.59-2.253h-.2c0 .846-.189 1.59-.557 2.142l.167.11Zm2.783-.156h-2.867v.2h2.867v-.2Zm-.1-4.2v4.3h.2v-4.3h-.2Zm-2.19.1h2.29v-.2h-2.29v.2Zm.1 2.003V8.853h-.2v2.102h.2Zm-.103.1h.003v-.2h-.003v.2Zm7.357 2.093c-.542 0-1.09-.273-1.458-.64l-.141.142c.397.397.995.698 1.6.698v-.2Zm1.45-.631c-.357.447-.898.63-1.45.63v.2c.594 0 1.2-.198 1.607-.706l-.156-.124Zm.648-1.562a2.205 2.205 0 0 1-.64 1.553l.141.142a2.405 2.405 0 0 0 .699-1.695h-.2Zm-.632-1.546c.446.356.632.895.632 1.546h.2c0-.687-.197-1.295-.707-1.703l-.125.157Zm-1.466-.647c.542 0 1.091.272 1.458.64l.141-.142c-.397-.398-.994-.698-1.599-.698v.2Zm-1.45.63c.357-.447.898-.63 1.45-.63v-.2c-.594 0-1.2.198-1.607.706l.156.125Zm-.647 1.563a2.205 2.205 0 0 1 .64-1.554l-.142-.141a2.405 2.405 0 0 0-.698 1.695h.2Zm.63 1.546c-.445-.357-.63-.896-.63-1.546h-.2c0 .687.196 1.295.706 1.702l.125-.156Zm8.156 1.316c-.834 0-1.477-.276-2.032-.83l-.141.14c.592.593 1.286.89 2.173.89v-.2Zm1.197-.276a2.545 2.545 0 0 1-1.197.276v.2c.493 0 .89-.1 1.286-.297l-.089-.18Zm.93-.746c-.289.288-.565.563-.93.746l.09.179c.398-.2.696-.498.98-.783l-.14-.142Zm-.478-.336.477.478.142-.142-.478-.478-.141.142Zm-1.65.889c.703 0 1.303-.303 1.797-.896l-.153-.128c-.462.553-1.008.824-1.643.824v.2Zm-1.694-.698a2.405 2.405 0 0 0 1.695.698v-.2a2.205 2.205 0 0 1-1.554-.64l-.141.142Zm-.698-1.695c0 .687.196 1.295.706 1.702l.125-.156c-.446-.357-.631-.896-.631-1.546h-.2Zm.706-1.702c-.51.407-.706 1.015-.706 1.702h.2c0-.65.185-1.19.63-1.546l-.124-.156Zm1.687-.691c-.345 0-.645.049-.922.162-.278.114-.527.29-.773.536l.141.141c.232-.231.46-.39.708-.491.248-.102.521-.148.846-.148v-.2Zm1.702.802a2.141 2.141 0 0 0-1.702-.802v.2a1.94 1.94 0 0 1 1.546.727l.156-.125Zm.329-.486-.478.477.142.142.477-.478-.141-.141Zm-2.031-.785c.832 0 1.472.275 2.026.92l.151-.13c-.593-.692-1.29-.99-2.177-.99v.2Zm-2.032.83c.555-.554 1.198-.83 2.032-.83v-.2c-.887 0-1.581.297-2.173.89l.141.14Zm-.83 2.032c0-.834.276-1.477.83-2.031l-.141-.142c-.592.592-.89 1.287-.89 2.173h.2Zm.83 2.031c-.554-.554-.83-1.198-.83-2.031h-.2c0 .886.297 1.58.889 2.173l.141-.142Zm6.522.935h.668v-.2h-.668v.2Zm-.1-5.164v5.064h.2V8.757h-.2Zm-1.525.1h1.625v-.2h-1.625v.2Zm-.1-.769v.67h.2v-.67h-.2Zm4.018-.1h-3.918v.2h3.918v-.2Zm.1.77v-.67h-.2v.67h.2Zm-1.724.1h1.624v-.2H57.87v.2Zm.1 4.963V8.757h-.2v5.064h.2Zm6.497-5.774-.043.096.183.082.043-.095-.183-.083Zm.191.137v-.096h-.2v.096h.2Zm-.143.1h.043v-.2h-.043v.2Zm-2.063 4.718 2.155-4.777-.183-.082-2.154 4.777.182.082Zm-1.429 1.11c.626 0 1.133-.42 1.43-1.111l-.184-.08c-.277.646-.725.991-1.246.991v.2Zm-.618-.106c.215.108.43.106.618.106v-.2c-.193 0-.361-.001-.528-.085l-.09.18Zm.14-.786-.191.67.192.054.191-.669-.192-.055Zm.478.023c-.048 0-.112 0-.174-.01-.065-.011-.112-.03-.137-.056l-.142.142c.07.07.167.098.246.111.08.014.16.013.207.013v-.2Zm.312-.066c-.062.062-.113.066-.312.066v.2c.183 0 .324.005.453-.124l-.141-.142Zm.268-.356a1.221 1.221 0 0 1-.268.356l.141.142c.098-.098.203-.203.305-.409l-.178-.09Zm.187-.47-.19.478.185.074.191-.478-.186-.074Zm-1.909-4.126 1.911 4.204.182-.082-1.91-4.204-.183.082Zm.951-.141h-.86v.2h.86v-.2Zm1.525 3.308-1.433-3.248-.183.08 1.433 3.249.183-.08Zm1.153-3.246-1.337 3.248.185.077 1.337-3.249-.185-.076Zm1.005-.062h-.912v.2h.912v-.2Zm.803.004v5.733h.2V8.088h-.2Zm4.209-.1H65.42v.2h4.109v-.2Zm.1 5.833V8.088h-.2v5.733h.2Zm-.865.1h.765v-.2h-.765v.2Zm-.1-5.164v5.064h.2V8.757h-.2Zm-2.575.1h2.675v-.2H66.09v.2Zm.1 4.964V8.757h-.2v5.064h.2Zm-.769.1h.669v-.2h-.669v.2Zm5.546-.1V8.088h-.2v5.733h.2Zm.664-.1h-.764v.2h.764v-.2Zm-.1-2.48v2.58h.2v-2.58h-.2Zm2.967-.1H71.63v.2h2.867v-.2Zm.1 2.68v-2.58h-.2v2.58h.2Zm.664-.1h-.764v.2h.764v-.2Zm-.1-5.633v5.733h.2V8.088h-.2Zm-.664.1h.764v-.2h-.764v.2Zm.1 2.385V8.088h-.2v2.485h.2Zm-2.967.1h2.867v-.2H71.63v.2Zm-.1-2.585v2.485h.2V8.088h-.2Zm-.664.1h.764v-.2h-.764v.2Zm8.312 5.829c.887 0 1.581-.297 2.173-.89l-.141-.14c-.555.554-1.198.83-2.032.83v.2Zm-2.172-.89c.592.593 1.286.89 2.172.89v-.2c-.833 0-1.476-.276-2.03-.83l-.142.14Zm-.89-2.172c0 .886.298 1.58.89 2.173l.141-.142c-.554-.554-.83-1.198-.83-2.031h-.2Zm.89-2.173c-.592.592-.89 1.287-.89 2.173h.2c0-.834.277-1.477.831-2.031l-.141-.142Zm2.172-.89c-.886 0-1.58.298-2.172.89l.141.142c.555-.555 1.198-.831 2.031-.831v-.2Zm2.173.89c-.592-.592-1.286-.89-2.173-.89v.2c.834 0 1.477.277 2.032.832l.141-.142Zm.89 2.173c0-.886-.298-1.58-.89-2.173l-.141.142c.554.554.83 1.197.83 2.03h.2Zm-.884 2.166c.491-.59.785-1.277.883-2.155l-.2-.022c-.093.842-.372 1.492-.837 2.049l.154.128Zm-3.873-.471c.397.397.995.698 1.6.698v-.2c-.543 0-1.092-.273-1.459-.64l-.141.142Zm-.698-1.695c0 .698.299 1.296.698 1.695l.141-.142a2.205 2.205 0 0 1-.64-1.553h-.2Zm.698-1.695a2.405 2.405 0 0 0-.698 1.695h.2c0-.64.274-1.189.64-1.554l-.142-.141Zm1.6-.698c-.595 0-1.201.198-1.608.706l.156.125c.358-.448.899-.631 1.451-.631v-.2Zm1.599.698c-.398-.398-.995-.698-1.6-.698v.2c.542 0 1.091.272 1.458.64l.142-.142Zm.698 1.695c0-.687-.197-1.295-.707-1.703l-.125.157c.446.356.632.895.632 1.546h.2Zm-.698 1.695a2.405 2.405 0 0 0 .698-1.695h-.2a2.205 2.205 0 0 1-.64 1.553l.142.142Zm-1.6.698c.594 0 1.2-.199 1.607-.707l-.156-.124c-.358.447-.899.63-1.45.63v.2Zm5.92-5.26v5.733h.2V8.088h-.2Zm2.202-.1h-2.102v.2h2.102v-.2Zm1.217.507a1.682 1.682 0 0 0-1.217-.507v.2c.448 0 .806.179 1.076.449l.14-.142Zm.507 1.218c0-.507-.204-.914-.507-1.218l-.142.142c.27.27.449.627.449 1.076h.2Zm-.138.629c.072-.201.138-.383.138-.63h-.2c0 .208-.054.36-.126.563l.188.067Zm-.002.004-.185-.075.185.075Zm0 0-.185-.075.185.075Zm-.056.163a7.73 7.73 0 0 1 .058-.167l-.189-.067-.06.17.19.064Zm-.637.54c.313-.103.524-.313.631-.527l-.179-.09a.88.88 0 0 1-.515.428l.063.19Zm.708.313c-.19-.19-.396-.398-.708-.502l-.063.19c.261.087.437.26.63.453l.141-.141Zm.316.93c0-.397-.1-.714-.316-.93l-.141.141c.165.166.257.423.257.79h.2Zm-.507 1.218c.303-.304.507-.71.507-1.218h-.2c0 .449-.179.806-.448 1.076l.141.142Zm-1.313.507c.508 0 .911-.205 1.302-.498l-.12-.16c-.373.28-.734.458-1.182.458v.2Zm-2.197 0H87.3v-.2h-2.197v.2Zm-.1-.196v.096h.2v-.096h-.2Zm.863-3.148h1.338v-.2h-1.338v.2Zm-.1-1.82v1.72h.2v-1.72h-.2Zm1.438-.1h-1.338v.2h1.338v-.2Zm.74.316a1.094 1.094 0 0 0-.33-.236.99.99 0 0 0-.41-.08v.2c.132 0 .237.022.33.063a.896.896 0 0 1 .268.194l.142-.141Zm.315.644c0-.227-.114-.442-.316-.644l-.14.141c.18.18.256.348.256.503h.2Zm-.316.644c.203-.202.316-.417.316-.644h-.2c0 .155-.077.322-.257.502l.141.142Zm-.74.316a.99.99 0 0 0 .412-.08c.122-.055.227-.135.329-.236l-.142-.142a.894.894 0 0 1-.268.195.79.79 0 0 1-.33.063v.2Zm.192 2.38h-1.433v.2h1.433v-.2Zm.598-.258a.895.895 0 0 1-.268.194.79.79 0 0 1-.33.063v.2a.99.99 0 0 0 .41-.08c.123-.054.228-.134.33-.236l-.142-.141Zm.258-.598a.79.79 0 0 1-.064.33.896.896 0 0 1-.194.268l.142.141c.101-.101.181-.206.235-.328a.99.99 0 0 0 .08-.411h-.2Zm-.258-.598a.933.933 0 0 1 .258.598h.2c0-.216-.105-.529-.316-.74l-.142.142Zm-.598-.258c.132 0 .237.022.33.063a.897.897 0 0 1 .268.195l.142-.142a1.094 1.094 0 0 0-.33-.235.99.99 0 0 0-.41-.08v.2Zm-1.433 0h1.433v-.2h-1.433v.2Zm.1 1.811v-1.91h-.2v1.91h.2ZM10.65 9.356l12.795 7.28.099-.173-12.795-7.28-.099.173Zm-.633-.228c.187.01.426.069.622.22l.122-.158a1.328 1.328 0 0 0-.733-.262l-.01.2Zm10.567 10.337L10.094 8.957l-.142.141 10.49 10.508.141-.141Zm2.84-2.986-2.982 2.986.142.141 2.98-2.986-.14-.14Zm-12.85 14.846a.88.88 0 0 1-.559.176l-.001.2c.24.002.479-.06.682-.218l-.123-.158Zm12.87-7.34-12.859 7.332.1.174 12.858-7.333-.099-.173Zm-3.002-2.828 2.98 2.985.142-.141-2.98-2.986-.142.142ZM10.085 31.672l10.498-10.515-.141-.142L9.944 31.531l.141.141ZM28.551 19.55c.426.241.634.525.635.761h.2c0-.35-.294-.684-.736-.935l-.099.174Zm-4.234-2.4 4.234 2.4.099-.174-4.234-2.4-.1.173Zm-3.1 3.231 3.22-3.248-.142-.141-3.22 3.248.142.141Zm3.233 3.122-3.233-3.263-.142.141 3.233 3.263.142-.141Zm4.099-2.421-4.22 2.405.1.173 4.219-2.405-.099-.173Zm.637-.77c0 .237-.208.524-.637.77l.1.173c.445-.255.738-.594.737-.944h-.2Zm-20.1 10.166c-.013.184.007.357.055.518l.192-.057a1.261 1.261 0 0 1-.048-.448l-.2-.013Zm-.002-20.371.001 20.378h.2V10.107h-.2Zm.057-.472a1.397 1.397 0 0 0-.057.477l.2-.01a1.197 1.197 0 0 1 .049-.41l-.192-.057ZM19.947 20.24 9.307 9.593l-.14.141 10.638 10.647.142-.141ZM9.307 31.038l10.64-10.657-.142-.141L9.166 30.897l.142.141Zm33.474-5.847v-1.72h-.2v1.72h.2Zm4.008-.1h-4.108v.2h4.108v-.2Zm-.885 2.368c.496-.496.887-1.282.984-2.258l-.198-.02c-.094.935-.467 1.677-.927 2.137l.141.141Zm-3.223 1.272c1.656 0 2.636-.684 3.223-1.272l-.141-.141c-.56.559-1.49 1.213-3.082 1.213v.2Zm-4.591-4.687c0 2.633 1.953 4.687 4.59 4.687v-.2c-2.521 0-4.39-1.96-4.39-4.486h-.2Zm4.59-4.686c-2.54 0-4.59 2.053-4.59 4.686h.2c0-2.525 1.963-4.486 4.39-4.486v-.2Zm3.22 1.267c-.778-.68-1.851-1.267-3.22-1.267v.2c1.308 0 2.336.56 3.088 1.218l.131-.15Zm1.105-1.237-1.242 1.242.141.141 1.242-1.242-.141-.141Zm-4.229-1.55c1.88 0 3.195.75 4.232 1.694l.135-.148c-1.064-.967-2.425-1.746-4.367-1.746v.2Zm-6.301 6.206c0-3.382 2.915-6.206 6.301-6.206v-.2c-3.493 0-6.501 2.91-6.501 6.406h.2Zm6.301 6.206c-3.386 0-6.301-2.823-6.301-6.206h-.2c0 3.497 3.008 6.406 6.501 6.406v-.2Zm4.322-1.783c-1.126 1.22-2.436 1.783-4.322 1.783v.2c1.936 0 3.301-.583 4.469-1.847l-.147-.136Zm1.502-3.945c0 1.226-.378 2.82-1.5 3.942l.142.142c1.171-1.172 1.558-2.825 1.558-4.084h-.2Zm-.09-1.02c.089.269.09.632.09 1.02h.2c0-.376.001-.777-.1-1.082l-.19.063Zm-5.83.07h5.924v-.2h-5.923v.2Zm6.597 2.766c0-2.332 1.77-4.009 4.009-4.009v-.2c-2.347 0-4.209 1.763-4.209 4.209h.2Zm4.009 4.008a3.978 3.978 0 0 1-4.009-4.008h-.2a4.178 4.178 0 0 0 4.209 4.208v-.2Zm4.008-4.008c0 2.332-1.769 4.008-4.008 4.008v.2c2.347 0 4.208-1.763 4.208-4.208h-.2Zm-4.008-4.009c2.24 0 4.008 1.583 4.008 4.009h.2c0-2.543-1.863-4.209-4.208-4.209v.2Zm8.885-.2c-2.347 0-4.208 1.763-4.208 4.209h.2c0-2.332 1.769-4.009 4.008-4.009v-.2Zm4.209 4.209c0-2.543-1.864-4.209-4.209-4.209v.2c2.241 0 4.009 1.583 4.009 4.009h.2Zm-4.209 4.208c2.347 0 4.209-1.763 4.209-4.208h-.2c0 2.332-1.77 4.008-4.009 4.008v.2Zm-4.208-4.208a4.178 4.178 0 0 0 4.208 4.208v-.2a3.978 3.978 0 0 1-4.008-4.008h-.2Zm4.21 2.288c-1.182 0-2.194-1-2.194-2.384h-.2c0 1.483 1.09 2.584 2.393 2.584v-.2Zm2.192-2.384c0 1.383-1.011 2.384-2.193 2.384v.2c1.303 0 2.393-1.1 2.393-2.584h-.2Zm-2.193-2.384c1.185 0 2.193.908 2.193 2.384h.2c0-1.581-1.093-2.584-2.393-2.584v.2Zm-2.193 2.384c0-1.383 1.012-2.384 2.193-2.384v-.2c-1.302 0-2.393 1.1-2.393 2.584h.2Zm-6.694 2.384c-1.182 0-2.193-1-2.193-2.384h-.2c0 1.483 1.09 2.584 2.393 2.584v-.2Zm2.193-2.384c0 1.383-1.011 2.384-2.193 2.384v.2c1.303 0 2.393-1.1 2.393-2.584h-.2Zm-2.193-2.384c1.184 0 2.193.908 2.193 2.384h.2c0-1.581-1.093-2.584-2.393-2.584v.2Zm-2.193 2.384c0-1.383 1.011-2.384 2.193-2.384v-.2c-1.302 0-2.393 1.1-2.393 2.584h.2Zm35.058-1.47c-.386-.965-1.366-2.643-3.532-2.643v.2c2.037 0 2.968 1.572 3.347 2.517l.185-.074Zm.191.478-.19-.478-.186.074.19.478.186-.074Zm-5.5 2.422 5.446-2.293-.077-.184-5.446 2.293.077.184Zm1.968 1.05c-.464 0-.826-.093-1.13-.283-.303-.191-.555-.487-.789-.908l-.175.097c.244.44.517.765.858.98.343.215.744.314 1.236.314v-.2Zm1.925-1.105c-.235.329-.488.604-.796.798-.306.192-.67.307-1.129.307v.2c.496 0 .897-.125 1.236-.338.337-.213.609-.51.852-.85l-.163-.117Zm1.477.932-1.337-.955-.117.163 1.338.955.116-.163Zm-3.402 1.997c1.86 0 3.036-1.174 3.43-1.866l-.173-.099c-.369.646-1.486 1.765-3.257 1.765v.2Zm-4.113-4.208c0 2.345 1.762 4.208 4.113 4.208v-.2c-2.235 0-3.913-1.767-3.913-4.008h-.2Zm3.922-4.209c-2.16 0-3.922 1.672-3.922 4.209h.2c0-2.432 1.678-4.009 3.722-4.009v-.2Zm0 1.529c-.913 0-2.203.902-2.203 2.489h.2c0-1.471 1.195-2.29 2.002-2.29v-.2Zm1.62.923c-.106-.267-.34-.497-.628-.66a2.052 2.052 0 0 0-.993-.263v.2c.316 0 .634.09.895.238s.457.348.541.559l.186-.074Zm-3.684 1.658 3.63-1.53-.077-.183-3.63 1.528.077.185Zm-4.529 3.925h1.815v-.2h-1.815v.2Zm-.1-12.043v11.943h.2V18.121h-.2Zm1.915-.1h-1.815v.2h1.815v-.2Zm.1 12.043V18.121h-.2v11.943h.2Zm-6.978-7.83c.92 0 1.661.46 2.127.926l.14-.142c-.49-.49-1.278-.984-2.267-.984v.2Zm-3.818 4.008c0-2.24 1.868-4.008 3.818-4.008v-.2c-2.064 0-4.018 1.861-4.018 4.208h.2Zm3.818 3.913c-2.047 0-3.818-1.675-3.818-3.913h-.2c0 2.348 1.86 4.113 4.018 4.113v-.2Zm2.024-.918c-.365.456-1.102.918-2.024.918v.2c.988 0 1.78-.493 2.18-.993l-.156-.125Zm.173-.037h-.095v.2h.095v-.2Zm.1.673V29.3h-.2v.573h.2Zm-2.297 2.489c.69 0 1.268-.223 1.673-.653.404-.43.624-1.053.624-1.836h-.2c0 .746-.21 1.316-.57 1.699-.36.382-.88.59-1.527.59v.2Zm-2.103-1.506c.202.707 1.003 1.505 2.103 1.505v-.2c-1.003 0-1.73-.73-1.91-1.36l-.193.055Zm-1.393.733 1.53-.67-.08-.182-1.53.669.08.183Zm3.591 2.197c-1.954 0-3.072-1.301-3.54-2.33l-.182.083c.488 1.072 1.663 2.447 3.722 2.447v-.2Zm3.722-4.104c0 1.461-.424 2.484-1.093 3.141-.67.658-1.597.963-2.629.963v.2c1.07 0 2.053-.317 2.77-1.02.716-.704 1.152-1.784 1.152-3.284h-.2Zm0-7.262v7.262h.2V22.42h-.2Zm-1.62.1h1.72v-.2h-1.72v.2Zm.1.57v-.67h-.2v.67h.2Zm-2.202 5.536c-1.182 0-2.194-1-2.194-2.384h-.2c0 1.483 1.091 2.584 2.394 2.584v-.2Zm2.097-2.384c0 1.39-.921 2.384-2.097 2.384v.2c1.307 0 2.297-1.107 2.297-2.584h-.2Zm-2.097-2.384c1.176 0 2.097.995 2.097 2.384h.2c0-1.477-.99-2.584-2.297-2.584v.2Zm-2.194 2.384c0-1.383 1.012-2.384 2.194-2.384v-.2c-1.303 0-2.394 1.1-2.394 2.584h.2Zm21.207-8.021h4.3v-.2h-4.3v.2Zm.1 11.843V18.121h-.2v11.943h.2Zm1.715-.1H90.07v.2h1.815v-.2Zm-.1-4.39v4.49h.2v-4.49h-.2Zm2.584-.1h-2.484v.2h2.484v-.2Zm3.818-3.627c0 2.227-1.855 3.626-3.818 3.626v.2c2.05 0 4.018-1.467 4.018-3.826h-.2Zm-3.818-3.626c1.963 0 3.818 1.4 3.818 3.626h.2c0-2.36-1.968-3.826-4.018-3.826v.2Zm.097 5.532h-2.58v.2h2.58v-.2Zm2.002-2.01c-.092 1.016-.828 2.01-2.002 2.01v.2c1.31 0 2.103-1.108 2.202-2.193l-.2-.018Zm-2.002-1.898c1.274 0 2.002 1.092 2.002 1.906h.2c0-.906-.8-2.106-2.202-2.106v.2Zm-2.58 0h2.58v-.2h-2.58v.2Zm.1 4.008v-4.108h-.2v4.108h.2Zm10.408.132c.457-1.188 1.744-1.751 3.06-1.751v-.2c-1.359 0-2.748.583-3.246 1.88l.186.07Zm1.569.54-1.624-.669-.076.185 1.624.67.076-.186Zm1.586-.867c-.343 0-.67.049-.962.189a1.7 1.7 0 0 0-.749.721l.174.1c.182-.319.406-.519.661-.64.257-.124.551-.17.876-.17v-.2Zm2.011 1.619c-.102-1.022-1.02-1.62-2.011-1.62v.2c.921 0 1.723.55 1.812 1.44l.199-.02Zm0 .105v-.095h-.2v.095h.2Zm-1.915-.378c.37 0 .743.07 1.058.163.317.094.57.21.702.298l.111-.166a3.02 3.02 0 0 0-.756-.323 4.005 4.005 0 0 0-1.115-.172v.2Zm-3.34 2.576c0-.822.41-1.463 1.033-1.901.625-.44 1.464-.675 2.307-.675v-.2c-.877 0-1.758.244-2.422.711-.667.47-1.118 1.167-1.118 2.065h.2Zm2.862 2.575c-1.489 0-2.862-1.021-2.862-2.575h-.2c0 1.694 1.494 2.775 3.062 2.775v-.2Zm2.216-1.11c-.237.284-.491.56-.834.766-.342.205-.777.344-1.382.344v.2c.638 0 1.11-.148 1.485-.373.373-.224.645-.521.885-.81l-.154-.128Zm.173-.037h-.096v.2h.096v-.2Zm.1 1.056v-.956h-.2v.956h.2Zm1.62-.1h-1.72v.2h1.72v-.2Zm-.1-4.486v4.586h.2v-4.586h-.2Zm-3.722-3.244c1.962 0 3.536 1.21 3.722 3.253l.199-.018c-.196-2.16-1.87-3.435-3.921-3.435v.2Zm-.191 6.392a1.83 1.83 0 0 1-.881-.225c-.265-.155-.452-.389-.452-.726h-.2c0 .428.243.72.551.899.305.178.682.252.982.252v-.2Zm2.004-1.827c-.184 1.101-1.1 1.827-2.004 1.827v.2c1.007 0 2.002-.802 2.201-1.994l-.197-.033Zm-.082.051.143.058.074-.186-.141-.057-.076.185Zm-.007-.003.09-.179-.09.18Zm-1.437-.314c.667 0 1.031.149 1.444.317l.076-.185c-.42-.171-.813-.332-1.52-.332v.2Zm-1.811 1.142c0-.431.233-.712.579-.89.35-.181.81-.252 1.232-.252v-.2c-.438 0-.934.073-1.324.274-.395.204-.687.544-.687 1.068h.2Zm9.451-.059 2.007-5.16-.187-.072-2.006 5.16.186.072Zm-.189.064h.096v-.2h-.096v.2Zm-2.194-5.222 2.102 5.16.185-.076-2.102-5.16-.185.076Zm-1.819.062h1.911v-.2h-1.911v.2Zm3.245 7.122-3.153-7.262-.183.08 3.153 7.261.183-.08Zm-1.816 4.094 1.816-4.013-.183-.083-1.815 4.013.182.083Zm1.724-.141h-1.815v.2h1.815v-.2Zm4.782-11.214-4.873 11.274.183.08 4.873-11.275-.183-.08Zm-1.82.14h1.911v-.2h-1.911v.2Zm-16.05 7.643h1.815v-.2h-1.816v.2Zm-.1-12.043v11.943h.2V18.121h-.2Zm1.915-.1h-1.816v.2h1.816v-.2Zm.1 12.043V18.121h-.2v11.943h.2Z" /></symbol>',126,40),pu=Ni("Icon40GooglePlayButtonEn","google_play_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 126 40" id="google_play_button_en_40"><path fill="currentColor" fill-rule="evenodd" d="M63.133 13.174c.583.6 1.321.905 2.196.905.875 0 1.612-.303 2.193-.908.579-.586.877-1.328.887-2.208 0-.857-.299-1.6-.887-2.207-.593-.6-1.33-.906-2.195-.906-.875 0-1.613.305-2.194.906-.588.588-.887 1.33-.887 2.207a3.079 3.079 0 0 0 .887 2.21Zm-26.041.012c.607.593 1.35.893 2.205.893.892 0 1.63-.298 2.193-.884.497-.495.747-1.165.747-1.994 0-.144-.021-.3-.043-.451l-.012-.082h-2.993v.898h2.094c-.053.426-.202.762-.443 1.002-.408.409-.93.615-1.552.615a2.099 2.099 0 0 1-1.512-.615c-.422-.41-.636-.949-.636-1.6 0-.65.214-1.189.636-1.6.42-.408.928-.615 1.511-.615.654 0 1.148.214 1.516.651l.068.08.653-.64-.058-.069a2.49 2.49 0 0 0-.937-.668 3.082 3.082 0 0 0-1.232-.254c-.868 0-1.61.3-2.205.893-.603.591-.909 1.338-.909 2.22 0 .882.306 1.629.909 2.22Zm35.894.766h.923V7.98h-.933v3.483l.024.81-2.658-4.247-.029-.046H69.26v5.97h.923v-3.695l-.024-.812 2.827 4.509Zm-15.529 0h.933V8.878h1.622V7.98h-4.177v.898h1.622v5.074Zm-3.316 0h.933V7.98h-.933v5.972Zm-5.242 0h.933V8.878h1.622V7.98h-4.177v.898h1.622v5.074Zm-5.79-.01h3.578v-.898h-2.642v-1.639h2.384v-.888h-2.384V8.878h2.642V7.98H43.11v5.962Zm22.22-.761a2.067 2.067 0 0 1-1.511-.625c-.408-.406-.612-.944-.612-1.59s.207-1.182.617-1.59c.41-.42.903-.625 1.508-.625.586 0 1.094.209 1.511.625.408.406.615.944.615 1.59s-.207 1.182-.617 1.59c-.412.42-.906.625-1.511.625ZM23.494 16.55 10.7 9.27a1.23 1.23 0 0 0-.677-.242l10.49 10.507 2.981-2.985Zm-13.48 15.052a.98.98 0 0 0 .62-.198l12.86-7.332-2.982-2.986-10.498 10.516ZM29.286 20.31c0-.293-.251-.602-.686-.848l-4.234-2.4-3.22 3.248 3.233 3.262 4.22-2.405c.437-.25.688-.563.687-.857ZM9.236 30.967a1.36 1.36 0 0 1-.05-.482l-.002-20.378a1.297 1.297 0 0 1 .053-.443L19.876 20.31 9.236 30.967Zm33.445-7.496v1.72h4.108c-.096.956-.478 1.72-.955 2.198-.574.573-1.53 1.242-3.153 1.242-2.58 0-4.491-2.007-4.491-4.586s2.006-4.587 4.49-4.587c1.338 0 2.39.574 3.154 1.242l1.242-1.242c-1.051-.955-2.389-1.72-4.3-1.72-3.44 0-6.401 2.867-6.401 6.307s2.962 6.306 6.401 6.306c1.911 0 3.249-.574 4.395-1.816 1.147-1.146 1.529-2.77 1.529-4.013 0-.382 0-.764-.096-1.05h-5.923Zm10.605-1.242c-2.293 0-4.109 1.72-4.109 4.109 0 2.293 1.816 4.108 4.109 4.108s4.108-1.72 4.108-4.108c0-2.484-1.815-4.109-4.108-4.109Zm4.777 4.109c0-2.389 1.815-4.109 4.108-4.109 2.293 0 4.109 1.625 4.109 4.109 0 2.388-1.816 4.108-4.109 4.108s-4.108-1.815-4.108-4.108Zm1.816-.096c0 1.433 1.051 2.484 2.293 2.484s2.293-1.05 2.293-2.484c0-1.529-1.05-2.484-2.293-2.484s-2.293 1.05-2.293 2.484Zm-8.887 0c0 1.433 1.051 2.484 2.293 2.484s2.293-1.05 2.293-2.484c0-1.529-1.05-2.484-2.293-2.484s-2.293 1.05-2.293 2.484Zm31.626-4.013c2.102 0 3.057 1.624 3.44 2.58l.19.478-5.445 2.293c.477.86 1.05 1.242 2.006 1.242.956 0 1.529-.478 2.007-1.147l1.337.956c-.382.669-1.529 1.815-3.344 1.815-2.293 0-4.013-1.815-4.013-4.108 0-2.485 1.72-4.109 3.822-4.109Zm-2.103 3.917c0-1.528 1.242-2.388 2.102-2.388.67 0 1.338.382 1.53.86l-3.632 1.529Zm-2.675 3.918h-1.815V18.121h1.815v11.943Zm-4.68-6.975c-.479-.478-1.243-.955-2.198-.955-2.007 0-3.918 1.815-3.918 4.108 0 2.293 1.816 4.013 3.918 4.013.955 0 1.72-.478 2.102-.955h.095v.573c0 1.529-.86 2.389-2.197 2.389-1.051 0-1.816-.765-2.007-1.434l-1.529.67c.478 1.05 1.625 2.388 3.631 2.388 2.102 0 3.822-1.242 3.822-4.204V22.42h-1.72v.67Zm-4.396 3.153c0 1.433 1.05 2.484 2.293 2.484s2.197-1.05 2.197-2.484c0-1.433-.955-2.484-2.197-2.484s-2.293 1.05-2.293 2.484Zm25.605-8.121h-4.3v11.943h1.816v-4.49h2.484c2.007 0 3.918-1.434 3.918-3.727s-1.911-3.726-3.918-3.726Zm-2.483 5.732h2.58c1.242 0 2.007-1.05 2.102-2.102 0-.86-.764-2.006-2.102-2.006h-2.58v4.108Zm13.568-1.72c-1.338 0-2.675.574-3.153 1.816l1.624.669c.382-.669.956-.86 1.624-.86.956 0 1.816.573 1.911 1.529v.095c-.286-.19-1.051-.477-1.815-.477-1.72 0-3.44.955-3.44 2.675 0 1.624 1.433 2.675 2.962 2.675 1.242 0 1.816-.573 2.293-1.146h.096v.955h1.72v-4.586c-.191-2.102-1.816-3.344-3.822-3.344Zm-1.624 5.542c0 .765.86 1.051 1.433 1.051.956 0 1.911-.764 2.102-1.91-.048-.02-.095-.04-.142-.058-.417-.17-.795-.325-1.482-.325-.86 0-1.911.287-1.911 1.242Zm11.464-5.255-2.006 5.16h-.096l-2.102-5.16h-1.911l3.153 7.262-1.815 4.013h1.815l4.873-11.275h-1.911Zm-14.235 7.644h-1.816V18.121h1.816v11.943Z" clip-rule="evenodd" /><path fill="currentColor" d="m63.133 13.174.072-.07-.072.07Zm4.39-.003-.072-.07h-.001l.072.07Zm.886-2.208.1.002v-.002h-.1Zm-.887-2.207.072-.07-.072.07Zm-4.389 0 .071.07h.001l-.072-.07Zm-.887 2.207.1.002v-.002h-.1Zm-25.154 2.223-.07.07v.001l.07-.071Zm4.398.01-.07-.072-.002.002.072.07Zm.704-2.446.1-.015h-.001l-.099.015Zm-.012-.082.099-.015-.013-.085h-.086v.1Zm-2.993 0v-.1h-.1v.1h.1Zm0 .898h-.1v.1h.1v-.1Zm2.094 0 .1.013.013-.113h-.113v.1Zm-.443 1.002-.071-.07.07.07Zm-3.064 0-.07.072.07-.072Zm0-3.2-.07-.071.07.071Zm3.027.036-.076.065.076-.065Zm.068.08-.076.065.07.081.076-.075-.07-.071Zm.653-.64.07.072.066-.064-.059-.071-.077.064Zm-.058-.069.077-.064-.077.064Zm-.937-.668-.04.092.04-.092Zm-3.437.64.07.07-.07-.07Zm36.817 5.205v.1h.1v-.1h-.1Zm-.923 0-.085.053.03.047h.055v-.1Zm.923-5.972h.1v-.1h-.1v.1Zm-.933 0v-.1h-.1v.1h.1Zm0 3.483h-.1v.003l.1-.003Zm.024.81-.084.053.195.312-.01-.368-.1.003Zm-2.658-4.247.085-.053v-.001l-.085.054Zm-.029-.046.085-.054-.03-.046h-.055v.1Zm-1.053 0v-.1h-.1v.1h.1Zm0 5.97h-.1v.1h.1v-.1Zm.923 0v.1h.1v-.1h-.1Zm0-3.695h.1v-.003l-.1.003Zm-.024-.812.085-.053-.196-.312.01.368.1-.003ZM58.39 13.952v.1h.1v-.1h-.1Zm-.933 0h-.1v.1h.1v-.1Zm.933-5.074v-.1h-.1v.1h.1Zm1.622 0v.1h.1v-.1h-.1Zm0-.898h.1v-.1h-.1v.1Zm-4.177 0v-.1h-.1v.1h.1Zm0 .898h-.1v.1h.1v-.1Zm1.622 0h.1v-.1h-.1v.1Zm-2.383 5.074v.1h.1v-.1h-.1Zm-.933 0h-.1v.1h.1v-.1Zm.933-5.972h.1v-.1h-.1v.1Zm-.933 0v-.1h-.1v.1h.1Zm-4.31 5.972v.1h.1v-.1h-.1Zm-.932 0h-.1v.1h.1v-.1Zm.933-5.074v-.1h-.1v.1h.1Zm1.622 0v.1h.1v-.1h-.1Zm0-.898h.1v-.1h-.1v.1Zm-4.177 0v-.1h-.1v.1h.1Zm0 .898h-.1v.1h.1v-.1Zm1.622 0h.1v-.1h-.1v.1Zm-2.212 5.064v.1h.1v-.1h-.1Zm-3.577 0h-.1v.1h.1v-.1Zm3.577-.898h.1v-.1h-.1v.1Zm-2.642 0h-.1v.1h.1v-.1Zm0-1.639v-.1h-.1v.1h.1Zm2.384 0v.1h.1v-.1h-.1Zm0-.888h.1v-.1h-.1v.1Zm-2.384 0h-.1v.1h.1v-.1Zm0-1.639v-.1h-.1v.1h.1Zm2.642 0v.1h.1v-.1h-.1Zm0-.898h.1v-.1h-.1v.1Zm-3.577 0v-.1h-.1v.1h.1Zm20.708 4.576.07-.07-.07.07Zm.005-3.18.07.07h.001l-.071-.07Zm3.02 0-.071.07.07-.07Zm-.003 3.18-.07-.07h-.001l.071.07ZM10.7 9.27l-.062.08.012.007.05-.087Zm12.794 7.28.07.07.093-.092-.114-.065-.049.087ZM10.023 9.028l.005-.1-.26-.014.184.184.07-.07Zm10.49 10.507-.071.071.07.07.071-.07-.07-.07Zm-9.878 11.87-.05-.088-.012.008.062.08Zm-.62.197-.071-.071-.169.169.239.002v-.1Zm13.479-7.53.05.087.113-.065-.093-.093-.07.07Zm-2.982-2.986.071-.07-.07-.072-.071.071.07.07Zm8.088-1.623-.05.087h.001l.05-.087Zm.686.848h.1-.1Zm-4.92-3.249.05-.087-.067-.037-.054.054.071.07Zm-3.22 3.249-.071-.07-.07.07.07.07.07-.07Zm3.233 3.262-.07.07.053.055.067-.038-.05-.087Zm4.22-2.405.049.087-.05-.086ZM9.184 30.486l.1.006v-.006h-.1Zm.052.482-.096.029.048.16.119-.118-.071-.07Zm-.053-20.86h.1v-.005l-.1.005Zm.053-.443.07-.071-.117-.118-.049.16.096.029ZM19.876 20.31l.07.07.071-.07-.07-.071-.071.07Zm22.805 4.88h-.1v.1h.1v-.1Zm0-1.72v-.1h-.1v.1h.1Zm4.108 1.72.1.01.01-.11h-.11v.1Zm-.955 2.198-.071-.071.07.07Zm0-6.689-.066.076.07.061.066-.066-.07-.07Zm1.242-1.242.07.071.075-.074-.078-.07-.067.073Zm.095 9.077-.07-.07-.003.002.073.068Zm1.433-5.064.095-.031-.022-.069h-.073v.1Zm37.454 1.338.092-.037-.092.037Zm.19.478.04.092.09-.038-.036-.092-.093.038Zm-5.445 2.293-.04-.092-.102.043.054.097.088-.048Zm4.013.095.058-.081-.082-.058-.058.081.082.058Zm1.337.956.087.05.045-.08-.074-.052-.058.082Zm-5.638-2.485h-.1v.151l.14-.058-.04-.093Zm3.631-1.528.039.092.09-.038-.036-.091-.093.037Zm-8.121 5.446h-.1v.1h.1v-.1Zm1.815 0v.1h.1v-.1h-.1Zm-1.815-11.943v-.1h-.1v.1h.1Zm1.815 0h.1v-.1h-.1v.1Zm-4.68 4.968-.071.07.17.171v-.24h-.1Zm-.096 6.21v-.1h-.048l-.03.038.078.063Zm.095 0h.1v-.1h-.1v.1Zm-4.204 1.53.096-.028-.031-.11-.105.046.04.091Zm-1.529.668-.04-.092-.093.041.042.092.091-.04Zm7.453-9.077h.1v-.1h-.1v.1Zm-1.72 0v-.1h-.1v.1h.1Zm16.91-4.3v-.1h-.1v.1h.1Zm0 11.944h-.1v.1h.1v-.1Zm1.816 0v.1h.1v-.1h-.1Zm0-4.49v-.1h-.1v.1h.1Zm.001-1.72h-.1v.1h.1v-.1Zm4.682-2.103.1.01v-.01h-.1Zm-4.682-2.006v-.1h-.1v.1h.1Zm10.415 4.204-.093-.036-.036.091.091.037.038-.092Zm1.624.669-.038.092.081.034.044-.077-.087-.05Zm3.535.669h.101l-.001-.01-.1.01Zm0 .095-.055.083.155.104v-.187h-.1Zm0 3.726v-.1h-.047l-.03.036.077.064Zm.096 0h.1v-.1h-.1v.1Zm0 .956h-.1v.1h.1v-.1Zm1.72 0v.1h.1v-.1h-.1Zm0-4.586h.1l-.001-.01-.099.01Zm-1.911 1.337.099.017.013-.08-.075-.03-.037.093Zm-.142-.057.038-.093-.038.093Zm6.065.822v.1h.068l.025-.064-.093-.036Zm2.006-5.16v-.1h-.068l-.025.064.093.036Zm-2.102 5.16-.092.037.025.063h.067v-.1Zm-2.102-5.16.093-.038-.025-.062h-.068v.1Zm-1.911 0v-.1h-.152l.061.14.091-.04Zm3.153 7.262.092.04.018-.04-.018-.04-.092.04Zm-1.815 4.013-.091-.042-.064.142h.155v-.1Zm1.815 0v.1h.066l.026-.06-.092-.04Zm4.873-11.275.092.04.06-.14h-.152v.1Zm-17.962 7.644h-.1v.1h.1v-.1Zm1.816 0v.1h.1v-.1h-.1Zm-1.816-11.943v-.1h-.1v.1h.1Zm1.816 0h.1v-.1h-.1v.1Zm-35.73-4.142c-.85 0-1.56-.295-2.124-.875l-.143.14c.602.62 1.366.935 2.267.935v-.2Zm2.12-.877c-.56.584-1.27.877-2.12.877v.2c.9 0 1.664-.312 2.265-.939l-.144-.138Zm.86-2.14c-.01.856-.3 1.572-.858 2.139l.142.14c.598-.605.906-1.373.916-2.276l-.2-.003Zm-.859-2.137c.57.59.859 1.306.859 2.138h.2c0-.883-.309-1.65-.915-2.277l-.144.14Zm-2.124-.875c.84 0 1.551.295 2.125.876l.142-.14c-.612-.62-1.375-.936-2.267-.936v.2Zm-2.12.875c.56-.58 1.271-.875 2.12-.875v-.2c-.9 0-1.664.315-2.265.936l.144.14Zm-.86 2.138c0-.851.29-1.568.858-2.137l-.142-.141c-.607.608-.916 1.377-.916 2.278h.2Zm.858 2.14a2.979 2.979 0 0 1-.858-2.138l-.2-.003a3.18 3.18 0 0 0 .916 2.282l.142-.141Zm-23.907.876c-.83 0-1.547-.29-2.135-.865l-.14.143a3.155 3.155 0 0 0 2.275.922v-.2Zm2.121-.853c-.543.564-1.254.853-2.12.853v.2c.915 0 1.68-.307 2.264-.915l-.144-.138Zm.72-1.925c0 .808-.244 1.45-.718 1.923l.14.142c.52-.517.777-1.215.777-2.065h-.2Zm-.043-.437c.022.152.042.301.042.437h.2a3.38 3.38 0 0 0-.044-.466l-.198.029Zm-.012-.082.012.082.198-.03-.012-.08-.198.028Zm-2.894.086h2.993v-.2h-2.993v.2Zm.1.798v-.898h-.2v.898h.2Zm1.994-.1h-2.094v.2h2.094v-.2Zm-.373 1.173c.26-.26.417-.619.472-1.06l-.198-.025c-.051.409-.193.722-.415.943l.141.142Zm-1.623.644c.646 0 1.196-.215 1.623-.644l-.141-.142c-.387.388-.884.586-1.482.586v.2Zm-1.58-.643c.437.426.971.643 1.58.643v-.2c-.557 0-1.04-.196-1.44-.587l-.14.144Zm-.667-1.672c0 .675.223 1.24.666 1.672l.14-.144c-.4-.39-.606-.9-.606-1.528h-.2Zm.666-1.671c-.443.431-.666.996-.666 1.671h.2c0-.627.206-1.138.606-1.528l-.14-.143Zm1.581-.644c-.609 0-1.143.217-1.58.644l.14.143c.4-.39.883-.587 1.44-.587v-.2Zm1.593.687c-.39-.463-.914-.687-1.593-.687v.2c.628 0 1.093.204 1.44.616l.153-.13Zm.067.079-.067-.08-.153.13.068.08.152-.13Zm.507-.646-.653.64.14.142.653-.639-.14-.143Zm-.065.066.058.07.154-.128-.058-.07-.154.128Zm-.9-.64c.376.16.679.378.9.64l.153-.129a2.59 2.59 0 0 0-.974-.695l-.079.184Zm-1.192-.247c.41 0 .81.082 1.192.247l.08-.184a3.182 3.182 0 0 0-1.272-.263v.2Zm-2.135.865c.576-.574 1.293-.865 2.135-.865v-.2c-.893 0-1.661.31-2.276.923l.141.142Zm-.879 2.149c0-.856.296-1.577.879-2.149l-.14-.142c-.623.61-.939 1.384-.939 2.29h.2Zm.879 2.148c-.583-.571-.879-1.292-.879-2.148h-.2c0 .907.316 1.68.939 2.29l.14-.142Zm36.747.738h-.923v.2h.923v-.2Zm-.1-5.872v5.972h.2V7.98h-.2Zm-.833.1h.933v-.2h-.933v.2Zm.1 3.383V7.98h-.2v3.483h.2Zm.024.807-.024-.81-.2.006.024.81.2-.006Zm-2.843-4.192 2.658 4.248.17-.106-2.658-4.248-.17.106Zm-.028-.045.028.046.17-.107-.03-.046-.168.107Zm-.97.047h1.054v-.2H69.26v.2Zm.1 5.87V7.98h-.2v5.97h.2Zm.824-.1h-.923v.2h.923v-.2Zm-.1-3.595v3.694h.2v-3.694h-.2Zm-.024-.81.024.813.2-.006-.024-.812-.2.006ZM73.07 13.9l-2.828-4.51-.169.107 2.827 4.509.17-.106Zm-14.68-.047h-.934v.2h.933v-.2Zm-.1-4.974v5.074h.2V8.878h-.2Zm1.721-.1H58.39v.2h1.622v-.2Zm-.1-.798v.898h.2V7.98h-.2Zm-4.077.1h4.177v-.2h-4.177v.2Zm.1.798V7.98h-.2v.898h.2Zm1.522-.1h-1.622v.2h1.622v-.2Zm.1 5.174V8.878h-.2v5.074h.2Zm-2.483-.1h-.933v.2h.933v-.2Zm-.1-5.872v5.972h.2V7.98h-.2Zm-.833.1h.933v-.2h-.933v.2Zm.1 5.872V7.98h-.2v5.972h.2Zm-4.41-.1H48.9v.2h.933v-.2Zm-.1-4.974v5.074h.2V8.878h-.2Zm1.723-.1h-1.622v.2h1.622v-.2Zm-.1-.798v.898h.2V7.98h-.2Zm-4.077.1h4.177v-.2h-4.177v.2Zm.1.798V7.98h-.2v.898h.2Zm1.522-.1h-1.622v.2h1.622v-.2Zm.1 5.174V8.878h-.2v5.074h.2Zm-2.313-.11H43.11v.2h3.576v-.2Zm-.1-.798v.898h.2v-.898h-.2Zm-2.541.1h2.641v-.2h-2.641v.2Zm-.1-1.739v1.639h.2v-1.639h-.2Zm2.484-.1h-2.384v.2h2.384v-.2Zm-.1-.788v.888h.2v-.888h-.2Zm-2.284.1h2.384v-.2h-2.384v.2Zm-.1-1.739v1.639h.2V8.878h-.2Zm2.741-.1h-2.641v.2h2.642v-.2Zm-.1-.798v.898h.2V7.98h-.2Zm-3.476.1h3.576v-.2H43.11v.2Zm.1 5.862V7.98h-.2v5.962h.2Zm20.537-1.315c.436.434.967.654 1.582.654v-.2a1.967 1.967 0 0 1-1.44-.596l-.142.142Zm-.641-1.661c0 .669.212 1.234.641 1.66l.141-.14c-.386-.385-.582-.897-.582-1.52h-.2Zm.646-1.661c-.43.43-.646.992-.646 1.66h.2c0-.622.199-1.131.587-1.519l-.141-.141Zm1.58-.654c-.632 0-1.152.214-1.581.655l.143.14c.39-.401.858-.595 1.437-.595v-.2Zm1.581.654a2.171 2.171 0 0 0-1.582-.654v.2c.56 0 1.043.198 1.44.595l.142-.141Zm.644 1.66c0-.668-.215-1.233-.644-1.66l-.141.141c.386.385.585.896.585 1.52h.2Zm-.646 1.662c.43-.43.646-.992.646-1.661h-.2c0 .623-.199 1.132-.588 1.52l.142.14Zm-1.582.654c.63 0 1.15-.215 1.582-.655l-.142-.14c-.393.4-.861.595-1.44.595v.2ZM10.65 9.356l12.795 7.28.098-.173-12.794-7.28-.099.173Zm-.633-.228c.187.01.425.069.622.22l.122-.158a1.328 1.328 0 0 0-.733-.262l-.01.2Zm10.566 10.337L10.094 8.957l-.141.141 10.49 10.508.141-.141Zm2.84-2.986-2.981 2.986.141.141 2.982-2.986-.142-.14Zm-12.85 14.846a.88.88 0 0 1-.558.176l-.001.2c.24.002.479-.06.682-.218l-.123-.158Zm12.871-7.34-12.859 7.332.1.174 12.858-7.333-.099-.173Zm-3.002-2.828 2.98 2.985.142-.141-2.98-2.986-.142.142ZM10.085 31.672l10.498-10.515-.141-.142L9.944 31.531l.141.141ZM28.551 19.55c.426.241.634.525.635.761h.2c0-.35-.294-.684-.736-.935l-.099.174Zm-4.234-2.4 4.234 2.4.099-.174-4.234-2.4-.1.173Zm-3.1 3.231 3.22-3.248-.142-.141-3.22 3.248.142.141Zm3.233 3.122-3.233-3.263-.142.141 3.233 3.263.142-.141Zm4.099-2.421-4.22 2.405.1.173 4.219-2.405-.099-.173Zm.637-.77c0 .237-.208.524-.637.77l.1.173c.445-.255.738-.594.737-.944h-.2Zm-20.1 10.166c-.013.184.007.357.055.518l.192-.057a1.261 1.261 0 0 1-.048-.448l-.2-.013Zm-.002-20.371.001 20.378h.2V10.107h-.2Zm.057-.472a1.397 1.397 0 0 0-.057.477l.2-.01a1.197 1.197 0 0 1 .049-.41l-.192-.057ZM19.947 20.24 9.307 9.593l-.14.141 10.638 10.647.142-.141ZM9.307 31.038l10.64-10.657-.142-.141L9.166 30.897l.142.141Zm33.474-5.847v-1.72h-.2v1.72h.2Zm4.008-.1h-4.108v.2h4.108v-.2Zm-.885 2.368c.496-.496.887-1.282.984-2.258l-.198-.02c-.094.935-.467 1.677-.927 2.137l.141.141Zm-3.223 1.272c1.656 0 2.636-.684 3.223-1.272l-.141-.141c-.56.559-1.49 1.213-3.082 1.213v.2Zm-4.591-4.687c0 2.633 1.953 4.687 4.59 4.687v-.2c-2.521 0-4.39-1.96-4.39-4.486h-.2Zm4.59-4.686c-2.54 0-4.59 2.053-4.59 4.686h.2c0-2.525 1.963-4.486 4.39-4.486v-.2Zm3.22 1.267c-.778-.68-1.851-1.267-3.22-1.267v.2c1.308 0 2.336.56 3.088 1.218l.131-.15Zm1.105-1.237-1.242 1.242.141.141 1.242-1.242-.141-.141Zm-4.229-1.55c1.88 0 3.195.75 4.232 1.694l.135-.148c-1.064-.967-2.425-1.746-4.367-1.746v.2Zm-6.301 6.206c0-3.382 2.915-6.206 6.301-6.206v-.2c-3.493 0-6.501 2.91-6.501 6.406h.2Zm6.301 6.206c-3.386 0-6.301-2.823-6.301-6.206h-.2c0 3.497 3.008 6.406 6.501 6.406v-.2Zm4.322-1.783c-1.126 1.22-2.436 1.783-4.322 1.783v.2c1.936 0 3.301-.583 4.469-1.847l-.147-.136Zm1.502-3.945c0 1.226-.378 2.82-1.5 3.942l.142.142c1.171-1.172 1.558-2.825 1.558-4.084h-.2Zm-.09-1.02c.089.269.09.632.09 1.02h.2c0-.376.001-.777-.1-1.082l-.19.063Zm-5.83.07h5.924v-.2h-5.923v.2Zm6.597 2.766c0-2.332 1.77-4.009 4.009-4.009v-.2c-2.347 0-4.209 1.763-4.209 4.209h.2Zm4.009 4.008a3.978 3.978 0 0 1-4.009-4.008h-.2a4.178 4.178 0 0 0 4.209 4.208v-.2Zm4.008-4.008c0 2.332-1.769 4.008-4.008 4.008v.2c2.347 0 4.208-1.763 4.208-4.208h-.2Zm-4.008-4.009c2.24 0 4.008 1.583 4.008 4.009h.2c0-2.543-1.863-4.209-4.208-4.209v.2Zm8.885-.2c-2.347 0-4.208 1.763-4.208 4.209h.2c0-2.332 1.769-4.009 4.008-4.009v-.2Zm4.209 4.209c0-2.543-1.864-4.209-4.209-4.209v.2c2.241 0 4.009 1.583 4.009 4.009h.2Zm-4.209 4.208c2.347 0 4.209-1.763 4.209-4.208h-.2c0 2.332-1.77 4.008-4.009 4.008v.2Zm-4.208-4.208a4.178 4.178 0 0 0 4.208 4.208v-.2a3.978 3.978 0 0 1-4.008-4.008h-.2Zm4.21 2.288c-1.182 0-2.194-1-2.194-2.384h-.2c0 1.483 1.09 2.584 2.393 2.584v-.2Zm2.192-2.384c0 1.383-1.011 2.384-2.193 2.384v.2c1.303 0 2.393-1.1 2.393-2.584h-.2Zm-2.193-2.384c1.185 0 2.193.908 2.193 2.384h.2c0-1.581-1.093-2.584-2.393-2.584v.2Zm-2.193 2.384c0-1.383 1.012-2.384 2.193-2.384v-.2c-1.302 0-2.393 1.1-2.393 2.584h.2Zm-6.694 2.384c-1.182 0-2.193-1-2.193-2.384h-.2c0 1.483 1.09 2.584 2.393 2.584v-.2Zm2.193-2.384c0 1.383-1.011 2.384-2.193 2.384v.2c1.303 0 2.393-1.1 2.393-2.584h-.2Zm-2.193-2.384c1.184 0 2.193.908 2.193 2.384h.2c0-1.581-1.093-2.584-2.393-2.584v.2Zm-2.193 2.384c0-1.383 1.011-2.384 2.193-2.384v-.2c-1.302 0-2.393 1.1-2.393 2.584h.2Zm35.058-1.47c-.386-.965-1.366-2.643-3.532-2.643v.2c2.037 0 2.968 1.572 3.347 2.517l.185-.074Zm.191.478-.19-.478-.186.074.19.478.186-.074Zm-5.5 2.422 5.446-2.293-.077-.184-5.446 2.293.077.184Zm1.968 1.05c-.464 0-.826-.093-1.13-.283-.303-.191-.555-.487-.789-.908l-.175.097c.244.44.517.765.858.98.343.215.744.314 1.236.314v-.2Zm1.925-1.105c-.235.329-.488.604-.796.798-.306.192-.67.307-1.129.307v.2c.496 0 .897-.125 1.236-.338.337-.213.609-.51.852-.85l-.163-.117Zm1.477.932-1.337-.955-.117.163 1.338.955.116-.163Zm-3.402 1.997c1.86 0 3.036-1.174 3.43-1.866l-.173-.099c-.369.646-1.486 1.765-3.257 1.765v.2Zm-4.113-4.208c0 2.345 1.762 4.208 4.113 4.208v-.2c-2.235 0-3.913-1.767-3.913-4.008h-.2Zm3.922-4.209c-2.16 0-3.922 1.672-3.922 4.209h.2c0-2.432 1.678-4.009 3.722-4.009v-.2Zm0 1.529c-.913 0-2.203.902-2.203 2.489h.2c0-1.471 1.195-2.29 2.002-2.29v-.2Zm1.62.923c-.106-.267-.34-.497-.628-.66a2.052 2.052 0 0 0-.993-.263v.2c.316 0 .634.09.895.238s.457.348.541.559l.186-.074Zm-3.684 1.658 3.63-1.53-.077-.183-3.63 1.528.077.185Zm-4.529 3.925h1.815v-.2h-1.815v.2Zm-.1-12.043v11.943h.2V18.121h-.2Zm1.915-.1h-1.815v.2h1.815v-.2Zm.1 12.043V18.121h-.2v11.943h.2Zm-6.978-7.83c.92 0 1.661.46 2.127.926l.14-.142c-.49-.49-1.278-.984-2.267-.984v.2Zm-3.818 4.008c0-2.24 1.868-4.008 3.818-4.008v-.2c-2.064 0-4.018 1.861-4.018 4.208h.2Zm3.818 3.913c-2.047 0-3.818-1.675-3.818-3.913h-.2c0 2.348 1.86 4.113 4.018 4.113v-.2Zm2.024-.918c-.365.456-1.102.918-2.024.918v.2c.988 0 1.78-.493 2.18-.993l-.156-.125Zm.173-.037h-.095v.2h.095v-.2Zm.1.673V29.3h-.2v.573h.2Zm-2.297 2.489c.69 0 1.268-.223 1.673-.653.404-.43.624-1.053.624-1.836h-.2c0 .746-.21 1.316-.57 1.699-.36.382-.88.59-1.527.59v.2Zm-2.103-1.506c.202.707 1.003 1.505 2.103 1.505v-.2c-1.003 0-1.73-.73-1.91-1.36l-.193.055Zm-1.393.733 1.53-.67-.08-.182-1.53.669.08.183Zm3.591 2.197c-1.954 0-3.072-1.301-3.54-2.33l-.182.083c.488 1.072 1.663 2.447 3.722 2.447v-.2Zm3.722-4.104c0 1.461-.424 2.484-1.093 3.141-.67.658-1.597.963-2.629.963v.2c1.07 0 2.053-.317 2.77-1.02.716-.704 1.152-1.784 1.152-3.284h-.2Zm0-7.262v7.262h.2V22.42h-.2Zm-1.62.1h1.72v-.2h-1.72v.2Zm.1.57v-.67h-.2v.67h.2Zm-2.202 5.536c-1.182 0-2.194-1-2.194-2.384h-.2c0 1.483 1.091 2.584 2.394 2.584v-.2Zm2.097-2.384c0 1.39-.921 2.384-2.097 2.384v.2c1.307 0 2.297-1.107 2.297-2.584h-.2Zm-2.097-2.384c1.176 0 2.097.995 2.097 2.384h.2c0-1.477-.99-2.584-2.297-2.584v.2Zm-2.194 2.384c0-1.383 1.012-2.384 2.194-2.384v-.2c-1.303 0-2.394 1.1-2.394 2.584h.2Zm21.207-8.021h4.3v-.2h-4.3v.2Zm.1 11.843V18.121h-.2v11.943h.2Zm1.715-.1H90.07v.2h1.815v-.2Zm-.1-4.39v4.49h.2v-4.49h-.2Zm2.584-.1h-2.484v.2h2.484v-.2Zm3.818-3.627c0 2.227-1.855 3.626-3.818 3.626v.2c2.05 0 4.018-1.467 4.018-3.826h-.2Zm-3.818-3.626c1.963 0 3.818 1.4 3.818 3.626h.2c0-2.36-1.968-3.826-4.018-3.826v.2Zm.097 5.532h-2.58v.2h2.58v-.2Zm2.002-2.01c-.092 1.016-.828 2.01-2.002 2.01v.2c1.31 0 2.103-1.108 2.202-2.193l-.2-.018Zm-2.002-1.898c1.274 0 2.002 1.092 2.002 1.906h.2c0-.906-.8-2.106-2.202-2.106v.2Zm-2.58 0h2.58v-.2h-2.58v.2Zm.1 4.008v-4.108h-.2v4.108h.2Zm10.408.132c.457-1.188 1.744-1.751 3.06-1.751v-.2c-1.359 0-2.748.583-3.246 1.88l.186.07Zm1.569.54-1.624-.669-.076.185 1.624.67.076-.186Zm1.586-.867c-.343 0-.67.049-.962.189a1.7 1.7 0 0 0-.749.721l.174.1c.182-.319.406-.519.661-.64.257-.124.551-.17.876-.17v-.2Zm2.011 1.619c-.102-1.022-1.02-1.62-2.011-1.62v.2c.921 0 1.723.55 1.812 1.44l.199-.02Zm0 .105v-.095h-.2v.095h.2Zm-1.915-.378c.37 0 .743.07 1.058.163.317.094.57.21.702.298l.111-.166a3.02 3.02 0 0 0-.756-.323 4.005 4.005 0 0 0-1.115-.172v.2Zm-3.34 2.576c0-.822.41-1.463 1.033-1.901.625-.44 1.464-.675 2.307-.675v-.2c-.877 0-1.758.244-2.422.711-.667.47-1.118 1.167-1.118 2.065h.2Zm2.862 2.575c-1.489 0-2.862-1.021-2.862-2.575h-.2c0 1.694 1.494 2.775 3.062 2.775v-.2Zm2.216-1.11c-.237.284-.491.56-.834.766-.342.205-.777.344-1.382.344v.2c.638 0 1.11-.148 1.485-.373.373-.224.645-.521.885-.81l-.154-.128Zm.173-.037h-.096v.2h.096v-.2Zm.1 1.056v-.956h-.2v.956h.2Zm1.62-.1h-1.72v.2h1.72v-.2Zm-.1-4.486v4.586h.2v-4.586h-.2Zm-3.722-3.244c1.962 0 3.536 1.21 3.722 3.253l.199-.018c-.196-2.16-1.87-3.435-3.921-3.435v.2Zm-.191 6.392a1.83 1.83 0 0 1-.881-.225c-.265-.155-.452-.389-.452-.726h-.2c0 .428.243.72.551.899.305.178.682.252.982.252v-.2Zm2.004-1.827c-.184 1.101-1.1 1.827-2.004 1.827v.2c1.007 0 2.002-.802 2.201-1.994l-.197-.033Zm-.082.051.143.058.074-.186a10.244 10.244 0 0 1-.141-.057l-.076.185Zm-1.444-.317c.667 0 1.031.149 1.444.317l.076-.185c-.42-.171-.813-.332-1.52-.332v.2Zm-1.811 1.142c0-.431.233-.712.579-.89.35-.181.81-.252 1.232-.252v-.2c-.438 0-.934.073-1.324.274-.395.204-.687.544-.687 1.068h.2Zm9.451-.059 2.007-5.16-.187-.072-2.006 5.16.186.072Zm-.189.064h.096v-.2h-.096v.2Zm-2.194-5.222 2.102 5.16.185-.076-2.102-5.16-.185.076Zm-1.819.062h1.911v-.2h-1.911v.2Zm3.245 7.122-3.153-7.262-.183.08 3.153 7.261.183-.08Zm-1.816 4.094 1.816-4.013-.183-.083-1.815 4.013.182.083Zm1.724-.141h-1.815v.2h1.815v-.2Zm4.782-11.214-4.873 11.274.183.08 4.873-11.275-.183-.08Zm-1.82.14h1.911v-.2h-1.911v.2Zm-16.05 7.643h1.815v-.2h-1.816v.2Zm-.1-12.043v11.943h.2V18.121h-.2Zm1.915-.1h-1.816v.2h1.816v-.2Zm.1 12.043V18.121h-.2v11.943h.2Z" /></symbol>',126,40),fu=Ni("Icon40AppStoreButtonRu","app_store_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 126 40" id="app_store_button_ru_40"><path fill="currentColor" fill-rule="evenodd" d="M22.35 6.364a5.162 5.162 0 0 1-1.179 3.694 4.332 4.332 0 0 1-3.421 1.62 4.91 4.91 0 0 1 1.209-3.558 5.238 5.238 0 0 1 3.39-1.756Zm4.2 7.862a5.239 5.239 0 0 0-2.491 4.394h.001a5.06 5.06 0 0 0 3.085 4.655 11.597 11.597 0 0 1-1.604 3.273c-.946 1.416-1.937 2.8-3.51 2.825-.748.017-1.253-.199-1.779-.423-.549-.234-1.121-.478-2.016-.478-.95 0-1.547.252-2.124.494-.497.21-.98.413-1.659.441-1.499.056-2.643-1.51-3.623-2.913-1.957-2.865-3.482-8.072-1.438-11.615a5.616 5.616 0 0 1 4.727-2.887c.85-.018 1.664.31 2.38.597.546.22 1.034.416 1.433.416.352 0 .826-.188 1.379-.408.87-.346 1.936-.769 3.021-.655a5.353 5.353 0 0 1 4.218 2.284Zm49.41 12.432c0 .472.08.876.242 1.21.16.334.385.61.674.83.288.207.616.363.985.466.38.092.79.138 1.227.138.472 0 .876-.051 1.21-.155.334-.115.605-.26.812-.432.208-.173.357-.369.45-.588.092-.23.138-.46.138-.691 0-.473-.11-.818-.329-1.037a1.723 1.723 0 0 0-.69-.484c-.439-.161-.952-.311-1.54-.45a240.156 240.156 0 0 1-2.142-.57c-.53-.138-.974-.317-1.331-.536a3.333 3.333 0 0 1-.83-.76 2.78 2.78 0 0 1-.45-.882 3.775 3.775 0 0 1-.12-.95c0-.623.126-1.158.38-1.608.265-.46.61-.84 1.037-1.14.426-.3.91-.519 1.452-.657a6.131 6.131 0 0 1 1.642-.225c.645 0 1.25.086 1.815.26.576.16 1.077.408 1.503.743.438.334.784.749 1.037 1.244.254.484.38 1.048.38 1.694h-2.16c-.058-.795-.328-1.354-.812-1.677-.484-.334-1.1-.501-1.85-.501a3.65 3.65 0 0 0-.777.086 2.182 2.182 0 0 0-.726.26 1.589 1.589 0 0 0-.553.484c-.139.207-.208.466-.208.777 0 .438.133.784.398 1.037.276.242.633.427 1.071.553.046.012.225.064.536.156a81.757 81.757 0 0 1 1.072.277c.391.103.772.207 1.14.31.38.093.651.162.813.208.403.127.755.3 1.054.519.3.219.547.472.743.76.208.277.358.576.45.899.103.323.155.645.155.968 0 .691-.144 1.285-.432 1.78a3.537 3.537 0 0 1-1.106 1.193c-.46.31-.985.535-1.573.674a7.249 7.249 0 0 1-1.797.224 7.395 7.395 0 0 1-1.988-.259 4.652 4.652 0 0 1-1.625-.795 3.91 3.91 0 0 1-1.106-1.365c-.276-.565-.42-1.228-.432-1.988h2.16ZM39.68 18.431h2.299l4.753 12.34h-2.316l-1.158-3.266h-4.926l-1.158 3.267h-2.23l4.736-12.341Zm-.76 7.432h3.768l-1.85-5.306h-.052l-1.866 5.306Zm8.935-4.027h1.867v1.21h.035c.276-.519.662-.887 1.158-1.106a3.765 3.765 0 0 1 1.607-.346c.703 0 1.314.127 1.832.38.53.242.968.582 1.314 1.02.345.426.605.927.777 1.503.173.577.26 1.193.26 1.85 0 .6-.08 1.181-.242 1.746a4.416 4.416 0 0 1-.709 1.503 3.584 3.584 0 0 1-1.192 1.037c-.484.254-1.055.38-1.712.38a4.397 4.397 0 0 1-.864-.086 3.435 3.435 0 0 1-.83-.242 3.687 3.687 0 0 1-.743-.432 2.668 2.668 0 0 1-.553-.64h-.034v4.46h-1.97V21.836Zm6.88 4.476a4.447 4.447 0 0 0-.156-1.175 3.088 3.088 0 0 0-.467-1.002 2.288 2.288 0 0 0-.778-.71 2.062 2.062 0 0 0-1.071-.276c-.83 0-1.458.288-1.884.865-.415.576-.622 1.342-.622 2.298 0 .45.051.87.155 1.262.115.38.282.709.501.985.22.277.479.496.778.657.311.161.668.242 1.072.242.45 0 .83-.092 1.14-.276.312-.185.565-.421.761-.71.207-.299.351-.633.432-1.002a4.898 4.898 0 0 0 .138-1.158Zm5.726-4.476h-1.867v12.237h1.97v-4.46h.035a2.666 2.666 0 0 0 .553.64 3.684 3.684 0 0 0 .744.432c.265.115.541.196.83.242.287.058.575.087.863.087.657 0 1.228-.127 1.711-.38.484-.266.882-.611 1.193-1.038.323-.438.559-.939.709-1.503a6.324 6.324 0 0 0 .242-1.746c0-.657-.087-1.273-.26-1.85a4.338 4.338 0 0 0-.777-1.503 3.493 3.493 0 0 0-1.314-1.02c-.518-.253-1.13-.38-1.832-.38-.576 0-1.112.115-1.607.346-.496.219-.882.587-1.158 1.106h-.035v-1.21Zm4.857 3.301a4.447 4.447 0 0 1 .155 1.175c0 .392-.046.778-.138 1.158a2.79 2.79 0 0 1-.432 1.003c-.196.288-.45.524-.76.709-.312.184-.692.276-1.141.276-.404 0-.76-.08-1.072-.242a2.49 2.49 0 0 1-.778-.657 2.944 2.944 0 0 1-.5-.985 4.917 4.917 0 0 1-.156-1.262c0-.956.207-1.722.622-2.298.426-.576 1.054-.865 1.884-.865.403 0 .76.093 1.071.277.311.173.57.409.778.709.207.288.363.622.467 1.002Zm20.915-3.301h-1.487v1.469h1.487v5.271c.011.37.046.698.103.986.07.288.19.53.363.726.185.184.432.328.744.432.322.092.743.138 1.261.138.22 0 .432-.012.64-.035l.64-.069v-1.52a2.59 2.59 0 0 1-.416.068h-.414c-.22 0-.392-.023-.519-.069a.681.681 0 0 1-.294-.242 1.135 1.135 0 0 1-.12-.38 7.13 7.13 0 0 1-.018-.536v-4.77h1.78v-1.47h-1.78v-2.678h-1.97v2.679Zm9.437 9.178c-.715 0-1.354-.116-1.919-.346a4.287 4.287 0 0 1-1.417-.985 4.35 4.35 0 0 1-.881-1.487 5.875 5.875 0 0 1-.294-1.9c0-.68.098-1.309.294-1.885a4.35 4.35 0 0 1 .881-1.486 4.082 4.082 0 0 1 1.417-.968c.565-.242 1.204-.363 1.919-.363.714 0 1.348.12 1.901.363a3.88 3.88 0 0 1 1.417.968c.392.415.686.91.882 1.486.207.576.311 1.204.311 1.884 0 .691-.104 1.325-.311 1.901a4.064 4.064 0 0 1-2.299 2.472c-.553.23-1.187.346-1.901.346Zm0-1.556c.438 0 .818-.092 1.14-.276.323-.185.588-.427.796-.726.207-.3.357-.634.449-1.003a4.383 4.383 0 0 0 .156-1.158c0-.38-.052-.76-.156-1.14a2.84 2.84 0 0 0-.45-1.003 2.405 2.405 0 0 0-.794-.726c-.323-.184-.703-.277-1.141-.277-.438 0-.818.093-1.14.277a2.404 2.404 0 0 0-.796.726 3.089 3.089 0 0 0-.467 1.002 4.826 4.826 0 0 0-.138 1.141c0 .392.046.778.138 1.158.104.369.26.703.467 1.003.207.3.472.541.795.726.323.184.703.276 1.14.276Zm8.171-7.622h-1.849v8.936h1.97V26.52c0-.496.064-.934.19-1.314.127-.38.3-.697.519-.95.219-.265.472-.461.76-.588.3-.138.617-.207.951-.207.138 0 .276.011.415.034.15.012.294.029.432.052v-1.901l-.277-.035a4.008 4.008 0 0 0-.466-.017c-.3 0-.594.058-.882.173a3.067 3.067 0 0 0-.795.466 3.45 3.45 0 0 0-.605.623c-.161.23-.271.466-.328.708h-.035v-1.728Zm10.232 3.681a3.009 3.009 0 0 0-.207-.898 2.111 2.111 0 0 0-.45-.744 1.953 1.953 0 0 0-.691-.518 1.915 1.915 0 0 0-.899-.208 2.34 2.34 0 0 0-.951.19 2.103 2.103 0 0 0-.725.502 2.573 2.573 0 0 0-.484.743c-.116.288-.179.6-.191.933h4.598Zm-4.598 1.297c0 .345.047.68.139 1.002.103.323.253.605.449.847s.444.438.743.588c.3.138.657.207 1.072.207.576 0 1.037-.121 1.383-.363.357-.253.622-.628.795-1.123h1.866a3.711 3.711 0 0 1-.535 1.296c-.254.38-.559.703-.916.968a3.914 3.914 0 0 1-1.21.57 4.566 4.566 0 0 1-1.383.208c-.703 0-1.325-.116-1.867-.346a3.945 3.945 0 0 1-1.382-.968 4.28 4.28 0 0 1-.847-1.486 6.193 6.193 0 0 1-.277-1.902c0-.633.098-1.233.294-1.797a4.7 4.7 0 0 1 .864-1.504c.38-.438.836-.783 1.366-1.037.53-.253 1.129-.38 1.797-.38.703 0 1.331.15 1.884.45a4.04 4.04 0 0 1 1.4 1.157c.369.484.634 1.043.795 1.677a4.94 4.94 0 0 1 .138 1.936h-6.568ZM37.224 14.218c.363.1.76.151 1.19.151.504 0 .93-.074 1.28-.222.356-.154.645-.346.867-.574.229-.229.393-.474.494-.736.101-.263.151-.505.151-.726 0-.195-.03-.387-.09-.575a1.644 1.644 0 0 0-.273-.514 1.611 1.611 0 0 0-.453-.393 1.835 1.835 0 0 0-.625-.242v-.03c.148-.048.292-.118.433-.212a1.75 1.75 0 0 0 .383-.353 1.629 1.629 0 0 0 .273-.454c.067-.168.1-.35.1-.544 0-.336-.063-.626-.191-.867-.128-.25-.303-.454-.524-.616s-.484-.279-.787-.352a3.632 3.632 0 0 0-.958-.121c-.383 0-.74.047-1.068.14a2.505 2.505 0 0 0-.847.424 2.011 2.011 0 0 0-.585.706 2.398 2.398 0 0 0-.232.998h.918c.053-.524.231-.9.534-1.13.302-.234.719-.352 1.25-.352.202 0 .393.02.575.06.188.04.353.108.494.202a.91.91 0 0 1 .343.353c.087.148.13.333.13.555 0 .242-.04.447-.12.615a.972.972 0 0 1-.323.393c-.134.1-.3.175-.494.222-.188.04-.397.06-.625.06h-.323c-.134 0-.242-.007-.322-.02v.786c.074-.006.174-.01.302-.01a6.614 6.614 0 0 1 .343-.01c.242 0 .47.017.685.05.222.034.414.098.575.192.168.088.303.215.403.383.101.162.152.373.152.635a1.406 1.406 0 0 1-.514 1.099c-.155.128-.34.229-.555.303a2.32 2.32 0 0 1-.696.1c-.289 0-.561-.03-.816-.09a1.982 1.982 0 0 1-.676-.292 1.666 1.666 0 0 1-.464-.545 1.925 1.925 0 0 1-.181-.827h-.918c0 .437.074.814.222 1.13.148.315.353.578.615.786.269.208.585.363.948.464Zm5.962.02c.208.054.43.08.665.08.363 0 .699-.06 1.008-.18.316-.128.592-.333.827-.616 0 .283.064.488.191.615.135.121.313.182.535.182.262 0 .467-.044.615-.131v-.666c-.114.034-.202.05-.262.05-.135 0-.215-.046-.242-.14a2.338 2.338 0 0 1-.03-.444v-2.682c0-.302-.058-.548-.172-.736a1.17 1.17 0 0 0-.454-.434 1.773 1.773 0 0 0-.635-.211 4.776 4.776 0 0 0-.695-.05c-.296 0-.575.03-.837.09-.256.06-.484.161-.686.302a1.484 1.484 0 0 0-.484.535 1.852 1.852 0 0 0-.201.817h.857c.02-.384.15-.642.393-.777.242-.141.544-.212.907-.212.135 0 .269.01.403.03.142.02.266.061.373.122a.68.68 0 0 1 .273.262c.074.114.11.265.11.454 0 .16-.046.285-.14.373-.095.08-.222.144-.384.191-.161.04-.35.074-.564.1a6.711 6.711 0 0 0-.666.102 7.154 7.154 0 0 0-.655.151c-.208.06-.397.151-.565.272a1.294 1.294 0 0 0-.393.454c-.1.188-.151.43-.151.726 0 .262.044.487.13.675.095.182.22.333.374.454.161.114.346.195.555.242Zm1.582-.776c-.201.074-.443.11-.726.11a1.761 1.761 0 0 1-.383-.04.985.985 0 0 1-.322-.13.814.814 0 0 1-.222-.233.762.762 0 0 1-.08-.363c0-.215.046-.383.14-.504a.975.975 0 0 1 .384-.292c.154-.067.329-.114.524-.141l.575-.081c.194-.027.38-.057.554-.09a.942.942 0 0 0 .423-.182v.877c0 .12-.03.252-.09.393-.06.135-.155.262-.283.383a1.658 1.658 0 0 1-.494.293Zm3.177-4.467h3.57v.756h-2.713v4.457h-.857V8.995Zm5.241 0h-.856v7.199h.857v-2.682h.02c.094.155.208.286.342.393.142.101.29.182.444.242a2.4 2.4 0 0 0 .464.131c.154.027.299.04.433.04.397 0 .743-.07 1.039-.211.302-.141.551-.333.746-.575a2.42 2.42 0 0 0 .443-.857c.101-.33.152-.682.152-1.058 0-.37-.05-.72-.152-1.049a2.54 2.54 0 0 0-.453-.867 2.063 2.063 0 0 0-.746-.605c-.296-.148-.645-.222-1.049-.222a2.43 2.43 0 0 0-.998.202 1.261 1.261 0 0 0-.665.625h-.02v-.706Zm2.35 4.406a1.472 1.472 0 0 1-.736.172c-.296 0-.548-.054-.756-.162a1.568 1.568 0 0 1-.515-.443 1.894 1.894 0 0 1-.282-.626 3.063 3.063 0 0 1-.09-.746c0-.242.026-.48.08-.715.06-.236.155-.444.282-.626a1.455 1.455 0 0 1 .494-.453c.202-.114.447-.172.736-.172.276 0 .514.054.716.162.208.107.376.252.504.433.135.182.232.39.293.625a2.488 2.488 0 0 1 .1.706c0 .256-.027.504-.08.746a1.974 1.974 0 0 1-.262.646c-.121.188-.283.339-.484.453Zm3.375 2.884a2.278 2.278 0 0 1-.303-.02 1.426 1.426 0 0 1-.292-.071v-.786l.242.08a.887.887 0 0 0 .262.04c.175 0 .316-.04.424-.12.107-.081.201-.199.282-.353l.353-.877-2.067-5.183h.968l1.522 4.265h.02l1.462-4.265h.908l-2.269 5.898c-.1.256-.201.47-.302.646a1.529 1.529 0 0 1-.323.423.962.962 0 0 1-.393.242c-.141.054-.306.08-.494.08Zm4.9-2.43c.39.31.93.464 1.623.464.276 0 .541-.034.797-.101.262-.067.494-.168.695-.303a1.541 1.541 0 0 0 .484-.514 1.44 1.44 0 0 0 .182-.736c0-.202-.03-.376-.091-.524a1.189 1.189 0 0 0-.232-.383 1.051 1.051 0 0 0-.323-.252c-.12-.06-.241-.101-.362-.121v-.02c.215-.048.406-.165.574-.353.175-.189.262-.434.262-.736 0-.242-.053-.45-.161-.625-.1-.175-.242-.32-.423-.434a1.755 1.755 0 0 0-.615-.262 3.386 3.386 0 0 0-.757-.08c-.262 0-.52.026-.776.08a2.065 2.065 0 0 0-.686.272c-.201.121-.37.29-.504.504-.134.209-.211.474-.232.797h.868a.994.994 0 0 1 .15-.444.966.966 0 0 1 .303-.292c.121-.074.256-.128.404-.162a2.178 2.178 0 0 1 .463-.05c.363 0 .636.074.817.222.188.148.282.32.282.514 0 .31-.107.528-.322.655-.215.121-.474.182-.777.182H64.9v.695h.695c.404 0 .69.074.857.222.169.148.253.353.253.615 0 .27-.111.491-.333.666-.222.174-.538.262-.948.262-.383 0-.702-.084-.958-.252-.255-.168-.396-.444-.423-.827h-.867c.033.571.245 1.012.635 1.32Zm4.909-4.86h.857v4.255l2.46-4.255h1.099v5.213h-.857V9.953l-2.46 4.255h-1.1V8.995Zm5.206.756h1.865v4.457h.857V9.75h1.866v-.756h-4.588v.756Zm7.59 4.568c-.416 0-.782-.068-1.098-.202a2.125 2.125 0 0 1-.776-.565 2.46 2.46 0 0 1-.474-.867 3.81 3.81 0 0 1-.151-1.099c0-.39.06-.75.181-1.078.12-.337.289-.626.504-.868a2.38 2.38 0 0 1 .776-.564c.303-.135.632-.202.989-.202.463 0 .846.098 1.149.293.309.188.554.43.736.726a2.755 2.755 0 0 1 .383.967c.074.35.104.683.09.999h-3.901c-.007.228.02.447.08.655.061.202.159.383.293.544.134.155.306.28.514.373.209.094.454.142.736.142.363 0 .659-.084.887-.253.236-.168.39-.423.464-.766h.847c-.114.592-.366 1.035-.756 1.331-.39.29-.88.434-1.472.434Zm1.402-3.217a1.68 1.68 0 0 0-.14-.574 1.318 1.318 0 0 0-.313-.464A1.314 1.314 0 0 0 82 9.75a1.378 1.378 0 0 0-.585-.12c-.222 0-.423.04-.605.12a1.338 1.338 0 0 0-.454.313 1.506 1.506 0 0 0-.302.474 1.735 1.735 0 0 0-.131.564h2.994Zm7.213-2.107h-2.41v5.213h2.834c.228 0 .44-.037.635-.111.195-.08.363-.188.504-.323s.249-.296.323-.484c.08-.188.12-.393.12-.615 0-.35-.09-.635-.271-.857a1.169 1.169 0 0 0-.716-.423v-.01c.242-.115.43-.26.564-.434.135-.175.202-.403.202-.685 0-.263-.05-.478-.151-.646a1.005 1.005 0 0 0-.404-.383 1.705 1.705 0 0 0-.574-.191 4.113 4.113 0 0 0-.656-.05Zm.898 4.245c-.141.161-.353.242-.635.242h-1.825v-1.644h1.673c.363 0 .622.071.777.212.154.141.232.33.232.565a.913.913 0 0 1-.222.625Zm-.222-2.309c-.141.135-.397.202-.766.202h-1.472V9.72h1.472c.376 0 .635.06.776.182.141.114.212.279.212.494 0 .221-.074.4-.222.534Z" clip-rule="evenodd" /></symbol>',126,40),mu=Ni("Icon40AppStoreButtonEn","app_store_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 126 40" id="app_store_button_en_40"><path fill="currentColor" fill-rule="evenodd" d="M22.35 6.364a5.162 5.162 0 0 1-1.179 3.694 4.332 4.332 0 0 1-3.421 1.62 4.91 4.91 0 0 1 1.209-3.558 5.238 5.238 0 0 1 3.39-1.756Zm4.2 7.862a5.239 5.239 0 0 0-2.491 4.394h.001a5.06 5.06 0 0 0 3.085 4.655 11.597 11.597 0 0 1-1.604 3.273c-.946 1.416-1.937 2.8-3.51 2.825-.748.017-1.253-.199-1.779-.423-.549-.234-1.121-.478-2.016-.478-.95 0-1.547.252-2.124.494-.497.21-.98.413-1.659.441-1.499.056-2.643-1.51-3.623-2.913-1.957-2.865-3.482-8.072-1.438-11.615a5.616 5.616 0 0 1 4.727-2.887c.85-.018 1.664.31 2.38.597.546.22 1.034.416 1.433.416.352 0 .826-.188 1.379-.408.87-.346 1.936-.769 3.021-.655a5.353 5.353 0 0 1 4.218 2.284Zm49.41 12.432c0 .472.08.876.242 1.21.16.334.385.61.674.83.288.207.616.363.985.466.38.092.79.138 1.227.138.472 0 .876-.051 1.21-.155.334-.115.605-.26.812-.432.208-.173.357-.369.45-.588.092-.23.138-.46.138-.691 0-.473-.11-.818-.329-1.037a1.723 1.723 0 0 0-.69-.484c-.439-.161-.952-.311-1.54-.45a240.156 240.156 0 0 1-2.142-.57c-.53-.138-.974-.317-1.331-.536a3.333 3.333 0 0 1-.83-.76 2.78 2.78 0 0 1-.45-.882 3.775 3.775 0 0 1-.12-.95c0-.623.126-1.158.38-1.608.265-.46.61-.84 1.037-1.14.426-.3.91-.519 1.452-.657a6.131 6.131 0 0 1 1.642-.225c.645 0 1.25.086 1.815.26.576.16 1.077.408 1.503.743.438.334.784.749 1.037 1.244.254.484.38 1.048.38 1.694h-2.16c-.058-.795-.328-1.354-.812-1.677-.484-.334-1.1-.501-1.85-.501a3.65 3.65 0 0 0-.777.086 2.182 2.182 0 0 0-.726.26 1.589 1.589 0 0 0-.553.484c-.139.207-.208.466-.208.777 0 .438.133.784.398 1.037.276.242.633.427 1.071.553.046.012.225.064.536.156a81.757 81.757 0 0 1 1.072.277c.391.103.772.207 1.14.31.38.093.651.162.813.208.403.127.755.3 1.054.519.3.219.547.472.743.76.208.277.358.576.45.899.103.323.155.645.155.968 0 .691-.144 1.285-.432 1.78a3.537 3.537 0 0 1-1.106 1.193c-.46.31-.985.535-1.573.674a7.249 7.249 0 0 1-1.797.224 7.395 7.395 0 0 1-1.988-.259 4.652 4.652 0 0 1-1.625-.795 3.91 3.91 0 0 1-1.106-1.365c-.276-.565-.42-1.228-.432-1.988h2.16ZM39.68 18.431h2.299l4.753 12.34h-2.316l-1.158-3.266h-4.926l-1.158 3.267h-2.23l4.736-12.341Zm-.76 7.432h3.768l-1.85-5.306h-.052l-1.866 5.306Zm8.935-4.027h1.867v1.21h.035c.276-.519.662-.887 1.158-1.106a3.765 3.765 0 0 1 1.607-.346c.703 0 1.314.127 1.832.38.53.242.968.582 1.314 1.02.345.426.605.927.777 1.503.173.577.26 1.193.26 1.85 0 .6-.08 1.181-.242 1.746a4.416 4.416 0 0 1-.709 1.503 3.584 3.584 0 0 1-1.192 1.037c-.484.254-1.055.38-1.712.38a4.397 4.397 0 0 1-.864-.086 3.435 3.435 0 0 1-.83-.242 3.687 3.687 0 0 1-.743-.432 2.668 2.668 0 0 1-.553-.64h-.034v4.46h-1.97V21.836Zm6.88 4.476a4.447 4.447 0 0 0-.156-1.175 3.088 3.088 0 0 0-.467-1.002 2.288 2.288 0 0 0-.778-.71 2.062 2.062 0 0 0-1.071-.276c-.83 0-1.458.288-1.884.865-.415.576-.622 1.342-.622 2.298 0 .45.051.87.155 1.262.115.38.282.709.501.985.22.277.479.496.778.657.311.161.668.242 1.072.242.45 0 .83-.092 1.14-.276.312-.185.565-.421.761-.71.207-.299.351-.633.432-1.002a4.898 4.898 0 0 0 .138-1.158Zm5.726-4.476h-1.867v12.237h1.97v-4.46h.035a2.666 2.666 0 0 0 .553.64 3.684 3.684 0 0 0 .744.432c.265.115.541.196.83.242.287.058.575.087.863.087.657 0 1.228-.127 1.711-.38.484-.266.882-.611 1.193-1.038.323-.438.559-.939.709-1.503a6.324 6.324 0 0 0 .242-1.746c0-.657-.087-1.273-.26-1.85a4.338 4.338 0 0 0-.777-1.503 3.493 3.493 0 0 0-1.314-1.02c-.518-.253-1.13-.38-1.832-.38-.576 0-1.112.115-1.607.346-.496.219-.882.587-1.158 1.106h-.035v-1.21Zm4.857 3.301a4.447 4.447 0 0 1 .155 1.175c0 .392-.046.778-.138 1.158a2.79 2.79 0 0 1-.432 1.003c-.196.288-.45.524-.76.709-.312.184-.692.276-1.141.276-.404 0-.76-.08-1.072-.242a2.49 2.49 0 0 1-.778-.657 2.944 2.944 0 0 1-.5-.985 4.917 4.917 0 0 1-.156-1.262c0-.956.207-1.722.622-2.298.426-.576 1.054-.865 1.884-.865.403 0 .76.093 1.071.277.311.173.57.409.778.709.207.288.363.622.467 1.002Zm20.915-3.301h-1.487v1.469h1.487v5.271c.011.37.046.698.103.986.07.288.19.53.363.726.185.184.432.328.744.432.322.092.743.138 1.261.138.22 0 .432-.012.64-.035l.64-.069v-1.52a2.59 2.59 0 0 1-.416.068h-.414c-.22 0-.392-.023-.519-.069a.681.681 0 0 1-.294-.242 1.135 1.135 0 0 1-.12-.38 7.13 7.13 0 0 1-.018-.536v-4.77h1.78v-1.47h-1.78v-2.678h-1.97v2.679Zm9.437 9.178c-.715 0-1.354-.116-1.919-.346a4.287 4.287 0 0 1-1.417-.985 4.35 4.35 0 0 1-.881-1.487 5.875 5.875 0 0 1-.294-1.9c0-.68.098-1.309.294-1.885a4.35 4.35 0 0 1 .881-1.486 4.082 4.082 0 0 1 1.417-.968c.565-.242 1.204-.363 1.919-.363.714 0 1.348.12 1.901.363a3.88 3.88 0 0 1 1.417.968c.392.415.686.91.882 1.486.207.576.311 1.204.311 1.884 0 .691-.104 1.325-.311 1.901a4.064 4.064 0 0 1-2.299 2.472c-.553.23-1.187.346-1.901.346Zm0-1.556c.438 0 .818-.092 1.14-.276.323-.185.588-.427.796-.726.207-.3.357-.634.449-1.003a4.383 4.383 0 0 0 .156-1.158c0-.38-.052-.76-.156-1.14a2.84 2.84 0 0 0-.45-1.003 2.405 2.405 0 0 0-.794-.726c-.323-.184-.703-.277-1.141-.277-.438 0-.818.093-1.14.277a2.404 2.404 0 0 0-.796.726 3.089 3.089 0 0 0-.467 1.002 4.826 4.826 0 0 0-.138 1.141c0 .392.046.778.138 1.158.104.369.26.703.467 1.003.207.3.472.541.795.726.323.184.703.276 1.14.276Zm8.171-7.622h-1.849v8.936h1.97V26.52c0-.496.064-.934.19-1.314.127-.38.3-.697.519-.95.219-.265.472-.461.76-.588.3-.138.617-.207.951-.207.138 0 .276.011.415.034.15.012.294.029.432.052v-1.901l-.277-.035a4.008 4.008 0 0 0-.466-.017c-.3 0-.594.058-.882.173a3.067 3.067 0 0 0-.795.466 3.45 3.45 0 0 0-.605.623c-.161.23-.271.466-.328.708h-.035v-1.728Zm10.232 3.681a3.009 3.009 0 0 0-.207-.898 2.111 2.111 0 0 0-.45-.744 1.953 1.953 0 0 0-.691-.518 1.915 1.915 0 0 0-.899-.208 2.34 2.34 0 0 0-.951.19 2.103 2.103 0 0 0-.725.502 2.573 2.573 0 0 0-.484.743c-.116.288-.179.6-.191.933h4.598Zm-4.598 1.297c0 .345.047.68.139 1.002.103.323.253.605.449.847s.444.438.743.588c.3.138.657.207 1.072.207.576 0 1.037-.121 1.383-.363.357-.253.622-.628.795-1.123h1.866a3.711 3.711 0 0 1-.535 1.296c-.254.38-.559.703-.916.968a3.914 3.914 0 0 1-1.21.57 4.566 4.566 0 0 1-1.383.208c-.703 0-1.325-.116-1.867-.346a3.945 3.945 0 0 1-1.382-.968 4.28 4.28 0 0 1-.847-1.486 6.193 6.193 0 0 1-.277-1.902c0-.633.098-1.233.294-1.797a4.7 4.7 0 0 1 .864-1.504c.38-.438.836-.783 1.366-1.037.53-.253 1.129-.38 1.797-.38.703 0 1.331.15 1.884.45a4.04 4.04 0 0 1 1.4 1.157c.369.484.634 1.043.795 1.677a4.94 4.94 0 0 1 .138 1.936h-6.568ZM39.727 7.142a2.852 2.852 0 0 0-1.237-.187h-2.329v6.448h2.33c1.92 0 3.033-1.184 3.033-3.244a2.852 2.852 0 0 0-1.797-3.017Zm-1.349 5.349h-1.215V7.867h1.215a2.033 2.033 0 0 1 2.126 2.305 2.027 2.027 0 0 1-.51 1.665 2.026 2.026 0 0 1-1.616.654Zm4.384-2.47a2.305 2.305 0 0 0-.107.947 2.305 2.305 0 0 0 .587 1.773 2.305 2.305 0 0 0 1.708.756 2.305 2.305 0 0 0 2.294-2.53 2.305 2.305 0 0 0-4.482-.946Zm2.19-.725c.83 0 1.305.617 1.305 1.672 0 1.059-.474 1.675-1.306 1.675-.834 0-1.304-.612-1.304-1.675 0-1.055.47-1.672 1.304-1.672Zm7.396 4.107h.997l1.335-4.866h-.96l-.867 3.713h-.076l-1-3.713h-.922l-1 3.713h-.072l-.872-3.713h-.973l1.34 4.866h.987l1.002-3.584h.076l1.005 3.584Zm4.385-4.866h-.925v4.866h.96v-2.847a1.116 1.116 0 0 1 .298-.883 1.116 1.116 0 0 1 .864-.35c.71 0 1.05.39 1.05 1.171v2.909h.96v-3.15a1.583 1.583 0 0 0-1.683-1.81 1.457 1.457 0 0 0-1.452.867h-.072v-.773Zm5.698-1.9h-.96v6.766h.96V6.638Zm1.442 3.384a2.305 2.305 0 0 0-.107.947 2.305 2.305 0 0 0 2.295 2.528 2.305 2.305 0 0 0 1.707-.756 2.307 2.307 0 0 0 .588-1.772 2.305 2.305 0 0 0-4.483-.947Zm2.19-.725c.83 0 1.304.617 1.304 1.672 0 1.059-.473 1.675-1.305 1.675-.835 0-1.304-.612-1.304-1.675 0-1.055.47-1.672 1.304-1.672Zm5.113 1.278c-1.157.072-1.81.577-1.81 1.453a1.47 1.47 0 0 0 .488 1.088 1.47 1.47 0 0 0 1.134.368 1.637 1.637 0 0 0 1.462-.764h.076v.684h.924v-3.325c0-1.028-.688-1.635-1.908-1.635-1.103 0-1.89.536-1.988 1.372h.93c.107-.344.478-.54 1.014-.54.656 0 .996.29.996.803v.42l-1.318.076Zm1.318.63v.407a1.147 1.147 0 0 1-1.26 1.064c-.522 0-.902-.255-.902-.693 0-.429.304-.657.974-.702l1.188-.076Zm4.238-2.748c-1.23 0-2.02.974-2.02 2.512 0 1.541.782 2.515 2.02 2.515a1.689 1.689 0 0 0 1.528-.85h.076v.77h.92V6.638h-.96V9.31h-.072a1.603 1.603 0 0 0-1.492-.854Zm.272 4.165c-.813 0-1.3-.621-1.3-1.653 0-1.024.492-1.649 1.3-1.649.804 0 1.31.639 1.31 1.653 0 1.019-.5 1.649-1.31 1.649Zm6.332-2.6a2.305 2.305 0 0 0-.107.947 2.305 2.305 0 0 0 1.36 2.332 2.305 2.305 0 0 0 3.23-2.332 2.307 2.307 0 0 0-.59-1.77 2.305 2.305 0 0 0-3.893.823Zm2.19-.725c.83 0 1.304.617 1.304 1.672 0 1.059-.473 1.675-1.305 1.675-.834 0-1.304-.612-1.304-1.675 0-1.055.47-1.672 1.304-1.672Zm4.505-.759h-.924v4.866h.96v-2.847a1.116 1.116 0 0 1 1.162-1.233c.71 0 1.05.39 1.05 1.171v2.909h.96v-3.15a1.583 1.583 0 0 0-1.684-1.81 1.457 1.457 0 0 0-1.452.867h-.072v-.773Zm8.634.022V7.326h-.961v1.233h-.773v.81h.773v2.747c0 .938.425 1.314 1.493 1.314a3.143 3.143 0 0 0 .522-.05v-.8a3.222 3.222 0 0 1-.366.023c-.478 0-.688-.223-.688-.733V9.368h1.054V8.56h-1.054Zm3.318-1.921h-.952v6.765h.96V10.56a1.136 1.136 0 0 1 1.225-1.233c.679 0 1.041.393 1.041 1.17v2.905h.961V10.26a1.61 1.61 0 0 0-.06-.696 1.603 1.603 0 0 0-1.616-1.118 1.494 1.494 0 0 0-.879.202 1.49 1.49 0 0 0-.604.67h-.076V6.638Zm8.035 6.538c.386-.258.669-.642.799-1.087h-.924a1.165 1.165 0 0 1-.49.471 1.163 1.163 0 0 1-.668.119 1.291 1.291 0 0 1-.522-.104 1.29 1.29 0 0 1-.434-.307 1.296 1.296 0 0 1-.274-.455 1.295 1.295 0 0 1-.066-.528v-.054h3.436v-.335c0-1.528-.817-2.453-2.171-2.453a2.245 2.245 0 0 0-.933.195 2.232 2.232 0 0 0-.768.564 2.235 2.235 0 0 0-.465.833 2.23 2.23 0 0 0-.077.95 2.203 2.203 0 0 0 .542 1.776 2.218 2.218 0 0 0 1.706.736c.46.05.924-.064 1.309-.321Zm-.121-2.655h-2.458a1.24 1.24 0 0 1 .092-.485 1.24 1.24 0 0 1 .683-.684c.154-.062.319-.094.485-.092.164-.003.326.027.478.09a1.176 1.176 0 0 1 .655.69c.055.154.077.318.065.481Z" clip-rule="evenodd" /></symbol>',126,40);var Au=function(e){var n=e.onClose,t=e.platform,a=sc().getLang;return(0,o.jsx)(bc.BaseModal,(0,i.__assign)({className:"CallsModalMobileAppDownloaded",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__wrap"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__device-img CallsModalMobileAppDownloaded__device-img-"+t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__qr"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__qrImg CallsModalMobileAppDownloaded__qrImg-"+t},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__title"},{children:function(){switch(t){case Oi.OS.IOS:return a("calls_application_for_ios");case Oi.OS.ANDROID:return a("calls_application_for_android")}}()}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__text"},{children:a("calls_scan_qr_offer")}),void 0)]}),void 0)]}),void 0)}),void 0)},gu=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.205 16.205 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.79 22.79 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.215 25.215 0 0 0 .647-1.49l.003-.008a18.66 18.66 0 0 0 .919-3.044.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.538 16.538 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#b)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395v14.068h2.395v-6.026h.598l5.268 6.026h3.153ZM73.52 13.797c1.258-.399 2.156-1.476 2.156-3.053 0-2.294-2.035-3.93-4.909-3.93-2.514 0-4.39 1.257-5.228 3.631l2.255.38c.519-1.098 1.517-1.817 2.913-1.817 1.457 0 2.554.779 2.554 1.916 0 1.157-1.137 1.936-2.733 1.936h-1.776v2.095h1.776c2.075 0 2.973.878 2.973 2.015 0 1.297-1.058 2.115-2.814 2.115-1.636 0-2.554-.698-3.192-2.015l-2.295.379c.579 2.275 2.654 3.831 5.507 3.831 3.313 0 5.248-1.856 5.248-4.21 0-1.756-1.137-2.834-2.434-3.273ZM85.286 15.693c.898-.419 1.477-1.117 1.477-2.195 0-1.636-1.497-2.793-3.652-2.793h-4.968V21.08h5.188c2.235 0 3.791-1.218 3.791-2.874a2.605 2.605 0 0 0-1.836-2.514ZM80.437 12.6h2.674c.798 0 1.357.479 1.357 1.138 0 .658-.559 1.117-1.357 1.117h-2.674V12.6Zm2.894 6.585h-2.894v-2.534h2.894c.898 0 1.496.519 1.496 1.277 0 .758-.598 1.257-1.496 1.257ZM94.16 21.28c3.252 0 5.547-2.235 5.547-5.387 0-3.153-2.295-5.388-5.547-5.388-3.253 0-5.548 2.235-5.548 5.388 0 3.152 2.295 5.387 5.548 5.387Zm0-2.095c-1.876 0-3.153-1.337-3.153-3.292 0-1.956 1.277-3.293 3.153-3.293 1.875 0 3.152 1.337 3.152 3.293 0 1.955-1.277 3.292-3.152 3.292ZM108.646 10.704v4.091h-4.649v-4.09h-2.295V21.08h2.295v-4.19h4.649v4.19h2.295V10.704h-2.295ZM119.975 21.08h3.013l-4.769-5.387 4.37-4.989h-2.734l-3.472 4.031h-.558v-4.03h-2.295V21.08h2.295v-4.13h.558l3.592 4.13ZM124.286 21.08h3.253l3.871-7.702h.319v7.703h2.195V10.704h-3.252l-3.871 7.703h-.32v-7.703h-2.195v10.377Z"},void 0)}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},Cu=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#b)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.897 22.897 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.164 25.164 0 0 0 .647-1.49l.003-.008c.412-1.05.711-2.048.919-3.044a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.535 16.535 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#c)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395V21.08h2.395v-6.027h.598l5.268 6.027h3.153ZM72.623 21.28c2.893 0 5.348-1.616 6.345-4.17l-2.374-.4c-.699 1.497-2.155 2.375-3.891 2.375-2.674 0-4.51-2.055-4.51-5.048 0-2.973 1.856-5.029 4.51-5.029 1.716 0 3.112.838 3.791 2.275l2.374-.399c-.957-2.514-3.332-4.07-6.245-4.07-4.03 0-6.924 3.012-6.924 7.223 0 4.23 2.893 7.243 6.924 7.243ZM85.004 10.505c-2.016 0-3.791 1.037-4.31 2.833l2.115.36c.32-.639 1.037-1.238 2.075-1.238 1.257 0 1.995.898 2.095 2.255h-2.235c-3.053 0-4.57 1.337-4.57 3.253 0 1.935 1.497 3.312 3.612 3.312 1.697 0 2.834-.978 3.333-1.836l.479 1.637h1.696v-5.827c0-3.013-1.636-4.75-4.29-4.75Zm-.679 8.84c-1.117 0-1.835-.58-1.835-1.477 0-.798.578-1.357 2.334-1.357H87c0 1.696-1.077 2.834-2.674 2.834ZM91.883 21.08h2.295V7.014h-2.295V21.08ZM96.969 21.08h2.295V7.014h-2.295V21.08ZM105.687 21.28c2.973 0 4.33-1.477 4.33-3.153 0-2.055-1.916-2.674-3.552-3.132-1.217-.34-2.275-.659-2.275-1.497 0-.678.758-1.038 1.616-1.038.958 0 1.676.5 2.056 1.357l2.135-.359c-.579-1.816-2.155-2.953-4.211-2.953-2.115 0-3.971.978-3.971 3.053 0 2.175 1.996 2.753 3.652 3.212 1.177.32 2.195.619 2.195 1.417 0 .818-.878 1.137-1.796 1.137-1.177 0-2.055-.558-2.394-1.536l-2.215.38c.439 1.915 2.075 3.112 4.43 3.112Z"},void 0)}),void 0)]}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h134v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"c"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},Eu=function(e){return"ru"===e.lang?(0,o.jsx)(gu,{},void 0):(0,o.jsx)(Cu,{},void 0)},Su=t(64372);const Tu=(0,X.makeIcon)("Icon16LogoApple","logo_apple_16","0 0 16 16",'<symbol viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="logo_apple_16"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.833 7.44c-.018-1.774 1.45-2.624 1.516-2.666-.825-1.204-2.11-1.369-2.568-1.388-1.093-.11-2.134.642-2.689.642-.553 0-1.41-.625-2.317-.609-1.192.018-2.29.691-2.904 1.755-1.239 2.143-.318 5.317.89 7.055.59.85 1.293 1.806 2.216 1.772.89-.036 1.225-.574 2.3-.574 1.076 0 1.378.574 2.319.556.957-.018 1.563-.867 2.149-1.72.677-.987.956-1.942.972-1.991-.02-.01-1.866-.714-1.884-2.832Zm-1.768-5.204c.49-.593.82-1.415.73-2.236-.706.029-1.561.469-2.068 1.06-.454.525-.852 1.363-.745 2.167.788.061 1.592-.4 2.083-.991Z" fill="currentColor" /></symbol>',16,16,!1,void 0),Iu=Ni("Icon16LogoWindows","logo_windows_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_windows_16"><path fill="currentColor" d="M2 8V3.677l5-.678V8H2Zm5.5 0H14V2l-6.5.903V8Zm-.5.5H2v3.823L7 13V8.5Zm.5 0v4.597L14 14V8.5H7.5Z" /></symbol>',16,16),xu=Ni("Icon16LogoLinux","logo_linux_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_linux_16"><path fill="currentColor" d="M12.744 12.112c-.336-.26-.205-.835-.554-1.118.338-1.963-.61-3.693-1.739-4.802-.948-.93-.642-1.836-.642-2.62C9.809 2.322 9.27 1 7.639 1 5.896 1 5.418 2.388 5.401 3.18c-.042 1.903.403 2.398-.764 3.783-1.373 1.63-1.575 3.254-1.265 4.116-.145.161-.34.34-.706.487-1.01.42-.27 1.123-.549 1.622A.884.884 0 0 0 2 13.62c0 .437.364.816 1.026.76.893-.077 1.717.527 2.25.527.47 0 .856-.255 1.036-.607.842-.198 1.88-.173 2.721.034.151.403.56.666 1.016.666.997 0 1.189-1.079 2.332-1.444a.9.9 0 0 0 .619-.868c0-.227-.085-.444-.256-.576Zm-5.59-6.105c-.195 0-.356-.15-.611-.331-.323-.229-.65-.36-.647-.6 0-.166.231-.217.53-.398.322-.194.448-.391.764-.391.324 0 .422.156.862.337.432.18.734.25.734.451 0 .207-.453.355-.708.507-.375.22-.567.425-.924.425Zm1.018-3.042c.539.083.6.987.341 1.432l-.217-.085c.113-.317.11-.838-.266-.871-.239-.021-.393.28-.426.537a1.07 1.07 0 0 0-.32-.074c.039-.538.403-1.013.888-.939Zm-2.08.193c.413-.098.657.36.659.837l-.19.111c-.025-.2-.119-.523-.353-.454-.252.075-.21.632-.07.746l-.188.1c-.256-.413-.256-1.245.142-1.34ZM4.8 14.383c-1.2-.52-1.608-.402-1.837-.402-.475 0-.63-.338-.452-.657.152-.272.105-.556.068-.784-.058-.35-.068-.463.292-.614.498-.201.72-.461.884-.655.463-.547.93.313 1.314 1.079.249.496.738.748.89 1.298.138.508-.435 1.05-1.16.735Zm4.27-1.093c-.846.393-1.924.573-2.73.175-.12-.329-.31-.541-.515-.755.33-.082.574-.474.281-.868-.312-.42-.95-.714-1.595-1.19-.603-.445-.794-1.542.028-2.769-.4 1.087-.167 2.088.034 2.374.042-.576.09-1.539.915-2.692.416-.582.422-1.351.431-1.832l.379.248c.279.196.512.413.847.413.495 0 .769-.272 1.15-.498.15-.088.375-.176.564-.3.318 1.445 1.634 3.182 1.708 4.171.306-.601-.087-2.05-.087-2.05.515.75.556 1.375.578 2.142.36.14.747.506.782.989l-.15-.016c-.077-.537-1.593-1.324-1.73-.315-.726.106-.462 1.205-.608 1.918-.068.326-.192.584-.283.855Zm2.96-.024c-.601.222-1.008.693-1.287.985-.538.564-1.249.293-1.325-.234-.08-.563.22-.87.35-1.501.118-.576-.014-1.462.263-1.557.18 1.023 1.263.593 1.51.314.401 0 .435.13.525.488.056.225.133.414.353.636.255.26.177.661-.388.87ZM7.143 5.68c-.398 0-.696-.253-.938-.45-.124-.099.031-.283.155-.183.237.192.475.394.783.394.37 0 .698-.303 1.14-.47.152-.056.238.167.088.223-.43.162-.775.486-1.228.486Z" /></symbol>',16,16);var Nu=function(e){var n=e.icon,t=e.text,a=e.onClick;return(0,o.jsxs)(Bn.default,(0,i.__assign)({appearance:"secondary",className:"CallsAppDownloadBanner--bannerButton",onClick:a},{children:[t,(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonIcon"},{children:n}),void 0)]}),void 0)},yu=function(){var e=function(){return wi("/calls?act=download_app&type=mac",d.DESKTOP_CALLS_FILENAME[Oi.OS.MAC],!0)},n=function(){return wi("/calls?act=download_app&type=windows",d.DESKTOP_CALLS_FILENAME[Oi.OS.WINDOWS],!0)},t=function(){return function(e){void 0===e&&(e=d.DESKTOP_CALLS_DOWNLOAD_PAGE);var n=document.createElement("a");n.target="_blank",n.href=e,document.body.appendChild(n),n.click(),n.remove()}("/calls?act=download_app&type=linux")},a=null,r=(0,o.jsx)(o.Fragment,{},void 0);switch(Oi.Platform.OS){case Oi.OS.WINDOWS:r=(0,o.jsx)(Nu,{icon:(0,o.jsx)(Iu,{},void 0),text:"Windows",onClick:n},void 0);break;case Oi.OS.MAC:r=(0,o.jsx)(Nu,{icon:(0,o.jsx)(Tu,{},void 0),text:"Mac",onClick:e},void 0);break;case Oi.OS.LINUX:r=(0,o.jsx)(Nu,{icon:(0,o.jsx)(xu,{},void 0),text:"Linux",onClick:t},void 0);break;default:r=(0,o.jsx)(Nu,{icon:(0,o.jsx)(Iu,{},void 0),text:"Windows",onClick:n},void 0),a=(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonsSecond"},{children:[(0,o.jsx)(Nu,{icon:(0,o.jsx)(Tu,{},void 0),text:"Mac",onClick:e},void 0),(0,o.jsx)(Nu,{icon:(0,o.jsx)(xu,{},void 0),text:"Linux",onClick:t},void 0)]}),void 0)}return{mainButton:r,otherButtons:a}},bu=function(e){var n=e.onCreateCall,t=sc().getLang,a=(0,Jd.useLocale)().locale;return(0,o.jsx)(Su.Dropdown,(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown",trigger:"hover",position:"l",dataJsx:function(){var e=(0,i.__read)(t("calls_dropdown_ios_download_disabled_v2").split("{link}"),2),a=e[0],r=e[1];return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__ctx CallsDropdownComponent__in"},{children:[(0,o.jsxs)("p",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__desc"},{children:[a.trim()," ",(0,o.jsx)(zd.default,(0,i.__assign)({target:"_blank",href:"https://calls.vk.com",rel:"noreferrer"},{children:"calls.vk.com"}),void 0),r?" "+r:""]}),void 0),(0,o.jsx)(Bn.default,(0,i.__assign)({wide:!0,appearance:"primary",size:"s",onClick:function(){return n(Ja.CallStatSource.HISTORY_CREATE)}},{children:t("calls_dropdown_ios_call_from_web")}),void 0)]}),void 0)},marginLeft:-221,useFixedPosition:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row","data-platform":"ios"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__link","data-platform":"ios"},{children:wu(a)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink","data-platform":"ios"},{children:(0,o.jsx)(vu,{},void 0)}),void 0)]}),void 0)}),void 0)},Ou=(0,l.memo)((function(e){var n=e.onCreateCall,t=e.useDisabledAppStoreBtn,a=sc().getLang,r=(0,Jd.useLocale)().locale,s=function(){var e=(0,i.__read)((0,l.useState)(!1),2),n=e[0],t=e[1],a=(0,l.useCallback)((function(){t(Oi.OS.IOS)}),[]),o=(0,l.useCallback)((function(){t(!1)}),[]);return{openedModal:n,openIOSModal:a,openAndroidModal:(0,l.useCallback)((function(){t(Oi.OS.ANDROID)}),[]),closeModal:o}}(),c=s.openedModal,d=s.openAndroidModal,u=s.closeModal,_=s.openIOSModal,v=yu(),h=v.mainButton,p=v.otherButtons;return(0,o.jsxs)(od.default,(0,i.__assign)({className:"CallsAppDownloadBanner--banner"},{children:[(0,o.jsx)(Eu,{lang:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerDesc"},{children:a("calls_history_desktop_banner_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerSubDesc"},{children:a("calls_history_desktop_banner_sub_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_mobile")}),void 0),t&&(0,o.jsx)(bu,{onCreateCall:n},void 0),!t&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row"},{children:[(0,o.jsx)(zd.default,(0,i.__assign)({className:"CallsAppDownloadBanner__link",target:"_blank",href:"https://apps.apple.com/app/id1612939275",rel:"noreferrer"},{children:wu(r)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink",onClick:_},{children:(0,o.jsx)(vu,{},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row"},{children:[(0,o.jsx)(zd.default,(0,i.__assign)({className:"CallsAppDownloadBanner__link",target:"_blank",href:"https://play.google.com/store/apps/details?id=com.vk.calls",rel:"noreferrer"},{children:"ru"===r?(0,o.jsx)(hu,{},void 0):(0,o.jsx)(pu,{},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink",onClick:d},{children:(0,o.jsx)(vu,{},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtons"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_desktop")}),void 0),h,p]}),void 0),c&&(0,o.jsx)(Au,{platform:c,onClose:u},void 0)]}),void 0)}));function wu(e){return"ru"===e?(0,o.jsx)(fu,{},void 0):(0,o.jsx)(mu,{},void 0)}var Lu=function(){var e=sc().getLang,n=$c((function(e){return e.showCreateCall})),t=function(e){var n=(0,l.useMemo)((function(){return{urlSection:new URLSearchParams(e.search).get("section")||""}}),[e]).urlSection,t=(0,i.__read)((0,l.useState)(n),2);return{section:t[0],setSection:t[1]}}(window.location),a=t.section,r=t.setSection,s=_d(),c=s.onCreateCallClick,d=s.onPlanCalendarEvent,u=vd(),_=u.loading,v=u.setLoading,h=(0,l.useMemo)((function(){return[{id:"",label:e("calls_page_menu_all_calls"),href:"calls",ref:(0,l.createRef)()},{id:"friends",label:e("calls_page_menu_friends_calls"),href:"calls?section=friends",ref:(0,l.createRef)()},{id:"sep1",separator:!0},{id:"current",label:e("calls_page_menu_current_calls"),href:"calls?section=current",ref:(0,l.createRef)()},{id:"scheduled",label:e("calls_scheduled"),href:"calls?section=scheduled",ref:(0,l.createRef)()},{id:"sep2",separator:!0},{id:Yc.HistoryScreenSections.HISTORY,label:e("calls_history"),href:"calls?section="+Yc.HistoryScreenSections.HISTORY,ref:(0,l.createRef)()},{id:"missed",label:e("calls_page_menu_miss_calls"),href:"calls?section=missed",ref:(0,l.createRef)()}]}),[e]),p=(0,l.useCallback)((function(e,n){return(0,nd.changeQuery)(n),r(e),v(!0),window.scrollTo({top:0}),Promise.resolve()}),[]),f=(0,l.useMemo)((function(){return a===Yc.HistoryScreenSections.MISS?(0,o.jsx)(Ld,{},void 0):a===Yc.HistoryScreenSections.FRIENDS?(0,o.jsx)(Rd,{},void 0):a===Yc.HistoryScreenSections.CURRENT?(0,o.jsx)(Vd,{},void 0):a===Yc.HistoryScreenSections.HISTORY?(0,o.jsx)(_u,{},void 0):a===Yc.HistoryScreenSections.SCHEDULED?(0,o.jsx)(uu,{},void 0):(0,o.jsx)(cu,{onMenuItemClick:p},void 0)}),[a]);return(0,o.jsx)(cd,(0,i.__assign)({showCreateCall:n,onCreateCallClick:c,activeMenuItem:a,menuItems:h,onMenuItemClick:p,loading:_,banner:(0,o.jsx)(Ou,{onCreateCall:c},void 0),onPlanCalendarEvent:d},{children:f}),void 0)},ku=function(){var e=ed(),n=$c((function(e){return e.error})),t=sc().getLang,a=function(){e((0,nd.dispatchSetError)(null))};return(0,o.jsx)(xr,{title:(0,o.jsxs)(o.Fragment,{children:[(null==n?void 0:n.title)||t("calls_oops")," "]},void 0),onClose:a,actionButtons:(0,o.jsx)(Bn.default,(0,i.__assign)({onClick:a},{children:t("calls_close")}),void 0),text:(0,o.jsx)(o.Fragment,{children:null==n?void 0:n.text},void 0)},void 0)},Pu=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e,n){console.error("Call history crashed:",e,n)},n.prototype.render=function(){return this.state.hasError?(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--error"},{children:(0,o.jsx)(od.default,(0,i.__assign)({title:this.props.getLang("global_error")},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--errorContent"},{children:this.props.getLang("global_unexpected_error_try_later")}),void 0)}),void 0)}),void 0):this.props.children},n}(l.Component),Mu=t(72382),Du=t(75683),ju=t(21333),Ru=function(){var e=(0,Bl.useIsMounted)(),n=ed(),t=(0,ue.useLang)().getLang,a=(0,xc.usePromiseError)().handleError,i=_d().setPlannedCalendarEvent,r=(0,Lc.useNotifier)().showText,c=(0,ju.useFetchData)({cb:sn.messagesEditCall}),d=(0,ju.useFetchData)({cb:sn.messagesDeleteScheduledCall}),u=(0,jc.useSendStatsDataCallScheduled)().sendCallScheduled,_=$c((function(e){return e.scheduledEditableCall})),v=$c((function(e){return e.popup})),h=$c((function(e){return e.profiles[e.meId]})),p=$c((function(e){return _?e.profiles[_.caller_id||""]:void 0})),f=(0,l.useMemo)((function(){return(0,Mc.getUserSelectOptions)(p)}),[p]),m=(0,Ic.useCalendarEventDetails)({meParticipant:h}).getDescription,A=(0,l.useCallback)((function(){n({type:Yc.HistoryScreenActionTypes.SET_POPUP})}),[]),g=(0,l.useCallback)((function(){n({type:Yc.HistoryScreenActionTypes.SET_POPUP,data:Yc.EHistoryScreenPopup.RescheduleCalendarEvent})}),[]),C=(0,l.useCallback)((function(n){if(_)return c.fetchData((0,Mc.mapFormData)(n,_)).then((function(){if(e()){var o=new Date(n.start),l={start:o,title:n.name,repeatRule:n.rrule,join_link:_.vk_join_link||"",call_id:_.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},c=m(l);switch(l.description=c,(0,s.copyTextToClipboard)(c).then((function(){r(t("calls_create_call_by_link_text_copied"))})).catch(a),u({creatorId:_.caller_id,sharingChannel:n.calendar,isEdit:!0}),n.calendar){case Dc.ECalendar.Other:i(l);break;case Dc.ECalendar.Google:var d=(0,Mc.google)((0,Mc.mapGoogleIcsUrl)(l,t));(0,Mc.openLinkInNewTab)(d,o);break;case Dc.ECalendar.iCloud:case Dc.ECalendar.Outlook:d=(0,Mc.ics)((0,Mc.mapGoogleIcsUrl)(l,t));(0,Mc.openLinkInNewTab)(d,o,!1)}A()}})).catch(a)}),[_,c.fetchData]),E=(0,l.useCallback)((function(){_&&d.fetchData({call_id:_.call_id}).then(A)}),[_,d.fetchData]);return _?(0,o.jsxs)(o.Fragment,{children:[v===Yc.EHistoryScreenPopup.EditCalendarEvent&&(0,o.jsx)(Pc.ModalScheduleCall,{onClose:A,headerTitle:t("calls_edit_call_title"),onSubmit:C,call:_,loading:c.loading,myUserId:null==h?void 0:h.id,userSelectOptions:f},void 0),v===Yc.EHistoryScreenPopup.DeleteCalendarEvent&&(0,o.jsx)(Du.ModalDeleteCall,{call:_,onClose:A,onSubmit:E,onReschedule:g,loading:d.loading},void 0),v===Yc.EHistoryScreenPopup.RescheduleCalendarEvent&&(0,o.jsx)(Mu.ModalRescheduleCall,{call:_,onClose:A,onSubmit:C,loading:c.loading,myUserId:null==h?void 0:h.id,userSelectOptions:f},void 0)]},void 0):((0,Fo.handlePromiseError)("Пытаемся показать окно редактирования без выбранного звонка"),null)},Zu=t(68891);const Bu=function(){var e,n,t=sc().getLang,a=$c((function(e){return e.error})),r=$c((function(e){return e.deleteCallId})),s=$c((function(e){return e.popup}));return e=ed(),n=$c((function(e){return e.meId})),(0,l.useEffect)((function(){var t=new Zu.CallsLongpoll(n,(function(n){e({type:Yc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE,data:n})}));return t.wait(),function(){t.destroy()}}),[n]),(0,o.jsxs)(Pu,(0,i.__assign)({getLang:t},{children:[(0,o.jsx)(Lu,{},void 0),r>=0&&(0,o.jsx)(td,{},void 0),null!==a&&(0,o.jsx)(ku,{},void 0),(0,Ve.hasIn)(s,Yc.EHistoryScreenPopup.DeleteCalendarEvent,Yc.EHistoryScreenPopup.EditCalendarEvent,Yc.EHistoryScreenPopup.RescheduleCalendarEvent)&&(0,o.jsx)(Ru,{},void 0)]}),void 0)};function Uu(e){var n=e.actionStatCollector,t=e.saveStatlogEvents,a=e.langUtils,l=e.navigateToConvo,u=e.navigateToProfile,_=e.apiWrapperWithAuth,v=e.apiWrapper,h=e.callSounds,p=e.config,f=void 0===p?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:p,m=e.eventHandlers,A=e.streamUrlExtractor;return(0,Bc.setApiWrappers)(_,v),{initialized:!1,initializing:!1,eventHandlers:null!=m?m:{},init:function(e){var _,v=this,p=e.callPreview,g=e.callsCredentials,C=e.imHash,S=e.callsOkStaging,T=e.tabIsMaster,I=e.onBeforeCallStart,x=e.onAfterCallFinish,N=e.onError,b=e.toggles,L=void 0===b?{}:b,k=e.friends,P=e.isFriend,M=e.getFriends,D=e.pushToTalkEnabled;if(this.initialized)return this.initializing;if(!(null==g?void 0:g.me))return console.log("Calls were not initialized as there are no callsCredentials.me"),!1;this.initialized=!0,this.isFriend=P,this.getFriends=M;var j=(0,i.__assign)((0,i.__assign)({},f),L);if(!J.browser.isBrowserSupported()){var R=function(){var e=a.getLang("calls_unsupported_browser_error");return N&&N({msg:e}),(null==m?void 0:m.onError)&&m.onError(new Error(e)),console.error(e),Promise.resolve()};return this.call=R,this.startGroupCall=R,this.startCall=R,this.acceptCall=R,this.joinCallByLink=R,this.showJoinPopup=R,this.showCallByNamePopup=R,this.showCreateCallByLinkPopup=R,void(this.showPlanCalendarEventPopup=R)}this.id=window.vk&&window.vk.id||g.me.peerId;var Z=T||function(){return!0},B=null!==(_=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY))&&void 0!==_?_:d.VideoResolutionTypes.SD;Yn.GlobalStore.setCallsStore((0,Gc.createStore)(Wc,Fc(g.me,C,p,{isDev:!!g.is_dev,token:g.secret,config:j,localVideoResolution:j.fullHD?B:B===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD,friends:k||[],friendsCache:(0,Vn.createFriendsCache)(k||[]),ipSettingEnabled:g.ip_setting_enabled,privacySettings:g.privacySettings,pushToTalkEnabled:D}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));var U=Yn.GlobalStore.getCallsStore();return this.collapseCall=function(){j.enableNavChangeCallCollapse&&(J.debugMessage(J.DebugMessageType.WARN,{message:"[external] bridge.collapseCall called"}),lo({isModalView:f.isModalView,uiMode:U.getState().uiMode,changeUIMode:function(e){U.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})}}),U.dispatch({type:d.E_ACTION.MANAGEMENT,isOpen:!1}))},this.restoreCall=function(){U.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})},this.showStartCallModal=function(e,n,t){v.isInActiveCall||U.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,peerId:e,joinLink:n,entryPoint:t})},this.setPlannedCalendarEvent=function(e){U.dispatch({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:e}),U.dispatch({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})},t&&ar(t),n&&w.callStats.setActionStatCollector(n),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:U},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Vc,{},void 0)}),void 0)}),void 0)}),void 0),Hu("calls")),this.initializing=dr(this,J,g,U,a.getLang,S).catch((function(){return!0})).then((function(){!function(e,n,t,a){var o=a.dispatch,r=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];r.forEach((function(e){e.type===d.INCOMING_CALL&&(0,sn.logCallReceived)(e.payload.call_id)}));var l=a.getState();Uc(l,o,e,r,t).then((function(){r.forEach((function(t){switch(t.type){case d.INCOMING_CALL:if(Hc(l,t))a.getState().ipSettingEnabled&&n.forceRelayPolicy(!t.payload.p2p_allowed),n.processPush(t.payload.call_id).then((function(){var e=JSON.parse((0,wa.decodeHTMLEntities)(t.payload.payload)),n=e.is_video?d.CallType.VIDEO:d.CallType.AUDIO,a=(0,Ve.getPeerIdFromLongpoll)(t.payload),r=(0,Ve.isGroupCallEvent)(t);a<0&&(r=e.with_join_link),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.INCOMING,peerId:a<0&&r?0:a,data:(0,i.__assign)((0,i.__assign)({},t.payload),{type:n,payload:e})}),nr({timeStart:Date.now(),startType:n}),w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:t.payload.call_id,peer_id:a,is_group_call:r,reason:e.is_video?d.CallType.VIDEO:d.CallType.AUDIO})})).catch((function(n){if(e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug)if("object"==typeof n){var t=n.hangup,a=n.message;console.error("Push process error",t,a)}else console.error("Push process error",n)}));else if(t.type===d.INCOMING_CALL){var r=function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(new Error(n)),e.debug&&console.warn("Incoming push skipped:",n,t)};switch(!0){case!t.payload.call_id:r("old lib call");break;case l.mode===d.Mode.CALL||l.mode===d.Mode.INCOMING:r("already in a call"),n.processPush(t.payload.call_id).then((function(){e.eventHandlers.onError&&e.eventHandlers.onError(new Error("processPush was incorrect accepted with call_id: "+t.payload.call_id)),e.debug&&console.warn("processPush was incorrect accepted",t.payload.call_id)})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.warn("processPush rejected:",n,t.payload.call_id)}));break;default:r("reason of decline is unknown")}}break;case d.ADD_MESSAGE:var s=a.getState(),c=(0,La.isChatPeer)(s.peer),u=s.callData.callId;if(s.peer!==t.peerId||t.flags&d.FLAG_OUTBOUND||s.me===t.userId||o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),c||!(0,O.isActiveGroupCallMessage)(t))return;var _=t.peerId;if(u===t.kludges.attach1_call_id)return vt(a.getState(),o,_);break;case d.READ_INBOUND:null!==t.chatUnreadCount&&a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t.unread,chatUpToMsgId:t.upToId});break;case d.SET_FLAGS:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&!(t.flags&d.FLAG_OUTBOUND)&&(t.flags&d.FLAG_DELETED||t.flags&d.FLAG_SPAM)&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.DELETE_DIALOG:a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case d.EDIT_MESSAGE:case d.REPLACE_MESSAGE:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&t.kludges.is_expired&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.CONVERSATION_UPDATED:_=t.peerId;var v=t.updateType;if(a.getState().peer!==_)return;if(v!==d.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==a.getState().callData.canFinishCall&&a.getState().callData.hasUrlLink||ht(a.getState(),o,_)}}))})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.error("Resource loading error",n),r.forEach((function(e){if(e.type===d.INCOMING_CALL){if(!Hc(l,e))return;o({type:d.E_ACTION.ERROR,text:t("calls_incoming_process_error"),handleType:d.ErrorHandleType.PROCESS,callId:e.payload.call_id})}}))}))};if(e.handleEvent=r,void 0!==window.Notifier){var s=window.Notifier.getLpInstance();s&&s.onData(r)}}(v,J,a.getLang,U);var e=Hu("calls");r.unmountComponentAtNode(e),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:U},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Zc,{bridge:v,SDK:J,tabIsMaster:Z,onBeforeCallStart:I,onAfterCallFinish:x,callSounds:h,navigateToConvo:l,onHandCountChanged:null==m?void 0:m.onHandCountChanged,onSuccessFeedback:null==m?void 0:m.onSuccessFeedback,navigateToProfile:u,okPublicKey:g.key,config:j,streamUrlExtractor:A},void 0)}),void 0)}),void 0)}),void 0),e)})),this.initializing.catch((function(e){if(null==m?void 0:m.onError){var n=e?e.message||e.msg:"sdk did not send the reasons for the error",t=e?e.error:"";[401].includes(t)||m.onError(new Error("Could not init calls. "+n+": "+t))}console.error("Could not init calls",e.error,e)}))},showJoinScreen:function(e,s,l,c,d,u,_){void 0===_&&(_=!1);var v=lr(c,m);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));ar(t),w.callStats.setActionStatCollector(n);var h=e.callsAllowCallByName,p=e.callsAllowWaitingHall,A=document.querySelector(s),g=(0,i.__assign)((0,i.__assign)({},f),{allowCallByName:h,allowWaitingHall:p});r.render((0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:g},{children:(0,o.jsx)(Sr,(0,i.__assign)({},e,{withPopup:_,bridge:this,entryPoint:l,onError:v,okPublicKey:d,onClose:u}),void 0)}),void 0)}),void 0),A)},showHistoryScreen:function(e,n,s){var d,_;void 0===n&&(n={}),void 0===s&&(s=!0);var v=lr(void 0,m);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));ar(t);var h=(0,Gc.createStore)(Jc,function(e,n){var t,a;return{meId:null!==(t=e.meId)&&void 0!==t?t:0,currentCalls:[],historyCalls:[],deleteCallId:-1,profiles:{},joinLinks:{},isDev:null!==(a=e.isDev)&&void 0!==a&&a,error:null,loading:!0,showCreateCall:!0,config:(0,i.__assign)((0,i.__assign)({},n),e.config||{})}}(n,f),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),p=document.querySelector(e),A={navigateToConvo:l,navigateToProfile:u},g={bridge:this,SDK:J};if(r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:h},{children:(0,o.jsx)(dd.Provider,(0,i.__assign)({value:g},{children:(0,o.jsx)(yd.Provider,(0,i.__assign)({value:A},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:f},{children:(0,o.jsx)(Bu,{},void 0)}),void 0)}),void 0)}),void 0)}),void 0)}),void 0),p),s){var C=document.querySelector("#l_ca");C&&C.classList.contains("AppLeftMenuWithNotify")&&C.classList.remove("AppLeftMenuWithNotify"),C&&C.classList.contains("AppLeftMenuWithNotifyBlueDot")&&C.classList.remove("AppLeftMenuWithNotifyBlueDot")}null===(_=null===(d=window.cur)||void 0===d?void 0:d.destroy)||void 0===_||_.push((function(){p&&r.unmountComponentAtNode(p)}))},debug:!1,setDebug:function(e){this.debug=e,J.debug(e)}}}function Hu(e){var n=document.getElementById(e);if(n)return n;var t=document.createElement("section");return t.setAttribute("id",e),document.body.appendChild(t),t}}}]);try{stManager.done("dist/b3c52704711ff506ec36e9c85b864ca9.b439d1872874bdf1d794.js")}catch(e){}