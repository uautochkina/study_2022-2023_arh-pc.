(()=>{"use strict";var __webpack_modules__={64107:(e,t,i)=>{i.d(t,{default:()=>_});const _=(0,i(63192).makeIcon)("Icon20Cancel","cancel_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="cancel_20"><path clip-rule="evenodd" d="M4.72 4.72a.75.75 0 0 1 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20,!1,void 0)},5103:(e,t,i)=>{i.d(t,{default:()=>_});const _=(0,i(63192).makeIcon)("Icon24ChevronDown","chevron_down_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="chevron_down_24"><path d="M12 13.698 6.64 9.232a1 1 0 0 0-1.28 1.536l6 5a1 1 0 0 0 1.28 0l6-5a1 1 0 1 0-1.28-1.536L12 13.698Z" /></symbol>',24,24,!1,void 0)},71351:(e,t,i)=>{i.d(t,{default:()=>_});const _=(0,i(63192).makeIcon)("Icon24ChevronUp","chevron_up_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="chevron_up_24"><path d="m12 10.302-5.36 4.466a1 1 0 1 1-1.28-1.536l6-5a1 1 0 0 1 1.28 0l6 5a1 1 0 1 1-1.28 1.536L12 10.302Z" /></symbol>',24,24,!1,void 0)},88379:(e,t,i)=>{i.d(t,{default:()=>c});i(75115);var _=i(61508),o=i(26271),a=i(61540),r=i(21295);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},n.apply(this,arguments)}var s=o.browser.iphone||o.browser.ipad||o.browser.ipod;function c(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=n({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function l(e,t,i){(0,a.isMvk)()?window.addEvent(e,t,i,{passive:!0}):window.addEvent(e,t,i)}function d(e,t,i){(0,a.isMvk)()?window.removeEvent(e,t,i,{passive:!0}):window.removeEvent(e,t,i)}function u(){return document.visibilityState||document.webkitVisibilityState}function f(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}window.extend(c.prototype,_.default.prototype),window.extend(c.prototype,{stop:function(){this.started=!1,d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),(0,a.isMvk)()&&this._isTopLevel()&&f()&&d(document,f(),this.onVisiblityChange),(0,a.isMvk)()&&s||(d(this.opts.focusElement,"focus",this.cbActiveB),d(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!(0,a.isMvk)()&&o.browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),(0,a.isMvk)()&&this._isTopLevel()&&f()&&l(document,f(),this.onVisiblityChange),(0,a.isMvk)()&&s||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(r.screenWakeLocker.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=u();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},67784:(e,t,i)=>{i.d(t,{addDelegateEvent:()=>n,removeDelegateEvent:()=>s});i(91181),i(56997),i(96253),i(19371),i(98837),i(51876);var _=i(15544),o=i(49535),a=new window.Map;function r(e){var t=a.get(e.currentTarget);if(t){var i=t[e.type];if(i)for(var o,r=0;r<i.length;r++){var n=i[r],s=n[0],c=n[1],l=void 0;if((0,_.hasClass)(e.target,s)?l=c(e,e.target):(o=(0,_.gpeByClass)(s,e.target,e.currentTarget))&&(l=c(e,o)),!1===l)break}}}function n(e,t,i,_,n){var s=a.get(e);s||(a.set(e,{}),s=a.get(e));for(var c=t.split(" "),l=0;l<c.length;l++){var d=c[l];s[d]||(s[d]=[],n?(0,o.addEvent)(e,d,r,!1,!1,n):(0,o.addEvent)(e,d,r)),s[d].push([i,_])}}function s(e,t,i,_){var n=a.get(e);n&&(t.split(" ").forEach((t=>{n[t]&&(n[t]=n[t].filter((e=>e[0]!==i||e[1]!==_)),0===n[t].length&&(0,o.removeEvent)(e,t,r))})),0===Object.keys(n).map((e=>n[e].length)).reduce(((e,t)=>e+t))&&a.delete(e))}},67537:(__unused_webpack___webpack_module__,__unused_webpack___webpack_exports__,__webpack_require__)=>{var core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(75115),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21466),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(59357),core_js_modules_es6_array_filter__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(98837),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(40851),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(96253),core_js_modules_es6_array_map__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(19371),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(51876),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(87481),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(26271),_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(66890),_web_lib_lang__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(86067),_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(59121),_web_lib_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(82452),_web_lib_fx__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(35676),_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(79957),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(49535),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(95724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(15544),_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(76270),_shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(88379),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(68040),_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(40906),_longpoll_singleton__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(59483),_web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(84683),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(19331),_shared_lib_site__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(61540),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(50167),_shared_audio_utils_wrapAudioPlay__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(2227),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(54612),_web_market_HappySanta__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(97332),_shared_im_request__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(87294),_shared_im_EventQueue__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(67181),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(59397),_shared_im_longpoll_events__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(63825),_web_messenger_helpers_events__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(45523),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(91525),_notifier_utils__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(16850),_vkontakte_internal_calls_constants__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(73674),_icons_desktop_getIcon20RepostCircleFillGreen__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(97453),_icons_desktop_getIcon20ClipCircleFillViolet__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(57663),_icons_desktop_getIcon20CheckCircleFillYellow__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(91451),_icons_desktop_getIcon20LikeCircleFillRed__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(40884),_icons_desktop_getIcon20PodcastCircleFillRed__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(96710),_icons_desktop_getIcon20PollCircleFillGreen__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(27031),_icons_desktop_getIcon20VideoCameraCircleFillRed__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__(91634),_icons_desktop_getIcon20EditCircleFillBlue__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__(98100),_icons_desktop_getIcon20AddCircleFillBlue__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__(35703),_icons_desktop_getIcon20MailCircleFillBlue__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__(26642),_icons_desktop_getIcon20QuestionCircleFillViolet__WEBPACK_IMPORTED_MODULE_54__=__webpack_require__(12939),_icons_desktop_getIcon20UserCircleFillBlue__WEBPACK_IMPORTED_MODULE_55__=__webpack_require__(41337),_icons_desktop_getIcon20StoryReplyCircleFillViolet__WEBPACK_IMPORTED_MODULE_58__=__webpack_require__(86497),_icons_desktop_getIcon20QuestionCircleFillGreen__WEBPACK_IMPORTED_MODULE_59__=__webpack_require__(75387),_icons_desktop_getIcon20SongCircleFillViolet__WEBPACK_IMPORTED_MODULE_60__=__webpack_require__(70685),_icons_desktop_getIcon20CameraCircleFillGreen__WEBPACK_IMPORTED_MODULE_61__=__webpack_require__(9165),_icons_desktop_getIcon20RssCircleFillYellow__WEBPACK_IMPORTED_MODULE_62__=__webpack_require__(49203),_icons_desktop_getIcon20RssCircleFillBlack__WEBPACK_IMPORTED_MODULE_63__=__webpack_require__(70953),_icons_desktop_getIcon20GiftCircleFillYellow__WEBPACK_IMPORTED_MODULE_64__=__webpack_require__(87759),_icons_desktop_getIcon20GiftCircleFillRed__WEBPACK_IMPORTED_MODULE_65__=__webpack_require__(73853),_icons_desktop_getIcon20CakeCircleFillPurple__WEBPACK_IMPORTED_MODULE_66__=__webpack_require__(66688),_icons_desktop_getIcon20GameCircleFillBlue__WEBPACK_IMPORTED_MODULE_68__=__webpack_require__(62039),_icons_desktop_getIcon20MentionCircleFillBlue__WEBPACK_IMPORTED_MODULE_69__=__webpack_require__(34402),_icons_desktop_getIcon20CalendarCircleFillRed__WEBPACK_IMPORTED_MODULE_70__=__webpack_require__(56543),_icons_desktop_getIcon20MessageCircleFillBlue__WEBPACK_IMPORTED_MODULE_71__=__webpack_require__(92090),_icons_desktop_getIcon20CommentCircleFillGreen__WEBPACK_IMPORTED_MODULE_72__=__webpack_require__(93534),_icons_desktop_getIcon20DiscussionsCircleFillBlue__WEBPACK_IMPORTED_MODULE_73__=__webpack_require__(93965),_icons_desktop_getIcon20BoxCircleFillBlue__WEBPACK_IMPORTED_MODULE_74__=__webpack_require__(76181),_icons_desktop_getIcon20MoneyTransferCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_75__=__webpack_require__(70039),_icons_desktop_getIcon20MoneyTransferCircleFillRed__WEBPACK_IMPORTED_MODULE_76__=__webpack_require__(13803),_icons_desktop_getIcon20CancelCircleFillRed__WEBPACK_IMPORTED_MODULE_77__=__webpack_require__(6962),_icons_desktop_getIcon20MoneyRequestCircleFillBlue__WEBPACK_IMPORTED_MODULE_78__=__webpack_require__(61315),_icons_desktop_getIcon20CheckCircleFillGreen__WEBPACK_IMPORTED_MODULE_80__=__webpack_require__(11803),_icons_desktop_getIcon20ServicesCircleFillBlue__WEBPACK_IMPORTED_MODULE_81__=__webpack_require__(94635),_icons_desktop_getIcon20RecentCircleFillYellow__WEBPACK_IMPORTED_MODULE_84__=__webpack_require__(78574),_icons_desktop_getIcon20StatisticCircleFillBlue__WEBPACK_IMPORTED_MODULE_85__=__webpack_require__(71563),_icons_desktop_getIcon20DonateCircleFillYellow__WEBPACK_IMPORTED_MODULE_86__=__webpack_require__(82251),_icons_desktop_getIcon20TextLiveCircleFillGreen__WEBPACK_IMPORTED_MODULE_87__=__webpack_require__(1354),_icons_desktop_getIcon20LightbulbCircleFillYellow__WEBPACK_IMPORTED_MODULE_88__=__webpack_require__(36817),_icons_desktop_getIcon20MessageUnreadCircleFillRed__WEBPACK_IMPORTED_MODULE_89__=__webpack_require__(27180),_icons_desktop_getIcon20AdvertisingCircleFillRed__WEBPACK_IMPORTED_MODULE_90__=__webpack_require__(69945),_icons_desktop_getIcon20AddCircleFillGreen__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(69224),_icons_desktop_getIcon20StripCircleFillRed__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__(71336),_icons_desktop_getIcon20VotesCircleFillBlue__WEBPACK_IMPORTED_MODULE_56__=__webpack_require__(4878),_icons_desktop_getIcon20ReplyCircleFillGreen__WEBPACK_IMPORTED_MODULE_57__=__webpack_require__(9473),_icons_desktop_getIcon20StoryFillCircleYellow__WEBPACK_IMPORTED_MODULE_67__=__webpack_require__(56769),_icons_desktop_getIcon20CheckCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_79__=__webpack_require__(9754),_icons_desktop_getIcon20ServicesCircleFillYellow__WEBPACK_IMPORTED_MODULE_82__=__webpack_require__(91240),_icons_desktop_getIcon20ThumbsUpCircleFillGreen__WEBPACK_IMPORTED_MODULE_83__=__webpack_require__(20945),_icons_desktop_getIcon20Users3CircleFillBlue__WEBPACK_IMPORTED_MODULE_91__=__webpack_require__(79870),_icons_desktop_getIcon20FireCircleFillRed__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(29009),_shared_ranges__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(48743),_web_notifier_sound__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(24817);function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},_extends.apply(this,arguments)}var ACTIVE_TAB_SWITCH_SERVER_TIMEOUT=_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__.browser.safari?3e3:1e4,LC_SERVER_SWITCH_TO_ACTIVE_FLAG="lc_server_switch_to_active_flag",NOTIFICATION_FADE_TIMEOUT=7e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE=35e3,NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE=5e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE=3e4,IS_SSE_ENABLED=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_sse_longpoll"),isMediaStoppedByCalls=!1,errorTimeout={initialValue:1,get:()=>window.curNotifier.error_timeout||errorTimeout.initialValue,set:e=>{window.curNotifier.error_timeout=e},reset:()=>{window.curNotifier.error_timeout=errorTimeout.initialValue},increase:()=>{window.curNotifier.error_timeout<64&&(window.curNotifier.error_timeout*=2)},increaseMore:()=>{window.curNotifier.error_timeout<256&&(window.curNotifier.error_timeout*=2)},decrease:()=>{window.curNotifier.error_timeout=Math.max(1,errorTimeout.get()/1.5)}};function showEventThumb(e){var t="";if(e.author_photo){var i;t="video_process_ready"===e.type?`<div class="notifier_video_thumb" style="background-image: url('${Notifier.fixPhoto(e.author_photo)}')"></div>`:`<img alt="" src="${Notifier.fixPhoto(e.author_photo)}" class="notifier_image" />`;var _=null==(i=e.icon_custom)?void 0:i.image_url;if(_)t=`<div class="feedback_photo_icon_custom" style="background-image: url('${(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_33__.escape)(_)}')"></div>`+t;else if(e.icon_type){var o=getSvgByIconType(e.icon_type);t=`<div class="feedback_photo_icon ${o&&"display_block"}">${o}</div>`+t}e.author_link&&(t=`<a href="${e.author_link}">${t}</a>`),t=`<div class="notifier_image_wrap">${t}</div>`}return t}function getSvgByIconType(e){switch(e){case"repost":case"mail_mention":return(0,_icons_desktop_getIcon20RepostCircleFillGreen__WEBPACK_IMPORTED_MODULE_41__.getIcon20RepostCircleFillGreen)().icon;case"interesting":return(0,_icons_desktop_getIcon20FireCircleFillRed__WEBPACK_IMPORTED_MODULE_42__.getIcon20FireCircleFillRed)().icon;case"clips":return(0,_icons_desktop_getIcon20ClipCircleFillViolet__WEBPACK_IMPORTED_MODULE_43__.getIcon20ClipCircleFillViolet)().icon;case"friends":return(0,_icons_desktop_getIcon20AddCircleFillGreen__WEBPACK_IMPORTED_MODULE_44__.getIcon20AddCircleFillGreen)().icon;case"suggested_post_published":return(0,_icons_desktop_getIcon20CheckCircleFillYellow__WEBPACK_IMPORTED_MODULE_45__.getIcon20CheckCircleFillYellow)().icon;case"like":return(0,_icons_desktop_getIcon20LikeCircleFillRed__WEBPACK_IMPORTED_MODULE_46__.getIcon20LikeCircleFillRed)().icon;case"podcast":return(0,_icons_desktop_getIcon20PodcastCircleFillRed__WEBPACK_IMPORTED_MODULE_47__.getIcon20PodcastCircleFillRed)().icon;case"voting":return(0,_icons_desktop_getIcon20PollCircleFillGreen__WEBPACK_IMPORTED_MODULE_48__.getIcon20PollCircleFillGreen)().icon;case"live":return(0,_icons_desktop_getIcon20VideoCameraCircleFillRed__WEBPACK_IMPORTED_MODULE_49__.getIcon20VideoCameraCircleFillRed)().icon;case"video_playlists":return(0,_icons_desktop_getIcon20StripCircleFillRed__WEBPACK_IMPORTED_MODULE_50__.getIcon20StripCircleFillRed)().icon;case"wall":return(0,_icons_desktop_getIcon20EditCircleFillBlue__WEBPACK_IMPORTED_MODULE_51__.getIcon20EditCircleFillBlue)().icon;case"follow":return(0,_icons_desktop_getIcon20AddCircleFillBlue__WEBPACK_IMPORTED_MODULE_52__.getIcon20AddCircleFillBlue)().icon;case"invite_group":return(0,_icons_desktop_getIcon20MailCircleFillBlue__WEBPACK_IMPORTED_MODULE_53__.getIcon20MailCircleFillBlue)().icon;case"question":case"story_question":return(0,_icons_desktop_getIcon20QuestionCircleFillViolet__WEBPACK_IMPORTED_MODULE_54__.getIcon20QuestionCircleFillViolet)().icon;case"friend_found":return(0,_icons_desktop_getIcon20UserCircleFillBlue__WEBPACK_IMPORTED_MODULE_55__.getIcon20UserCircleFillBlue)().icon;case"transfer_votes":return(0,_icons_desktop_getIcon20VotesCircleFillBlue__WEBPACK_IMPORTED_MODULE_56__.getIcon20VotesCircleFillBlue)().icon;case"reply":return(0,_icons_desktop_getIcon20ReplyCircleFillGreen__WEBPACK_IMPORTED_MODULE_57__.getIcon20ReplyCircleFillGreen)().icon;case"story_reply":return(0,_icons_desktop_getIcon20StoryReplyCircleFillViolet__WEBPACK_IMPORTED_MODULE_58__.getIcon20StoryReplyCircleFillViolet)().icon;case"story_question_answer":return(0,_icons_desktop_getIcon20QuestionCircleFillGreen__WEBPACK_IMPORTED_MODULE_59__.getIcon20QuestionCircleFillGreen)().icon;case"story_music":return(0,_icons_desktop_getIcon20SongCircleFillViolet__WEBPACK_IMPORTED_MODULE_60__.getIcon20SongCircleFillViolet)().icon;case"photo_tag":return(0,_icons_desktop_getIcon20CameraCircleFillGreen__WEBPACK_IMPORTED_MODULE_61__.getIcon20CameraCircleFillGreen)().icon;case"new_post":return(0,_icons_desktop_getIcon20RssCircleFillYellow__WEBPACK_IMPORTED_MODULE_62__.getIcon20RssCircleFillYellow)().icon;case"private_post":return(0,_icons_desktop_getIcon20RssCircleFillBlack__WEBPACK_IMPORTED_MODULE_63__.getIcon20RssCircleFillBlack)().icon;case"gift":case"recent":return(0,_icons_desktop_getIcon20GiftCircleFillYellow__WEBPACK_IMPORTED_MODULE_64__.getIcon20GiftCircleFillYellow)().icon;case"birthday":return(0,_icons_desktop_getIcon20GiftCircleFillRed__WEBPACK_IMPORTED_MODULE_65__.getIcon20GiftCircleFillRed)().icon;case"birthday_cake":return(0,_icons_desktop_getIcon20CakeCircleFillPurple__WEBPACK_IMPORTED_MODULE_66__.getIcon20CakeCircleFillPurple)().icon;case"advice":return(0,_icons_desktop_getIcon20StoryFillCircleYellow__WEBPACK_IMPORTED_MODULE_67__.getIcon20StoryFillCircleYellow)().icon;case"invite_app":return(0,_icons_desktop_getIcon20GameCircleFillBlue__WEBPACK_IMPORTED_MODULE_68__.getIcon20GameCircleFillBlue)().icon;case"mention":return(0,_icons_desktop_getIcon20MentionCircleFillBlue__WEBPACK_IMPORTED_MODULE_69__.getIcon20MentionCircleFillBlue)().icon;case"event_unify":return(0,_icons_desktop_getIcon20CalendarCircleFillRed__WEBPACK_IMPORTED_MODULE_70__.getIcon20CalendarCircleFillRed)().icon;case"message_request":return(0,_icons_desktop_getIcon20MessageCircleFillBlue__WEBPACK_IMPORTED_MODULE_71__.getIcon20MessageCircleFillBlue)().icon;case"comment":return(0,_icons_desktop_getIcon20CommentCircleFillGreen__WEBPACK_IMPORTED_MODULE_72__.getIcon20CommentCircleFillGreen)().icon;case"discussions":return(0,_icons_desktop_getIcon20DiscussionsCircleFillBlue__WEBPACK_IMPORTED_MODULE_73__.getIcon20DiscussionsCircleFillBlue)().icon;case"_delivery":case"market_order_status_delivering":return(0,_icons_desktop_getIcon20BoxCircleFillBlue__WEBPACK_IMPORTED_MODULE_74__.getIcon20BoxCircleFillBlue)().icon;case"transfer_money":case"money_complete":return(0,_icons_desktop_getIcon20MoneyTransferCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_75__.getIcon20MoneyTransferCircleFillTurquoise)().icon;case"money_decline":return(0,_icons_desktop_getIcon20MoneyTransferCircleFillRed__WEBPACK_IMPORTED_MODULE_76__.getIcon20MoneyTransferCircleFillRed)().icon;case"transfer_money_cancelled":case"invite_group_fired":case"ads_fail":case"market_order_status_canceled":return(0,_icons_desktop_getIcon20CancelCircleFillRed__WEBPACK_IMPORTED_MODULE_77__.getIcon20CancelCircleFillRed)().icon;case"request_money":return(0,_icons_desktop_getIcon20MoneyRequestCircleFillBlue__WEBPACK_IMPORTED_MODULE_78__.getIcon20MoneyRequestCircleFillBlue)().icon;case"ads_ok":return(0,_icons_desktop_getIcon20CheckCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_79__.getIcon20CheckCircleFillTurquoise)().icon;case"friend_accepted":case"approved":case"market_order_status_completed":case"invite_group_accepted":return(0,_icons_desktop_getIcon20CheckCircleFillGreen__WEBPACK_IMPORTED_MODULE_80__.getIcon20CheckCircleFillGreen)().icon;case"services":return(0,_icons_desktop_getIcon20ServicesCircleFillBlue__WEBPACK_IMPORTED_MODULE_81__.getIcon20ServicesCircleFillBlue)().icon;case"service_installation":return(0,_icons_desktop_getIcon20ServicesCircleFillYellow__WEBPACK_IMPORTED_MODULE_82__.getIcon20ServicesCircleFillYellow)().icon;case"service_recommend":return(0,_icons_desktop_getIcon20ThumbsUpCircleFillGreen__WEBPACK_IMPORTED_MODULE_83__.getIcon20ThumbsUpCircleFillGreen)().icon;case"market_order_status_collecting":return(0,_icons_desktop_getIcon20RecentCircleFillYellow__WEBPACK_IMPORTED_MODULE_84__.getIcon20RecentCircleFillYellow)().icon;case"engagement_stats":return(0,_icons_desktop_getIcon20StatisticCircleFillBlue__WEBPACK_IMPORTED_MODULE_85__.getIcon20StatisticCircleFillBlue)().icon;case"donut":return(0,_icons_desktop_getIcon20DonateCircleFillYellow__WEBPACK_IMPORTED_MODULE_86__.getIcon20DonateCircleFillYellow)().icon;case"text_live":return(0,_icons_desktop_getIcon20TextLiveCircleFillGreen__WEBPACK_IMPORTED_MODULE_87__.getIcon20TextLiveCircleFillGreen)().icon;case"market_native_shop_release":return(0,_icons_desktop_getIcon20LightbulbCircleFillYellow__WEBPACK_IMPORTED_MODULE_88__.getIcon20LightbulbCircleFillYellow)().icon;case"message_reminders":return(0,_icons_desktop_getIcon20MessageUnreadCircleFillRed__WEBPACK_IMPORTED_MODULE_89__.getIcon20MessageUnreadCircleFillRed)().icon;case"feed_promo":return(0,_icons_desktop_getIcon20AdvertisingCircleFillRed__WEBPACK_IMPORTED_MODULE_90__.getIcon20AdvertisingCircleFillRed)().icon;case"group":return(0,_icons_desktop_getIcon20Users3CircleFillBlue__WEBPACK_IMPORTED_MODULE_91__.getIcon20Users3CircleFillBlue)().icon;default:return null}}function showEventAddPhoto(e){var t="";return e.add_photo&&(t=`<div class="notifier_add_image_wrap"><img src="${e.add_photo}" class="notifier_add_image"></div>`),t}function setHooksForLoadingCalls(e){var t;if(!1!==(null==(t=window.Calls)?void 0:t.initialized)){var i={},_=t=>function(){for(var i=arguments.length,_=new Array(i),o=0;o<i;o++)_[o]=arguments[o];return loadCallsModule().then((()=>{var t;return null==(t=window.Calls)||null==t.init?void 0:t.init(e)})).then((()=>{var e,i;return null==(e=(i=window.Calls)[t])?void 0:e.call(i,..._)}))};i.call=_("call"),i.startGroupCall=_("startGroupCall"),i.startCall=_("startCall"),i.acceptCall=_("acceptCall"),i.joinCallByLink=_("joinCallByLink"),i.showJoinPopup=_("showJoinPopup"),i.showCallByNamePopup=_("showCallByNamePopup"),i.showCreateCallByLinkPopup=_("showCreateCallByLinkPopup"),i.showPlanCalendarEventPopup=_("showPlanCalendarEventPopup"),i.showStartCallModal=_("showStartCallModal"),i.showHistoryScreen=_("showHistoryScreen"),i.initArgs=e,window.Calls=i;var o=window.Notifier.getLpInstance();o&&o.onData((function t(){var i;if(null==(i=window.Calls)?void 0:i.initialized)o.offData(t);else{for(var _=arguments.length,a=new Array(_),r=0;r<_;r++)a[r]=arguments[r];a.forEach((i=>{if(i.type===_vkontakte_internal_calls_constants__WEBPACK_IMPORTED_MODULE_37__.INCOMING_CALL)return o.offData(t),loadCallsModule().then((()=>{var t;return null==(t=window.Calls)?void 0:t.init(e)})).then((()=>window.Calls.handleEvent(i)))}))}}))}else window.Calls.init(e)}function loadVKUIModule(){return new Promise((e=>window.stManager.add(["vkui.css"],(()=>e()))))}function loadCallsModule(){return new Promise((e=>{window.stManager.add([window.jsc("web/calls.js"),"vkui.css","calls.css"],(()=>{e()}))}))}function loadReforgedFastchatModule(){var e=ls.get("stickers_keywords"),t=e&&e.time?Math.floor(e.time/1e3):0;return ajax.post("al_im.php",{act:"a_get_fast_chat",cache_time:t},{onDone:e=>{e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations)},onFail:()=>!0}),window.stManager.add([window.jsc("web/ui_media_selector.js"),"vkui.css","ui_media_selector.css",window.jsc("web/emoji.js")]).then((()=>Promise.all([__webpack_require__.e(24509),__webpack_require__.e(40885),__webpack_require__.e(56990),__webpack_require__.e(49685),__webpack_require__.e(38288),__webpack_require__.e(68592),__webpack_require__.e(91454),__webpack_require__.e(26461),__webpack_require__.e(83040),__webpack_require__.e(49154),__webpack_require__.e(97474),__webpack_require__.e(90729),__webpack_require__.e(79542),__webpack_require__.e(70306),__webpack_require__.e(68069),__webpack_require__.e(87595),__webpack_require__.e(23299),__webpack_require__.e(99138),__webpack_require__.e(8719),__webpack_require__.e(85780)]).then(__webpack_require__.bind(__webpack_require__,67180))))}window.curNotifier||(window.curNotifier={addQueues:{},recvClbks:{},recvData:{},onConnectionId:[]}),window.Notifier={debug:!1,init:function(e){var t;if(!window.curNotifier||!curNotifier.connection_id){if(Notifier.notificationsGc(),window.curNotifier=_extends({},e,{q_events:[],q_prior_events:[],q_shown:[],q_closed:[],q_max:3,q_idle_max:5,negotiations:{},currentIm:{},uiNotifications:[],browser_shown:{},done_events:{},addQueues:curNotifier.addQueues||{},recvClbks:curNotifier.recvClbks||{},recvData:curNotifier.recvData||{},error_timeout:errorTimeout.initialValue,request_timeout:1e3,sound:new _web_notifier_sound__WEBPACK_IMPORTED_MODULE_39__.Sound("mp3/bb1"),sound_im:new _web_notifier_sound__WEBPACK_IMPORTED_MODULE_39__.Sound("mp3/bb2"),sound_im_current:new _web_notifier_sound__WEBPACK_IMPORTED_MODULE_39__.Sound("mp3/bb3"),onConnectionId:[],showDoneBoxLastId:-1}),!this.initFrameTransport())return!1;this.initIdleMan(),this.initCommunityQueues(),IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_23__.lpSingletonOnTabInitialLoaded)(),(curNotifier.cont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("notifiers_wrap"))||bodyNode.insertBefore(curNotifier.cont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ce)("div",{id:"notifiers_wrap",className:"fixed"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("page_wrap"));if(loadVKUIModule(),!(null==(t=window.Calls)?void 0:t.initialized)&&!e.callsIsForbidden){var i,_={callsCredentials:e.callsCredentials,imHash:e.imHash,participantLimit:e.participantLimit,callsOkStaging:e.callsOkStaging,pushToTalkEnabled:e.callsPushToTalkEnabled,toggles:{debugLog:e.callsLogging,incomingCall:e.CallsIncomingCall,allowBanParticipant:e.callsAllowBanParticipant,showFeedbackScreen:e.callsFeedbackScreenEnabled,enableVideoSlots:e.callsVideoSlotsEnabled,videoSlotsCount:e.videoSlotsCount,browserWarnings:e.browserWarnings,allowCallByName:e.callsAllowCallByName,enableScreenTrack:e.callsEnableScreenTrack,enableProducerScreenTrack:e.callsEnableProducerScreenTrack,allowWaitingHall:e.callsAllowWaitingHall,allowPushToTalk:e.callsAllowPushToTalk,badNetwork:e.callsBadNetwork,badNetworkP2P:e.callsBadNetworkP2P,desktopAppNotification:e.callsDesktopAppNotification,lazyLoading:e.callsLazyLoading,enableDomainBender:e.callsEnableDomainBender,enableMultipleDevices:e.callsEnableMultipleDevices,enableParticipantListChunk:e.callsEnableParticipantListChunk,enableServerAudioRed:e.callsEnableServerAudioRed,enableP2PAudioRed:e.callsEnableP2PAudioRed,enableTranslationSplit:e.callsEnableTranslationSplit,enableNavChangeCallCollapse:e.callsEnableNavChangeCallCollapse,enableCustomScreenSharePacketSize:e.callsEnableCustomScreenSharePacketSize,customScreenSharePacketSize:e.callsCustomScreenSharePacketSize},onError:e=>{var t=e.msg;return t&&(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_36__.logError)(t),t&&(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_29__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_11__.getLang)("global_error"),t)},onBeforeCallStart:()=>{Notifier.pauseGlobalMedia()},onAfterCallFinish:()=>{Notifier.resumeGlobalMedia()},tabIsMaster:()=>Notifier.tabIsMaster(),isFriend:e=>!!(window.curFastChat&&window.curFastChat.friends&&window.curFastChat.friends[e+"_"])},o=/(firefox)\/(\d+)\.(\d+)/.test(navigator.userAgent.toLowerCase());if(e.callsLazyLoading&&!o)setHooksForLoadingCalls(_);else window.Calls=null!=(i=window.Calls)?i:{},window.Calls.initArgs=_,window.requestIdleCallback((()=>{loadCallsModule().then((()=>{var e;null==(e=window.Calls)||null==e.init||e.init(_)}))}))}if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter")){var a=Notifier.getLpInstance();a&&a.onData(Notifier.handleUnreadCountChange)}}},handleUnreadCountChange(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];(0,_web_messenger_helpers_events__WEBPACK_IMPORTED_MODULE_35__.compactCounterEvents)(t).forEach((e=>{if(e.type===_shared_im_longpoll_events__WEBPACK_IMPORTED_MODULE_34__.UNREAD_COUNT){var t=e.showOnlyNotMuted,i=e.countNotMuted,_=e.count,o=t?i:_;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("msg",o,"","",i>0)}}))},initCommunityQueues:function(e){var t=ls.get("im_m_comms_key"),i=t&&t.split?t.split(";"):[];if("empty"===i[0]&&i[1]&&Date.now()-i[1]<6e4?t="empty":"empty"===i[0]&&(t=!1),t)return Notifier.proccessCommunityQueues(t,e||0);ajax.post("al_im.php",{act:"a_get_comms_key"},{onDone:function(t){"empty"===t?t+=";"+Date.now():Notifier.proccessCommunityQueues(t,e||0),ls.set("im_m_comms_key",t)},onFail:function(){return!0}})},notificationsGc:function(){curNotifier.uiGcTo=setTimeout((function(){for(var e=curNotifier.uiNotifications,t=[],i=0;i<e.length;i++){var _=e[i];Date.now()-_[1]>1e4?_[0].close():t.push(_)}curNotifier.uiNotifications=t,Notifier.notificationsGc()}),5e3)},resetCommConnection:function(e){var t=ls.get("im_m_comms_key");t&&delete curNotifier.addQueues[t.queue],ls.set("im_m_comms_key",!1),Notifier.initCommunityQueues(e||0)},proccessCommunityQueues:function(e,t){if("empty"===e||!e)return!1;Notifier.addKey(e,(function(e,i){if(i.failed)++t<50&&setTimeout(Notifier.resetCommConnection.pbind(t),100);else{(e=ls.get("im_m_comms_key"))&&(e.ts=i.ts,ls.set("im_m_comms_key",e));var _=i.events;_&&_.map((function(e){return e.split("<!>")})).forEach((function(e){if("update_cnt"===e[1]){var t=e[5],i=e[4];(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("mgid"+t,i)}}))}}))},destroy:function(){if(Notifier.hideAllEvents(),curNotifier.idle_manager.stop(),curNotifier.uiGcTo&&clearTimeout(curNotifier.uiGcTo),curNotifier={},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)("notifiers_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)("queue_transport_wrap"),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter")){var e=Notifier.getLpInstance();e&&e.offData(Notifier.handleUnreadCountChange)}},reinit:function(){ajax.post("notifier.php?act=a_get_params",{},{onDone:function(e){e?(errorTimeout.reset(),this.init(e)):(setTimeout(this.reinit.bind(this),1e3*errorTimeout.get()),errorTimeout.increaseMore())}.bind(this),onFail:function(){return setTimeout(this.reinit.bind(this),1e3*errorTimeout.get()),errorTimeout.increaseMore(),!0}.bind(this)})},standby:function(e){this.destroy(),e&&errorTimeout.set(e),setTimeout(this.reinit.bind(this),1e3*errorTimeout.get())},freezeEvents:function(){curNotifier.frozen=!0,curNotifier.unfreezeAfterTooltipHide=!1,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.q_shown,(function(){clearTimeout(this.fadeTO),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.getStyle)(this.baloonEl,"opacity")<1&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_14__.animate)(this.baloonEl,{opacity:1},100)}))},unfreezeEvents:function(){curNotifier.tooltipShown?curNotifier.unfreezeAfterTooltipHide=!0:(curNotifier.frozen=!1,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.q_shown,(function(e,t){t.timeoutConf?t.fadeTO=setTimeout(t.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()?t.timeoutConf.unfreeze_am:t.timeoutConf.unfreeze):t.fadeTO=setTimeout(t.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()?3e4:5e3)})))},getTransportWrap:function(){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("queue_transport_wrap")||utilsNode.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ce)("div",{id:"queue_transport_wrap"}))},setFocus:function(e){var t=(e?"1":"0")+curNotifier.instance_id;"frame"===curNotifier.transport&&(Notifier.lcSend("focus",{instance_id:t}),this.onInstanceFocus(t))},initIdleMan:function(){curNotifier.idle_manager&&curNotifier.idle_manager.started||(curNotifier.idle_manager=new _shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_20__.default({onIdleCb:function(){Notifier.freezeEvents(),Notifier.setFocus(0),cur.onIdle&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(cur.onIdle,(function(e,t){t()}))},onUnIdleCb:function(){Notifier.unfreezeEvents(),Notifier.setFocus(1),cur.onUnidle&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(cur.onUnidle,(function(e,t){t()})),FastChat&&FastChat.onUnidle(),vk.spentLastSendTS=Date.now()},id:"window",element:document,focusElement:window}),curNotifier.idle_manager.start())},initFrameTransport:function(){if(!ls.checkVersion()||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__.browser.msie8||!("onmessage"in window)&&!("postMessage"in window))return!1;for(var e in curNotifier.connection_id="queue_connection_"+curNotifier.queue_id,curNotifier.lc_prev_value="",curNotifier.is_server=!1,curNotifier.lp_connected=!1,curNotifier.transport="frame",errorTimeout.reset(),this.lcInit(),curNotifier.onConnectionId)curNotifier.onConnectionId[e]();return curNotifier.onConnectionId=[],!0},tabIsMaster:function(){return!(!window.curNotifier||!window.curNotifier.is_server)},tabIsIdle:function(){return!!(curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)},onActivated:function(){curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?curNotifier.idle_manager.is_idle=!1:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||Notifier.setFocus(1),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.removeEvent)(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionInit:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionFailed:function(){},onRelogin:function(){setTimeout((function(){Notifier.standby()}),0)},onMessage:function onMessage(msg){if(!curNotifier.focus_instance||curNotifier.focus_instance==curNotifier.instance_id)try{var events=eval("("+msg+")");Notifier.pushEvents(events)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)(e.message)}},onInstanceFocus:function(e){var t=e.charAt(0);e=e.substr(1),"1"==t?(curNotifier.focus_instance=e,e!=curNotifier.instance_id&&(curNotifier.idle_manager.is_idle||curNotifier.idle_manager.idle(),Notifier.hideAllEvents())):curNotifier.focus_instance==e&&(curNotifier.focus_instance="")},onInstanceServer:function(e){curNotifier.is_server!==!!e&&(curNotifier.is_server=!!e,IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_23__.lpSingletonSyncWithNotifier)(),window.reforgedME&&window.reforgedME.engine&&window.reforgedME.engine.switch(e?"master":"slave"))},getLpInstance:()=>IS_SSE_ENABLED?(window.sseConnect||(window.sseConnect=new _web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_24__.DEPRECATEDLongpollAdapter(window.vk.lpConfig.key,window.vk.lpConfig.ts,window.vk.lpConfig.sseUrl,window.vk.id)),window.sseConnect):(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_23__.lpSingletonGetInstance)(),getEventQueueInstance(){if(!window.imEventQueue){var e="im_event_queue";window.imEventQueue=new _shared_im_EventQueue__WEBPACK_IMPORTED_MODULE_32__.EventQueue({getQueue:()=>{var t=()=>(localStorage.removeItem(e),(0,_shared_im_request__WEBPACK_IMPORTED_MODULE_31__.post)("al_im.php",{act:"a_messenger_queue_subscribe"}).then((e=>e[0])).then((t=>(localStorage.setItem(e,JSON.stringify(t)),t))));return Notifier.tabIsMaster()?t():new Promise(((i,_)=>{var o=()=>{if(Notifier.tabIsMaster())return t().then(i).catch(_);var a=localStorage.getItem(e);if(!a)return setTimeout(o,3e3);try{i(JSON.parse(a))}catch(e){_(e)}};o()}))},registerQueue:(t,i)=>{Notifier.addKey(t,((t,_)=>{!(!_.failed&&!_.err)&&Notifier.tabIsMaster()&&localStorage.removeItem(e),i(t,_)}))}})}return window.imEventQueue},pushEvents:function(e,t){var i=0;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(e,(function(e,_){i|=Notifier.pushEvent(_,t)})),i&&!ls.get("sound_notify_off")&&curNotifier.is_server&&!1&i&&curNotifier.sound.play()},pushEvent:function pushEvent(ev,cnt){var _window$Emoji,_window$Emoji2;if("nop"!==ev){if("string"==typeof ev)try{ev=JSON.parse(ev)}catch(e){return void(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,ev)}ev.timeoutConf={default:ev.timeout?ev.timeout:NOTIFICATION_FADE_TIMEOUT,default_am:ev.timeout?5*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE,unfreeze:ev.timeout?.7*ev.timeout:NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE,unfreeze_am:ev.timeout?4.4*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE};var push=cnt?0:1,push_prioritized=!1;if(ev.version!==curNotifier.version&&-1!==ev.version)return(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("Notifier old version: "+ev.version+" !== "+curNotifier.version),!1;if("update_cnt"===ev.type){if(ev.add&&ev.add.section){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter")&&"msg"===ev.add.section_id)return 0;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)(ev.add.section_id,ev.add.count,ev.add.section_link,ev.add.section_add)}return 0}if(!curNotifier.done_events[ev.id]){switch(curNotifier.done_events[ev.id]=1,void 0!==ev.top_count&&-1!==ev.top_count&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("ntf",ev.top_count),ev.type){case"video_process_ready":if(ev.add.video_raw&&window.Video&&Video.isVideoPlayerOpen(ev.add.video_raw))return;if(ev.add&&window.Video&&Video.isVideoPlayerOpen(ev.add))return;break;case"mail":if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter"))break;ev.add&&null!==ev.add.count&&void 0!==ev.add.count&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("msg",ev.add.count);break;case"friend_request":ev.add.fr_count?(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("fr",ev.add.fr_count):(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("fr",ev.add);break;case"friend_request_counter":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("fr",ev.add.fr_count),push=0;break;case"ach_achieved":ev.add.cnt&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("ach",ev.add.cnt);break;case"ach_achieved_upd":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("ach",ev.add),push=0;break;case"group_update_addresses":window.opener&&window.opener.postMessage(ev.add,window.opener.origin),push=0;break;case"bt_upd":if(ev.add.cnt){(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("bt",ev.add.cnt);var bt=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("bt_tab_updates");bt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.geByClass1)("ui_tab_count",bt),ev.add.cnt>0?ev.add.cnt:"")}break;case"bt_upd_upd":ev.add&&ev.add.section&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("bt",ev.add.count,ev.add.section,ev.add.prefix),push=0;var bt=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("bt_tab_updates");bt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.geByClass1)("ui_tab_count",bt),ev.add>0?ev.add:"");break;case"push_settings":push=0;var muted=JSON.parse(ev.add);curNotifier.mutedPeers=curNotifier.mutedPeers.filter((function(e){return e!==muted.peer_id})),0!==muted.disabled_until&&curNotifier.mutedPeers.push(muted.peer_id);break;case"mail_cnt":if(push=0,(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter"))break;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("msg",ev.add);break;case"clear_notify":TopNotifier&&TopNotifier.invalidate(),Notifier.hideAllEvents(),push=0;break;case"support_reply":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.toggle)("l_spr",ev.add>0);break;case"support_cnt":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.toggle)("l_spr",ev.add>0),push=0;break;case"balance_changed":parseInt(ev.add.balance)?(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_13__.updateMoney)(parseInt(ev.add.balance)):parseInt(ev.add)&&(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_13__.updateMoney)(parseInt(ev.add));break;case"gift_sent":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)("left_block10_0");var left_block=ev.add;if(left_block){var leftBlocksElem=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("left_blocks"),left_unpaid_gifts=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.se)(left_block);leftBlocksElem&&(leftBlocksElem.firstChild?leftBlocksElem.insertBefore(left_unpaid_gifts,leftBlocksElem.firstChild):leftBlocksElem.appendChild(left_unpaid_gifts))}break;case"notify_tt":case"login_attempt":if(ev.add.text&&ev.add.key){var evalText=`(${ev.add})`;try{ev.add=eval(evalText),TopNotifier.showTooltip(ev.add.text,ev.add.key)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,evalText)}push=0}break;case"reload_stickers":window.emojiStickers=null,null==(_window$Emoji=window.Emoji)||_window$Emoji.resetStickersCache();case"reload_stickers_keywords":window.stickersKeywordsData=null,ls.remove("stickers_keywords"),null==(_window$Emoji2=window.Emoji)||_window$Emoji2.updateTabs(),push=0;break;case"any_counter":if(push=0,(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_longpoll_unread_counter")&&"msg"===ev.add.section_id)break;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_10__.handlePageCount)(ev.add.section_id,ev.add.count,ev.add.link,ev.add.add);break;case"done_box":case"done_box_full":push=0,push_prioritized=!0;break;case _web_market_HappySanta__WEBPACK_IMPORTED_MODULE_30__.MARKET_NOTIFY_ID__HS_MIGRATION_STATE:push=0,(0,_web_market_HappySanta__WEBPACK_IMPORTED_MODULE_30__.onHappySantaMarketMigrationStateChanged)(ev)}if("mail"===ev.type&&(push=this.sendMailNotification(ev)),ev.add&&ev.add.tooltip_text){var html='<div class="notify_tt_wrap">'+(ev.author_photo?`<img class="notify_tt_img" src="${ev.author_photo}" />`:'<div class="notify_tt_thumb"></div>')+'<h4 class="notify_tt_text">'+ev.add.tooltip_text+"</h4></div>";TopNotifier.showTooltip(html,0),push=0}return 1&push&&(curNotifier.q_events.push(ev),curNotifier.q_events.length>30&&curNotifier.q_events.splice(0,curNotifier.q_events.length-30),this.checkEvents()),push_prioritized&&(curNotifier.q_prior_events.push(ev),curNotifier.q_prior_events.length>5&&curNotifier.q_prior_events.splice(0,curNotifier.q_prior_events.length-5),this.checkEvents()),push}}},isActive:function(){return window.curNotifier&&curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle},sendImProxy:function(e){e.text=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.winToUtf)(e.text),curNotifier.browser_shown[e.id]||(curNotifier.browser_shown[e.id]=!0,Notifier.trySendBrowserNotification(e,!0),setTimeout((function(){curNotifier.browser_shown[e.id]=void 0}),2e3))},shouldShowNotification:function(e){return"im"!==cur.module&&!FastChat.isChatOpen(e.author_id)},sendSimpleNotification:function(e){return Notifier.playSound(e),Notifier.shouldShowNotification(e)?3:0},sendBrowserNotification:function(e){"im"!==cur.module?Notifier.negotiate({message:"send_im_notification",onSuccess:function(t){Notifier.lcSend("negotiate_back",{token:t.msg,ev:e})},onFail:function(){Notifier.showBrowserNotification(e)}}):(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showBrowserNotification(e))},shouldPlaySound:function(e){var t=e.add&&e.add.no_sound;return!ls.get("sound_notify_off")&&Notifier.shouldDisturb(e)&&!t},shouldDisturb:e=>!cur.noDisturbMode&&(cur.focused!=e.author_id&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.inArray)(e.author_id,cur.mutedPeers)&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.inArray)(e.author_id,curNotifier.mutedPeers)),shouldPlayCurrentSound:function(e){return!ls.get("sound_notify_off")&&cur.focused==e.author_id&&(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.inArray)(e.author_id,cur.mutedPeers)},playSound:function(e){curNotifier.sound_im&&curNotifier.sound_im.play&&Notifier.shouldPlaySound(e)?e.author_id==cur.peer&&(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()?curNotifier.sound_im_current.play():curNotifier.sound_im.play():Notifier.shouldPlayCurrentSound(e)&&curNotifier.sound_im_current&&curNotifier.sound_im_current.play()},trySendBrowserNotification:function(e,t){Notifier.negotiate({message:"who_is_active",msg:e.author_id,onFail:function(){!Notifier.canNotifyUi()||cur.peer==e.author_id&&Notifier.isActive()?(t||(Notifier.lcSend("show_notification",e),Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0)),Notifier.playSound(e)):Notifier.sendBrowserNotification(e)}})},showBrowserNotification:function(e){Notifier.showEventUi(e),Notifier.playSound(e)},proxyIm:function(e){if(this.isActive())return this.playSound(e),void(Notifier.canNotifyUi()&&cur.peer!==e.author_id&&Notifier.shouldDisturb(e)&&(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showEventUi(e)));curNotifier.is_server?(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",this.sendImProxy(e)):curNotifier.is_server||this.lcSend("message_from_im",e)},sendMailNotification:function(e){if(e.add.is_call)return 0;if("im"===cur.module?e.onclick="IMBRIDGE.activateTab('"+e.author_id+"');":(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_fastchat_reforged")?e.onclick=`window.reforgedME && window.reforgedME.selectPeer && window.reforgedME.selectPeer(${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(e.author_id)}, 'notifications');`:e.onclick="FastChat.selectPeer('"+e.author_id+"');",this.isActive()&&Notifier.canNotifyUi())this.playSound(e),this.shouldDisturb(e)&&cur.peer!=e.author_id&&this.showEventUi(e);else{if(this.isActive()&&this.shouldDisturb(e))return this.sendSimpleNotification(e);curNotifier.is_server&&this.shouldDisturb(e)&&this.trySendBrowserNotification(e)}return 0},checkEvents:function(){var e;window.curNotifier&&curNotifier.idle_manager&&((!curNotifier.q_events.length||curNotifier.q_shown.length>=(curNotifier.idle_manager.is_idle?curNotifier.q_idle_max:curNotifier.q_max))&&!curNotifier.q_prior_events.length||!curNotifier.idle_manager.is_idle&&curNotifier.frozen||cur.noDisturbMode||(e=curNotifier.q_prior_events.length?curNotifier.q_prior_events.shift():curNotifier.q_events.shift())&&this.showEvent(e))},showEvent:function showEvent(ev,force){"mail"!==ev.type&&Math.random()<.1&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_15__.statlogsValueEvent)("feed_top_notify_popup",1,"show",ev.type),curNotifier.q_shown.push(ev);var thumbEl=showEventThumb(ev),addPhoto=showEventAddPhoto(ev);ev.baloonWrapEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ce)("div",{className:"notifier_baloon_wrap",innerHTML:`\n        <div class="notifier_baloon notifier_type_${ev.type}">\n          <div class="notifier_baloon_head clear_fix">\n            <a class="notifier_close_wrap" role="link" title="${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_11__.getLang)("global_close")}" aria-label="${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_11__.getLang)("global_close")}"></a>\n            <h4 class="notifier_baloon_title">${ev.title||""}</h4>\n          </div>\n          <div class="notifier_baloon_body clear_fix">\n            ${thumbEl}\n            ${addPhoto}\n            <div class="notifier_baloon_msg wrapped">${ev.text||""}</div>\n          </div>\n        </div>`}),!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ge)("notifier_popup_icon_mask")&&ev.icon_type&&(utilsNode.appendChild(document.createElement("div")).outerHTML='<svg style="display: block;" width="0" height="0"><defs><clipPath id="notifier_popup_icon_mask"><path d="M48.254 34.197A9.958 9.958 0 0 0 42 32c-5.523 0-10 4.477-10 10 0 2.367.822 4.542 2.197 6.254A24.934 24.934 0 0 1 25 50C11.193 50 0 38.807 0 25S11.193 0 25 0s25 11.193 25 25c0 3.247-.62 6.35-1.746 9.197z"/></clipPath></defs></svg>'),ev.baloonEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.geByClass1)("notifier_baloon",ev.baloonWrapEl),ev.closeEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.geByClass1)("notifier_close_wrap",ev.baloonEl),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(ev.baloonEl,"mouseover mouseout",(function(e){ev.over="mouseover"==e.type,ev.over?Notifier.freezeEvents():Notifier.unfreezeEvents()})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(ev.baloonEl,"mousedown click",(function(event){event=event.originalEvent||event||window.event;var btn=event.which,nohide=!1;if(1==btn&&(event.ctrlKey||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__.browser.mac&&event.metaKey)&&(btn=2,_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__.browser.mac&&(nohide=!0)),"A"!=(event.target||event.srcElement).tagName){switch("mail"!==ev.type&&Math.random()<.1&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_15__.statlogsValueEvent)("feed_top_notify_popup",1,"click",ev.type),btn){case 1:try{eval(ev.onclick)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,ev.onclick)}Notifier.trackEvent("click",{event_id:ev.id}),ev.preventHideByClick||Notifier.hideEvent(ev);break;case 2:if(!ev.link)return;var wnd=window.open(ev.link,"_blank");try{wnd.blur(),window.focus()}catch(e){}Notifier.trackEvent("click",{event_id:ev.id}),nohide||Notifier.hideEvent(ev);break;case 3:if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_9__.browser.mozilla)return}return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.cancelEvent)(event)}})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(ev.baloonEl,"contextmenu",(function(e){return setTimeout((function(){Notifier.hideEvent(ev,!1,!1,!0)}),10),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.cancelEvent)(e)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(ev.closeEl,"mousedown click",(function(e){return Notifier.hideEvent(ev,!1,!1,!0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.cancelEvent)(e)})),ev.startFading=function(){ev.fading=(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_14__.animate)(ev.baloonEl,{opacity:0},1e3,Notifier.hideEvent.bind(Notifier).pbind(ev,!1)),ev.over&&ev.fading.stop()},curNotifier.cont.insertBefore(ev.baloonWrapEl,curNotifier.cont.firstChild);var h=ev.baloonWrapEl.offsetHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)(ev.baloonWrapEl),curNotifier.cont.appendChild(ev.baloonWrapEl),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.setStyle)(curNotifier.cont,{bottom:-h}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.setStyle)(ev.baloonWrapEl,{visibility:"visible"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_14__.animate)(curNotifier.cont,{bottom:0},200),curNotifier.idle_manager.is_idle&&!force||(ev.timeoutConf?ev.fadeTO=setTimeout(ev.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()?ev.timeoutConf.default_am:ev.timeoutConf.default):ev.fadeTO=setTimeout(ev.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_19__.hasAccessibilityMode)()?NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE:NOTIFICATION_FADE_TIMEOUT)),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(ev.tooltipHandler)&&ev.tooltipHandler(ev.baloonWrapEl,{ev,hide:()=>{Notifier.hideEvent(ev,!1,!1,!0)}})},trackEvent:function(e,t){ajax.post("al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.extend)({act:"a_feedback_track_event",event:e},t||{}))},canNotifyUi:function(){if(window.pushNotifier&&window.pushNotifier.loadEndpoint())return!1;var e="im_notify_flag",t=!ls.get("im_ui_notify_off")&&DesktopNotifications.supported()&&DesktopNotifications.checkPermissionNeeded()<=0;return!ls.get(e)&&t&&ls.set(e,1),t&&!cur.noDisturbMode},showEventUi:function showEventUi(ev){if(!this.canNotifyUi())return!1;var title,text;if("mail"===ev.type){var div=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ce)("div");div.innerHTML=ev.text,title=div.firstChild.textContent.trim(),text=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.stripHTML)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.replaceEntities)(ev.text.replace(/<br\/?>/g,"\n")).replace(/<span class='notifier_author_quote'.*<\/span>(.*?)/,"$1").replace(/<img.*?alt="(.*?)".*?>/gi,"$1")).replace(/&laquo;|&raquo;/gi,'"').trim()}else title=ev.title,text=ev.text;var notification=ev.uiNotification=DesktopNotifications.createNotification(ev.author_photo,title,text);return curNotifier.uiNotifications.push([notification,Date.now()]),notification.onclick=function(e){if(window.focus(),ev.onclick||("im"===cur.module?ev.onclick="IMBRIDGE.activateTab("+ev.author_id+");":(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_fastchat_reforged")?ev.onclick=`window.reforgedME && window.reforgedME.selectPeer && window.reforgedME.selectPeer(${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(ev.author_id)}, 'notifications');`:ev.onclick="FastChat.selectPeer('"+ev.author_id+"');"),"IM"===ev.onclick.substr(0,2)&&"im"!==cur.module)(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_fastchat_reforged")?window.reforgedME&&window.reforgedME.selectPeer&&window.reforgedME.selectPeer((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(ev.author_id),"notifications"):FastChat.selectPeer((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(ev.author_id));else try{eval(ev.onclick)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,ev.onclick)}Notifier.hideEvent(ev)},notification.onclose=function(){Notifier.hideEvent(ev,!0)},notification.show(),ev.closeTO=setTimeout(Notifier.hideEvent.bind(Notifier).pbind(ev),5e3),!0},hideEvent:function(e,t,i,_){clearTimeout(e.closeTO),clearTimeout(e.fadeTO),e.fading&&e.fading.stop();var o,a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.indexOf)(curNotifier.q_shown,e);-1!=a&&curNotifier.q_shown.splice(a,1),Notifier.unfreezeEvents(),t||(e.baloonWrapEl?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.cleanElems)(e.closeEl,e.baloonEl),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)(e.baloonWrapEl)):e.uiNotification&&e.uiNotification.cancel()),!0===_&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isArray)(curNotifier.q_closed)&&(curNotifier.q_closed.unshift((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)()),(o=curNotifier.q_closed.length)>3&&(curNotifier.q_closed.splice(3,o-3),o=3),3==o&&curNotifier.q_closed[0]-curNotifier.q_closed[2]<700&&Notifier.hideAllEvents()),-1!=_&&this.checkEvents(),"frame"!=curNotifier.transport||i||this.lcSend("hide",{event_id:e.id}),!0!==_&&curNotifier.idle_manager.is_idle||curNotifier.q_events.length||curNotifier.q_shown.length||ajax.post("notifier.php",{act:"a_clear_notifier"}),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(e.onHide)&&e.onHide()},hideAllEvents:function(){curNotifier.q_events=[],(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.clone)(curNotifier.q_shown),(function(){Notifier.hideEvent(this,!1,!0,-1)})),curNotifier.q_shown=[],curNotifier.q_closed=[]},onEventHide:function(e){e&&((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.q_shown,(function(){if(this.id==e)return Notifier.hideEvent(this,!1,!0),!1})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.q_events,(function(t){if(this.id==e)return curNotifier.q_events.splice(t,1),!1})))},lcInit:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_16__.addEvent)(window,"storage",this.lcOnStorage.bind(this)),this.lcStart()},lcStart:function(){Notifier.lcCheckServer()?this.lcServer():(this.lcSend("check"),clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=setTimeout(this.lcServer.bind(this).pbind(!0),500)),curNotifier.checkServerInt=setInterval(function(){curNotifier.is_server||(curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&curNotifier.idle_manager.getActiveTime()>ACTIVE_TAB_SWITCH_SERVER_TIMEOUT&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("this tab wants to become server"),ls.set(LC_SERVER_SWITCH_TO_ACTIVE_FLAG,!0),this.lcServer(!0)),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)()-curNotifier.last_succ>8e3&&Notifier.lcCheckServer()&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("timeout"),this.lcServer(!0)))}.bind(this),1e3+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.rand)(-100,100))),curNotifier.isServerBroadcastInt=setInterval(function(){curNotifier.is_server&&(Notifier.lcCheckServer()?this.lcSend("check_ok"):(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("no server from server broadcast"),this.lcNoServer()))}.bind(this),5e3+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.rand)(-100,100)));var e=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_25__.partConfigEnabled)("mail_fastchat_reforged");e||void 0!==curNotifier.fc&&window.stManager.add([window.jsc("web/emoji.js")],(function(){FastChat.init(curNotifier.fc)})),e&&loadReforgedFastchatModule().then((()=>{window.reforgedME.init({fcEnabled:e,silentModules:curNotifier.fastchatsSilentModules||[]})}))},lcStop:function(){clearInterval(curNotifier.isServerBroadcastInt),clearInterval(curNotifier.checkServerInt),clearTimeout(curNotifier.becomeServerTO)},lcSend:function(e,t){if(!curNotifier.connection_id)return curNotifier.onConnectionId&&curNotifier.onConnectionId.push(Notifier.lcSend.pbind(e,t)),!1;Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)(curNotifier.instance_id+": sending",e,t||"");var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.extend)({__client:curNotifier.instance_id,__act:e,__rnd:Math.random()},t||{});if(curNotifier.post_message)try{curNotifier.storage_frame.postMessage(curNotifier.connection_id+":"+JSON.stringify(i),curNotifier.storage_frame_origin)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)(e,e.message,e.stack)}else ls.set(curNotifier.connection_id,i)},lcRecv:function(e){if(e&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isEmpty)(e)&&e.__client!=curNotifier.instance_id){var t=e.__act;switch(delete e.__client,delete e.__act,delete e.__rnd,Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)(curNotifier.instance_id+": recv",t,e),t){case"new_server":curNotifier.last_succ=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)()+1e3;break;case"feed":curNotifier.timestamp=e.ts,curNotifier.key=e.key,Notifier.pushEvents(e.events,!e.full);break;case"addfeed":Notifier.addFeed(e[0],e[1]);break;case"new_key":(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("new key",e),curNotifier.timestamp=e.ts,curNotifier.key=e.key;break;case"new_addkey":var i=(0,_notifier_utils__WEBPACK_IMPORTED_MODULE_40__.subscriptionObjectStableId)(e),_=curNotifier.addQueues[i],o=!_&&curNotifier.is_server;_?_[0]=Date.now():curNotifier.addQueues[i]=[Date.now(),e.ts,e.key],o&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier));break;case"clear_addkeys":curNotifier.addQueues={};break;case"check_ok":curNotifier.last_succ=Date.now(),curNotifier.becomeServerTO&&(clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=!1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit());break;case"focus":Notifier.onInstanceFocus(e.instance_id);break;case"hide":Notifier.onEventHide(e.event_id);break;case"check_playlist":var a=ls.get("pad_playlist");a&&a.instance==curNotifier.instance_id&&ls.set("pad_pltime",(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)());break;case"who_is_active":Notifier.isActive()&&(_shared_ranges__WEBPACK_IMPORTED_MODULE_38__.Ranges.isChatOrChannelPeer((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(e.msg))&&"im"===cur.module||_shared_ranges__WEBPACK_IMPORTED_MODULE_38__.Ranges.isUserPeerTransitional((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.intval)(e.msg)))&&this.lcSend("negotiate_back",e);break;case"show_notification":Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0);break;case"send_im_notification":if("im"===cur.module){var r=Notifier.createNegotiationSlot({onSuccess:function(e){e.ev.onclick="IMBRIDGE.activateTab("+e.ev.author_id+");",Notifier.showBrowserNotification(e.ev)}});Notifier.lcSend("negotiate_back",{msg:r.token,token:e.token})}break;case"negotiate_back":Notifier.endNegotiation(e);break;case"recent_emoji_set":window.Emoji&&Emoji.setRecentEmojiList(e);break;case"lp_data":IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_23__.lpSingletonOnNotifierRecv)(e);break;default:if(curNotifier.recvClbks&&curNotifier.recvClbks[t])for(var n in curNotifier.recvClbks[t])curNotifier.recvClbks[t][n](e);else curNotifier.recvData[t]=e}if(curNotifier.is_server)switch(t){case"new_server":case"new_key":case"check_ok":Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("no server from lcRecv",t),Notifier.lcNoServer();break;case"check":this.lcSend("check_ok");break;case"message_from_im":Notifier.sendImProxy(e)}}},negotiate:function(e){e=this.createNegotiationSlot(e),this.lcSend(e.message,{token:e.token,msg:e.msg})},createNegotiationSlot:function(e){var t="negotiations_"+Date.now()+Math.round((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.rand)(0,1e4));return e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.extend)({timeout:3e3,token:t,msg:""},e),curNotifier.negotiations[e.token]={},curNotifier.negotiations[e.token].timer=setTimeout((function(){e.onFail&&e.onFail(),curNotifier.negotiations[e.token]&&(curNotifier.negotiations[e.token]=void 0)}),e.timeout),curNotifier.negotiations[e.token].success=e.onSuccess,e},endNegotiation:function(e){var t=e.token,i=curNotifier.negotiations[t];i&&(clearTimeout(i.timer),curNotifier.negotiations[t].success&&curNotifier.negotiations[t].success(e),curNotifier.negotiations[t]=void 0)},lcOnStorage:function(e){e=e||window.event,Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("onstorage",e.key,e.newValue,e);var t=e.key,i=e.newValue;if(i){if(t){if(e.key!=curNotifier.connection_id)return}else{if(t=curNotifier.connection_id,(i=localStorage.getItem(t))==curNotifier.lc_prev_value)return;curNotifier.lc_prev_value=i}this.lcRecv(JSON.parse(i)||{})}},lcServer:function(e){Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("becoming server"),this.lpInit(),this.lcSend("new_server"),Notifier.lcCheckServer(!0),Notifier.onInstanceServer(1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit()),this.lpStop(),e?this.lpReset(this.lpStart.bind(this)):this.lpStart()},lcNoServer:function(){this.lpStop(),curNotifier.is_server&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("not server now"),this.onInstanceServer(0))},lcCheckServer:function(e){var t,i="server_"+curNotifier.connection_id,_=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)();return!(!e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isArray)(t=ls.get(i))&&t[0]!=curNotifier.instance_id&&_-t[1]<8e3)&&(ls.set(i,[curNotifier.instance_id,_]),!0)},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.re)("queue_transport_frame"),Notifier.getTransportWrap().appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.ce)("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,curNotifier.lpInvalid?Notifier.lpGetKey():Notifier.lpCheck()},lpStop:function(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to),clearTimeout(curNotifier.lp_req_check_to)},lpCheck:function lpCheck(){if(curNotifier.lp_started&&!curNotifier.lpActive&&!curNotifier.lpInvalid){if(!curNotifier.lpMakeRequest)return clearTimeout(curNotifier.lp_check_to),void(curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3));if(!Notifier.lcCheckServer())return Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("no server from check"),void this.lcNoServer();var now=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)(),add_queues=[],completed=!1,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25};(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.addQueues,(function(e,t){if(now-t[0]>3e4&&!e.match(/nccts/))return(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("drop key",e,now-t[0]),void delete curNotifier.addQueues[e];add_queues.push(e),params.ts+="_"+t[1],params.key+=t[2]}));var onFail=function(){completed||(completed=!0,curNotifier.lpActive=!1,clearTimeout(curNotifier.lp_req_check_to),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*errorTimeout.get()+(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.irand)(1e3,1e4)),errorTimeout.increase())}.bind(this);curNotifier.lpActive=!0,clearTimeout(curNotifier.lp_req_check_to),curNotifier.lp_req_check_to=setTimeout(onFail,1e3*(params.wait+5)),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){if(!completed&&(completed=!0,curNotifier.lpActive=!1,curNotifier.lp_started)){this.lcSend("check_ok");try{var response=eval("("+text+")"),main_response=response,add_response,add_queue,busy=0;if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isArray)(response))for(main_response=response.shift();(add_response=response.shift())&&(add_queue=add_queues.shift(),add_queue);)2!=add_response.failed||4!=add_response.err?(this.lcSend("addfeed",[add_queue,add_response]),this.addFeed(add_queue,add_response),add_response.failed&&delete curNotifier.addQueues[add_queue]):(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("!!notifier key busy!! "+curNotifier.instance_id),busy|=1);else if(response.failed){for(;add_queue=add_queues.shift();)this.lcSend("addfeed",[add_queue,response]),this.addFeed(add_queue,response),delete curNotifier.addQueues[add_queue];this.lcSend("clear_addkeys")}switch(this.lpChecked(main_response)){case 0:break;case 1:default:return;case 2:busy|=2}busy?ls.get(LC_SERVER_SWITCH_TO_ACTIVE_FLAG)?ls.remove(LC_SERVER_SWITCH_TO_ACTIVE_FLAG):this.lcNoServer():(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(this.lpCheck.bind(this),curNotifier.request_timeout||1e3),errorTimeout.decrease())}catch(e){text&&-1==text.indexOf("Ad Muncher")&&((0,_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_12__.topError)("Notifier error: "+e.message,{dt:-1,type:5,stack:e.stack,answer:text+"\n\nbusy:"+busy+"\nserver:"+curNotifier.is_server+"\ninstance:"+curNotifier.instance_id,url:curNotifier.frame_url,query:params&&(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_21__.toQueryString)(params)}),(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)(e.message,e.stack,e)),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*errorTimeout.get()),errorTimeout.increase()}}}.bind(this),onFail)}},lpChecked:function(e){if(2==e.failed)return 4==e.err?2:((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("notifier lpCheck error",e),curNotifier.lpInvalid=!0,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*errorTimeout.get()),errorTimeout.increase(),1==e.err?1:3);if(e.failed)throw new Error((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_11__.getLang)("global_unknown_error"));return this.lcSend("feed",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.extend)({full:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&!this.canNotifyUi(),key:curNotifier.key},e)),curNotifier.timestamp=e.ts,Notifier.pushEvents(e.events),0},lpOnReset:function(){curNotifier.lpOnReset&&curNotifier.lpOnReset()},lpReset:function(e){curNotifier.lpOnReset=e,clearTimeout(curNotifier.resetTO),curNotifier.resetTO=setTimeout((function(){if(!curNotifier.is_server||curNotifier.lp_started){if(curNotifier.lpMakeRequest&&!curNotifier.lpInvalid){var e=curNotifier.key,t=curNotifier.timestamp;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.each)(curNotifier.addQueues,(function(i,_){e+=_[2],t+="_"+_[1]})),void curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_release",key:e,ts:t,id:curNotifier.uid,wait:25},Notifier.lpOnReset,Notifier.lpOnReset)}ajax.post("notifier.php?act=a_reset",!1,{onDone:Notifier.lpOnReset,onFail:function(){return Notifier.lpOnReset(),!0}})}else Notifier.lpStart()}),100)},lpGetKey:function(){ajax.post("notifier.php?act=a_get_key",{id:curNotifier.uid,hash:curNotifier.notifierHash},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,curNotifier.lpInvalid=!1,(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("notifier lpGetKey done"),this.lcSend("new_key",{ts:t,key:e}),this.lpCheck()}.bind(this),onFail:function(e){switch((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.debugLog)("notifier lpGetKey fail",e),e){case 1:case 3:return void Notifier.standby();case 4:return void Notifier.standby(300);case 2:return void Notifier.onRelogin();default:return errorTimeout.set(64),clearTimeout(this.lp_error_to),this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*errorTimeout.get()),!0}}.bind(this)})},addKey:function(e,t,i){var _;if(!e||!(null==(_=window.curNotifier)?void 0:_.addQueues))return!1;var o=(0,_notifier_utils__WEBPACK_IMPORTED_MODULE_40__.subscriptionObjectStableId)(e),a=curNotifier.addQueues[o],r=!a&&curNotifier.is_server;return a?(a[0]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)(),a[3]=t,a[4]=i):curNotifier.addQueues[o]=[(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.vkNow)(),e.ts,e.key,t,i],i||Notifier.lcSend("new_addkey",e),r&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier)),!0},addFeed:function(e,t){var i,_,o=null==(i=window.curNotifier)||null==(_=i.addQueues)?void 0:_[e];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isArray)(o)&&o.length&&(o[1]=t.ts,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_22__.isFunction)(o[3])&&o[3](e,t))},addRecvClbk:function(e,t,i,_){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]||(curNotifier.recvClbks[e]={}),curNotifier.recvClbks[e][t]&&!_||(curNotifier.recvClbks[e][t]=i)},setRecvClbk:function(e,t){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]=[t]},fixPhoto:function(e,t){return-1===(e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_17__.clean)(e)).indexOf("question_c.gif")?e:t?"/images/question_inv_xc.png":"/images/question_inv_c.png"},pauseGlobalMedia:function(){var e=!!(0,_shared_lib_site__WEBPACK_IMPORTED_MODULE_26__.isMvk)(),t=e?audio:(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_27__.getAudioPlayer)(),i=window.Videoview;isMediaStoppedByCalls=!0,Notifier.lcSend("video_start"),!e&&t&&t.isPlaying()&&(t.pause(),t.pausedByCalls=!0),!e&&i&&(i.togglePlay(!1),i.pausedByCalls=!0),e&&t.playing&&t.playing()&&(t.pause(),t.pausedByCalls=!0)},resumeGlobalMedia:function(){var e=!!(0,_shared_lib_site__WEBPACK_IMPORTED_MODULE_26__.isMvk)(),t=e?audio:(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_27__.getAudioPlayer)(),i=window.Videoview;isMediaStoppedByCalls&&(isMediaStoppedByCalls=!1,Notifier.lcSend("video_hide")),!e&&t&&t.pausedByCalls&&(t.play(),delete t.pausedByCalls),!e&&i&&i.pausedByCalls&&(i.togglePlay(!0),delete i.pausedByCalls),e&&t&&t.pausedByCalls&&((0,_shared_audio_utils_wrapAudioPlay__WEBPACK_IMPORTED_MODULE_28__.wrapAudioPlay)(t).catch((()=>{})),delete window.audio.pausedByCalls)}}},24817:(e,t,i)=>{i.d(t,{Sound:()=>a});var _=i(15544),o=i(87481);function a(e,t){var i,a,r=!1;if(!e)throw new Error("Undefined filename");t=t||{};try{r=!!(a=(0,_.ce)("audio")).canPlayType,"no"!=a.canPlayType("audio/mpeg")&&""!=a.canPlayType("audio/mpeg")?i=".mp3?1":"no"==a.canPlayType('audio/ogg; codecs="vorbis"')||""==a.canPlayType('audio/ogg; codecs="vorbis"')||t.forceMp3?r=!1:i=".ogg?1"}catch(e){}var n=t.forcePath||"/"+e+i;if(r){a.src=n;var s=!1;a.addEventListener("ended",(()=>{s=!0}),!0),a.load(),this.playSound=()=>{s&&a.load();try{var e=a.play();e&&e.catch((e=>{(0,o.debugLog)(e)}))}catch(e){}s=!1},this.pauseSound=()=>{var e=a.pause();e&&e.catch((e=>{(0,o.debugLog)(e)}))}}}a.prototype={play(){try{this.playSound()}catch(e){}},pause(){try{this.pauseSound()}catch(e){}}},window.Sound=a},69906:(__unused_webpack___webpack_module__,__unused_webpack___webpack_exports__,__webpack_require__)=>{var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21466),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(59357),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(51876),core_js_modules_es6_array_slice__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50110),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(85893),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(67294),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(49535),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(75632),_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(86067),_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(40906),_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(79957),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3834),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(95724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(15544),_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(86409),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(54612),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(76852),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(87481),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(19331),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(91525),_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(35676),_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(71516),_shared_evbus__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(82804),_icons_desktop_getIcon20Check__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(44030),_icons_desktop_getIcon20Cancel__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(84502),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(59397),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(86125),_shared_lib_init_react__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(81117),_web_reports_UserSatisfactionModeration_UserSatisfactionModeration__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(74880);window.TopNotifierCur||(window.TopNotifierCur={link:"top_notify_btn",count:"top_notify_count",_qParams:{section:"notifications",_tb:1,list:""},loaded:!1,loading:!1,from:"",viewsObserver:null,viewedNotifications:[]}),window.TopNotifier={onBellMouseDown:function(e){return!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onBellClick:function(e){return!!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.checkEvent)(e)||!!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onLoad:function onLoad(rows,js,from,header){if(!from||TopNotifierCur.from!==from){void 0!==rows&&"undefined"!==rows||(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_19__.logError)("TopNotifier load undefinded response",{environment:"top_notify"});var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.logEvalError)(e,evalExpr)}TopNotifierCur.loaded=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(TopNotifier.getContentNode(),rows),TopNotifier.trackViews(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_show_all")),TopNotifier.refreshHeader(header),TopNotifier.cleanCount(),TopNotifier.refreshCounters(),TopNotifierCur.from=from}},trackViews:function(){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_notify_cont");"IntersectionObserver"in window&&(TopNotifierCur.viewsObserver&&TopNotifierCur.viewsObserver.disconnect(),TopNotifierCur.viewsObserver=new IntersectionObserver((function(e){e.forEach((e=>{var t=e.target.parentNode.dataset.notification_id;e.isIntersecting&&-1===TopNotifierCur.viewedNotifications.indexOf(t)&&(TopNotifierCur.viewedNotifications.push(t),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_18__.partConfigEnabled)("notifications_view_new")?(0,_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_21__.saveStatlogEvents)({name:"notifications_views",value:t,keys:[]}):(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_10__.statlogsValueEvent)("notifications_views",t))}))}),{root:e,threshold:.6}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass)("feedback_row",e).forEach((function(e){TopNotifierCur.viewsObserver.observe(e)})))},refreshHeader:function(e){var t,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_unread"),_=e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_top_notify_header"),o=i&&i.offsetHeight;if(_?(TopNotifierCur.header=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.se)(e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{className:"top_notify_header_label"}),TopNotifierCur.header.appendChild(t)):t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_header_label",TopNotifierCur.header),_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(t,"");var a="";TopNotifierCur.notify_sources.forEach((function(e){""!==e.list&&e.list===TopNotifierCur._qParams.list&&(a=e.name)})),""===a&&(a=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_notifications_user"));var r,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{className:"top_notify_header_sup_label"}),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("span",{className:"top_notify_header_label_user",innerHTML:a}),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("span",{className:"top_notify_header_label_groups"}),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("a",{onmouseover:function(e){TopNotifier.getSourcesTip(this,e)},className:"top_notify_header_label_groups_link",innerHTML:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_notifications_groups")});if(c.appendChild(l),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("span",{className:"top_notify_header_label_groups_counter",innerHTML:""}),n.appendChild(s),cur.user_has_admined_groups>0&&(n.appendChild(c),n.appendChild(r)),t.appendChild(n),o){var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{className:"top_notify_header_sub_label",innerHTML:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_viewed_notifications")});t.appendChild(d)}}_&&TopNotifierCur.wrapper.insertBefore(TopNotifierCur.header,TopNotifierCur.wrapper.firstChild),TopNotifierCur.header_unread=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_header"),TopNotifierCur.header_unread&&(o?(TopNotifierCur.header_unread_hidden&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__.slideDown)(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!1,TopNotifierCur.header_unread_handler||(TopNotifierCur.header_unread_height=TopNotifierCur.header_unread.offsetHeight,TopNotifierCur.header_unread_handler=function(e){if(TopNotifierCur.header_unread){var t=TopNotifierCur.header_unread.offsetTop+TopNotifierCur.header_unread_height<e.data.scrollTop;t!=TopNotifierCur.swaped&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.toggleClass)(TopNotifierCur.header,"top_notify_header_swap_labels",t),TopNotifierCur.swaped=t)}},TopNotifierCur.scrollbar.emitter.addListener("update",TopNotifierCur.header_unread_handler))):(TopNotifierCur.header_unread_hidden||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__.slideUp)(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!0,TopNotifierCur.header_unread_handler&&(TopNotifierCur.scrollbar.emitter.removeListener("update",TopNotifierCur.header_unread_handler),TopNotifierCur.header_unread_handler=null)))},preload:function(){TopNotifier.shown()||vk.isBanned||TopNotifierCur.loaded||ajax.post("/al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clone)(TopNotifierCur._qParams),{_preload:1}),{cache:1,onDone:function(e,t,i,_){TopNotifier.shown()&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("pr","top_notify_cont")&&(TopNotifier.onLoad(e,t,i,_),TopNotifierCur.loaded=!0)},stat:["feed.css","page.css","post.css"]})},loadMore:function loadMore(){var btn=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("ui_top_notify_load_more");btn&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.isButtonLocked)(btn)&&(TopNotifierCur.ajax=ajax.post("/al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clone)(TopNotifierCur._qParams),{from:TopNotifierCur.from,more:1,need_header:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(!((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_header")||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_sticky")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_unread")))}),{onDone:function onDone(rows,js,newFrom){if(TopNotifierCur.scrollbar){var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.logEvalError)(e,evalExpr)}if(rows){for(var row=null,cont=TopNotifier.getContentNode(),au=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.cf)(rows);row=au.firstChild;)cont.insertBefore(row,btn);TopNotifier.refreshHeader(),TopNotifier.trackViews()}newFrom?TopNotifierCur.from=newFrom:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)(btn)}},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.show)(btn),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(btn)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)(btn),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(btn)}}))},updateTime:function(e){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass)("rel_date_needs_update",e,"span"),(function(e,t){if(t){var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(t.getAttribute("time")),_=60*((new Date).getTimezoneOffset()+180),o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getDateText)(i,_);!0===(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(this,"ucfirst")&&(o=o.charAt(0).toUpperCase()+o.slice(1)),t.innerHTML=o}}))},createNewEventsBox:function(e){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_18__.partConfigEnabled)("notify_new_events_box")){var t=TopNotifier.getContentNode();if(t){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("notifications_new_events",t);e>0?(i||((i=document.createElement("div")).className="feed_row _feed_row notifications_new_events",i.onclick=function(e){i.onclick=null,(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.showProgress)(i),TopNotifierCur._qParams.list="",TopNotifier.refresh(e,!1)}),i.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.langStr)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("notifications_new_events",e),"count",e),t.insertBefore(i,t.children[0])):i&&!TopNotifierCur.loading&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)(i)}}},show:function(e){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("top_notify_cont",e.target))return!0;if(!0!==(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.checkEvent)(e)&&!vk.isBanned){if(TopNotifier.shown())return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("top_notify_wrap",e.target,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_nav"))||TopNotifier.hide(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)(TopNotifierCur.link),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_notify_cont");TopNotifier.updateTime(i),TopNotifierCur.timeUpdateInt=setInterval((function(){TopNotifier.updateTime(i)}),1e4),cur.introNotifyTooltipHide&&(cur.introNotifyTooltipHide(),delete cur.introNotifyTooltipHide),t.tt&&t.tt.hide&&t.tt.hide(),i||(TopNotifierCur.wrapper=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{innerHTML:'<div id="top_notify_cont" class="top_notify_cont wall_module" ontouchstart="event.cancelBubble = true;" onmousedown="event.cancelBubble = true;"></div><a href="/feed?section=notifications'+(TopNotifierCur._qParams.list?"&list="+TopNotifierCur._qParams.list:"")+'" class="top_notify_show_all" onmousedown="event.cancelBubble = true;" onclick="TopNotifier.hide(); return nav.go(this, event);">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_notify_show_all")+"</a>",id:"top_notify_wrap",className:"scroll_fix_wrap top_notify_wrap"}),t.appendChild(TopNotifierCur.wrapper),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_notify_cont"));var _=window.innerHeight||document.documentElement.clientHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.setStyle)(i,{maxHeight:Math.min(Math.max(_-200,300),600)}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(TopNotifierCur.link,"TopNavBtn--active");var o=uiScroll;return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.container.__uiScroll__||(TopNotifierCur.scrollbar=new o(i,{global:!0,stopScrollPropagationAlways:!0,onmore:TopNotifier.loadMore})),TopNotifierCur.loaded?TopNotifier.trackViews():TopNotifier.refresh(),window.pushNotifier&&window.pushNotifier.cleanNotification(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__.cancelStackPush)("top_notifier",TopNotifier.hide.bind(TopNotifier),!0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e)}},hide:function(){TopNotifier.shown()&&(TopNotifierCur.viewedNotifications=[],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeClass)(TopNotifierCur.link,"TopNavBtn--active"),clearInterval(TopNotifierCur.timeUpdateInt),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__.cancelStackFilter)("top_notifier",!0),""!==TopNotifierCur._qParams.list&&(TopNotifierCur._qParams.list="",TopNotifier.invalidate()))},shown:function(){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(TopNotifierCur.link,"TopNavBtn--active")},getContentNode:function(){return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.content&&TopNotifierCur.scrollbar.container.__uiScroll__?TopNotifierCur.scrollbar.content:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_notify_cont")},showProgress:function(){var e=TopNotifier.getContentNode();(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("pr",e)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(e,""),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.showProgress)(e))},hideProgress:function(){var e=TopNotifier.getContentNode();(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(e,""),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.hideProgress)(e)},showTooltip:function(e,t){if(!TopNotifier.shown()&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.isVisible)("dev_top_nav")){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)(TopNotifierCur.link),_={};if(i){if("shownow"==i.tt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeAttr)(i,"tt"),e)_.text=function(){return e},t&&(_.onHide=n.pbind(t));else{i.tt&&i.tt.destroy&&i.tt.destroy();var o=ls.get("ntfseen")||{},a=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(o,(function(e,t){a.push(e+":"+t)})),_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(_,{url:"al_feed.php",params:{act:"a_last_notify",seen:a.join(";")},ajaxdt:2e3,noload:1,onHide:n})}var r=function e(t){setTimeout((function(){window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?e(t):(t&&t.hide(),Notifier.lcSend("hide_notify_tt"))}),6e3)};(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_16__.showTooltip)(i,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(_,{typeClass:"top_notify_tt",dir:"up",width:250,shift:[1,0],nohideover:1,nohide:1,onShowStart:function(e){TopNotifier.shown()&&(e.opts.onHide=!1,e.hide()),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.addEvent)(e.container,"mousedown",(function(e){if(!e||!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(e.target.tagName,["A","IMG"]))return TopNotifier.show(e),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e)})),r(e),Notifier.setRecvClbk("hide_notify_tt",e.hide)}}))}}function n(e){if(!e&&cur.topNotifyTTKey&&(e=cur.topNotifyTTKey,delete cur.topNotifyTTKey),e){var t=e.split(":"),i=ls.get("ntfseen")||{};2===t.length&&(i[0]=parseInt((new Date).getTime()/1e3),i[t[0]]=t[1],ls.set("ntfseen",i))}}},invalidate:function(){TopNotifierCur.loaded=!1,TopNotifierCur.from="",ajax.invalidate("/al_feed.php",TopNotifierCur._qParams),TopNotifierCur.ajax&&TopNotifierCur.ajax.abort()},setCount:function(e,t){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isString)(e)&&(e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)(e)),parseInt(e)>=100&&(e="+99"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(TopNotifierCur.link,"has_notify")&&e?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_20__.animateCount)(TopNotifierCur.count,e,{str:"auto"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(TopNotifierCur.count,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.toggleClass)(TopNotifierCur.link,"has_notify",!!e),t||TopNotifier.invalidate()},cleanCount:function(){if(cur.topNotifyHash){var e=cur.groupNotify_readGids||[];cur.groupNotify_readGids=[],TopNotifierCur.notify_sources.forEach((function(t,i){var _=parseInt(t.list.replace("group-",""));t.list!==TopNotifierCur._qParams.list&&-1===e.indexOf(_)||(TopNotifierCur.notify_sources[i].counter=0)})),ajax.post("/al_feed.php",{act:"a_clean_notify",hash:cur.topNotifyHash,list:TopNotifierCur._qParams.list,gn_readGids:e})}},refresh:function(e,t){void 0===e&&(e=null),void 0===t&&(t=!0),null!==e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e),TopNotifier.invalidate(),TopNotifierCur.wrapper&&!TopNotifierCur.loading&&(TopNotifierCur.loading=!0,t&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_notify_header")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_top_notify_header"))),TopNotifierCur.from=0,ajax.post("/al_feed.php",TopNotifierCur._qParams,{cache:1,onDone:(e,t,i,_)=>{TopNotifierCur.loading=!1,TopNotifier.onLoad(e,t,i,_)},showProgress:()=>{t&&TopNotifier.showProgress()},stat:["feed.css"],onFail(){TopNotifierCur.loading=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_show_all")),TopNotifier.hideProgress(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(TopNotifier.getContentNode(),'<div class="top_notify_empty no_rows error_message"><div>'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_notify_error_occured")+'</div><button class="flat_button button_small secondary" onclick="TopNotifier.refresh(event);">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_notify_refresh")+"</button></div>")},no_ads_params:!0}))},unifiedDeleteRow:function(e,t,i,_,o){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e);var a=o.closest(".ui_actions_menu_wrap");a&&TopNotifier.hideActionsMenu(a);var r=a&&a.dataset.for_notification_id,n=TopNotifier.getContentNode(),s=n&&n.querySelector(`.feedback_row_wrap[data-notification_id="${r}"]`),c=s&&s.closest(".feed_row"),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("post_actions",c),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("feedback_row_wrap",c);ajax.post("al_feed.php",{act:"a_feedback_unified_delete",query:t,hash:i,from:"top_notifier"},{onDone:function(e){"."!==_.substr(-1)&&(_+=".");var o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("notifications_cancel_disable"),a=`${_} <a onclick="TopNotifier.unifiedRestoreRow('${t}', '${i}', this);return cancelEvent(event);">${o}</a>`;e&&(a+="<br>"+e);var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{className:"feedback_deleted_container"});r.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div",{className:"feedback_row dld _feedback_deleted _top_feedback_deleted",innerHTML:a})),c.appendChild(r),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)(d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(c,"feedback_row_clickable")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(c,"feedback_row_touched")},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass.pbind(l,"post_actions_progress"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeClass.pbind(l,"post_actions_progress")})},unifiedRestoreRow:function(e,t,i){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("feed_row",i),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("feedback_deleted_container",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("_feedback_deleted",_)),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("feedback_row_wrap",_);if(o&&a){var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_unified_restore",query:e,hash:t,from:"top_notifier"},{onDone:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.show)(a),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeClass)(_,"feedback_row_touched")},showProgress:()=>i.parentNode.replaceChild(r,i),hideProgress:()=>r.parentNode.replaceChild(i,r)})}},notifyMarkSpam:function(e,t){ajax.post("al_feed.php",{act:"a_feedback_mark_spam",item:e,hash:t},{onDone:function(t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("notify_mark_spam_"+e).innerHTML=t}})},notifyDeleteAll:function(e,t,i,_){if(cur.notifyDeletingAll||(cur.notifyDeletingAll={}),!cur.notifyDeletingAll[e]){cur.notifyDeletingAll[e]=1;var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_delete_all",uid:e,item:i,hash:t},{onDone:function(t,i){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("_feedback_deleted",_);if(1!=i){var a,r=!1;if((r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(o,"_top_feedback_deleted")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("top_notify_cont"):cur.rowsCont)&&(a=r.firstChild)){var n,s,c=!1,l=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_11__.scrollGetY)();do{a.className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(a,"_feed_row")&&a.firstChild&&e==a.firstChild.getAttribute("author")&&(n=a.offsetHeight,s=a.offsetTop,!1===c&&(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.getXY)(a.offsetParent)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)(a),s+c<l&&(l-=n,(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_11__.scrollToY)(l,0)))}while(a=a.nextSibling);(0===cur.wasScroll||cur.wasScroll>0)&&(cur.wasScroll=l)}o.innerHTML='<span class="dld_inner">'+t+"</span>"}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("_feed_row",o))},showProgress:function(){_&&"button"===_.tagName.toLowerCase()?(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(_):_.parentNode.replaceChild(o,_)},hideProgress:function(){_&&"button"===_.tagName.toLowerCase()?(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(_):o.parentNode.replaceChild(_,o)}})}},checkClick:function(e,t){if(t=t||window.event,!e||!t)return!0;TopNotifier.trackClick(t.target);var i=t.target||t.srcElement,_=8,o=!1,a=/(feedback_row)/;do{if(!i||i===e||i.onclick||i.onmousedown||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(i.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||(o=i.className.match(a)))break}while(_--&&(i=i.parentNode));return!!o&&(i||!0)},detectClickRegion:function(e){switch(e.tagName){case"BUTTON":for(var t=e.parentNode.childNodes,i=1,_=0;_<t.length;++_)t[_]===e&&(i=_+1);return"button"+i;case"IMG":return e.dataset.elementName;default:return e.parentNode.closest(".feedback_attachments")?"attachments":"cell"}},trackClick:function(e){var t=e.closest(".feedback_row");if(t){for(var i=t.parentNode,_=TopNotifier.detectClickRegion(e),o=-1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass)("feedback_row"),r=0;r<a.length;++r)if(a[r]===t){o=r;break}(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_10__.statlogsValueEvent)("notifications_click",0,i.dataset.notification_type,o,i.dataset.notification_id,_)}},loadMoreUngrouped:(e,t,i)=>{ajax.post("/al_feed.php",{act:"ungroup_notifications",query:t,from:i},{onDone:(i,_,o)=>{if(!_&&o){if(!i)return TopNotifier.loadMoreUngrouped(e,t,o),!1;i+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+t+"', '"+o+"')\">"+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("notifications_show_more")+"</div>"}e.outerHTML=i},showProgress:()=>{e.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.showProgress)(e)},hideProgress:()=>e.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("notifications_show_more"),no_ads_params:!0})},ungroupUnified:function(e,t,i,_){if(void 0===i&&(i=null),void 0===_&&(_=""),null!==i){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.gpeByClass)("feed_row",e),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("post_actions",o);ajax.post("/al_feed.php",{act:"ungroup_notifications",query:i,from:_},{onDone:(_,o,a)=>{if(!o&&a){if(!_)return TopNotifier.ungroupUnified(e,t,i,a),!1;_+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+i+"', '"+a+"')\">"+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("notifications_show_more")+"</div>"}e.parentNode.outerHTML=_},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass.pbind(a,"post_actions_progress"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeClass.pbind(a,"post_actions_progress"),no_ads_params:!0})}else e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domClosest)("_feed_row",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domNS)(e)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)(e);t.stopPropagation(),t.preventDefault()},showActionsMenu:function(e){var t=!1,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domClosest)("_feed_row",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(i);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(_,"_notify_unread")&&(_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(_)),!(_.lastChild!=i||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(_,"feed_row_fb_hidden")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(_,"feedback_sticky_rows")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(_).lastChild!=_)){t={appendParentCls:"top_notify_wrap",processHoverCls:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(e),"post_actions")?"feedback_row":"feedback_sticky_row"};var o=e.dataset.for_notification_id;o&&(t.wrapAttrs={"data-for_notification_id":o})}uiActionsMenu.show(e,!1,t)},hideActionsMenu:function(e){uiActionsMenu.hide(e)},frProcess:function(e,t,i,_){var o;(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.isButtonLocked)(i)||(o=_?{act:"add",mid:e,hash:t,request:1,from:"top_notifier"}:{act:"remove",mid:e,hash:t,report_spam:1,from:"top_notifier"},(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_10__.statlogsValueEvent)("feed_top_notify",0,"friends",o.act),ajax.post("/al_friends.php",o,{onDone:function(t,o){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(a,t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(a,"feedback_buttons_response"),"friends"==cur.module&&window.Friends&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)("request_controls_"+e,t),window.Friends.processRequest(e,_)),o&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_24__.showDoneBox)(o)},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_error"),e).hide,3e3),!0},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(i),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(i)}))},apiCallProcess:function(e,t){if(!(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_23__.isObject)(e)||(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.isButtonLocked)(t))return!1;var i=e.query,_=e.successText,o=e.successIcon,a=e.confirmTitle,r=e.confirmText,n=e.confirmOkLabel,s=e.confirmCancelLabel,c=e.snackbarText,l=e.replaceAllActions,d=function(){ajax.post("/al_feed.php",{act:"a_api_call",hash:cur.topNotifyHash,query:i},{onDone:function(e){var i;switch(o){case"done":i=(0,_icons_desktop_getIcon20Check__WEBPACK_IMPORTED_MODULE_27__.getIcon20Check)().icon;break;case"cancel":i=(0,_icons_desktop_getIcon20Cancel__WEBPACK_IMPORTED_MODULE_28__.getIcon20Cancel)().icon}var a=`<div class="feedback_apicallText">${i?`<div class="feedback_apicallText__icon">${i}</div>`:""}${_}</div>`;if(l){var r=t.parentElement;r&&(r.innerHTML=a)}else t.outerHTML=a;c&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_24__.showDoneBox)(c)},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_error"),e).hide,3e3),!0},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(t),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(t)})};return r?(a=a||(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_action_confirmation"),cur.confirmBox=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)(a,r,n,(function(){d(),cur.confirmBox.hide()}),s)):d(),!0},joinGroup:function(e,t,i,_){ajax.post("/al_groups.php",{act:"enter",gid:e,hash:t,from:"top_notifier",context:_},{onDone:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(t,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(t,"feedback_buttons_response")},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_error"),e).hide,3e3),!0},showProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(i)},hideProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(i)}})},grProcess:function(e,t,i,_){if(!((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(i,"flat_button")&&(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.isButtonLocked)(i)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domFC)(i)&&"progress_inline"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domFC)(i))){var o=-2==_?"spam":_?"enter":"leave",a=-1==_?"_decline":"";ajax.post("/al_groups.php",{act:o,gid:e,hash:t,from:"top_notifier",context:a},{onDone:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(t,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(t,"feedback_buttons_response")},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_error"),e).hide,3e3),!0},showProgress:function(){if(-2==_){i.oldhtml=i.innerHTML;var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.getSize)(i)[0];i.innerHTML='<span class="progress_inline"></span>',(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domFC)(i),{width:e})}else(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(i)},hideProgress:function(){-2==_?i.innerHTML=i.oldhtml:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(i)}})}},gn_grProcess:function(e,t,i,_,o,a){return o.stopPropagation(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hasClass)(_,"flat_button")&&(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.isButtonLocked)(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domFC)(_)&&"progress_inline"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domFC)(_)||ajax.post("groupsedit.php",{act:"user_action",id:e,addr:t,hash:i,from:"top_notifier",action:a},{onDone:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.domPN)(_);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(t,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(t,"feedback_buttons_response"),!1},onFail:function(e){return!!e&&(setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_error"),e).hide,3e3),!1)},showProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton)(_)},hideProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton)(_)}}),!1},showGiftBox:function(e,t,i){return!(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showBox)("al_gifts.php",{act:"get_gift_box",fids:e,fr:1,ref:i},{stat:["gifts.css","wide_dd.js","wide_dd.css"],cache:1,dark:1},t)},getSourcesTip:function(e,t){return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(t),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_16__.showTooltip)(e,{url:"/al_page.php",params:{act:"notify_get_sources",cur_list:TopNotifierCur._qParams.list},slide:15,ajxdt:200,hidedt:200,dir:"bottom",shift:[100,10],id:"notify_sources",className:"notify_sources",onShowStart:function(){TopNotifierCur.notify_sources.forEach((function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("notify_tooltip_counter"+e.list),e.counter>0?e.counter:"")})),TopNotifier.refreshTooltip()}}),!1},changeSource:function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),null!==i&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(i),e!==TopNotifierCur._qParams.list?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("notify_sources")),t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("ui_rmenu_count",t),""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_show_all")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.attr)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_show_all"),"href","/feed?section=notifications"+(e?"&list="+e:"")),TopNotifierCur._qParams.list=e,TopNotifier.refresh()):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("notify_sources"))},changeSourceFullCallback:function(){TopNotifier.refreshCounters(),TopNotifierCur.notify_sources.forEach((function(e){e.list&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("ui_rmenu_count",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("feed_section_"+e.list)),e.counter>0?e.counter:"")}));var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByTag1)("a",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("header_side_link",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("feed_notifications")));""===TopNotifierCur.settings_url?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)(e):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.show)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.attr)(e,"href",TopNotifierCur.settings_url)),TopNotifierCur.source_name||(TopNotifierCur.source_name=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.getLang)("news_title_notifications")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("page_block_header_inner",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("feed_notifications")),TopNotifierCur.source_name)},hideBanner:function(e,t,i){ajax.post("al_feed.php",{act:"a_feedback_hide_banner",group_id:i,hash:t}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ge)("internal_notification131"))},addNewSource:function(e,t,i){return ajax.post("al_settings.php",{act:"a_group_notify_add_source",gid:e,from:i,hash:t},{onDone:function(t){nav.go("/settings?act=group_notify&gid="+e),TopNotifier.changeSource("group-"+e,null,null)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_14__.unlockButton.pbind(cur.popupSubmitBtnEl)}),!0},refreshCounters:function(){var e=0,t=0,i=0,_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("top_notify_header_label_groups_counter");TopNotifierCur.notify_sources.forEach((function(_){""!==_.list&&_.counter>0&&(1===_.unmuted?t++:e++),""===_.list&&(i=_.counter)})),vk.counts.ntf=i+t,TopNotifier.setCount(i+t,!0),TopNotifier.createNewEventsBox(i),t>0?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.addClass)(_,"unmuted"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(_,t)):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.removeClass)(_,"unmuted"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(_,e>0?e:""))},refreshTooltip:function(){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("groups",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("notify_sources")),t=[],i=[],_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.ce)("div");e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass)("line_cell",e).forEach((function(e,_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.geByClass1)("ui_rmenu_count",e))>0?t.push(e):i.push(e)})),t.concat(i).forEach((function(e){_.appendChild(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_13__.val)(e,""),e.appendChild(_))},showCommonFriendsBox:function(e,t){return(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showTabbedBox)("al_page.php",{act:"box",oid:t,tab:"common"},{cache:1},e),!1},userSatisfactionModeration:function(){return ajax.post("user_satisfaction_moderation.php",{act:"questions"},{onDone:e=>{(0,_shared_lib_init_react__WEBPACK_IMPORTED_MODULE_25__.showComponentInBox)((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_web_reports_UserSatisfactionModeration_UserSatisfactionModeration__WEBPACK_IMPORTED_MODULE_26__.UserSatisfactionModeration,{hash:e.hash,questions:e.questions,form:e.form}))}}),!0}},vk.widget||((0,_shared_evbus__WEBPACK_IMPORTED_MODULE_22__.tq)().setInteractiveHandler("Gifts/show_received_gifts",(e=>{var t=e.event,i=e.payload.dataAttrs.userId;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_15__.showBox)("al_gifts.php",{act:"box",tab:"received",mid:i},{cache:1,stat:["gifts.css",window.jsc("web/gifts.js")]},t)})),(0,_shared_evbus__WEBPACK_IMPORTED_MODULE_22__.tq)().setInteractiveHandler("Gifts/show_gifts_catalog",(e=>{var t=e.event,i=e.payload.dataAttrs,_=i.toId,o=i.ref;window.TopNotifier.showGiftBox(_,t,o)})))},67181:(e,t,i)=>{i.d(t,{EntityType:()=>_,EventQueue:()=>a});var _,o=i(70655);!function(e){e.Online="online"}(_||(_={}));var a=function(e){var t=this,i=e.getQueue,_=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var i=(0,o.__assign)({},e);t.intervalId=window.setInterval((function(){t.registerQueue(i,(function(e,_){var a,r,n,s;if(function(e){return void 0!==e.err}(_))t.restart();else{i.ts=_.ts;try{for(var c=(0,o.__values)(_.events),l=c.next();!l.done;l=c.next()){var d=l.value;try{for(var u=(n=void 0,(0,o.__values)(t.listeners)),f=u.next();!f.done;f=u.next())(0,f.value)(d)}catch(e){n={error:e}}finally{try{f&&!f.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}}}catch(e){a={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(a)throw a.error}}}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=_,this.getQueue=i}},21295:(e,t,i)=>{i.d(t,{screenWakeLocker:()=>_});var _=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}())},84683:(e,t,i)=>{i.d(t,{DEPRECATEDLongpollAdapter:()=>d});var _=i(70655),o=i(68040);function a(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=function(e){return e<10?"0"+e.toString():e.toString()},a=new Date,r=a.getHours()+":"+o(a.getMinutes())+":"+o(a.getSeconds()),n="background: "+e+"; color: white";window.__sseDebug&&console.debug.apply(console,(0,_.__spreadArray)(["%c"+r+" SSE:",n],(0,_.__read)(t),!1))}window.sseDebug=function(e){window.__sseDebug=e,window.__debugMode=e};var r=function(e,t){var i=this,r=t.starterConfig,s=t.refreshedConfig;this.listeners=[],this.reconnect=function(e){if(void 0===e&&(e=200),a("none","new connection requested"),0!==i.listeners.length){var t=e>500;t&&i.simulate([-3,e/1e3]);var r=(0,o.toQueryString)({key:i.config.key,ts:i.config.ts,uid:i.config.userId,version:14,mode:1226});i.connectionLimiter.scheduleReconnect(i.config.url+"?"+r,{onConnect:function(){t&&i.simulate([-4])},onOpen:function(){a("green","connection opened"),e=200,i.simulate([-5])},onClose:function(){var t=n(e);a("red","connection closed, reconnect in",t),i.reconnect(t)},onMessage:function(t){var o,r,s=JSON.parse(t.data);if(a("none","message received",s),void 0!==s.failed)switch(i.connectionLimiter.disconnect(),s.failed){case 1:i.simulate([-1]),i.config.ts=s.ts,i.reconnect();break;case 2:case 3:a("none","requesting new config"),i.refreshedConfig().then((function(e){a("none","new config received",e),i.config=(0,_.__assign)((0,_.__assign)({},e),{url:i.config.url}),i.simulate([-1]),i.reconnect()})).catch((function(t){a("red","error on updating key",t);var _=n(e);i.reconnect(_)}));break;case 4:throw new Error("Unknown longpoll version");default:throw new Error("Unknown longpoll error")}else{i.config.ts=s.ts;try{for(var c=(0,_.__values)(i.listeners),l=c.next();!l.done;l=c.next())(0,l.value)(s.updates)}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}}}},e)}else a("none","no listeners, aborting reconnect")},this.skipWaiting=function(){i.isConnected()||a("none","skip waiting"),i.connectionLimiter.skipWaiting()},this.subscribe=function(e){return a("none","new client subscribed"),i.listeners.push(e),1===i.listeners.length&&i.reconnect(200),function(){a("none","client unsubscribed"),i.listeners.includes(e)&&(i.listeners=i.listeners.filter((function(t){return e!==t})),0!==i.listeners.length||i.connectionLimiter.disconnect())}},this.simulate=function(){for(var e,t,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];a("none","simulating events",o);try{for(var n=(0,_.__values)(i.listeners),s=n.next();!s.done;s=n.next()){var c=s.value;c(o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},this.isConnected=function(){return i.connectionLimiter.isConnected()},this.config=r(),this.refreshedConfig=s,this.connectionLimiter=e};function n(e){return Math.min(2*e,6e4)}var s=function(){var e=this;this.scheduleReconnect=function(t,i,_){var o=i.onConnect,r=i.onOpen,n=i.onMessage,s=i.onClose;void 0===_&&(_=0),e.disconnect(),a("none","scheduling reconnection in",_);var c=function(){a("green","creating new EventSource");var i=new EventSource(t);setTimeout(o,0),i.addEventListener("open",r),i.addEventListener("message",(function(t){e.resetPingTimeout(s),n(t)})),i.addEventListener("ping-interval",(function(t){var i=JSON.parse(t.data);a("none","ping interval received",i),e.pingInterval=i})),i.addEventListener("ping",(function(){e.resetPingTimeout(s)})),i.addEventListener("error",(function(){switch(a("red","EventSource error, readyState:",i.readyState),e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),i.readyState){case EventSource.CONNECTING:case EventSource.OPEN:break;case EventSource.CLOSED:s()}})),e.source=i},l=window.setTimeout((function(){e.scheduled=void 0,c()}),_);e.scheduled={timeoutId:l,reconnect:c}},this.skipWaiting=function(){if(e.scheduled){var t=e.scheduled,i=t.timeoutId,_=t.reconnect;e.scheduled=void 0,clearTimeout(i),_()}},this.disconnect=function(){a("red","disconnecting EventSource"),e.scheduled&&(clearTimeout(e.scheduled.timeoutId),e.scheduled=void 0),e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),e.source&&e.source.close()},this.isConnected=function(){return!!e.source&&e.source.readyState===EventSource.OPEN},this.resetPingTimeout=function(t){if(e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),e.pingInterval){var i=e.pingInterval+1e3;e.pingTimeoutId=window.setTimeout((function(){a("red","connection ping timed out"),e.disconnect(),t()}),i)}}},c=i(63825),l=i(87294),d=function(e,t,i,o){var n=this;this.buffer=[],this.paused=0,this.subscriptions=[],this.onData=function(e){n.subscriptions.push(e),n.unsubscribe||(n.unsubscribe=n.source.subscribe((function(e){var t,i,o,a=e.map(c.constructEvent);if(n.isPaused())(t=n.buffer).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(a),!1));else try{for(var r=(0,_.__values)(n.subscriptions),s=r.next();!s.done;s=r.next())s.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(a),!1))}catch(e){i={error:e}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}})))},this.offData=function(e){n.subscriptions=n.subscriptions.filter((function(t){return t!==e})),0===n.subscriptions.length&&n.unsubscribe&&(n.unsubscribe(),n.unsubscribe=void 0)},this.push=function(e){var t,i;e.length>0&&"transition_event"!==e[0].type&&a("none","pushed events",e);try{for(var o=(0,_.__values)(n.subscriptions),r=o.next();!r.done;r=o.next())r.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(e),!1))}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},this.isPaused=function(){return n.paused>0},this.pause=function(){a("none","paused longpoll"),n.paused++},this.resume=function(){var e,t;if(0!==n.paused&&(a("none","resumed longpoll"),n.paused--,0!==n.buffer.length)){var i=n.buffer;n.buffer=[];try{for(var o=(0,_.__values)(n.subscriptions),r=o.next();!r.done;r=o.next())r.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(i),!1))}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}},this.abortWaiting=function(){n.source.skipWaiting()},this.isEnabled=function(){return n.source.isConnected()},this.isSSE=!0,this.source=new r(new s,{starterConfig:function(){return{key:e,ts:t,url:i,userId:o}},refreshedConfig:function(){return function(e){return new Promise((function(t,i){var _=!1,o=setTimeout((function(){_=!0,i(new Error("timeout"))}),1e3);(0,l.post)("al_im.php",{act:"a_get_key",uid:e,gid:Math.max(-e,0)},1e3).then((function(e){_||(t(e),clearTimeout(o))})).catch((function(e){_||(i(e),clearTimeout(o))}))}))}(o).then((function(e){var t=(0,_.__read)(e,4);return{key:t[0],url:t[1]+"/"+t[2],ts:t[3],userId:o}}))}})}},21880:(e,t,i)=>{var _=i(86409),o=i(87481),a=i(95724),r=i(15544),n=i(88379),s=(i(24817),i(26271)),c=i(35676),l=i(49535),d=i(40906);window.curRBox||(window.curRBox={guid:0,active:!1,focused:[],tabs:{}});function u(e,t){var i=this;i.options=t=(0,a.extend)({minH:50,minW:50},t),i.content=e;var o=i.id="rb_box_"+(t.id||curRBox.guid++);i.wrap=(0,r.ce)("div",{id:o,className:"rb_box_wrap fixed"+(t.fixed?" fc_fixed":"")}),i.wrap.innerHTML+='<div class="tt-fastchat-wrap"></div>';var n={};i.toBottom=i.toRight=!1,t.fixed?(n.bottom=0,n.right=72):(void 0!==t.startTop?n.top=t.startTop:void 0!==t.startBottom&&(n.bottom=t.startBottom),void 0!==t.startLeft?n.left=t.startLeft:void 0!==t.startRight&&(n.right=t.startRight)),(0,r.setStyle)(i.wrap,n),t.movable&&(0,l.addEvent)(t.movable,"mousedown",i._head_mdown.bind(i)),i.resizeableH=t.resizeableH||e,t.startHeight&&(0,r.setStyle)(i.resizeableH,"height",t.startHeight),i.resizeableW=t.resizeableW||e,t.startWidth&&(0,r.setStyle)(i.resizeableW,"width",t.startWidth),(0,l.addEvent)(e,"mousedown",i._cont_mdown.bind(i)),t.closer&&((0,l.addEvent)(t.closer,"mousedown",i._close_mdown.bind(i)),(0,l.addEvent)(t.closer,"click",i._close_click.bind(i))),t.hider&&((0,l.addEvent)(t.hider,"mousedown",i._close_mdown.bind(i)),(0,l.addEvent)(t.hider,"click",i._hide_click.bind(i))),t.minimizer&&!0!==t.minimizer&&((0,l.addEvent)(t.minimizer,"mousedown",i._close_mdown.bind(i)),(0,l.addEvent)(t.minimizer,"click",i._min_toggle.bind(i))),i.wrap.appendChild(e),!1!==t.resize&&(i.resizeWrap=(0,r.ce)("div",{className:"rb_resize_wrap",innerHTML:'<div class="chats_sp rb_resize"></div>'}),i.wrap.appendChild(i.resizeWrap),(0,l.addEvent)(i.resizeWrap,"mousedown",i._resize_mdown.bind(i))),t.minimized&&((0,r.addClass)(i.wrap,"rb_minimized"),i.minimized=!0),bodyNode.insertBefore(i.wrap,(0,r.ge)("page_wrap"));var c=(0,r.getStyle)(i.wrap,"top"),d=(0,r.getStyle)(i.wrap,"bottom"),u=(0,r.getStyle)(i.wrap,"left"),f=(0,r.getStyle)(i.wrap,"right");this.toBottom=("auto"===c||""===c||s.browser.msie&&0===c)&&"auto"!=d&&""!==d&&!(s.browser.msie&&0===d),this.toRight=("auto"===u||""===u||s.browser.msie&&0===u)&&"auto"!=f&&""!==f&&!(s.browser.msie&&0===f),this.toRight&&(0,r.setStyle)(i.wrap,{marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),(t.nofocus||t.noshow)&&(0,r.addClass)(i.wrap,"rb_inactive"),this.toBottom&&((0,r.setStyle)(i.wrap,{marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),(0,r.addClass)(i.wrap,"fc_tobottom")),this.options.marginFixedToLayer&&(0,r.setStyle)(i.wrap,{marginRight:(0,r.hasClass)(document.body,"layers_shown")?(0,_.sbWidth)():0}),curRBox.tabs[o]=i,i.pos=!1,t.noshow?((0,r.setStyle)(i.wrap,{visibility:"hidden",display:"block"}),i._update_pos(),(0,r.setStyle)(i.wrap,{visibility:"",display:""})):i.show(!1,t.nofocus)}(0,a.extend)(u.prototype,{show:function(e,t){var i=this;void 0===e&&(e=0),e?((0,r.setStyle)(i.wrap,{opacity:0,display:"block"}),i.visible=!0,!t&&i.focus(),(0,c.animate)(i.wrap,{opacity:1},e,(function(){(0,r.setStyle)(i.wrap,s.browser.msie?{filter:"none"}:{opacity:""}),i._update_pos()}))):((0,r.show)(i.wrap),i.visible=!0,!t&&i.focus(),i._update_pos()),i.options.onShow&&i.options.onShow()},hide:function(e,t,i){var _=this;if(!t&&_.options.onBeforeHide&&_.options.onBeforeHide())return!0;void 0===e&&(e=0),e?((0,r.setStyle)(_.wrap,{opacity:1,display:"block"}),(0,c.animate)(_.wrap,{opacity:0},e,(function(){(0,r.hide)(_.wrap),(0,r.setStyle)(_.wrap,s.browser.msie?{filter:"none"}:{opacity:""})}))):(0,r.hide)(_.wrap),_.visible=!1,!t&&_.options.onHide&&_.options.onHide(i||{})},_head_mdown:function(e){if(!(0,l.checkEvent)(e)){(e.originalEvent||e).cancelBubble=!0;var t,i,o=this,n=e.target,c=getWndInner(),d=curRBox.active==o.id,u=e.pageY,f=e.pageX,h=o.wrap.offsetHeight,p=o.wrap.offsetWidth,b=0,E=0,m=c[0]-h,C=c[1]-p,g=s.browser.msie?"selectstart":"mousedown";o.options.fixed&&FastChat.pinTab(o.options.peer||-1,e,!0),d||o.focus(e),o.toBottom?(o.toBottom=!1,t=c[0]-(0,a.intval)((0,r.getStyle)(o.wrap,"bottom"))-h,(0,r.setStyle)(o.wrap,{top:t,bottom:"auto"}),(0,r.removeClass)(o.wrap,"fc_tobottom")):t=(0,a.intval)((0,r.getStyle)(o.wrap,"top")),o.toRight?(o.toRight=!1,i=c[1]-(0,a.intval)((0,r.getStyle)(o.wrap,"right"))-p,(0,r.setStyle)(o.wrap,{left:i,right:"auto"})):i=(0,a.intval)((0,r.getStyle)(o.wrap,"left")),b=t,E=i,cur._fcdrag=1;var v=function(e){return b=Math.max(0,Math.min(m,t+e.pageY-u)),m-b<10?b=m:b<10&&(b=0),o.wrap.style.top=b+"px",E=Math.max(0,Math.min(C,i+e.pageX-f)),C-E<10?E=C:E<10&&(E=0),o.wrap.style.left=E+"px",(0,l.cancelEvent)(e)};return(0,l.addEvent)(document,"mousemove",v),(0,l.addEvent)(document,"mouseup",(function e(t){cur._fcdrag=0,(0,l.removeEvent)(document,"mousemove",v),(0,l.removeEvent)(document,"mouseup",e),(0,l.removeEvent)(document,g,l.cancelEvent),(0,r.setStyle)(bodyNode,"cursor",""),(0,r.setStyle)(n,"cursor",""),(o.toBottom=b>=m-5)&&((0,r.setStyle)(o.wrap,{top:"auto",bottom:0}),(0,r.addClass)(o.wrap,"fc_tobottom")),(o.toRight=E>=C-5)&&(0,r.setStyle)(o.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),o._update_pos();var i=Math.abs(t.pageY-u)<3&&Math.abs(t.pageX-f)<3;cur._fcpromo>0?cur._fcpromo=i?0:-1:o.options.minimizer&&i?!o.minimized&&d?o.minimize(!0):o.minimized&&o.unminimize(!0):o.options.onDragEnd&&o.options.onDragEnd(o.toBottom?-1:b/c[0],o.toRight?-1:E/c[1])})),(0,l.addEvent)(document,g,l.cancelEvent),(0,r.setStyle)(bodyNode,"cursor","move"),(0,r.setStyle)(n,"cursor","move"),!1}},_resize_mdown:function(e){if(!(0,l.checkEvent)(e)){this.focus(e);var t,i,o=this,n=e.target,c=getWndInner(),d=e.pageY,u=e.pageX,f=o.wrap.offsetHeight,h=o.wrap.offsetWidth,p=0,b=0,E=o.resizeableH.clientHeight-(0,a.intval)((0,r.getStyle)(o.resizeableH,"paddingBottom"))-(0,a.intval)((0,r.getStyle)(o.resizeableH,"paddingTop")),m=o.resizeableW.clientWidth-(0,a.intval)((0,r.getStyle)(o.resizeableW,"paddingRight"))-(0,a.intval)((0,r.getStyle)(o.resizeableW,"paddingLeft")),C=s.browser.msie?"selectstart":"mousedown",g=!s.browser.msie&&o.options.onResize||!1;o.toBottom?(o.toBottom=!1,t=c[0]-(0,a.intval)((0,r.getStyle)(o.wrap,"bottom"))-f,(0,r.setStyle)(o.wrap,{top:t,bottom:"auto"}),(0,r.removeClass)(o.wrap,"fc_tobottom")):t=(0,a.intval)((0,r.getStyle)(o.wrap,"top")),o.toRight?(o.toRight=!1,i=c[1]-(0,a.intval)((0,r.getStyle)(o.wrap,"right"))-h,(0,r.setStyle)(o.wrap,{left:i,right:"auto"})):i=(0,a.intval)((0,r.getStyle)(o.wrap,"left")),o.options.onResizeStart&&o.options.onResizeStart(E,m);var v=E+c[0]-t-f,w=m+c[1]-i-h,M=function(e){return p=Math.max(o.options.minH,Math.min(v,E+e.pageY-d)),v-p<10&&(p=v),o.resizeableH.style.height=p+"px",b=Math.max(o.options.minW,Math.min(w,m+e.pageX-u)),w-b<10&&(b=w),o.resizeableW.style.width=b+"px",g&&g(p,b),(0,l.cancelEvent)(e)};return(0,l.addEvent)(document,"mousemove",M),(0,l.addEvent)(document,"mouseup",(function e(t){(0,l.removeEvent)(document,"mousemove",M),(0,l.removeEvent)(document,"mouseup",e),(0,l.removeEvent)(document,C,l.cancelEvent),(0,r.setStyle)(bodyNode,"cursor",""),(0,r.setStyle)(n,"cursor",""),(o.toBottom=p==v)&&((0,r.setStyle)(o.wrap,{top:"auto",bottom:0}),(0,r.addClass)(o.wrap,"fc_tobottom")),(o.toRight=b==w)&&(0,r.setStyle)(o.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),o._update_pos(),o.options.onResizeEnd&&o.options.onResizeEnd(p,b,c[0],c[1],o.toBottom,o.toRight)})),(0,l.addEvent)(document,C,l.cancelEvent),(0,r.setStyle)(bodyNode,"cursor","move"),(0,r.setStyle)(n,"cursor","move"),!1}},_update_pos:function(){var e=this;e.pos=[e.wrap.offsetTop,e.wrap.offsetLeft,e.wrap.offsetHeight,e.wrap.offsetWidth]},_wnd_resize:function(e,t,i){var _=this;_.toBottom&&(_.pos[0]=_.wrap.offsetTop),_.toRight&&(_.pos[1]=_.wrap.offsetLeft);var o={},a=!1,n=!1,s=_.pos[0]+_.pos[2]-e,c=_.pos[0],l=_.resizeableH.clientHeight-_.options.minH,d=_.pos[1]+_.pos[3]-t,u=_.pos[1],f=!1!==_.options.resize?_.resizeableW.clientWidth-_.options.minW:0;i&&(f<0&&(0,r.setStyle)(_.resizeableW,_.options.minW),l<0&&(0,r.setStyle)(_.resizeableH,_.options.minH)),(s<=0||c<=0&&l<=0)&&(d<=0||u<=0&&f<=0)||(s>0&&c>0&&(s-=c=Math.min(s,c),o.top=_.pos[0]-c,o.bottom=""),s>0&&l>0&&(l=Math.min(s,l),a=_.resizeableH.clientHeight-l),d>0&&u>0&&(d-=u=Math.min(d,u),o.left=_.pos[1]-u,o.right=""),d>0&&f>0&&(f=Math.min(d,f),n=_.resizeableW.clientWidth-f),!1!==n&&(0,r.setStyle)(_.resizeableW,"width",n),!1!==a&&(0,r.setStyle)(_.resizeableH,"height",a),(0,r.setStyle)(_.wrap,o),_._update_pos(),_.options.onResize&&_.options.onResize(_.resizeableH.clientHeight,_.resizeableW.clientWidth))},_cont_mdown:function(e){if(curRBox.active!=this.id&&(this.focus(e),!(0,r.hasClass)(e.target,"fc_editable")))return(0,l.cancelEvent)(e)},_focus:function(){var e=this,t=(0,a.indexOf)(curRBox.focused,e.id),i=curRBox.active,_=i&&curRBox.tabs[i];if(i!=e.id){_&&(0,d.isFunction)(_.options.onBlur)&&_.options.onBlur(),-1!=t&&curRBox.focused.splice(t,1),curRBox.focused.unshift(e.id);var o=1e4+curRBox.focused.length,n=!0;(0,a.each)(curRBox.focused,(function(e,t){var i=curRBox.tabs[t].wrap;n?((0,r.addClass)(i,"rb_active"),(0,r.removeClass)(i,"rb_inactive"),curRBox.active=t,n=!1):((0,r.removeClass)(i,"rb_active"),(0,r.addClass)(i,"rb_inactive")),(0,r.setStyle)(i,"zIndex",o),o--}))}},_hide_click:function(){this.hide()},minimize:function(e){var t=this,i=t.wrap;if(t.options.fixed)return!1;(0,r.addClass)(i,"rb_minimized"),t.minimized=!0,t._update_pos(),e&&t.options.onMinimize&&t.options.onMinimize(0)},unminimize:function(e){var t=this,i=t.wrap,_=getWndInner();(0,r.removeClass)(i,"rb_minimized"),t.minimized=!1,t._update_pos(),t._wnd_resize(_[0],_[1],!0),curRBox.active=!1,t.focus(),e&&t.options.onMinimize&&t.options.onMinimize(1)},_min_toggle:function(e){var t=this;setTimeout((function(){t.minimized?t.unminimize(!0):t.minimize(!0)}),50)},destroy:function(){var e=this,t=(0,a.indexOf)(curRBox.focused,e.id);-1!=t&&curRBox.focused.splice(t,1),(0,r.cleanElems)(e.wrap,e.resizeWrap,e.content,e.options.movable,e.options.closer,e.options.hider),(0,r.re)(e.wrap),delete curRBox.tabs[e.id]},_close_mdown:function(e){(e.originalEvent||e).cancelBubble=!0},_close_click:function(e){this.close()},_close:function(e){this.destroy(),curRBox.focused[0]&&!0!==e&&curRBox.tabs[curRBox.focused[0]].focus()},focus:function(e){var t=this,i=curRBox.active!=t.id||!0;return t._focus(),i&&(0,d.isFunction)(t.options.onFocus)&&t.options.onFocus(e),i},close:function(){var e=this,t=e.pos;e._close(),(0,d.isFunction)(e.options.onClose)&&e.options.onClose(t)}}),window.RBox=u;i(67537),i(50110),i(20075),i(66108),i(21466),i(83946),i(51876),i(59357),i(75115),i(19371),i(98837),i(91181),i(56997),i(76774),i(40851),i(96253);var f=i(54612),h=i(82452),p=i(416),b=i(35429),E=i(27909),m=i(86125),C=i(76852),g=i(86067),v=i(61540),w=i(28238),M=i(29164),P=i(20929),T=i(32656),O=i(40157),D=i(21227),I=i(63825);i(81303);var k=i(87294),y=i(91040),B=i(60615),L=i(94940),N=i(39464),A=i(54593),R=i(63035),F=i(37867),U=i(48743);function W(){return W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},W.apply(this,arguments)}var S=1e4,x="fc_msgs_unread",K="WithCollapsedFastChats";function q(){return!curFastChat.version||!curFastChat.tabs}function H(e,t){return{name:e[0],photo:e[1],fname:e[2],hash:e[3],sex:e[4],link:e[5],online:curFastChat.onlines[t]}}window.curFastChat||(window.curFastChat={}),window.FastChat={init:function(e){var t=this;0!==vk.id&&((0,a.extend)(curFastChat,{tabs:{},needPeers:{},gotPeers:{},needMedia:{},gotMedia:{},ldb:(0,w.mount)(vk.id),myTypingEvents:{},typingEvents:{},inited:!0,options:e,posSeq:0,error_timeout:1,lpInstance:Notifier.getLpInstance()}),delete curFastChat.standby,delete curFastChat.standbyTO,curFastChat.lpInstance.onData((function(){for(var e=arguments.length,i=new Array(e),_=0;_<e;_++)i[_]=arguments[_];var o=t.getResourcesThatShouldBeLoaded(i),a=o.shouldLoad?t.loadResources(o):Promise.resolve();a.then((()=>{i.forEach((e=>{switch(e.type){case I.TYPING:var i=t.getTab(e.peerId);t.setTyping(e),i&&(t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.blinkTyping(e.peerId);break;case I.ADD_MESSAGE:var _=t.getTab(e.peerId);t.setTyping(e),_&&(t.addMessage(t.prepareMessageData(e)),t.scroll(e.peerId),t.blinkTab(e.peerId),t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.updateTabUnreadCounter(_,e);break;case I.EDIT_MESSAGE:case I.REPLACE_MESSAGE:var o=e.peerId,a=e.messageId,r=t.getTab(o);r&&r.msgs[a]&&(delete curFastChat.gotMedia[a],t.editMessage(t.prepareMessageData(e)));break;case I.REPLACE_FLAGS:case I.SET_FLAGS:case I.RESET_FLAGS:e.flags&I.FLAG_DELETED&&t.deleteMessage(t.prepareMessageData(e));break;case I.READ_INBOUND:case I.READ_OUTBOUND:t.markMessagesAsRead(e);break;case I.CHAT_CHANGED:case I.CONVERSATION_UPDATED:var n=t.getTab(e.peerId);t.handleEventChatUpdated(n,e);case I.VIDEO_CALL:case I.UNREAD_COUNT:case I.NOTIFY_SETTINGS_CHANGED:case I.EMPTY:case I.RESYNC:case I.REFRESH_LP_KEY:case I.TRANSITION:case I.RESET_PEER:case I.MUTEX:case I.CHANGE_PEER:case I.CHANGE_TAB:case I.FAILED_MESSAGE:case I.RESEND:case I.DELETE_DIALOG:}}))}))})),Notifier.addRecvClbk("fastchat",0,FastChat.lcRecv,!0),Notifier.addRecvClbk("logged_off",0,FastChat.standby,!0),FastChat.lcSend("needSettings",{version:e.version,lang_id:langConfig.id}),clearTimeout(curFastChat.getSettingsTO),curFastChat.getSettingsTO=setTimeout(FastChat.getSettings,300))},getSettings:function(){var e=ls.get("fcFriends"+vk.id);ajax.post("al_im.php",{act:"a_get_fast_chat",friends:e&&e.version,cache_time:FastChat.cachedStickersKeywordsTime()},{onDone:function(t){-1==t.friends?(t.friends_version=e.version,t.friends=e.list):ls.set("fcFriends"+vk.id,{version:t.friends_version,list:t.friends}),FastChat.gotSettings(t),FastChat.sendSettings()},onFail:function(){return!0}})},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},gotSettings:function(e){e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations),clearTimeout(curFastChat.getSettingsTO),window.lang=(0,a.extend)(window.lang||{},e.lang),(0,a.extend)(curFastChat,e,{lang_id:langConfig.id}),curFastChat.friendsCnt=Object.keys(curFastChat.friends),setTimeout(FastChat.clistCache.pbind(!1),10),FastChat.initUI()},sendSettings:function(){clearTimeout(curFastChat.sendSettingsTO);var e=["friends","friends_version","onlines","tpl","lang","me","version"].reduce(((e,t)=>(e[t]=curFastChat[t],e)),{});curFastChat.sendSettingsTO=setTimeout((function(){FastChat.lcSend("settings",{settings:e})}),curNotifier.is_server?0:(0,d.irand)(50,100))},destroy:function(){return!!curFastChat.inited&&(curFastChat.ldb.unmount(),(0,a.each)(curFastChat.tabs||{},(function(e,t){t.box.destroy()})),curFastChat.clistBox&&curFastChat.clistBox.destroy(),(0,a.each)(curFastChat.el||{},(function(){(0,r.cleanElems)(this)})),clearInterval(curFastChat.updateFriendsInt),clearTimeout(curFastChat.correspondentsTO),clearTimeout(curFastChat.lp_error_to),curFastChat={inited:!1},!0)},isChatOpen:function(e){if(window.curFastChat&&curFastChat.inited&&e){var t=curFastChat.tabs,i=curFastChat.clistBox;if(t&&t[e]&&t[e].box.visible||i&&i.visible)return!0}return!1},standby:function(e){FastChat.destroy(),curFastChat.standby=!0;var t=1;!function i(){if(!curNotifier.is_server)return clearTimeout(curFastChat.standbyTO),void(curFastChat.standbyTO=setTimeout(i,1e3*t));ajax.post("notifier.php?act=a_get_reload",{version:e},{onDone:function(e,t){FastChat.lcSend("gotConfig",{navVersion:e,config:t}),FastChat.gotConfig(e,t)},onFail:function(){return t*=2,clearTimeout(curFastChat.standbyTO),curFastChat.standbyTO=setTimeout(i,1e3*t),!0}})}()},gotConfig:function(e,t){clearTimeout(curFastChat.standbyTO),curFastChat.standby&&setTimeout((function(){if(e>stVersions.nav){(0,o.debugLog)("appending al loader");var i=vk.navPostfix||"";headNode.appendChild((0,r.ce)("script",{type:"text/javascript",src:`/js/loader_nav${i}${e}_${vk.lang}.js`}))}setTimeout((function(){e<=stVersions.nav?window.stManager.add(["notifier.js","notifier.css",window.jsc("web/emoji.js")],(function(){FastChat.init(t)})):setTimeout(arguments.callee,100)}),0)}),curNotifier.is_server?0:(0,d.irand)(1e3,2e3))},updateVersion:function(e){FastChat.lcSend("standby",{version:e}),FastChat.standby(e)},lcSend:function(e,t){Notifier.lcSend("fastchat",(0,a.extend)({act:e,__id:curFastChat.me&&curFastChat.me.id||vk.id},t))},lcRecv:function(e){if(!(0,d.isEmpty)(e)){var t=e.act;e.__id===(curFastChat.me&&curFastChat.me.id||vk.id)&&(delete e.act,delete e.__id,FastChat.lcFeed(t,e))}},lcFeed:function(e,t){switch(e){case"needSettings":curFastChat.version<t.version||t.lang_id==curFastChat.lang_id&&FastChat.sendSettings();break;case"settings":!curFastChat.version&&curFastChat.options&&t.settings.version==curFastChat.options.version&&FastChat.gotSettings(t.settings),clearTimeout(curFastChat.sendSettingsTO);break;case"standby":q()||FastChat.standby(t.version);break;case"gotConfig":FastChat.gotConfig(t.navVersion,t.config);break;case"clistOnlines":q()||FastChat.clistGotOnlines(t);break;case"needPeer":if(q())break;var i=t.id,_=curFastChat.tabs[i],o=curFastChat.friends[i+"_"],r=!1;if(void 0!==_?(r={name:_.name,photo:_.photo,fname:_.fname,hash:_.hash,sex:_.sex,data:_.data,online:_.online},Object.keys(_.msgs).length>0&&(r.history=[_.log.innerHTML,_.msgs])):o&&(r=H(o,i)),!1===r)break;curFastChat.gotPeers[i]=setTimeout((function(){var e={};e[i]=r,FastChat.lcSend("gotPeers",e)}),curNotifier.is_server?0:(0,d.irand)(50,100));break;case"fetchingPeers":if(q())break;(0,a.each)(t,(function(e,t){var i=curFastChat.needPeers[e];i&&(t&i[0])==i[0]&&clearTimeout(i[2])}));break;case"gotPeers":q()||FastChat.gotPeers(t);break;case"stateChange":q()||FastChat.onStateChanged(t);break;case"needMedia":var n=t.msgId,s=curFastChat.gotMedia[n];if(void 0===s||0===s)break;curFastChat.gotMedia[n][3]=setTimeout((function(){FastChat.lcSend("gotMedia",{msgId:n,peer:s[0],text:s[1],msgOpts:s[2]})}),curNotifier.is_server?0:(0,d.irand)(50,100));break;case"fetchingMedia":var c=t.msgId,l=curFastChat.needMedia[c];if(void 0===l||0===curFastChat.gotMedia[c])break;clearTimeout(l[1]),l[1]=setTimeout(FastChat.loadMsgMedia.pbind(l[0],c),1e3);break;case"gotMedia":var u=t.msgId,f=curFastChat.gotMedia[u];(0,d.isArray)(f)&&clearTimeout(f[3]),FastChat.gotMsgMedia(t.peer,u,t.text,t.msgOpts)}},getResourcesThatShouldBeLoaded(e){var t={},i=e.filter((e=>e.type===I.ADD_MESSAGE)),_=e.filter(L.isServiceMsg),o=i.filter((e=>!this.isTabLoaded(e.peerId))).map((e=>e.peerId));function a(e,i){var _=FastChat.getTab(e);(0,N.isChatPeer)(e)&&i&&_&&!_.data.members[i]&&(t[e]?-1===t[e].indexOf(i)&&t[e].push(i):t[e]=[i])}return i.forEach((e=>{this.isTabLoaded(e.peerId)&&a(e.peerId,e.userId)})),_.forEach((e=>{a(e.peerId,+e.kludges.source_mid)})),{shouldLoad:Object.keys(t).length>0||o.length>0,needPeers:o,needMembers:t}},loadResources(e){var t=e.needMembers,i=curFastChat.lpInstance;return i.pause(),this.loadMembers(t).then((()=>i.resume()))},loadMembers(e){if(0===Object.keys(e).length)return Promise.resolve();var t=Object.keys(e).map((t=>`${t}:${e[t].join(",")}`)).join(";");return(0,k.post)(A.CONTROLLER,{act:"a_load_member",need:t}).then((t=>{var i=t[0];Object.keys(e).forEach((t=>{var _=this.getTab(t);_&&_.data&&_.data.members&&(_.data.members=e[t].reduce(((e,t)=>{var _=i.find((e=>e.id===t));return e[t]=Object.assign({name_inv_case:_.inv_name,name_kick_case:_.kick_name},_),e}),_.data.members))}))}))},handleEventChatUpdated(e,t){switch(t.updateType){case I.MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED:case I.MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED:var i=[t.peerId,0].join(",");this.loadPeers(i,(e=>{this.updateChatInfo(t.peerId,e)}));case I.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case I.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:case I.MAIL_CHAT_UPDATE_TYPE_PINNED:case I.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:case I.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case I.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:case I.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:case I.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:case I.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:}},updateChatInfo(e,t){var i=this.getTab(e),_=t[e],o=_.photo,a=_.grid,r=_.name,n=document.querySelector(`#chat_tab_icon_${e} .chat_tab_img`),s=document.createElement(o?"img":"div"),c=i&&i.unread?" ("+i.unread+")":"";i&&i.title&&(i.name=r,i.title.innerHTML=r+c),s.classList.add("chat_tab_img"),a?s.innerHTML=`<div class="chat_tab_grid">${a}</div>`:o&&(s.id=`im_dialog_ph${U.Ranges.convertChatPeerIdToChatId(e)}`,s.src=o),n&&n.parentNode.replaceChild(s,n)},blinkEl:function(e,t,i){if(t>10)return i(),!1;t%2==0?(0,c.animate)(e,{opacity:0},400,(function(){FastChat.blinkEl(e,t+1,i)})):(0,c.animate)(e,{opacity:1},400,(function(){setTimeout((function(){FastChat.blinkEl(e,t+1,i)}),400)}))},blinkTyping:function(e){var t=(0,r.ge)("chat_tab_icon_"+e);if(t){var i=(0,r.geByClass1)("chat_tab_typing_wrap",t);(0,c.fadeIn)(i,150,(function(){FastChat.blinkEl(i.firstChild,0,(function(){(0,c.fadeOut)(i,150)}))}))}},imFeed:function(e,t){var i=this.getTab(e);if(!i)return!1;i.auto&&!i.unread&&(i.box._close(!0),delete curFastChat.tabs[e])},tabNotify:function(e,t,i){var _,o=curFastChat.tabs[e];if(U.Ranges.isUserPeerTransitional(e)&&(0,d.isFunction)(cur.onPeerStatusChanged)&&cur.onPeerStatusChanged(e,t,i),!U.Ranges.isCommunityPeer(e)&&o&&o.box&&!o.box.minimized){switch(clearTimeout(o.hideNotifyTO),t){case"online":_=(0,g.getLang)("mail_im_user_became_online",3-o.sex),FastChat.blinkTab(e);break;case"offline":_=(0,g.getLang)("mail_im_user_became_offline",3-o.sex),FastChat.blinkTab(e);break;case"unavail":_=(0,g.getLang)("mail_im_not_online",3-o.sex).replace(/\.$/,"")}_=_.replace("{user}",o.fname),(0,r.val)(o.notify,'<div class="fc_tab_notify fc_tab_notify_'+t+'">'+_+"</div>");var a=o.notify.firstChild;clearTimeout(o.hideNotifyTO),o.hideNotifyTO=setTimeout((function(){(0,c.fadeOut)(a,200,(function(){(0,r.val)(o.notify,"")}))}),5e3)}},hideChatCtrl:function(){(0,r.removeClass)(Chat.wrap,"chat_active"),(0,l.removeEvent)(document,"mousedown",FastChat.onDocClick)},showChatCtrl:function(){(0,r.addClass)(Chat.wrap,"chat_active"),setTimeout((function(){(0,l.addEvent)(document,"mousedown",FastChat.onDocClick)}),0)},hideUI:function(){(0,r.addClass)(bodyNode,"chat_onl_hidden")},showUI:function(){(0,r.removeClass)(bodyNode,"chat_onl_hidden")},initUI:function(){if(curFastChat.options){var e=curFastChat.el={},t=getWndInner();(0,r.re)("rb_box_fc_clist"),e.clistWrap=(0,r.se)(curFastChat.tpl.clist),e.clist=(0,r.geByClass1)("fc_contacts",e.clistWrap,"div"),e.clistTitle=(0,r.geByClass1)("fc_tab_title",e.clistWrap,"div"),e.clistOnline=(0,r.geByClass1)("fc_clist_online",e.clistWrap,"div");var i=curFastChat.options.state||!1,_=!curFastChat.friendsCnt||(i&&void 0!==i.clist.min?i.clist.min:t[1]<1200||curFastChat.friendsCnt<5);curFastChat.clistW=270,curFastChat.clistH=299;var o={id:"fc_clist",movable:(0,r.geByClass1)("fc_tab_head",e.clistWrap),hider:(0,r.geByClass1)("fc_tab_close_wrap",e.clistWrap,"a"),startHeight:curFastChat.clistH,startWidth:curFastChat.clistW,resizeableH:e.clist,resize:!1,minH:150,fixed:_,onHide:function(){(0,r.val)("fc_clist_filter",curFastChat.q=""),(0,r.addClass)(curFastChat.clistBox.wrap,"fc_fixed"),curFastChat.clistBox.fixed=!0,FastChat.stateChange({op:"clist_toggled",val:0}),(0,r.setStyle)(curFastChat.clistBox.wrap,{top:"auto",bottom:0,right:72,left:"auto"}),(0,r.show)(e.topLink),FastChat.hideChatCtrl()},onShow:function(){FastChat.showChatCtrl()},onDragEnd:function(e,t){FastChat.stateChange({op:"clist_moved",y:e,x:t})},onResize:function(){curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0)}};i&&!_&&(!1!==i.clist.x&&(-1==i.clist.x?o.startRight=0:o.startLeft=t[1]*i.clist.x),!1!==i.clist.y&&(-1==i.clist.y?o.startBottom=0:o.startTop=t[0]*i.clist.y)),_&&(o.noshow=!0),void 0===o.startTop&&void 0===o.startBottom&&(o.startTop=t[0]<800?0:.1*t[0]),void 0===o.startLeft&&void 0===o.startRight&&(o.startRight=0),curFastChat.clistBox=new window.RBox(e.clistWrap,o),o.noshow||void 0===o.startLeft&&void 0===o.startTop||curFastChat.clistBox._wnd_resize(t[0],t[1],!0),curFastChat.clistBoxScroll=new Scrollbar(e.clist,{prefix:"fc_",scrollChange:FastChat.clistShowMore,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto"}),curFastChat.updateFriendsInt=setInterval(FastChat.clistUpdate,18e4);var n,c=(0,r.ge)("fc_clist_filter");if((0,p.placeholderInit)(c,{global:!0}),curFastChat.q="",(0,l.addEvent)(c,"keyup "+(s.browser.opera?"keypress":"keydown"),(function(e){if(e.keyCode===l.KEY.ESC)return FastChat.clistHide(),(0,l.cancelEvent)(e);var t=FastChat.clistFilterKey(e);if(void 0!==t)return t;curFastChat.q=(0,a.trim)((0,r.val)(this)),FastChat.clistRender()})),e.clistOnline)bodyNode.appendChild(n=(0,r.ce)("nobr",{className:"fl_l",innerHTML:(0,g.getLang)("mail_im_clist_onlines")},{visibility:"hidden",position:"absolute"})),(0,r.re)(n),(0,l.addEvent)(e.clistOnline,"mouseover",(function(t){(0,C.showTooltip)(this,{text:(0,g.getLang)("mail_im_clist_onlines"),forcetoup:1,shift:[12,4,3],className:"tt_fc_onlines",init:function(){s.browser.msie&&(e.clistOnline.tt.isFixed=!1)},black:1})})),(0,l.addEvent)(e.clistOnline,"click",(function(e){(e.originalEvent||e).cancelBubble=!0,FastChat.clistToggleOnlines(),FastChat.clistRender()})),i&&i.clist&&i.clist.onlines&&FastChat.clistToggleOnlines(!0);_?FastChat.clistUpdateTitle():FastChat.clistRender(),curFastChat.ready=!0,i&&i.tabs&&(0,a.each)(i.tabs,(function(e,i){e=(0,a.intval)(e);var _={nofocus:1};this.min&&(_.minimized=!0),this.h&&(_.startHeight=this.h*t[0]),this.w&&(_.startWidth=this.w*t[1]),void 0!==this.x&&this.x<=1&&(this.x<0?_.startRight=0:_.startLeft=t[1]*this.x),void 0!==this.y&&this.y<=1&&(this.y<0?_.startBottom=0:_.startTop=t[0]*this.y),i.fx?(_.fixedLoad=!0,FastChat.prepareTabIcon(e,_,!0)):(_.noAnim=!0,FastChat.addPeer(e,!1,!1,_))})),(0,l.addEvent)(Chat.itemsCont,"mouseover",FastChat.itemsTT),(0,l.addEvent)(Chat.itemsCont,"mouseout",FastChat.itemsOut)}},itemsOffset:12,itemsTT:function(e){for(var t=e.target,i=!1;t&&t!=Chat.itemsCont;){if((0,r.hasClass)(t,"chat_tab_wrap")){i=t;break}t=t.parentNode}if(!i)return clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,!1;var _=i.id.split("_")[3],o=Chat.tabs[_];return!!o&&(curFastChat.activeBox&&curFastChat.activeBox.visible&&curFastChat.activeBox.options.peer==_?(FastChat.itemsOut(),!1):(clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,(0,C.showTooltip)(i,{text:o.name,slideX:15,black:1,asrtl:1,appendEl:Chat.ttNode,className:"tt_black_side",shift:[-58,-37,0],zIndex:10201}),void(Chat.ttPeer=i)))},itemsOut:function(){if(Chat.ttOutTimeout)return!1;Chat.ttOutTimeout=setTimeout((function(){if(Chat.ttOutTimeout=!1,!Chat.ttPeer)return!1;(0,l.triggerEvent)(Chat.ttPeer,"mouseout"),Chat.ttPeer=!1}),0)},stateChange:function(e){ajax.post("al_im.php",(0,a.extend)({act:"a_state_fc",hash:curFastChat.options.state_hash||""},e),{onFail:function(){return!0}}),FastChat.lcSend("stateChange",e)},onStateChanged:function(e){var t=!!e.peer&&curFastChat.tabs[e.peer],i=e.peer?t&&t.box:curFastChat.clistBox,_=getWndInner();switch(e.op){case"added":if(t){delete t.auto;break}e.fixed?FastChat.prepareTabIcon(e.peer,{fixedLoad:!0}):FastChat.addPeer(e.peer);break;case"unfixed":var o={startHeight:(0,a.intval)(_[0]*e.h),startWidth:(0,a.intval)(_[1]*e.w)};-1==e.y?o.startBottom=0:o.startTop=(0,a.intval)(_[0]*e.y),-1==e.x?o.startRight=0:o.startLeft=(0,a.intval)(_[1]*e.x),FastChat.addPeer(e.peer,!1,!1,o);break;case"closed":if(Chat.tabs[e.peer]&&FastChat.closeTabIcon(e.peer),!t||!i)break;i.close();break;case"hidden":if(!t||!i)break;i.close();break;case"minimized":if(!t||!i)break;e.val?i.unminimize():i.minimize();break;case"moved":case"clist_moved":(0,r.setStyle)(i.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?(0,a.intval)(_[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?(0,a.intval)(_[1]*e.x):"auto"}),i.toBottom=-1==e.y,i.toRight=-1==e.x;break;case"resized":(0,r.setStyle)(i.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?(0,a.intval)(_[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?(0,a.intval)(_[1]*e.x):"auto"}),i.toBottom=-1==e.y,i.toRight=-1==e.x;var n=(0,a.intval)(_[1]*e.w);(0,r.setStyle)(i.resizeableH,"height",(0,a.intval)(_[0]*e.h)),(0,r.setStyle)(i.resizeableW,"width",n),FastChat.fixResized(t,n);break;case"clist_toggled":e.val?i.show(0,!0):i.hide(0,!0),(0,r.toggle)(curFastChat.el.topLink,!e.val);break;case"onlines_toggled":FastChat.clistToggleOnlines(e.val),FastChat.clistRender()}},onUnidle:function(){curNotifier.version&&curFastChat.clistBox&&(curFastChat.clistBox.visible&&(curFastChat.el.clist.scrollTop<100||curRBox.active!=curFastChat.clistBox.id)?FastChat.clistRender():FastChat.clistUpdateTitle(),(0,a.each)(curFastChat.tabs,(function(e){FastChat.restoreDraft(e)})))},clistUpdate:function(){var e=(0,d.vkNow)();if(curNotifier.is_server&&!(curFastChat.clistUpdatedTs&&e-curFastChat.clistUpdatedTs<6e4)){curFastChat.clistUpdatedTs=e;var t=Object.keys(curFastChat.tabs).concat(Object.keys(Chat.tabs)).join();ajax.post("al_im.php",{act:"a_onlines",peer:t},{onDone:function(e){FastChat.clistGotOnlines(e),FastChat.lcSend("clistOnlines",e)},onFail:()=>!0})}},clistGotOnlines:function(e){var t=curFastChat.onlines,i=[];curFastChat.onlines=e,curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||!curFastChat.tabs&&Chat.tabs||((0,a.each)(curFastChat.tabs,(function(_){curFastChat.onlines[_]!=t[_]&&(FastChat.tabNotify(_,e[_]?"online":"offline",e[_]),e[_]||(i[_]=1))})),(0,a.each)(Chat.tabs,(function(i){if(curFastChat.onlines[i]!=t[i]){var _=(0,r.geByClass1)("_chat_tab_image",(0,r.ge)("chat_tab_icon_"+i));(0,r.toggleClass)(_,"online",e[i]),(0,r.toggleClass)(_,"mobile",e[i]&&mobPlatforms[e[i]])}})),i=(0,a.arrayKeyDiff)(t,e,i),(0,a.each)(i,(function(e){FastChat.tabNotify(e,"offline")})),FastChat.clistRender())},clistShow:function(){var e=(0,r.hasClass)(Chat.wrap,"chat_active");FastChat.clistRender(),curFastChat.clistBox.visible?curFastChat.clistBox.focus():(curFastChat.activeBox&&curFastChat.activeBox!=curFastChat.clistBox&&curFastChat.activeBox.hide(),curFastChat.clistBox.show(),FastChat.setActive(curFastChat.clistBox),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0),curFastChat.el.topLink&&(0,r.hide)(curFastChat.el.topLink)),(0,r.elfocus)("fc_clist_filter"),FastChat.movePointer(!1,e)},clistHide:function(){curFastChat.clistBox.hide(),curFastChat.activeBox==curFastChat.clistBox&&FastChat.setActive(!1)},clistRender:function(e){var t=[],i=!e,_=1+(e?40:20),o=!1,n=!1,c=!1,l=curFastChat.q;if(l?(c=[],(0,a.each)(FastChat.clistCache(l),(function(){c.push((0,a.escapeRE)(this))})),c=new RegExp("([ -]|^|s|&nbsp;|\b)("+c.join("|")+")","gi"),o=curFastChat.clistCache[l]||{}):curFastChat.clOnlines&&(o=curFastChat.onlines),curFastChat.clHasMore=!1,(0,a.each)(curFastChat.friends,(function(e){var r=(0,a.intval)(e),s=!o||o[r];if(i){if(s){if(!--_)return curFastChat.clHasMore=!0,!1;t.push(FastChat.clistWrapPeer(r,this,c)),n=r}}else r==curFastChat.clOffset&&(i=!0)})),!1!==n||e||l?l&&!curFastChat.clHasMore&&t.push(FastChat.getCorrespondents(l,c,!1===n)):t.push('<div class="fc_clist_empty">'+(0,g.getLang)(l?"mail_im_clist_notfound":"mail_im_clist_empty")+"</div>"),curFastChat.clOffset=n,e){for(var d=(0,r.ce)("div",{innerHTML:t.join("")}),u=document.createDocumentFragment();d.firstChild;)u.appendChild(d.firstChild);curFastChat.el.clist.appendChild(u),curFastChat.clHasMore||FastChat.clistUpdateTitle(!0)}else(0,r.val)(curFastChat.el.clist,t.join("")),FastChat.clistUpdateTitle(!0),(s.browser.chrome||s.browser.safari)&&setTimeout((function(){(0,r.setStyle)(curFastChat.el.clist.firstChild,{width:curFastChat.el.clist.firstChild.clientWidth}),setTimeout((function(){(0,r.setStyle)(curFastChat.el.clist.firstChild,{width:""})}),0)}),0);if(curFastChat.clSel){var f=(0,r.ge)("fc_contact"+curFastChat.clSel);f?FastChat.clistPeerOver(f,1):curFastChat.clSel=!1}else{var h=(0,r.geByClass1)("fc_contact",curFastChat.el.clist);FastChat.clistPeerOver(h,1)}curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()},clistWrapPeer:function(e,t,i){var _,o,a=curFastChat.tabs[e]?curFastChat.tabs[e].unread:0,r=curFastChat.onlines[e],n=(0,h.onlinePlatformClass)(r),s=(t[0]||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return i&&(s=s.replace(i,'$1<em class="fc_clist_hl">$2</em>')),U.Ranges.isUserPeerTransitional(e)?(_="/id"+e,o='onmousemove="FastChat.clistPeerOver(this.parentNode, 2);"  onmouseout="FastChat.clistPeerOver(this.parentNode, 1);"'):(_="/im?sel="+e,o=""),'<a href="'+_+'" class="fc_contact clear_fix" id="fc_contact'+e+'" onclick="return FastChat.selectPeer('+e+', event, { entrypoint: \'fastchat_search\' });" onmousedown="event.cancelBubble = true;" onmouseover="FastChat.clistPeerOver(this, 1, event);"  onmouseout="FastChat.clistPeerOver(this, 0, event);"><span class="fc_contact_photo'+n+'" '+o+">"+(U.Ranges.isChatOrChannelPeer(e)&&t[3]?t[3]:'<img src="'+Notifier.fixPhoto(t[1])+'" class="fc_contact_photo"/>')+'</span><span class="fc_contact_status"></span><span class="fc_contact_name">'+s+'<span id="fc_contact_unread'+e+'" class="fc_contact_unread">'+(a?" <b>+"+a+"</b>":"")+"</span></span></a>"},clistPeerOver:function(e,t,i){if(e&&(0,l.checkOver)(i,e)){var _=e.id.substr(10);curFastChat.clSel&&t&&curFastChat.clSel!=_&&FastChat.clistPeerOver((0,r.ge)("fc_contact"+curFastChat.clSel),0),(0,r.toggleClass)(e,"fc_contact_over",t),t?curFastChat.clSel=_:curFastChat.clSel==_&&(curFastChat.clSel=!1)}},authorOver:function(e){var t=(0,r.gpeByClass)("fc_tab_log",e),i=e.getBoundingClientRect().top,_=t.getBoundingClientRect().top,o=e.getAttribute("data-title"),a=!1;if(i-_<10&&(a=!0),o){var n=e.getAttribute("data-date");n&&(o+="<br>"+n);var s=(0,r.gpeByClass)("rb_box_wrap",e).querySelector(".tt-fastchat-wrap");(0,C.showTooltip)(e,{text:'<div class="fc_author_tt">'+o+"</div>",black:1,center:1,forcetodown:a,appendEl:s,shift:[1,8,0]})}},getCorrespondents:function(e,t,i){return clearTimeout(curFastChat.correspondentsTO),curFastChat.correspondents&&void 0!==curFastChat.correspondents[e]?FastChat.wrapCorrespondents(curFastChat.correspondents[e])||i&&'<div class="fc_clist_empty">'+(0,g.getLang)("mail_im_clist_notfound")+"</div>"||"":(curFastChat.correspondentsTO=setTimeout(FastChat.loadCorrespondents.pbind(e,t),100),'<div id="fc_correspondents"></div>')},loadCorrespondents:function(e,t){e==curFastChat.q&&ajax.post("hints.php",{act:"a_json_friends",str:e,from:"fc",allow_multi:1},{onDone:function(i){curFastChat.correspondents||(curFastChat.correspondents={});var _,o={};if((0,a.each)(i,(function(){_=this[3]+"_",curFastChat.friends[_]||(o[_]=[this[1],this[2],this[3],this[4]||""])})),curFastChat.correspondents[e]=o,e==curFastChat.q){var n=(0,r.ge)("fc_correspondents");if(n){var s=n.parentNode,c=(0,r.ce)("div",{innerHTML:FastChat.wrapCorrespondents(o,t)}),l=document.createDocumentFragment();if(c.firstChild)for(;c.firstChild;)l.appendChild(c.firstChild);else s.firstChild==n&&l.appendChild((0,r.ce)("div",{className:"fc_clist_empty",innerHTML:(0,g.getLang)("mail_im_clist_notfound")}));s.replaceChild(l,n),FastChat.clistUpdateTitle(!0),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()}}}})},wrapCorrespondents:function(e,t){var i=[];return(0,a.each)(e,(function(e){i.push(FastChat.clistWrapPeer((0,a.intval)(e),this,t))})),i.join("")},updateFriends:function(e){if(window.Chat&&Chat.inited){var t=Chat.onl;t&&(e>0?((0,r.val)(t,e),(0,r.show)(Chat.wrap)):(0,r.hide)(Chat.wrap))}},onDocClick:function(e){if(curFastChat.activeBox){var t=e.target;if((0,m.curBox)())return!0;for(;t;){if("fc_tab_wrap"==t.className||-1!==["chat_onl_wrap","custom_menu_cont","layer_wrap","box_layer_wrap","wk_layer_wrap"].indexOf(t.id))return!0;t=t.parentNode}var i=curFastChat.tabs[curFastChat.activeBox.options.peer];if(i&&((0,a.trim)(Emoji.editableVal(i.txt))||i.imMedia&&i.imMedia.getMedias().length))return!0;curFastChat.activeBox.hide()}},clistCache:function(e){if(e){var t,i,_,o,r,n,s=[e];if((i=(0,g.parseLatin)(e))&&s.push(i),(i=(0,g.parseLatKeys)(e))&&s.push(i),(i=(0,g.parseCyr)(e))&&s.push(i),void 0!==curFastChat.clistCache[e])return s;for(var c in n=curFastChat.clistCache[e]={},s)if(s.hasOwnProperty(c)&&(t=s[c],_=curFastChat.clistCache[" "+t.charAt(0).toLowerCase()]))for(var l in o=new RegExp("(^|\\s|\\()"+(0,a.escapeRE)(t),"gi"),_)if(_.hasOwnProperty(l)){if(r=curFastChat.friends[l+"_"],!(0,d.isArray)(r))continue;null!==r[0].match(o)&&(n[l]=1)}return n._num=Object.keys(n).length,s}var u,f,h;for(var p in curFastChat.clistCache={},curFastChat.friends)if(curFastChat.friends.hasOwnProperty(p))for(u=curFastChat.friends[p][0],p=(0,a.intval)(p),f=0;h=" "+u.charAt(f).toLowerCase(),curFastChat.clistCache[h]||(curFastChat.clistCache[h]={}),curFastChat.clistCache[h][p]=1,-1!==(f=u.indexOf(" ",f+1));)++f},clistShowMore:function(){if(curFastChat.clHasMore){var e=curFastChat.el.clist;e.scrollTop+3*e.clientHeight>e.scrollHeight&&FastChat.clistRender(!0)}},clistUpdateTitle:function(e){var t=0,i=0;for(var _ in curFastChat.friends)curFastChat.onlines[(0,a.intval)(_)]?(i++,t++):curFastChat.clOnlines||t++;var o=window.newVal=(i?(0,g.getLang)("mail_im_X_onlines_title",i):(0,g.getLang)("mail_im_onlines_title")).toString();FastChat.updateFriends(i),(0,r.val)(curFastChat.el.clistTitle,o),(0,r.val)(curFastChat.el.topLink,o.toLowerCase()),curFastChat.clistBoxScroll&&(!curFastChat.clHasMore&&e?t=curFastChat.el.clist.childNodes.length:curFastChat.q&&(t=(0,a.intval)((curFastChat.clistCache[curFastChat.q]||{})._num)),curFastChat.clistBoxScroll.options.contHeight=50*t)},clistToggleOnlines:function(e){void 0===e&&(e=!curFastChat.clOnlines,FastChat.stateChange({op:"onlines_toggled",val:e?1:0})),(0,r.toggleClass)(curFastChat.el.clistOnline,"fc_clist_online_active",e),curFastChat.clOnlines=e},clistFilterKey:function(e){var t;switch(e.keyCode){case l.KEY.DOWN:case l.KEY.UP:if("keyup"!==e.type){var i;if(t=curFastChat.clSel&&(0,r.ge)("fc_contact"+curFastChat.clSel)){var _=e.keyCode===l.KEY.DOWN?"nextSibling":"previousSibling";i=t;do{i=i[_]}while(i&&(1!==i.nodeType||!(0,r.hasClass)(i,"fc_contact")))}else curFastChat.clSel||e.keyCode!==l.KEY.DOWN||(i=(0,r.geByClass1)("fc_contact",curFastChat.el.clist,"a"));if(i&&i!==t){FastChat.clistPeerOver(i,1);var o=curFastChat.el.clist;i.offsetTop+16>o.clientHeight+o.scrollTop?(o.scrollTop=i.offsetTop+16-o.clientHeight,curFastChat.clistBoxScroll.update()):i.offsetTop-36<o.scrollTop&&(o.scrollTop=i.offsetTop-36,curFastChat.clistBoxScroll.update())}}break;case l.KEY.LEFT:case l.KEY.RIGHT:return!0;case l.KEY.ENTER:if("keyup"==e.type||!(t=curFastChat.clSel&&(0,r.ge)("fc_contact"+curFastChat.clSel)))break;if(e.ctrlKey||e.metaKey&&s.browser.mac){var a=(0,v.getHostName)().replace(".","\\.");nav.go(t.href.match(new RegExp(`\\b(vkontakte\\.ru|${a})(\\/[^\\/]+?)$`))[2])}else FastChat.selectPeer(curFastChat.clSel);case l.KEY.ESC:if("keyup"!=e.type){var n=(0,r.ge)("fc_clist_filter"),c=(0,r.val)(n)||curFastChat.clSel;n.blur(),(0,r.val)(n,curFastChat.q=""),curFastChat.clSel=!1,c&&FastChat.clistRender()}break;default:return}return(0,l.cancelEvent)(e)},prepareTabIcon:function(e,t,i){var _=curFastChat.friends&&curFastChat.friends[e+"_"];if(_){var o=H(_,e);FastChat.addTabIcon(e,o,i)}else{curFastChat.needPeers[e]=[3,!1,setTimeout(FastChat.getPeers,(0,d.irand)(150,200)),t]}},addTabIcon:function(e,t,i){if(Chat.itemsCont&&!Chat.tabs[e]){var _=U.Ranges.isChatOrChannelPeer(e),o=_?t.data.members_grid_fc||"":`<img class="chat_tab_img" src="${t.photo}"/>`,a=_?"im?sel=c"+U.Ranges.convertChatPeerIdToChatId(e):t.alink||"/id"+e,n=(0,h.onlinePlatformClass)(t.online),s=(0,r.se)('<a class="chat_tab_wrap'+(i?"":" chat_tab_beforeanim")+'" id="chat_tab_icon_'+e+'" href="'+a+'" onclick="FastChat.itemsOut();return FastChat.togglePeer('+e+', event);"><div class="chat_tab_imgcont _chat_tab_image'+n+'"><div class="chat_tab_close" onclick="return FastChat.closeTabIcon('+e+', event)"></div>'+o+'</div><div class="chat_tab_typing_wrap"><div class="chats_sp chat_tab_typing_icon"></div></div><div class="chat_tab_counter"></div></a>');Chat.itemsCont.insertBefore(s,Chat.itemsCont.firstChild),Chat.tabs[e]={el:s,name:t.name},(0,r.addClass)(Chat.wrap,"chat_expand"),i||(0,r.removeClass)(s,"chat_tab_beforeanim"),FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=0}},checkChatHeight:function(){var e=(0,r.getSize)(Chat.itemsCont)[1];function t(){(0,l.addEvent)(Chat.scrollNode,s.browserFeatures.wheelEvent,FastChat.scrollWrap)}function i(){(0,l.removeEvent)(Chat.scrollNode,s.browserFeatures.wheelEvent,FastChat.scrollWrap)}Chat.lastHeight=e,e>Chat.maxHeight?(Chat.fixH||(Chat.fixH=!0,(0,r.addClass)(Chat.scrollNode,"chat_fix_height"),(0,r.setStyle)(Chat.scrollNode,{height:Chat.maxHeight}),(0,l.addEvent)(Chat.scrollNode,"mouseenter",t),(0,l.addEvent)(Chat.scrollNode,"mouseleave",i),FastChat.checkShadow()),Chat.scrollNode.scrollTop=e-Chat.maxHeight):Chat.fixH&&(Chat.fixH=!1,(0,r.removeClass)(Chat.scrollNode,"chat_fix_height"),(0,r.setStyle)(Chat.scrollNode,{height:"auto"}),(0,l.removeEvent)(Chat.scrollNode,s.browserFeatures.wheelEvent,FastChat.scrollWrap),(0,l.removeEvent)(Chat.scrollNode,"mouseenter",t),(0,l.removeEvent)(Chat.scrollNode,"mouseleave",i),FastChat.checkShadow())},checkShadow:function(){var e=(0,a.intval)(Chat.scrollNode.scrollTop);e&&Chat.fixH?Chat.shadowTop||((0,r.addClass)(Chat.wrap,"chat_scroll_top"),(0,c.fadeIn)((0,r.geByClass1)("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!0):Chat.shadowTop&&((0,c.fadeOut)((0,r.geByClass1)("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!1),Chat.lastHeight-e>Chat.maxHeight&&Chat.fixH?Chat.shadowBottom||((0,c.fadeIn)((0,r.geByClass1)("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!0):Chat.shadowBottom&&((0,c.fadeOut)((0,r.geByClass1)("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!1)},scrollWrap:function(e){e||(e=window.event);var t=0;return e.wheelDeltaY||e.wheelDelta?t=(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&(t=10*-e.detail),Chat.scrollNode.scrollTop-=t,curFastChat.activeBox==curFastChat.clistBox?(curFastChat.pointerMargin=0,FastChat.setPointer(!1,curFastChat.pointerMargin,curFastChat.prevPointer)):(curFastChat.pointerMargin=-Chat.scrollNode.scrollTop,FastChat.setPointer(!0,curFastChat.pointerMargin,curFastChat.prevPointer)),FastChat.checkShadow(),(0,r.setStyle)(Chat.ttNode,{top:-Chat.scrollNode.scrollTop}),(0,l.cancelEvent)(e)},togglePeer:function(e,t){return curFastChat.activeBox&&curFastChat.activeBox.options.peer==e?(curFastChat.activeBox.hide(),FastChat.setActive(!1),!1):FastChat.selectPeer(e,t,{entrypoint:"fastchat_icon"})},selectPeer:function(e,t,i){if((0,l.checkEvent)(t))return!0;var _=(0,r.hasClass)(Chat.wrap,"chat_active");if(curFastChat.tabs&&curFastChat.tabs[e]){var o=curFastChat.tabs[e].box;o.minimized&&o.unminimize(!0),FastChat.activateTab(e),FastChat.movePointer(e,_)}else i||(i={}),i.fixed=!0,i.onPeerAdded=function(){FastChat.movePointer(e,_)},i.onHistoryLoaded=FastChat.readLastMessages.pbind(e),FastChat.addPeer(e,!1,!0,i);return curFastChat.tabs[e]&&curFastChat.tabs[e].iman&&(curFastChat.tabs[e].entrypoint=i&&i.entrypoint,curFastChat.tabs[e].iman.unidle()),FastChat.trackActivity("open"),!1},closeTabIcon:function(e,t,i){curFastChat.activeBox&&curFastChat.activeBox.options.peer==e&&!i&&(curFastChat.activeBox.hide(),FastChat.setActive(!1));var _=(0,r.ge)("chat_tab_icon_"+e);(0,r.addClass)(_,"chat_tab_hiding"),delete Chat.tabs[e],curFastChat.tabs[e]&&curFastChat.tabs[e].box.options.fixed&&(curFastChat.tabs[e].iman.stop(),delete curFastChat.tabs[e]);return(0,c.animate)(_,{height:0,opacity:0},{duration:100,onComplete:function(){(0,r.re)(_),_&&(_=!1,curFastChat.activeBox&&FastChat.movePointer(curFastChat.activeBox.options.peer,!0));var e=Chat.scrollNode.scrollTop;FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=e}}),i||FastChat.stateChange({op:"closed",peer:e}),Object.keys(Chat.tabs).length||(0,r.removeClass)(Chat.wrap,"chat_expand"),FastChat.itemsOut(),(0,l.cancelEvent)(t)},getPointerShift:function(e,t,i){var _=i-t,o=Chat.maxHeight+32;return e&&_<62?_-62:e&&_>o?_-o:0},setPointer:function(e,t,i){if(!curFastChat.activeBox)return!1;var _=FastChat.getPointerShift(e,t,i),o=(0,r.geByClass1)("fc_tab_pointer",curFastChat.activeBox.wrap);return(0,r.setStyle)(o,{marginTop:t+_}),_},movePointer:function(e,t){if(!curFastChat.activeBox)return!1;var i,_,o=(0,r.geByClass1)("fc_pointer_offset",curFastChat.activeBox.wrap);if(e){var a,n=(0,r.ge)("chat_tab_icon_"+e);if(!n)return!1;a=!Chat.fixH&&n.nextSibling?(0,r.getXY)(n.nextSibling)[1]-50:n.nextSibling||Chat.fixH?(0,r.getXY)(n)[1]+Chat.scrollNode.scrollTop:(0,r.getXY)((0,r.ge)("chat_tab_wrap"))[1]-50,i=23+(0,r.getXY)(Chat.cont)[1]-a,_=-Chat.scrollNode.scrollTop}else i=28,_=0;var s=FastChat.setPointer(e,_,i);if(t){if(curFastChat.prevPointer){var l=FastChat.getPointerShift(!0,_+s,curFastChat.prevPointer);(0,r.setStyle)(o,{bottom:curFastChat.prevPointer-l+s})}(0,c.animate)(o,{bottom:i},{duration:100})}else(0,r.setStyle)(o,{bottom:i});curFastChat.prevPointer=i},setActive:function(e){curFastChat.activeBox=e,e&&FastChat.moveBoxesLeft(e.pos[1])},moveBoxesLeft:function(e,t){e-=8;var i=!1,_=0;for(var o in curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(o)){var a=curFastChat.tabs[o];if(t||(a.box.movedLeft=!1),!a||a.box.options.fixed||!a.box.toBottom||a.box.movedLeft||a.box.noMove)continue;var r=a.box.pos;r[1]+r[3]>=e&&r[1]>_&&(i=a,_=r[1])}if(i){var n=e-i.box.pos[3],s=i.box.pos[0];n<0&&(n=0),i.box.movedLeft=!0,(0,c.animate)(i.box.wrap,{left:n},200),i.box.pos=[s,n,i.box.pos[2],i.box.pos[3]];var l=getWndInner();FastChat.stateChange({op:"moved",peer:i.box.options.peer,y:s/l[0],x:n/l[1]}),n&&FastChat.moveBoxesLeft(n,!0)}else FastChat.moveLeftY=0},moveBoxAway:function(e,t){for(var i=e.pos[3],_=t-e.pos[3]-20,o=e.pos[0],a=!1;_>0&&!a;)for(var r in a=!0,curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(r)){var n=curFastChat.tabs[r].box.pos;n[0]+n[2]/2>o&&n[1]+n[3]>_&&n[1]<_+i&&(_-=n[3],a=!1)}_<0&&(_=(0,d.positive)(Math.random()*t)),(0,c.animate)(e.wrap,{left:_},300);var s=getWndInner();FastChat.stateChange({op:"moved",peer:e.options.peer,y:o/s[0],x:_/s[1]})},pinTab:function(e,t,i){var _=-1==e?curFastChat.clistBox:curFastChat.tabs[e].box;_.options.fixed=!1,(0,r.removeClass)(_.wrap,"fc_fixed"),FastChat.hideChatCtrl(),FastChat.setActive(!1);var o=_.wrap.offsetTop,n=_.wrap.offsetLeft-10;(0,r.setStyle)(_.wrap,{left:_.wrap.offsetLeft,top:_.wrap.offsetTop,right:"auto",bottom:"auto"}),i||(0,c.animate)(_.wrap,{left:n,top:o},300),_.pos=[o,n,_.pos[2],_.pos[3]],_.toRight=!1,_.toBottom=!0,(0,r.addClass)(_.wrap,"fc_tobottom");var s=_.resizeableW.clientWidth-(0,a.intval)((0,r.getStyle)(_.resizeableW,"paddingRight"))-(0,a.intval)((0,r.getStyle)(_.resizeableW,"paddingLeft")),l=_.resizeableH.clientHeight-(0,a.intval)((0,r.getStyle)(_.resizeableH,"paddingBottom"))-(0,a.intval)((0,r.getStyle)(_.resizeableH,"paddingTop")),d=getWndInner();-1==e?FastChat.stateChange({op:"clist_toggled",val:1,y:_.toBottom?-1:_.pos[0]/d[0],x:_.toRight?-1:_.pos[1]/d[1]}):FastChat.stateChange({op:"unfixed",peer:e,y:_.toBottom?-1:_.pos[0]/d[0],x:_.toRight?-1:_.pos[1]/d[1],h:l/d[0],w:s/d[1]}),_.noMove=!0,FastChat.moveBoxesLeft(n),_.noMove=!1},addPeer:function(e,t,i,_){_||(_={});var o=curFastChat.friends&&curFastChat.friends[e+"_"],a=0;if(i?FastChat.stateChange({op:"added",peer:e,fixed:_.fixed}):curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&t&&(i=!0),o){var r=H(o,e);FastChat.addTabIcon(e,r,_.noAnim),FastChat.addBox(e,r,_),t?(curFastChat.tabs[e].auto=1,FastChat.imFeed(e,t)):(_&&_.nofocus||FastChat.activateTab(e),curFastChat.onlines[e]||FastChat.tabNotify(e,"unavail"),a|=2)}else a=3;a&&(i?(curFastChat.needPeers[e]=[a,t,!1,_],FastChat.getPeers()):(curFastChat.needPeers[e]=[a,t,setTimeout(FastChat.getPeers,(0,d.irand)(150,200)),_],FastChat.lcSend("needPeer",{id:e,mask:a})))},getPeers(){var e=[],t={};Object.keys(curFastChat.needPeers||{}).forEach((i=>{var _=curFastChat.needPeers[i],o=_[0],a=_[2];e.push(i,o),a&&clearTimeout(a),t[i]=o})),e.length&&(FastChat.lcSend("fetchingPeers",t),FastChat.loadPeers(e.join(","),(function(e){FastChat.gotPeers(e),FastChat.lcSend("gotPeers",e)})))},gotPeers:function(e){q()||(0,a.each)(curFastChat.needPeers,(function(t){if(e[t]){U.Ranges.isUserPeerTransitional(e[t])&&(curFastChat.friends[t+"_"]=[e[t].name,e[t].photo,e[t].fname,e[t].hash,(0,a.intval)(e[t].sex)]);var i=this[1],_=this[3];2&this[0]&&void 0===e[t].history||(clearTimeout(this[2]),delete curFastChat.needPeers[t]),curFastChat.tabs[t]?FastChat.gotHistory(t,e[t].history):_.fixedLoad?FastChat.addTabIcon(t,e[t]):(FastChat.addTabIcon(t,e[t]),FastChat.addBox(t,e[t],_),i?(curFastChat.tabs[t].auto=1,FastChat.imFeed(t,i)):(2&this[0]&&FastChat.gotHistory(t,e[t].history),_&&_.nofocus||FastChat.activateTab(t))),_.onHistoryLoaded&&_.onHistoryLoaded()}}))},gotHistory:function(e,t){if((0,d.isArray)(t)&&t.length&&t[0]){var i=curFastChat.tabs[e],_=t[0],o=t[1];i.offset=t[2],(0,a.extend)(i.msgs,o),(0,a.each)(o,(function(e,t){!t[0]&&t[1]&&i.unread++})),(0,r.val)(i.log,_),i.logWrap.scrollTop=i.logWrap.scrollHeight,setTimeout((function(){i.logWrap.scrollTop=i.logWrap.scrollHeight,i.scroll&&i.scroll.update(!1,!0)}),10)}},decHashCb:function(e){var t;t=e,curFastChat.decodedHashes[t]=function(e){for(var t=r.ge?"":"___",i=0;i<e.length;++i)t+=e.charAt(e.length-i-1);return r.geByClass?t:"___"}(t.substr(t.length-5)+t.substr(4,t.length-12))},decodehash:function(e){return curFastChat.decodedHashes||(curFastChat.decodedHashes={}),curFastChat.decodedHashes[e]||FastChat.decHashCb(e),curFastChat.decodedHashes[e]},loadPeers(e,t){ajax.post("al_im.php",{act:"a_get_fc_peers",peers:e},{onDone:t})},sendTyping:function(e){var t=(0,a.intval)(e),i=this.getTab(t),_=Date.now();!U.Ranges.isEmailPeer(t)&&i&&(curFastChat.myTypingEvents[t]&&_-curFastChat.myTypingEvents[t]<5e3||(curFastChat.myTypingEvents[t]=_,ajax.post("al_im.php",{act:"a_activity",type:"typing",peer:t,hash:i.sendhash,from:"fc"})))},setTyping(e){var t=this.getTab(e.peerId),i=e.type===I.ADD_MESSAGE;if(t&&t.typing&&i){var _=t.typing.userIds.filter(((t,i)=>t!==e.userId));0===_.length?delete t.typing:t.typing=Object.assign(t.typing,{userIds:_})}else t&&!i&&(e.ts=Date.now()/1e3,t.typing=Object.assign(e,{userIds:(e.userIds||[]).filter(((e,t)=>e!==vk.id))}))},waitTyping(e){return(0,y.pause)(A.ACTIVITY_PERIOD+2).then((()=>{var t=this.getTab(e.peerId);t&&t.typing&&(Date.now()-1e3*t.typing.ts>=1e3*A.ACTIVITY_PERIOD&&delete t.typing)}))},updateTypings(){var e=curFastChat.tabs||{};Object.keys(e).forEach((e=>{FastChat.updateTyping(e)}))},updateTyping(e,t){var i=this.getTab(e),_=(0,r.ge)("fc_tab_typing"+e),o=(0,r.geByClass1)("_fc_tab_typing_progress",_),a=(0,r.geByClass1)("_fc_tab_typing_name",_);if(i.typing&&i.typing.userIds.length>0){var n=this.formatTyping(i.typing);(0,r.val)(a,n),(0,r.show)(o)}else(0,r.val)(a,""),(0,r.hide)(o);t?(0,r.setStyle)(_,"opacity",1):(0,c.fadeTo)(_,200,1)},formatTyping(e){var t=e.peerId,i=e.userIds,_=this.getTab(t),o=i[0],a=(0,N.isChatPeer)(t)?_.data.members[o]:_,r=e=>e.fname||e.name||"";if(1===i.length||!(0,N.isChatPeer)(t))return(0,g.langSex)(a.sex,(0,g.getLang)("mail_im_typing")).replace("{user}",r(a));var n=i[i.length-1],s=(0,N.isChatPeer)(t)?_.data.members[n]:_;return(0,g.getLang)("mail_im_multi_typing").replace("{users}",r(a)).replace("{last_user}",r(s))},markMessagesAsRead(e){var t=e.type,i=e.peerId,_=e.upToId,o=e.unread,a=this.getTab(i);a&&(t===I.READ_INBOUND&&(a.inUpTo=_),t===I.READ_OUTBOUND&&(a.outUpTo=_),a.unread=o,this.updateUnreadMessagesInTab(i,_,t===I.READ_OUTBOUND)),this.updateTabUnreadCounterElement(a||{unread:0},i)},updateUnreadMessagesInTab(e,t,i){var _=this.getTab(e),o=i?".fc_msgs_unread.fc_msgs_out":".fc_msgs_unread:not(.fc_msgs_out)";if(_&&_.log){var a=_.log.querySelectorAll(o);Array.prototype.forEach.call(a,(e=>{+e.getAttribute("data-message-id")<=t&&e.classList.remove(x)}))}},readLastMessages(e){var t=FastChat.getTab(e);if(e&&t){if(!t.markingRead&&t.unread){var i=[];for(var _ in t.msgs)!t.msgs[_][0]&&t.msgs[_][1]&&i.push(_);i.length>0&&FastChat.markRead(e,i)}t.unread=0,FastChat.updateTabUnreadCounterElement(t,e)}},markRead:function(e,t){var i=this.getTab(e);i.markingRead=!0,ajax.post("al_im.php",{act:"a_mark_read",peer:e,ids:t,hash:i.sendhash,from:"fc"},{onDone:function(_){for(var o in i.markingRead=!1,t){if(t.hasOwnProperty(o))if("continue"===function(){var e=t[o],_=(0,r.ge)("fc_msg"+e),n=_&&_.parentNode;if(!_)return"continue";i.msgs[e]&&i.msgs[e][1]&&(i.msgs[e][1]=0,i.msgs[e][0]||i.unread--),(0,r.removeClass)(_,"fc_msg_unread"),(0,r.hasClass)(n.parentNode,"fc_msgs_unread")&&(0,a.each)(n.childNodes,(function(){if(!(0,r.hasClass)(this,"fc_msg_unread"))return(0,r.removeClass)(n.parentNode,"fc_msgs_unread"),!1}))}())continue}i.unread=0,FastChat.updateTabUnreadCounterElement(i,e)},onFail:function(){i.markingRead=!1}})},getMessageText(e,t){var i=e||"",_=Math.round(1e9*Math.random()).toString(16),o={},a=0;return i=(i=(0,P.replaceHyperLinks)(i,P.linksReplacer)).replace(/(<a.+?<\/a>)/gi,(e=>{var t=`!link_${a}_${_}!`;return o[t]=e,a++,t})),i=(0,O.replaceMentions)(i),i=(0,T.replaceEmailLinks)(i),i=(0,D.replaceHashtags)(i,(e=>`<a href="/im?sel=${t}&st=${encodeURIComponent(e)}">${e}</a>`)),Object.keys(o).forEach((e=>{i=i.replace(e,o[e])})),i=Emoji.emojiToHTML(i,1)},getEditCont:function(e){return window.stManager.add([window.jsc("web/emoji.js")]),'<div class="emoji_cont _emoji_field_wrap">'+Emoji.tplSmile((0,g.getLang)("mail_emoji_hint"))+'<div class="fc_editable dark" tabindex="0" contenteditable="true" placeholder="'+(0,g.getLang)("mail_chat_placeholder")+'"></div></div>'},getInputValue:function(e){return Emoji?Emoji.editableVal(e):""},onTxtResize:function(e){var t=curFastChat.tabs[e],i=(0,r.geByClass1)("fc_tab_txt",t.wrap),_=(0,r.getSize)(i)[1];if(_>40){var o=(0,d.positive)(_-40),n=(0,a.intval)((0,r.getSize)(t.box.resizeableH)[1]);n+t.hDiff-o<40&&(o=n+t.hDiff-40),(0,r.setStyle)(t.box.resizeableH,{height:n+(t.hDiff||0)-o}),t.hDiff=o,FastChat.fixResized(t,t.wrap.clientWidth,!0)}else if(t.hDiff){var s=(0,a.intval)((0,r.getSize)(t.box.resizeableH)[1]);(0,r.setStyle)(t.box.resizeableH,{height:s+t.hDiff}),t.hDiff=0,FastChat.fixResized(t,t.wrap.clientWidth,!0)}},initTab:function(e,t,i){var _=(0,r.geByClass1)("fc_editable",i),o=curFastChat.tabs[e]={name:t.name,fname:t.fname,photo:t.photo,link:t.alink||"/id"+e,hash:t.hash,sendhash:FastChat.decodehash(t.hash),sex:t.sex||0,data:t.data||{},online:t.online,msgs:{},msgscount:0,unread:0,box:!1,wrap:i,editable:1,txt:_,txtWrap:_.parentNode.parentNode,logWrap:(0,r.geByClass1)("fc_tab_log",i),log:(0,r.geByClass1)("fc_tab_log_msgs",i),notify:(0,r.geByClass1)("fc_tab_notify_wrap",i),title:(0,r.geByClass1)("fc_tab_title",i)},a=30;if(o.addMediaBtn=(0,r.geByClass1)("fc_tab_attach",i),o.editable)cur.t=o,o.emojiId=Emoji.init(o.txt,{controlsCont:(0,r.geByClass1)("fc_tab_txt_wrap",i),ttDiff:-46,ttShift:0,rPointer:!0,global:!0,noRce:!0,peer:e,isChat:!0,noCtrlSend:!0,ref:"fast_chat",onSend:FastChat.send.pbind(e),checkEditable:FastChat.checkEditable,onResize:function(){FastChat.onTxtResize(e)},addMediaBtn:o.addMediaBtn,onShow:function(){(0,E.cssAnim)(o.scroll.scrollbar,{opacity:0},{duration:400})},onHide:function(){(0,E.cssAnim)(o.scroll.scrollbar,{opacity:1},{duration:400})},onEsc:function(e){return o.box.hide(),(0,l.cancelEvent)(e)},onStickerSend:function(t,i){FastChat.send(e,t,i)}});else{(0,b.autosizeSetup)(o.txt,{minHeight:15,maxHeight:42}),o.txt.autosize.options.onResize=function(e){if(!o.box.minimized){var t=42==e?42:15;t!=e&&(0,r.setStyle)(o.txt,"height",t),t!=a&&((0,r.setStyle)(o.logWrap,"height",o.logWrap.clientHeight-t+a),a=t,o.scroll&&o.scroll.update(!1,!0))}}}return o.imPeerMedias={},o.imSortedMedias={},o.previewEl=(0,r.geByClass1)("fc_tab_preview",i),window.stManager.add(["page.js","page.css",window.jsc("web/ui_media_selector.js"),"ui_media_selector.css"],(function(){var t=[["photo",(0,g.getLang)("profile_wall_photo")],["video",(0,g.getLang)("profile_wall_video")],["audio",(0,g.getLang)("profile_wall_audio")],["doc",(0,g.getLang)("profile_wall_doc")],["map",(0,g.getLang)("profile_wall_map")]];o.imMedia=new window.MediaSelector(o.addMediaBtn,o.previewEl,t,{limit:10,hideAfterCount:0,maxShown:0,mail:1,tooltip:1,topOffset:0,forceUp:1,global:1,toId:vk.id,from:"message"}),o.imMedia.onChange=setTimeout.pbind((function(){if(curFastChat.sendOnUpload)FastChat.send(curFastChat.sendOnUpload),curFastChat.sendOnUpload=void 0;else{var t=(0,M.loadDraftForPeer)(curFastChat.ldb,e);t.removeAllAttaches(),o.imMedia.getMedias().forEach((e=>t.addAttach(e[0],e[1]))),t.destroy()}FastChat.onTxtResize(e)}),0)})),o},addBox:function(e,t,i){if(void 0===curFastChat.tabs[e]){var o=FastChat.getEditCont(Emoji.last);i=i||{},curFastChat.tabs[e]={};var d=(0,r.se)((0,r.rs)(FastChat.tplBox,{id:e,name:t.name,myphoto:Notifier.fixPhoto(curFastChat.me.photo,!0),cont:o}));i.fixed&&curFastChat.activeBox&&curFastChat.activeBox.hide(0,!1,{noState:!0});var u=FastChat.initTab(e,t,d),f=getWndInner(),h={id:"fc_peer"+e,marginFixedToLayer:!0,peer:e,movable:(0,r.geByClass1)("fc_tab_head",d),closer:(0,r.geByClass1)("fc_tab_close_wrap",d,"a"),resizeableH:u.logWrap,startHeight:250,startWidth:270,fixed:i.fixed,minH:150,minW:270,nofocus:!0,onFocus:function(t){u.auto&&(FastChat.stateChange({op:"added",peer:e}),delete u.auto),FastChat.restoreDraft(e),u.editable?Emoji.editableFocus(u.txt,!1,!0):(0,r.elfocus)(u.txt),u.wrap.clientWidth&&(0,r.setStyle)(u.title,{maxWidth:u.wrap.clientWidth-71}),u.editable||(0,r.setStyle)(u.txt.autosize.helper,{width:(0,r.getStyle)(u.txt,"width",!1)}),u.scroll&&u.scroll.update(!1,!0),setTimeout(r.elfocus.pbind(u.txt),10)},onHide:function(){i.fixed&&FastChat.hideChatCtrl(),curFastChat.activeBox&&e==curFastChat.activeBox.options.peer&&FastChat.setActive(!1)},onClose:function(t){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),this.onHide(),i&&i.beforeClose&&i.beforeClose();var _=curFastChat.tabs,o=_[e].posSeq;if(delete _[e],curNotifier.isIdle||FastChat.stateChange({op:"hidden",peer:e}),o){var n,l,d,u,f,h={},p=[];for((0,a.each)(_,(function(){this.posSeq>o&&(h[this.posSeq]=this,p.push(this.posSeq))})),p.unshift(o),p.sort(),f=!s.browser.msie&&p.length<10,n=1;n<p.length;n++)l=p[n],d=h[l].box,u=n>1?h[p[n-1]].box.pos:t,f?(0,c.animate)(d.wrap,{left:u[1]},100,function(e){e._update_pos()}.pbind(d)):(0,r.setStyle)(d.wrap,{left:u[1]});if(!f)for(n=1;n<p.length;n++)(d=h[p[n]].box)._update_pos()}},onMinimize:function(t){FastChat.stateChange({op:"minimized",peer:e,val:t}),FastChat.fixResized(u,u.wrap.clientWidth,!0),t||(u.txt.blur(),FastChat.restoreDraft(e))},onResizeEnd:function(t,i){var _=getWndInner(),o=u.box.pos;u.scroll&&u.scroll.show(),FastChat.fixResized(u,i,!0),FastChat.stateChange({op:"resized",peer:e,h:t/_[0],w:i/_[1],y:u.box.toBottom?-1:o[0]/_[0],x:u.box.toRight?-1:o[1]/_[1]})},onResize:function(e,t){FastChat.fixResized(u,t);var i=(0,r.geByClass1)("fc_tab_title",u.box.content);(0,r.setStyle)(i,{width:t-78})},onResizeStart:function(){delete u.posSeq,u.scroll&&u.scroll.hide(),(0,r.val)(u.notify,""),clearTimeout(u.hideNotifyTO)},onDragEnd:function(t,i){delete u.posSeq,FastChat.stateChange({op:"moved",peer:e,y:t,x:i})}};if(i&&(0,a.extend)(h,i),void 0===h.startLeft&&void 0===h.startRight){var p=[],b=f[0]-350,E=curFastChat.clistBox.pos,m=!1;if(window.Call&&(Call.box||Call.invitation)){var C=Call.calcBoxPos();p.push([C.x,C.x+C.w]),m=!0}E[0]+E[2]>b&&(curFastChat.clistBox.visible||!m)&&p.push([E[1],E[1]+E[3]]),(0,a.each)(curFastChat.tabs,(function(t){(E=this.box&&this.box.pos)&&t!=e&&E[0]+E[2]>b&&p.push([E[1],E[1]+E[3]])}));var g,v,w,M=lastWindowWidth-262-(0,_.sbWidth)(),P=!1,T=!1,O=0>M?1:-1;for(g=M;O*g<0*O;g+=135*O){for(v=0,w=0;w<p.length;w++)g>p[w][0]-260&&g<p[w][1]&&v++,g>p[w][0]-10&&g<p[w][0]+10&&(v+=1.1);(!1===P||v<T)&&(P=g,T=v)}m&&T&&(P=M),(0,a.extend)(h,{startBottom:0,startLeft:P})}var D,I=!0;for(D in i||{})if("nofocus"!=D){I=!1;break}I&&(u.posSeq=++curFastChat.posSeq),h.fixed&&(h.startHeight=curFastChat.clistH,h.startWidth=curFastChat.clistW,h.onShow=FastChat.showChatCtrl),u.box=new window.RBox(d,h),u.iman=new n.default({id:"tab"+e,element:u.box.content,onUnIdleCb:function(){FastChat.readLastMessages(e)},parentManager:curNotifier.idle_manager,idleTimeout:1e4}),curFastChat.tabs[e].iman.start(),h.fixed&&FastChat.setActive(u.box),u.scroll=new Scrollbar(u.logWrap,{prefix:"fc_",nomargin:!0,nokeys:!0,global:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto",onScroll:FastChat.onScroll.pbind(u)}),h.minimized||!i||void 0===i.startLeft&&void 0===i.startTop&&void 0===i.startWidth&&void 0===i.startHeight||u.box._wnd_resize(f[0],f[1],!0),u.wrap.clientWidth&&(0,r.setStyle)(u.title,{maxWidth:u.wrap.clientWidth-71}),(0,l.addEvent)(u.txt,"keydown",this.onInputKeydown.bind(this,u)),(0,l.addEvent)(u.txt,"keyup",this.onInputKeyUp.bind(this,u,e)),(0,l.addEvent)(u.txt,"focus",this.onInputFocus.bind(this,e)),(0,l.addEvent)(u.log,"click",(t=>this.onLogClick(t,+e))),FastChat.restoreDraft(e),h.onPeerAdded&&h.onPeerAdded()}},onInputFocus(e){curFastChat.peer=e},onInputKeydown(e,t){if(t.ctrlKey&&t.keyCode===l.KEY.RETURN){var i=t.target,_=i.value;if("number"==typeof i.selectionStart&&"number"==typeof i.selectionEnd){var o=i.selectionStart;i.value=_.slice(0,o)+"\n"+_.slice(i.selectionEnd),i.selectionStart=i.selectionEnd=o+1}else if(document.selection&&document.selection.createRange){i.focus(t);var a=document.selection.createRange();a.text="\r\n",a.collapse(!1),s.browser.opera&&(a.moveEnd("character",0),a.moveStart("character",0)),a.select()}e.editable?this.checkEditable(e.emojiId,e.txt):(e.txt.autosize.update(),setTimeout((()=>e.txt.autosize.update()),0))}},onInputKeyUp(e,t){var i=e.lastValue||"",_=this.getInputValue(e.txt);_.length===i.length&&_===i||(_&&this.sendTyping(t),e.lastValue=_),clearTimeout(e.saveDraftTO),e.saveDraftTO=setTimeout(this.saveDraft.pbind(t),_.length?300:0),this.checkEditable(e.emojiId,e.txt)},onLogClick:function(e,t){if(e.target.classList.contains("_fc_call_link")){var i=this.getTab(t);if((0,N.isChatPeer)(t)){var _={peerId:t,name:i.name,tab:i.name,photo:i.photo};window.Calls.startGroupCall(t,[_],[],!1,R.CallStatSource.FAST_CHAT).then((()=>this.closeTab(t)))}else{var o={peerId:t,id:t,link:i.link,name:i.name,firstName:i.fname,lastName:i.name.split(" ")[1],sex:i.sex,photo:i.photo},a=W({},o,{canAddMembers:!0});window.Calls.call(t,!1,[a,[o]],R.CallStatSource.FAST_CHAT).then((()=>this.closeTab(t)))}}},onScroll:function(e){var t=e.scroll.obj.scrollTop,i=(0,r.geByClass1)("_fc_msgs_more",e.logWrap);t<200&&(0,r.isVisible)(i)&&i.click()},loadMore:function(e,t){var i=curFastChat.tabs[e],o=i.offset;if(i.moreLoading)return!1;i.moreLoading=!0,ajax.post("al_im.php",{act:"a_history",peer:e,offset:o,from:"fc"},{onDone:function(e){e[3]||(0,r.hide)(t);var _=t.parentNode,o=_.clientHeight;_.insertBefore((0,r.cf)(e[0]),t.nextSibling);var a=_.clientHeight-o;a&&(i.logWrap.scrollTop+=a),i.scroll.update(),i.offset=e[2],i.moreLoading=!1,FastChat.onScroll(i)},onFail:function(){i.moreLoading=!1},showProgress:_.lockButton.pbind(t),hideProgress:_.unlockButton.pbind(t)})},sendOnResponse:function(e,t,i){if(e.version&&(0,a.intval)(e.version)>curFastChat.version)FastChat.updateVersion(e.version);else{var _=(0,r.ge)("fc_msg"+t),o=e.msg_id,n=(0,a.indexOf)(t,i.newmsgs);if(_){if(e.media){var s={sticker:(0,a.intval)(e.sticker)};FastChat.lcSend("gotMedia",{msgId:t,peer:i.box.options.peer,text:e.media,msgOpts:s}),FastChat.gotMsgMedia(i.box.options.peer,t,e.media,s)}++i.msgscount,-1!=n&&i.newmsgs.splice(n,1),_.id="fc_msg"+o,i.msgs[o]=[1,1]}}},checkEditable:function(e,t){Emoji.checkEditable(e,t,{height:52})},fixResized:function(e,t,i){e&&(e.logWrap.scrollTop=e.logWrap.scrollHeight,t>0&&(0,r.setStyle)(e.title,{maxWidth:t-71}),i&&(e.editable||(0,r.setStyle)(e.txt.autosize.helper,{width:(0,r.getStyle)(e.txt,"width",!1)}),e.scroll&&e.scroll.update(!1,!0)))},activateTab:function(e){var t=curFastChat.tabs[e].box;curFastChat.activeBox&&curFastChat.activeBox!=t&&curFastChat.activeBox.hide(0,!1,{noState:!0}),t.show(),t.options.fixed&&FastChat.setActive(t)},blinkTab:function(e){var t=this.getTab(e);if(!t.blinking&&curFastChat.peer!=e){t.blinking=!0,clearTimeout(t.blinkingTO);var i=t.box.wrap,_=i.className,o=Math.min(S,(0,a.intval)((0,r.getStyle)(i,"zIndex")));(0,r.setStyle)(i,{zIndex:S}),(0,r.removeClass)(i,"rb_inactive"),t.blinkingTO=setTimeout((function(){delete t.blinking,delete t.blinkingTO,(0,r.getStyle)(i,"zIndex")==S&&((0,r.setStyle)(i,{zIndex:o}),i.className=_)}),2e3)}},createProgress:function(e,t,i){var _=(0,r.ce)("span",{innerHTML:(0,r.rs)(vk.pr_tpl,{id:"",cls:""}),className:"fc_msg_progress",id:"fc_msg_progress"+t});return e.insertBefore(_,i),_},removeProgress:function(e){(0,r.re)("fc_msg_progress"+e)},send:function(e,t,i){var _=curFastChat.tabs[e],o=(0,a.trim)(_.editable?Emoji.editableVal(_.txt):(0,r.val)(_.txt)),n="";t?(n=[["sticker",t]],o=""):n=_.imMedia?_.imMedia.getMedias():[];var s=(0,r.ge)("fc_tab_typing"+e),c=(0,r.geByClass1)("page_progress_preview",_.wrap);if(c&&c.childNodes.length>0){curFastChat.sendOnUpload=e;var l=(0,r.geByClass)("fc_tab_log",_.wrap)[0];return FastChat.createProgress(l,e,l.lastChild),void(s.style.visibility="hidden")}if(curFastChat.sendOnUpload=!1,FastChat.removeProgress(e),s.style.visibility="visible",o||n.length){var u=function(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,d.intval)((0,d.rand)(0,2147483647).toFixed(0))}(),f={act:"a_send",to:e,hash:_.sendhash,msg:o,from:"fc",entrypoint:curFastChat.tabs[e].entrypoint||"fastchat_old_default",media:[],random_id:u};i&&(f.sticker_referrer=i);for(var h,p=0,b=n.length;p<b;++p)(h=n[p])&&f.media.push(h[0]+":"+h[1]);f.media=f.media.join(","),_.sending=!0,Emoji.ttHide(_.emojiId),curFastChat.tabs[e].entrypoint=!1,ajax.post("al_im.php",f,{onDone:function(t){clearTimeout(_.saveDraftTO),FastChat.saveDraft(e),FastChat.sendOnResponse(t,u,_)},onFail:function(t){FastChat.error(e,t||(0,g.getLang)("global_unknown_error")),(0,r.elfocus)(_.txt),(0,r.val)(_.txt,(0,a.clean)(o)),_.editable?FastChat.checkEditable(_.emojiId,_.txt):_.txt.autosize.update();var i=(0,r.ge)("fc_msg"+u);if(i)return i.appendChild((0,r.ce)("span",{className:"fc_msg_error",innerHTML:(0,g.getLang)("global_error")})),FastChat.scroll(e),!0},showProgress:function(){_.sending=!0,_.sendProgressTO=setTimeout((function(){var e=(0,r.ge)("fc_msg"+u);e&&FastChat.createProgress(e,u,e.firstChild)}),2e3)},hideProgress:function(){_.sending=!1,clearTimeout(_.sendProgressTO),FastChat.removeProgress(u)}}),(0,r.re)("fc_error"+e),t||((0,r.val)(_.txt,""),_.imMedia&&_.imMedia.unchooseMedia()),FastChat.addMessage(FastChat.prepareMessageData({messageId:u,text:(0,a.clean)(o).replace(/\n/g,"<br>"),peerId:e,flags:3,randomId:f.random_id,attaches:[]})),delete curFastChat.myTypingEvents[e],_.editable?FastChat.checkEditable(_.emojiId,_.txt):_.txt.autosize.update(!1,!0),(0,r.elfocus)(_.txt),FastChat.scroll(e),FastChat.trackActivity("send")}else _.editable?Emoji.editableFocus(_.txt,!1,!0):(0,r.elfocus)(_.txt)},saveDraft:function(e){var t=curFastChat.tabs[e],i=(t||{}).txt;if(i&&t){var _=Emoji.editableVal(i),o=(0,M.loadDraftForPeer)(curFastChat.ldb,e);o.setText((0,a.trim)(_)||""),o.destroy()}},restoreDraft:function(e){var t=curFastChat.tabs[e],i=t.txt,_=(0,M.loadDraftForPeer)(curFastChat.ldb,e);return!(!i||!t||(0,r.val)(i).length>_.dData.txt.length&&!_.hasAttaches())&&(t.editable?i.innerHTML=Emoji.emojiToHTML((0,a.clean)(_.dData.txt),1):(0,r.val)(i,(0,a.clean)(_.dData.txt)),setTimeout((()=>{for(var e=_.dData.attaches,i=0;i<e.length;i++)t.imMedia&&t.imMedia.chooseMedia(e[i].type,e[i].id,e[i].object||{});_.destroy()}),40),FastChat.checkEditable(t.emojiId,i),setTimeout((function(){i.scrollTop=i.scrollHeight}),10),!0)},error:function(e,t){e=e||curFastChat.peer;var i=curFastChat.tabs[e];(0,r.re)("fc_error"+e),i.log.appendChild((0,r.ce)("div",{id:"fc_error"+e,className:"fc_msgs_error",innerHTML:t||(0,g.getLang)("global_error")})),FastChat.scroll(e)},scroll:function(e){e=e||curFastChat.peer;var t=curFastChat.tabs[e];t&&(t.logWrap.scrollTop=t.logWrap.scrollHeight,t.scroll&&t.scroll.update(!1,!0))},mkdate:function(e){var t=new Date(1e3*e),i=new Date,_=function(e){return(e+"").length<2?"0"+e:e};if(t.getDay()==i.getDay())return _(t.getHours())+":"+_(t.getMinutes());var o=_(t.getDate())+"."+_(t.getMonth()+1);return t.getFullYear()!=i.getFullYear()&&(o+="."+(t.getFullYear()+"").substr(2)),o},prepareMessageData(e){var t=e.peerId,i=e.flags,_=e.messageId,o=e.text,a=e.date,r=(0,L.getUserId)(e),n=this.getMessageMedia(e),s=n[0],c=n[1],l="",d=e.randomId;((0,L.isServiceMsg)(e)||(0,L.isCallMessage)(e))&&(l=this.renderServiceMessage(e));var u=(0,L.isServiceMsg)(e)||(0,L.isCallMessage)(e)?l:(0,L.isExpiredCasperMessage)(e)?(0,g.getLang)("mail_expired_message"):this.getMessageText(o,t)+s;return-1!==String(_).indexOf("rid")&&(d=Number(_.slice(3))),Object.assign({id:_,peer:t,from_id:r,text:u,out:(0,L.isOut)(e),unread:Boolean(1&i),date:a,date_str:FastChat.mkdate(a),randomId:d,isServiceMessage:(0,L.isServiceMsg)(e)||(0,L.isCallMessage)(e)},this.getMessageAuthor(e),c)},getMessageAuthor(e){var t=e.peerId,i=(0,L.getUserId)(e),_=this.getTab(e.peerId);if(!_||!i)return{};var o=(0,L.isOut)(e)?curFastChat.me:(0,N.isChatPeer)(t)?_.data.members[i]:_,a=o.name,r=o.link,n=o.photo,s=o.fname,c=o.first_name;return{fname:(0,N.isChatPeer)(t)?s||c:"",from_id:i,name:a,link:r,photo:n}},getMessageMedia(e){var t=e.peerId,i=e.messageId;if((0,L.isServiceMsg)(e)||(0,L.isCallMessage)(e)||!Array.isArray(e.attaches))return["",{}];var _="",o={};return e.attaches.forEach((e=>{switch(e.type){case"sticker":_+=i?this.renderSticker(e.id,e.productId,e.kind,i):this.renderSticker(e.id,e.productId),o.sticker=!0;break;case"mail":var a=e.object?e.object.fwd_count:e.id.split(";").length;_+=(0,r.rs)(curFastChat.tpl.msg_fwd,{msg_id:i,peerId_nice:(0,N.convertPeerToUrl)(t),label:(0,g.getLang)(a>1?"mail_im_fwd_msgs":"mail_im_fwd_msg")});break;default:_+=(0,r.rs)(vk.pr_tpl,{id:"",cls:""}),i>0&&setTimeout(FastChat.needMsgMedia.pbind(t,i),5)}})),_&&(_=`<div class="fc_msg_attachments" id="fc_msg_attachments${i}">${_}</div>`),[_,o]},renderSticker(e,t,i,_){var o,a=window.devicePixelRatio>=2?"256":"128";return"animation"===i?(o=(0,r.rs)(curFastChat.tpl.animatedSticker,{id:e,size:a,productId:t,messageId:_}),Number.isInteger(_)&&this.loadStickersModuleIfNeed().then((()=>{window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer("animatedSticker"+_,10)}))):o=(0,r.rs)(curFastChat.tpl.sticker,{id:e,size:a}),o},loadStickersModuleIfNeed:()=>new Promise((e=>{var t=Boolean(window.StickersSettings&&window.StickersAnimation);curFastChat.stickersLoading||t?e():(curFastChat.stickersLoading=!0,window.stManager.add([window.jsc("web/stickers.js")],(()=>{curFastChat.stickersLoading=!1,e()})))})),renderServiceMessage(e){if((0,L.isCallMessage)(e))return this.renderCallMessage(e);var t=e.kludges,i=e.peerId,_=t.source_act,o=Number(t.source_mid),r=(0,a.intval)((0,N.isChatPeer)(e.peerId)?t.from:e.userId),n=this.getMember(i,r),s="",c=r===o;switch(_){case N.CREATE_CHAT_ACTION:s="mail_im_chat_created";break;case N.CHAT_TITLE_ACTION:s=t.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case N.CHAT_INVITE_USER:s=c?"mail_im_returned_to_chat":"mail_im_invited";break;case N.CHAT_KICK_USER:s=c?"mail_im_left":"mail_im_kicked_from_chat";break;case N.CHAT_PHOTO_UPDATE:s="mail_im_photo_set";break;case N.CHAT_PHOTO_REMOVE:s=t.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case N.CHAT_PIN_MESSAGE:s=t.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case N.CHAT_UNPIN_MESSAGE:s=t.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case N.CHAT_INVITE_BY_LINK:s="mail_im_invite_by_link";break;case N.CHAT_SCREENSHOT:s=vk.id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case N.CHAT_GROUP_CALL_STARTED:s="mail_im_group_call_started";break;case N.CHAT_KICK_USER_CALL_BLOCK:s="mail_im_kick_user_call_block";break;case N.CHAT_KICK_DON:s="mail_im_chat_kick_don";break;default:return"mail_no_support"}if(s=(s=(0,g.langSex)(n.sex,(0,g.getLang)(s,"raw"))).replace("{from}",(0,F.getServiceLinkTemplate)(n.link,n.name,!0)),o&&o!==r){var l=t.source_email;if(l)s=s.replace("{user}",(0,F.getServiceLinkTemplate)(`/im?email=${encodeURIComponent(l)}`,"email",!0));else{var u=this.getMember(i,o)||{name_inv_case:"",name_kick_case:"",link:""},f=_===N.CHAT_KICK_USER?u.name_kick_case:u.name_inv_case;s=s.replace("{user}",(0,F.getServiceLinkTemplate)(u.link,f,!0))}}if(t.source_text){var h=t.source_old_text?`«<b class="im_srv_lnk">${t.source_old_text}</b>» &rarr; `:"";s=s.replace("{title}",h+`«<b class="im_srv_lnk">${t.source_text}</b>»`)}if(t.source_act===N.CHAT_PIN_MESSAGE||t.source_act===N.CHAT_UNPIN_MESSAGE)if(t.source_message){var p=(0,N.replaceSpecialSymbols)(Emoji.emojiToHTML((0,d.stripHTML)(t.source_message.replace(/<br\s?\/?>/gi," ")),!0)),b=(0,F.getServiceLinkTemplate)("",p,!1,"im_srv_mess_link");s=s.replace("{msg}",b)}else s=s.replace(/{link}(.+){\/link}/i,((e,t)=>(0,F.getServiceLinkTemplate)("",t,!1,"im_srv_mess_link")));return s},renderCallMessage(e){var t,i=vk.id,_=e.attaches[0],o=_.initiatorId,r=_.state,n=_.receiverId,s=i===o;switch(r){case"reached":var c=(0,N.secondsToHuman)(_.duration);t=(t=s?(0,g.getLang)("mail_call_outgoing"):(0,g.getLang)("mail_call_incoming")).replace("{duration}",c);break;case"canceled_by_initiator":t=s?(0,g.getLang)("mail_call_canceled"):(0,g.getLang)("mail_call_missed");break;case"canceled_by_receiver":if(s){var l=H(curFastChat.friends[n+"_"],n);t=l?(0,g.langSex)(l.sex,(0,g.getLang)("mail_call_declined_by","raw")).replace("{user_name}",l.name):(0,g.getLang)("mail_call_declined")}else t=(0,g.getLang)("mail_call_canceled");break;default:t=(0,g.getLang)("mail_added_call")}return(0,a.getTemplate)("im_calls_link",{text:t,peerId:e.peerId})},getMember(e,t){var i=this.getTab(e);return(0,N.isChatPeer)(e)&&i?i.data.members[t]:i||null},needMsgMedia:function(e,t){t<=0||(FastChat.lcSend("needMedia",{msgId:t}),curFastChat.needMedia[t]=[e,setTimeout(FastChat.loadMsgMedia.pbind(e,t),curNotifier.is_server?0:(0,d.irand)(150,250))])},loadMsgMedia:function(e,t){t<=0||void 0!==curFastChat.gotMedia[t]&&0!==curFastChat.gotMedia[t]||(FastChat.lcSend("fetchingMedia",{msgId:t}),curFastChat.gotMedia[t]=0,ajax.post("al_im.php",{act:"a_get_media",id:t,from:"fc"},{onDone:function(i){i[0];var _=i[1],o=(i[2],i[3]);FastChat.lcSend("gotMedia",{msgId:t,peer:e,text:_,msgOpts:o}),FastChat.gotMsgMedia(e,t,_,o)}}))},gotMsgMedia:function(e,t,i,_){if((0,r.val)("fc_msg_attachments"+t,i),_&&_.sticker){var o=(0,r.ge)("fc_msg"+t),a=o&&o.parentNode;o&&(0,r.addClass)(a.parentNode,"fc_msg_sticker"),window.StickersAnimation&&window.StickersAnimation.checkSettingsAndLoadInWeb(t,!1,!1,!0)}FastChat.scroll(e),curFastChat.gotMedia[t]=[e,i,_],_&&_.stickers&&window.Emoji&&Emoji.updateTabs(_.stickers,_.keywords),void 0!==curFastChat.needMedia[t]&&(clearTimeout(curFastChat.needMedia[t][1]),delete curFastChat.needMedia[t])},replaceSpecialSymbols:function(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,"$1$4")},addMessage:function(e){var t,i=e.peer,_=this.getTab(i),o=_.log;if(!_||e.out||!_.box.visible||_.iman.is_idle||curNotifier.idle_manager.is_idle||(e.unread=!1,FastChat.markRead(e.peer,[e.id])),e.randomId&&(0,r.re)(document.querySelector(`[data-random-id="${e.randomId}"]`)),_.msgs[e.id]=[e.out,e.unread],this.isNewStack(e)){(0,r.re)("fc_log_empty"+i);var a=(e.out?"fc_msgs_out ":"")+(e.unread?"fc_msgs_unread":"");e.sticker&&(a+=" fc_msg_sticker");var n=e.isServiceMessage?curFastChat.tpl.msgs_service:e.out?curFastChat.tpl.msgs_out:curFastChat.tpl.msgs;t=(0,r.se)((0,r.rs)(n,{from_id:e.from_id,link:e.link,photo:Notifier.fixPhoto(e.photo),name:e.from_id==curFastChat.me.id?(0,g.getLang)("mail_im_thats_u"):(0,d.stripHTML)(e.name),classname:a,date:e.date,date_str:e.date_str,msgs:"",randomId:e.randomId||0,messageId:e.id})),o.appendChild(t)}else e.unread||(0,r.removeClass)(t,"fc_msgs_unread");var s=(0,r.geByClass1)("fc_msgs_list",t,"div"),c=(0,r.geByClass1)("fc_msgs_date",s),l=(0,r.geByClass1)("fc_msg_last",s);l&&(0,r.removeClass)(l,"fc_msg_last");var u=FastChat.replaceSpecialSymbols(e.text),f=(0,r.se)((0,r.rs)(curFastChat.tpl.msg,{msg_id:e.id,classname:(e.unread?"fc_msg_unread":"")+" fc_msg_last",text:e.isServiceMessage?`<div class="fc_srv_msg">${u}</div>`:u}));(0,r.domFC)(s)&&"BR"===(0,r.domFC)(s).tagName&&(0,r.re)((0,r.domFC)(s)),c?s.insertBefore(f,c):s.appendChild(f),vk.id!=e.from_id&&(delete curFastChat.typingEvents[i],FastChat.updateTyping(i,1)),_.scroll&&_.scroll.update()},getTab:e=>curFastChat.tabs[e],isTabLoaded(e){return Boolean(curFastChat.tabs&&this.getTab(e))},isNewStack(e){var t=this.getTab(e.peer).log.lastChild;return t&&"fc_msgs_error"==t.className&&(t=t.previousSibling),!t||(!(0,r.hasClass)(t,"fc_msgs_wrap")||(!(0,r.hasClass)(t,"fc_msgs_unread")&&!0===e.unread||(t.getAttribute("data-from")!==e.from_id||(e.date-(0,a.intval)(t.getAttribute("data-date"))>=300||!(!e.sticker&&!(0,r.hasClass)(t,"fc_msg_sticker"))))))},editMessage(e){var t=e.id,i=(0,r.ge)("fc_msg"+t);if(i){var _=(0,r.se)((0,r.rs)(curFastChat.tpl.msg,{msg_id:t,classname:i.getAttribute("class"),text:FastChat.replaceSpecialSymbols(e.text)}));i.parentNode.replaceChild(_,i)}},deleteMessage(e){var t=e.id,i=(0,r.ge)("fc_msg"+t);if(i){var _=!(0,r.domNS)(i)&&!(0,r.domPS)(i),o=(0,r.domClosest)("fc_tab_log_msgs",i);for((0,r.re)(_?(0,r.domClosest)("fc_msgs_wrap",i):i);(0,r.hasClass)((0,r.domLC)(o),"fc_msgs_date");)(0,r.re)((0,r.domLC)(o))}},updateTabUnreadCounter(e,t){if(!e){var i=document.querySelector(`#chat_tab_icon_${t.peerId}`),_=i&&i.querySelector(".chat_tab_counter");e={unread:_&&Math.max(+_.innerHTML,0)||0}}(0,L.isOut)(t)?e.unread=0:e.unread++,this.updateTabUnreadCounterElement(e,t.peerId)},updateTabUnreadCounterElement(e,t){if(e){var i=document.querySelector(`#chat_tab_icon_${t}`),_=i&&i.querySelector(".chat_tab_counter");_&&(_.innerHTML=e.unread>0?e.unread:""),e.title&&e.name&&((0,r.val)(e.title,e.name+(e.unread?' <span class="fc_tab_count">('+e.unread+")</span>":"")),(0,r.val)("fc_contact_unread"+t,e.unread?" <b>+"+e.unread+"</b>":""))}},showMsgFwd:function(e){return!(0,f.showBox)("al_im.php",{act:"a_show_forward_box",id:vk.id+"_"+e,from:"mail"},{stat:["im.css"],dark:1,params:{onHide:function(){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)}}})},closeTab:function(e){curFastChat.tabs[e].box.close()},trackActivity(e){(0,B.statlogsValueEvent)("im_fastchat_location",e,window.cur.module)},toggleFastChats(e){var t=!e;(0,r.toggleClass)((0,r.ge)("chat_onl_wrap"),"fast_chats_toggle_hide",t),(0,r.toggleClass)((0,r.ge)("rb_box_fc_clist"),"fast_chats_toggle_hide",t),(0,a.each)((0,r.geByClass)("rb_box_wrap"),(()=>(0,r.toggleClass)(this,"fast_chats_toggle_hide",t)))},toggleFullScreenState(e){e?document.body.classList.add(K):document.body.classList.remove(K)},getFullScreenState:()=>document.body.classList.contains(K),tplBox:'<div class="fc_tab_wrap"><div class="fc_tab_head clear_fix"><a class="fc_tab_close_wrap"><div class="chats_sp fc_tab_close"></div></a><a class="fc_tab_max_wrap" href="/im?sel=%id%" onmousedown="event.cancelBubble = true;" onclick="return nav.go(this, event);"><div class="chats_sp fc_tab_max"></div></a><a class="fc_tab_pin_wrap" onmousedown="event.cancelBubble = true;" onclick="return FastChat.pinTab(%id%, event);"><div class="chats_sp fc_tab_pin"></div></a><div class="fc_tab_title noselect">%name%</div></div><div class="fc_tab"><div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><a class="fc_tab_attach"></a><div class="fc_tab_txt">%cont%<div class="fc_tab_preview"></div></div></div></div><div class="fc_pointer_offset"><div class="fc_tab_pointer fc_tab_pointer_peer"></div></div></div>',tplTab:'<div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><div class="fc_tab_txt">%cont%</div></div>'};var j=i(12202);window.DesktopNotifications={supported:function(){return!!window.Notification},checkPermissionNeeded:function(){return"granted"===Notification.permission?0:1},requestPermission:function(e){window.Notification.requestPermission(e).finally((function(){}))},createNotification:function(e,t,i){var _;return(_=new Notification(t,{icon:e,body:i})).cancel=function(){this.close()},_.show=function(){},(0,j.statlogsProbValueEvent)(.1,"browser_notification",1),_}};i(69906);window.getWndInner=function(){var e=window.lastWindowWidth,t=window.lastWindowHeight,i=(0,_.sbWidth)();return(!1!==window.lastWndScroll[0]?window.lastWndScroll[0]:window.htmlNode.scrollHeight>window.htmlNode.clientHeight)&&(e-=i+(i?1:0)),[t,e]},window.lastWndScroll=[!1,!1];window.updateWndVScroll=function(){var e=!1;e=window.boxLayerWrap&&(0,r.isVisible)(window.boxLayerWrap)?window.boxLayerWrap.scrollHeight>window.boxLayerWrap.clientHeight?1:0:window.layerWrap&&(0,r.isVisible)(window.layerWrap)?window.layerWrap.scrollHeight>window.layerWrap.clientHeight?1:0:!(!window.mvLayerWrap||!(0,r.isVisible)(window.mvLayerWrap))&&(window.mvLayerWrap.scrollHeight>window.mvLayerWrap.clientHeight?1:0),(0,a.each)(window.curRBox.tabs,(function(){this.options.marginFixedToLayer&&(0,r.setStyle)(this.wrap,{marginRight:(0,r.hasClass)(document.body,"layers_shown")?(0,_.sbWidth)():0})})),e!==window.lastWndScroll[0]&&(window.lastWndScroll[0]=e,(0,a.each)(window.curRBox.tabs,(function(){this.toRight&&!this.options.marginFixedToLayer&&(0,r.setStyle)(this.wrap,{marginRight:e?(0,_.sbWidth)():0})})))};window.defBox=function(e,t){var i,_='<div class="'+(e.subClass||"")+'"><div class="fc_tab_head"><a class="fc_tab_close_wrap fl_r"><div class="chats_sp fc_tab_close"></div></a><div class="fc_tab_title noselect">%title%</div></div><div id="fc_ctabs_cont"><div class="fc_ctab fc_ctab_active">%content%</div></div></div></div>';i=e.content?'<div class="fc_content_wrap"><div class="fc_content">'+e.content+"</div></div>":e.innerHTML;var n=(0,r.se)((0,r.rs)(_,{title:e.title,content:i}));i=(0,r.geByClass1)("fc_content",n,"div");var s,c={movable:(0,r.geByClass1)("fc_tab_head",n),hider:(0,r.geByClass1)("fc_tab_close_wrap",n,"a"),startLeft:e.x,startTop:e.y,startHeight:e.height,startWidth:e.width,resizeableH:i,resize:!1,minH:e.minH,onBeforeHide:e.onBeforeHide||function(){},onHide:e.onHide||function(){},onDragEnd:function(){},onResize:function(){}},l=new window.RBox(n,(0,a.extend)(c,e));return e.content&&(s=new window.Scrollbar(i,{prefix:"fc_",more:o.debugLog,nomargin:!0,global:!0,nokeys:!0,right:window.vk.rtl?"auto":0,left:window.vk.rtl?0:"auto",onHold:e.onHold})),t({id:l.id,cont:i,update:function(){s&&s.update()}}),l};try{window.stManager.done("notifier.js")}catch(e){}},10124:(e,t,i)=>{i.d(t,{createMutations:()=>r,createModule:()=>c,destroyModule:()=>l});var _=i(70655),o=i(67784),a=i(49535);function r(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(t),!1))}}}function n(e,t,i,_){(0,a.addEvent)(t,i,_),e._registeredHandlers.push({handlerType:"bind",elem:t,types:i,handler:_})}function s(e,t,i,_,a,r){(0,o.addDelegateEvent)(t,i,_,a,r),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:i,selector:_,handler:a})}function c(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return n.apply(void 0,(0,_.__spreadArray)([t],(0,_.__read)(e),!1))}),(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return s.apply(void 0,(0,_.__spreadArray)([t],(0,_.__read)(e),!1))})),t}function l(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,i=e.elem,_=e.types,r=e.handler;"delegate"===t?(0,o.removeDelegateEvent)(i,_,e.selector,r):(0,a.removeEvent)(i,_,r)})),e._registeredHandlers=[]}},97332:(e,t,i)=>{i.d(t,{MARKET_NOTIFY_ID__HS_MIGRATION_STATE:()=>r,onHappySantaMarketMigrationStateChanged:()=>s});var _=i(18253),o=i(15544),a=i(54612),r="happy_santa_market_migration_state";function n(){window.wkcur&&window.cur&&window.WkView&&(window.wkcur.onHide=null,window.cur.isMigrateAvailable=!1,window.WkView.hide())}function s(e){if(void 0!==e.add&&void 0!==e.add.state&&void 0!==e.add.group_id){var t=Number(e.add.state),i=Number(e.add.group_id);if(1!==t)switch(t){case 3:var r=_.GROUP_ORDERS_DEFAULT_COLUMNS.map((function(e,t){return{id:e,order:t,isEnabled:"merchantComment"!==e&&"deliveryOption"!==e}})),s=_.GROUP_ORDERS_COLUMNS_STORAGE_KEY+"_"+i;window.ls.set(s,r);var c=document.querySelector("#group_edit_market_settings_link");c&&(0,o.show)(c),n();break;case 2:n();var l=e.add.info_title?String(e.add.info_title):"",d=e.add.info_text?String(e.add.info_text):"";l&&d&&window.cur.isMigrationInProgress&&(0,a.showFastBox)(l,d)}}}},59483:(e,t,i)=>{i.d(t,{lpSingletonGetInstance:()=>q,lpSingletonOnNotifierRecv:()=>z,lpSingletonOnTabInitialLoaded:()=>H,lpSingletonSyncWithNotifier:()=>j});var _=i(70655),o=i(91040),a=i(87294),r=i(63825),n=i(19331),s=(0,n.partConfigEnabled)("me_web_read_by_cmid")?15:14;function c(e,t){e.waitAbortFns.push(t)}function l(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),i=t.request,r=t.cancel;return e.stopFn=r,i.then((function(t){var i=(0,_.__read)(t,2),o=i[0],a=i[1];return e.onData(e,a),e.waitTimeout=2,JSON.parse(o)})).catch((function(t){var i=(0,_.__read)(t,2)[1];return e.onData(e,i),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var i=t.failed?(0,o.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},a=i.abort,r=i.pause;switch(t.failed){case 1:return c(e,a),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)}));case 2:return c(e,a),e.onKeyExpired(e,t).then((function(t){var i=(0,_.__read)(t,4),o=i[0],a=i[1],r=i[2],n=i[3];return e.onResult({ts:+n,updates:[[-2,o,a+"/"+r],[-1]]})})).then(r).then((function(){return l(e)}));case 3:return e.onLpBroken(e,t);default:return t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)})):Promise.resolve(t)}}(e,t)}))}function d(e){e.isStoppedFn()||l(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&u(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);var i=(0,o.abortablePause)(e.waitTimeout,null),_=i.abort,a=i.pause;return c(e,_),a().then((function(){return u(e,-4)}))}(e,t)})).then((function(){return d(e)}))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function f(e){return e||function(){}}function h(e){return e?function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return Promise.resolve(e.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(t),!1)))}:function(){return Promise.reject()}}function p(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(window.vk.lpConfig.debug){var a="background: "+e+"; color: white",r=new Date,n=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,(0,_.__spreadArray)(["%c "+r.getHours()+":"+n(r.getMinutes())+":"+n(r.getSeconds())+":"+r.getMilliseconds()+" "+t+" ",a],(0,_.__read)(i),!1))}}function b(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function E(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function m(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function C(){var e;m()&&(E().forEach((function(e){!b().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,p("red","im not fc",e.ev))})),b().forEach((function(e){var t=E().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,p("red","now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=b().filter((function(t){return t.time>e})),window.lpBufferIm=E().filter((function(t){return t.time>e}))}window.longpollTestingOnImEvents=function(e){var t;m()&&((t=E()).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),!1)),setTimeout(C,1100)),p.apply(void 0,(0,_.__spreadArray)(["blue","im"],(0,_.__read)(e),!1))};var g=i(54593),v=i(60615);function w(e,t){return function(e,t){var i=!!e.stopped,_={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||s,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return i},onResult:function(e){e.ts&&a(_.ts,e.ts,e.updates.map(r.constructEvent))},onData:f(t.onData),onRequestError:f(t.onRequestError),onHistoryLost:h(t.onHistoryLost),onKeyExpired:h(t.onKeyExpired),onLpBroken:h(t.onHistoryLost)},o=t.onEvents;function a(e,t,i){_.ts=t;for(var a=0;a<i.length;++a)i[a].type===r.REFRESH_LP_KEY&&(_.key=i[a].key||"",_.url=i[a].url||"");o(e,t,i)}var n={options:_,isStopped:function(){return i},stopConnection:function(){i=!0,_.stopFn&&_.stopFn(),_.stopFn=void 0,document.removeEventListener("resume",c),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",c),u(_,-4),i=!1,d(_)},abortWaiting:function(){_.waitAbortFns.forEach((function(e){return e()})),_.waitAbortFns=[],_.waitTimeout=2},onLp:a};function c(){n.abortWaiting()}return document.addEventListener("resume",c),d(_),n}(e,{onEvents:t,onData:T,onRequestError:O,onHistoryLost:D,onKeyExpired:I,onLpBroken:k})}var M={},P=Date.now();function T(e,t){if(t&&t.status&&e.lpstat){var i=t.status.toString();t.status>=500&&t.status<600&&(0,v.statlogsValueEvent)("fc_longpoll",1,i,t.getResponseHeader("x-frontend")||""),M[i]=i in M?M[i]+1:1,Date.now()-P>=3e4&&(Object.keys(M).forEach((function(e){(0,v.statlogsValueEvent)("fc_longpoll",M[e],e,t.getResponseHeader("x-frontend")||"")})),M={},P=Date.now())}}function O(e){p("red","LP error",e.message||"no message (probably browser reset)")}function D(e,t){p("red","LP failed: old timestamp; resync, next ts",t.ts)}function I(e){return p("red","LP failed: key is incorrect; refresh key"),(0,a.post)(g.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function k(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}function y(e,t,i){var o=0,a=e,r=[],n=!1;function s(){!r.length||o>0||n||(t(r),r=[])}return{pause:function(){o++},resume:function(){o>0&&(o--,s())},onLp:function(e,t,o){n||(a>=e?(a=t,r.push.apply(r,(0,_.__spreadArray)([],(0,_.__read)(o),!1)),s()):i&&(n=!0,i(a).then((function(e){var t=(0,_.__read)(e,3),i=t[1],o=t[2];a=i,n=!1,r.push.apply(r,(0,_.__spreadArray)([],(0,_.__read)(o),!1)),s()}))))}}}var B=i(26271),L=i(95724),N=i(94795),A=i.n(N),R=window.lpConnect,F=window.lpInstance;function U(){return window.vk.id>0}function W(){return Boolean(window.curNotifier&&window.curNotifier.lp_connected)}function S(){return window.curNotifier&&window.curNotifier.is_server||B.browser.safari}function x(e,t,i){F.onLp(e,t,i),W()&&S()&&(e!=t||i.length)&&function(e,t,i){window.Notifier.lcSend("lp_data",{tsOld:e,tsNow:t,evs:i}),p("silver","broadcast to others",e,t,i)}(e,t,i)}function K(){var e=new(A()),t=y(window.vk.lpConfig.ts,(function(t){!function(e){var t;m()&&((t=b()).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),!1)),setTimeout(C,0)),p.apply(void 0,(0,_.__spreadArray)(["green","fc"],(0,_.__read)(e),!1))}(t),e.trigger("data",t)}),G);window.lpInstance=F={onData:function(t){e.on("data",t)},offData:function(t){e.off("data",t)},pause:function(){t.pause()},resume:function(){t.resume()},push:function(t){e.trigger("data",t)},abortWaiting:function(){R.abortWaiting()},onLp:function(e,i,_){t.onLp(e,i,_)},isEnabled:function(){return R&&!R.isStopped()}}}function q(){return U()?(F||(window.vk.lpConfig.url&&0!==window.vk.lpConfig.enabled||(window.vk.lpConfig.stopped=!0),window.vk.lpConfig.id=window.vk.id,window.lpConnect=R=w(window.vk.lpConfig,x),K()),F):null}function H(){var e,t;U()&&(p("orange","init longpoll connection on load"),q(),null===(t=null===(e=window.curNotifier)||void 0===e?void 0:e.idle_manager)||void 0===t||t.on("unidle",(function(){R.abortWaiting()})),j())}function j(){U()&&(W()?R.isStopped()&&S()?(p("orange","now master, init connection"),R.reinitConnection()):R.isStopped()||S()||(p("orange","now slave, stop connection"),R.stopConnection()):setTimeout(j,500))}function z(e){W()&&!S()&&U()&&(p("silver","recv from master",e.tsOld,e.tsNow,e.evs),R.onLp(e.tsOld,e.tsNow,e.evs))}function G(e){var t=(0,L.extend)({},window.lpConnect.options,{ts:e});return p("orange","createLongpoll to load from",e),new Promise((function(e){var i=w(t,(function(t,_,o){p("orange","Loaded ["+t+","+_+")"),i.stopConnection(),e([t,_,o])}))}))}},16850:(e,t,i)=>{function _(e){var t,i;if(null!==(i=t=e)&&"object"==typeof i&&("queue"in t||"key"in t&&"string"==typeof t.key))return e.queue||e.key}i.d(t,{subscriptionObjectStableId:()=>_})},74880:(e,t,i)=>{i.d(t,{UserSatisfactionModeration:()=>g});var _=i(70655),o=i(85893),a=i(67294),r=i(88420),n=i(64107),s=i(81117),c=function(e){function t(t){return e.call(this,t)||this}return(0,_.__extends)(t,e),t.prototype.render=function(){return(0,o.jsx)("div",(0,_.__assign)({className:"CloseButton__container",onClick:s.destroyComponentInBox},{children:(0,o.jsx)(n.default,{className:"CloseButton__icon"},void 0)}),void 0)},t}(a.Component);const l=(0,i(63192).makeIcon)("Icon36Favorite","favorite_36","0 0 36 36",'<symbol fill="none" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" id="favorite_36"><path d="m23.015 12.727 6.645.638c2.312.222 3.02 2.48 1.235 3.964l-5.201 4.323 1.93 7.043c.635 2.313-1.333 3.713-3.303 2.321L18 26.551l-6.32 4.465c-1.963 1.386-3.939-.008-3.304-2.321l1.93-7.043-5.201-4.323c-1.793-1.49-1.087-3.741 1.235-3.964l6.643-.638L15.91 5.98c.917-2.113 3.264-2.112 4.18 0z" fill="currentColor" /></symbol>',36,36,!1,void 0);var d=i(59397),u=[1,2,3,4,5],f=function(e){function t(t){var i=e.call(this,t)||this;return i.state={hover:0},i}return(0,_.__extends)(t,e),t.prototype.isSelected=function(e){return this.state.hover?e<=this.state.hover:this.props.selected>=e},t.prototype.render=function(){var e=this;return(0,o.jsxs)("div",(0,_.__assign)({className:this.props.className,onMouseLeave:function(){e.setState({hover:0})}},{children:[(0,o.jsx)("div",(0,_.__assign)({className:"RatingInput__description"},{children:this.props.description}),void 0),(0,o.jsx)("div",(0,_.__assign)({className:"RatingInput__container"},{children:u.map((function(t){return(0,o.jsx)(l,{onMouseEnter:function(){return e.setState({hover:t})},onClick:function(){return e.props.onChange(t)},className:(0,d.classNames)("RatingInput__star",{"RatingInput__star--selected":e.isSelected(t)})},t)}))}),void 0),(0,o.jsxs)("div",(0,_.__assign)({className:"RatingInput__hints"},{children:[(0,o.jsx)("div",{className:"RatingInput__hint--left",dangerouslySetInnerHTML:{__html:this.props.minHint}},void 0),(0,o.jsx)("div",{className:"RatingInput__hint--right",dangerouslySetInnerHTML:{__html:this.props.maxHint}},void 0)]}),void 0)]}),void 0)},t}(a.Component),h=i(56589),p=i(73947),b=i(64891),E=i(71516),m=function(e){function t(t){var i=e.call(this,t)||this;return i.close=i.close.bind(i),i.clickLink=i.clickLink.bind(i),i}return(0,_.__extends)(t,e),t.prototype.componentWillUnmount=function(){null===window||void 0===window||window.nav.reload()},t.prototype.close=function(){if(this.props.giftStatus){var e={act:"status",hash:this.props.hash};window.ajax.post("user_satisfaction_moderation.php",e,{onDone:function(){(0,s.destroyComponentInBox)()}})}else(0,s.destroyComponentInBox)()},t.prototype.clickLink=function(){(0,E.saveStatlogEvents)({name:"user_satisfaction_moderation_click",value:1,keys:["thanks_click_about","web"]})},t.prototype.render=function(){return(0,o.jsxs)("div",(0,_.__assign)({className:"StatusForm__box"},{children:[(0,o.jsx)(c,{},void 0),(0,o.jsx)("div",(0,_.__assign)({className:"StatusForm__imageContainer"},{children:(0,o.jsx)("img",{src:this.props.imageUrl},void 0)}),void 0),(0,o.jsx)("div",{className:"StatusForm__title",dangerouslySetInnerHTML:{__html:this.props.title}},void 0),(0,o.jsx)("div",{className:(0,d.classNames)("StatusForm__description",{"StatusForm__description--short":!this.props.giftStatus}),dangerouslySetInnerHTML:{__html:this.props.description}},void 0),(0,o.jsxs)("div",(0,_.__assign)({className:"StatusForm__actions"},{children:[(0,o.jsx)(r.default,{className:"StatusForm__actions--success",dangerouslySetInnerHTML:{__html:this.props.buttonText},onClick:this.close},void 0),(0,o.jsx)(b.default,(0,_.__assign)({href:this.props.linkUrl,className:"StatusForm__actions--link",onClick:this.clickLink,target:"_blank"},{children:this.props.linkText}),void 0)]}),void 0)]}),void 0)},t}(a.Component),C=function(e){function t(t){var i=e.call(this,t)||this;return i.state={question:0,answers:[]},i.nextQuestion=i.nextQuestion.bind(i),i.ratingChanged=i.ratingChanged.bind(i),i.answerChanged=i.answerChanged.bind(i),i.commentChanged=i.commentChanged.bind(i),i}return(0,_.__extends)(t,e),t.prototype.nextQuestion=function(){if(this.state.question<this.props.questions.length-1)this.setState({question:this.state.question+1});else{var e={act:"send",answers:JSON.stringify(this.state.answers),hash:this.props.hash};(0,s.destroyComponentInBox)(),window.ajax.post("user_satisfaction_moderation.php",e,{onDone:function(e){(0,s.showComponentInBox)((0,o.jsx)(m,{title:e.form.title,imageUrl:e.form.image_url,description:e.form.description,buttonText:e.form.button_text,linkText:e.form.link_text,linkUrl:e.form.link_url,giftStatus:e.gift_status,hash:e.hash},void 0))}})}},t.prototype.ratingChanged=function(e){var t=this.state.answers;t[this.state.question]={rating:e,value:void 0,comment:void 0},this.setState({answers:t})},t.prototype.answerChanged=function(e){var t=this.state.answers;t[this.state.question]={rating:void 0,value:e.selected.value,comment:void 0},this.setState({answers:t})},t.prototype.commentChanged=function(e){var t=this.state.answers,i=t[this.state.question]||{rating:void 0,value:void 0,comment:void 0},_=e.target.value.replace(/[\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF]/g,"");_.length>255||(i.comment=_,t[this.state.question]=i,this.setState({answers:t}))},t.prototype.getSelectedRating=function(){var e=this.state.answers[this.state.question];return e?e.rating:0},t.prototype.renderInput=function(e,t){var i,a;if(e.rating_answer)return(0,o.jsx)(f,{onChange:this.ratingChanged,selected:t,minHint:e.min_hint,maxHint:e.max_hint,description:this.props.choiceRating,className:"QuestionForm__ratingInput"},void 0);var r=this.state.answers[this.state.question],n=(null==r?void 0:r.value)!==(null===(i=e.text_area_on_answer)||void 0===i?void 0:i.toString())?(0,o.jsx)("div",(0,_.__assign)({className:"QuestionForm__dropDownHint"},{children:this.props.dropDownHint}),void 0):(0,o.jsx)(p.default,{grow:!1,placeholder:this.props.textAreaPlaceholder,className:"QuestionForm__comment",style:{height:86},onChange:this.commentChanged,value:(null==r?void 0:r.comment)||""},void 0),s=(null===(a=e.answers)||void 0===a?void 0:a.map((function(e,t){return{label:e,value:t+""}})))||[];return(0,o.jsxs)("div",(0,_.__assign)({className:"QuestionForm__dropDownContainer"},{children:[(0,o.jsx)(h.default,{placeholder:this.props.dropDownPlaceholder,onChange:this.answerChanged,value:null==r?void 0:r.value,appearance:"secondary",options:s,inputOtherProps:{className:"QuestionForm__selectInput"}},void 0),n]}),void 0)},t.prototype.buttonText=function(e){var t=this.state.answers[this.state.question];return t&&void 0!==(null==t?void 0:t.rating)||void 0!==(null==t?void 0:t.value)||void 0!==(null==t?void 0:t.comment)?e.button_text:e.button_text_on_empty||e.button_text},t.prototype.render=function(){if(!this.props.questions.length)return null;var e=this.props.questions[this.state.question],t=this.getSelectedRating(),i=e.is_required&&!t;return(0,o.jsxs)("div",(0,_.__assign)({className:"QuestionForm__box"},{children:[(0,o.jsx)(c,{},void 0),(0,o.jsx)("div",(0,_.__assign)({className:"QuestionForm__imageContainer"},{children:(0,o.jsx)("img",{src:e.icon_url},void 0)}),void 0),(0,o.jsx)("div",(0,_.__assign)({className:"QuestionForm__hint"},{children:e.number}),void 0),(0,o.jsx)("h2",{className:"QuestionForm__description",dangerouslySetInnerHTML:{__html:e.description}},void 0),this.renderInput(e,t),(0,o.jsx)("div",(0,_.__assign)({className:"QuestionForm__actionsRow"},{children:(0,o.jsx)(r.default,(0,_.__assign)({onClick:this.nextQuestion,className:"QuestionForm__button",disabled:i},{children:this.buttonText(e)}),void 0)}),void 0)]}),void 0)},t}(a.Component),g=function(e){function t(t){var i=e.call(this,t)||this;return i.showQuestions=i.showQuestions.bind(i),i}return(0,_.__extends)(t,e),t.prototype.showQuestions=function(){(0,s.destroyComponentInBox)(),(0,s.showComponentInBox)((0,o.jsx)(C,{hash:this.props.hash,questions:this.props.questions,choiceRating:this.props.form.choice_rating,dropDownHint:this.props.form.drop_down_hint,textAreaPlaceholder:this.props.form.text_area_placeholder,dropDownPlaceholder:this.props.form.drop_down_placeholder},void 0))},t.prototype.render=function(){return(0,o.jsxs)("div",(0,_.__assign)({className:"UserSatisfactionModeration__box"},{children:[(0,o.jsx)(c,{},void 0),(0,o.jsx)("div",(0,_.__assign)({className:"UserSatisfactionModeration__image"},{children:(0,o.jsx)("img",{src:this.props.form.image_url},void 0)}),void 0),(0,o.jsx)("h2",{className:"UserSatisfactionModeration__title",dangerouslySetInnerHTML:{__html:this.props.form.title}},void 0),(0,o.jsx)("div",{className:"UserSatisfactionModeration__description",dangerouslySetInnerHTML:{__html:this.props.form.description}},void 0),(0,o.jsx)(r.default,(0,_.__assign)({onClick:this.showQuestions,className:"UserSatisfactionModeration__button"},{children:this.props.form.button_text}),void 0)]}),void 0)},t}(a.Component)}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,i,_)=>{if(!t){var o=1/0;for(s=0;s<deferred.length;s++){for(var[t,i,_]=deferred[s],a=!0,r=0;r<t.length;r++)(!1&_||o>=_)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[r])))?t.splice(r--,1):(a=!1,_<o&&(o=_));if(a){deferred.splice(s--,1);var n=i();void 0!==n&&(e=n)}}return e}_=_||0;for(var s=deferred.length;s>0&&deferred[s-1][2]>_;s--)deferred[s]=deferred[s-1];deferred[s]=[t,i,_]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var _={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var o=2&t&&e;"object"==typeof o&&!~leafPrototypes.indexOf(o);o=getProto(o))Object.getOwnPropertyNames(o).forEach((t=>_[t]=()=>e[t]));return _.default=()=>e,__webpack_require__.d(i,_),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>56990===e?"vkui.0133dcd090142dd51f2c.js":49685===e?"redux.ac4d9ede197b2e60daf7.js":38288===e?"lottie.d6073f0bcab9a2f10c8d.js":91454===e?"0965445620e7eb48893c2bf2696c17a6.8e4c86cee97072909f31.js":26461===e?"1f01bdf2b5e5fd01c15943c0f5fbf9a8.77af123c0781c7d575df.js":83040===e?"de7ff8b84642a83ebcb5f52dc4f86ff6.f9c66b7d0de80788ee60.js":49154===e?"e7c3f5121c99841d270d0ef1ee074543.69971b8631e72fa77862.js":97474===e?"ac4c4c217b0f94690b343f2a810e66fc.f1de661053cdb8dffcb8.js":90729===e?"330f10ca7370f1ea8ecfb83c6419d845.2ce5c2e18ae1ab31f089.js":79542===e?"11c7a0efa74f6d488cf4ce0ffbe4d05a.b7fa677bc26d5ce62438.js":70306===e?"3ae78002d05d100ea57d5ee29ec63b89.dbe1cfdf7856228d5f72.js":68069===e?"b3c52704711ff506ec36e9c85b864ca9.b439d1872874bdf1d794.js":87595===e?"88729b1d8252e9abdf31a8698586f9d6.3feb4e72725e0e4c13a5.js":23299===e?"3bad6e117063d3681bf4f60574b483cc.08ff57fb23c566d04b8d.js":99138===e?"2b952f3ea411b7ed56134eb55f574493.ca1dfb5bebbb1ee48527.js":8719===e?"c565bd4c03935309f8a94999b93eb4f2.9e349d8d3be4fb620bbe.js":85780===e?"fastchat_reforged_v150.d64710e597d89330a89b.js":void 0,__webpack_require__.miniCssF=e=>8719===e?"c565bd4c03935309f8a94999b93eb4f2.01e62204b6a0e149c410.css":e+".3a6733820bd0688b67e5.css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,i,_)=>{if(inProgress[e])inProgress[e].push(t);else{var o,a;if(void 0!==i)for(var r=document.getElementsByTagName("script"),n=0;n<r.length;n++){var s=r[n];if(s.getAttribute("src")==e||s.getAttribute("data-webpack")=="vk:"+i){o=s;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack","vk:"+i),o.src=e),inProgress[e]=[t];var c=(t,i)=>{o.onerror=o.onload=null,clearTimeout(l);var _=inProgress[e];if(delete inProgress[e],o.parentNode&&o.parentNode.removeChild(o),_&&_.forEach((e=>e(i))),t)return t(i)},l=setTimeout(c.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=c.bind(null,o.onerror),o.onload=c.bind(null,o.onload),a&&document.head.appendChild(o)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,i)=>{var _=__webpack_require__.miniCssF(e),o=__webpack_require__.p+_;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),_=0;_<i.length;_++){var o=(r=i[_]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(o===e||o===t))return r}var a=document.getElementsByTagName("style");for(_=0;_<a.length;_++){var r;if((o=(r=a[_]).getAttribute("data-href"))===e||o===t)return r}})(_,o))return t();((e,t,i,_)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=a=>{if(o.onerror=o.onload=null,"load"===a.type)i();else{var r=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.href||t,s=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");s.code="CSS_CHUNK_LOAD_FAILED",s.type=r,s.request=n,o.parentNode.removeChild(o),_(s)}},o.href=t,document.head.appendChild(o)})(e,o,t,i)})),installedCssChunks={90675:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{8719:1,85780:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={90675:0};__webpack_require__.f.j=(t,i)=>{var _=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==_)if(_)i.push(_[2]);else{var o=new Promise(((i,o)=>_=e[t]=[i,o]));i.push(_[2]=o);var a=__webpack_require__.p+__webpack_require__.u(t),r=new Error;__webpack_require__.l(a,(i=>{if(__webpack_require__.o(e,t)&&(0!==(_=e[t])&&(e[t]=void 0),_)){var o=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",r.name="ChunkLoadError",r.type=o,r.request=a,_[1](r)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,i)=>{var _,o,[a,r,n]=i,s=0;for(_ in r)__webpack_require__.o(r,_)&&(__webpack_require__.m[_]=r[_]);if(n)var c=n(__webpack_require__);for(t&&t(i);s<a.length;s++)o=a[s],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[a[s]]=0;return __webpack_require__.O(c)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__=__webpack_require__.O(void 0,[76429,22897,75514,24509,40885,68592,77521,26001,21654],(()=>__webpack_require__(21880)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();